/*! (c) Philipp Koenig under MS-RSL */
(function(){"use strict";var e=window.Document.prototype.createElement,t=window.Document.prototype.createElementNS,a=window.Document.prototype.importNode,l=window.Document.prototype.prepend,r=window.Document.prototype.append,o=window.DocumentFragment.prototype.prepend,i=window.DocumentFragment.prototype.append,n=window.Node.prototype.cloneNode,s=window.Node.prototype.appendChild,d=window.Node.prototype.insertBefore,c=window.Node.prototype.removeChild,h=window.Node.prototype.replaceChild,p=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),m=window.Element.prototype.attachShadow,u=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),g=window.Element.prototype.getAttribute,f=window.Element.prototype.setAttribute,b=window.Element.prototype.removeAttribute,v=window.Element.prototype.getAttributeNS,y=window.Element.prototype.setAttributeNS,k=window.Element.prototype.removeAttributeNS,w=window.Element.prototype.insertAdjacentElement,C=window.Element.prototype.insertAdjacentHTML,x=window.Element.prototype.prepend,D=window.Element.prototype.append,_=window.Element.prototype.before,E=window.Element.prototype.after,T=window.Element.prototype.replaceWith,B=window.Element.prototype.remove,S=window.HTMLElement,A=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),L=window.HTMLElement.prototype.insertAdjacentElement,I=window.HTMLElement.prototype.insertAdjacentHTML,H=new Set;function P(e){var t=H.has(e);return e=/^[a-z][.0-9_a-z]*-[-.0-9_a-z]*$/.test(e),!t&&e}"annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ").forEach((function(e){return H.add(e)}));var O=document.contains?document.contains.bind(document):document.documentElement.contains.bind(document.documentElement);function M(e){var t=e.isConnected;if(void 0!==t)return t;if(O(e))return!0;for(;e&&!(e.__CE_isImportDocument||e instanceof Document);)e=e.parentNode||(window.ShadowRoot&&e instanceof ShadowRoot?e.host:void 0);return!(!e||!(e.__CE_isImportDocument||e instanceof Document))}function W(e){var t=e.children;if(t)return Array.prototype.slice.call(t);for(t=[],e=e.firstChild;e;e=e.nextSibling)e.nodeType===Node.ELEMENT_NODE&&t.push(e);return t}function j(e,t){for(;t&&t!==e&&!t.nextSibling;)t=t.parentNode;return t&&t!==e?t.nextSibling:null}function N(e,t,a){for(var l=e;l;){if(l.nodeType===Node.ELEMENT_NODE){var r=l;t(r);var o=r.localName;if("link"===o&&"import"===r.getAttribute("rel")){if(l=r.import,void 0===a&&(a=new Set),l instanceof Node&&!a.has(l))for(a.add(l),l=l.firstChild;l;l=l.nextSibling)N(l,t,a);l=j(e,r);continue}if("template"===o){l=j(e,r);continue}if(r=r.__CE_shadowRoot)for(r=r.firstChild;r;r=r.nextSibling)N(r,t,a)}l=l.firstChild?l.firstChild:j(e,l)}}function R(){var e=!(null==ne||!ne.noDocumentConstructionObserver),t=!(null==ne||!ne.shadyDomFastWalk);this.m=[],this.g=[],this.j=!1,this.shadyDomFastWalk=t,this.I=!e}function U(e,t,a,l){var r=window.ShadyDOM;if(e.shadyDomFastWalk&&r&&r.inUse){if(t.nodeType===Node.ELEMENT_NODE&&a(t),t.querySelectorAll)for(e=r.nativeMethods.querySelectorAll.call(t,"*"),t=0;t<e.length;t++)a(e[t])}else N(t,a,l)}function F(e,t){e.j&&U(e,t,(function(t){return q(e,t)}))}function q(e,t){if(e.j&&!t.__CE_patched){t.__CE_patched=!0;for(var a=0;a<e.m.length;a++)e.m[a](t);for(a=0;a<e.g.length;a++)e.g[a](t)}}function V(e,t){var a=[];for(U(e,t,(function(e){return a.push(e)})),t=0;t<a.length;t++){var l=a[t];1===l.__CE_state?e.connectedCallback(l):Y(e,l)}}function K(e,t){var a=[];for(U(e,t,(function(e){return a.push(e)})),t=0;t<a.length;t++){var l=a[t];1===l.__CE_state&&e.disconnectedCallback(l)}}function z(e,t,a){var l=(a=void 0===a?{}:a).J,r=a.upgrade||function(t){return Y(e,t)},o=[];for(U(e,t,(function(t){if(e.j&&q(e,t),"link"===t.localName&&"import"===t.getAttribute("rel")){var a=t.import;a instanceof Node&&(a.__CE_isImportDocument=!0,a.__CE_registry=document.__CE_registry),a&&"complete"===a.readyState?a.__CE_documentLoadHandled=!0:t.addEventListener("load",(function(){var a=t.import;if(!a.__CE_documentLoadHandled){a.__CE_documentLoadHandled=!0;var o=new Set;l&&(l.forEach((function(e){return o.add(e)})),o.delete(a)),z(e,a,{J:o,upgrade:r})}}))}else o.push(t)}),l),t=0;t<o.length;t++)r(o[t])}function Y(e,t){try{var a=t.ownerDocument,l=a.__CE_registry,r=l&&(a.defaultView||a.__CE_isImportDocument)?le(l,t.localName):void 0;if(r&&void 0===t.__CE_state){r.constructionStack.push(t);try{try{if(new r.constructorFunction!==t)throw Error("The custom element constructor did not produce the element being upgraded.")}finally{r.constructionStack.pop()}}catch(e){throw t.__CE_state=2,e}if(t.__CE_state=1,t.__CE_definition=r,r.attributeChangedCallback&&t.hasAttributes()){var o=r.observedAttributes;for(r=0;r<o.length;r++){var i=o[r],n=t.getAttribute(i);null!==n&&e.attributeChangedCallback(t,i,null,n,null)}}M(t)&&e.connectedCallback(t)}}catch(e){X(e)}}function $(a,l,r,o){var i=l.__CE_registry;if(i&&(null===o||"http://www.w3.org/1999/xhtml"===o)&&(i=le(i,r)))try{var n=new i.constructorFunction;if(void 0===n.__CE_state||void 0===n.__CE_definition)throw Error("Failed to construct '"+r+"': The returned value was not constructed with the HTMLElement constructor.");if("http://www.w3.org/1999/xhtml"!==n.namespaceURI)throw Error("Failed to construct '"+r+"': The constructed element's namespace must be the HTML namespace.");if(n.hasAttributes())throw Error("Failed to construct '"+r+"': The constructed element must not have any attributes.");if(null!==n.firstChild)throw Error("Failed to construct '"+r+"': The constructed element must not have any children.");if(null!==n.parentNode)throw Error("Failed to construct '"+r+"': The constructed element must not have a parent node.");if(n.ownerDocument!==l)throw Error("Failed to construct '"+r+"': The constructed element's owner document is incorrect.");if(n.localName!==r)throw Error("Failed to construct '"+r+"': The constructed element's local name is incorrect.");return n}catch(i){return X(i),l=null===o?e.call(l,r):t.call(l,o,r),Object.setPrototypeOf(l,HTMLUnknownElement.prototype),l.__CE_state=2,l.__CE_definition=void 0,q(a,l),l}return q(a,l=null===o?e.call(l,r):t.call(l,o,r)),l}function X(e){var t=e.message,a=e.sourceURL||e.fileName||"",l=e.line||e.lineNumber||0,r=e.column||e.columnNumber||0,o=void 0;void 0===ErrorEvent.prototype.initErrorEvent?o=new ErrorEvent("error",{cancelable:!0,message:t,filename:a,lineno:l,colno:r,error:e}):((o=document.createEvent("ErrorEvent")).initErrorEvent("error",!1,!0,t,a,l),o.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{configurable:!0,get:function(){return!0}})}),void 0===o.error&&Object.defineProperty(o,"error",{configurable:!0,enumerable:!0,get:function(){return e}}),window.dispatchEvent(o),o.defaultPrevented||console.error(e)}function G(){var e=this;this.g=void 0,this.F=new Promise((function(t){e.l=t}))}function J(e){var t=document;this.l=void 0,this.h=e,this.g=t,z(this.h,this.g),"loading"===this.g.readyState&&(this.l=new MutationObserver(this.G.bind(this)),this.l.observe(this.g,{childList:!0,subtree:!0}))}function Z(e){e.l&&e.l.disconnect()}function Q(e){this.s=new Map,this.u=new Map,this.C=new Map,this.A=!1,this.B=new Map,this.o=function(e){return e()},this.i=!1,this.v=[],this.h=e,this.D=e.I?new J(e):void 0}function ee(e,t){if(!P(t))throw new SyntaxError("The element name '"+t+"' is not valid.");if(le(e,t))throw Error("A custom element with name '"+t+"' has already been defined.");if(e.A)throw Error("A custom element is already being defined.")}function te(e,t,a){var l;e.A=!0;try{var r=a.prototype;if(!(r instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var o=function(e){var t=r[e];if(void 0!==t&&!(t instanceof Function))throw Error("The '"+e+"' callback must be a function.");return t},i=o("connectedCallback"),n=o("disconnectedCallback"),s=o("adoptedCallback"),d=(l=o("attributeChangedCallback"))&&a.observedAttributes||[]}catch(e){throw e}finally{e.A=!1}return a={localName:t,constructorFunction:a,connectedCallback:i,disconnectedCallback:n,adoptedCallback:s,attributeChangedCallback:l,observedAttributes:d,constructionStack:[]},e.u.set(t,a),e.C.set(a.constructorFunction,a),a}function ae(e){if(!1!==e.i){e.i=!1;for(var t=[],a=e.v,l=new Map,r=0;r<a.length;r++)l.set(a[r],[]);for(z(e.h,document,{upgrade:function(a){if(void 0===a.__CE_state){var r=a.localName,o=l.get(r);o?o.push(a):e.u.has(r)&&t.push(a)}}}),r=0;r<t.length;r++)Y(e.h,t[r]);for(r=0;r<a.length;r++){for(var o=a[r],i=l.get(o),n=0;n<i.length;n++)Y(e.h,i[n]);(o=e.B.get(o))&&o.resolve(void 0)}a.length=0}}function le(e,t){var a=e.u.get(t);if(a)return a;if(a=e.s.get(t)){e.s.delete(t);try{return te(e,t,a())}catch(e){X(e)}}}function re(e,t,a){function l(t){return function(a){for(var l=[],r=0;r<arguments.length;++r)l[r]=arguments[r];r=[];for(var o=[],i=0;i<l.length;i++){var n=l[i];if(n instanceof Element&&M(n)&&o.push(n),n instanceof DocumentFragment)for(n=n.firstChild;n;n=n.nextSibling)r.push(n);else r.push(n)}for(t.apply(this,l),l=0;l<o.length;l++)K(e,o[l]);if(M(this))for(l=0;l<r.length;l++)(o=r[l])instanceof Element&&V(e,o)}}void 0!==a.prepend&&(t.prepend=l(a.prepend)),void 0!==a.append&&(t.append=l(a.append))}function oe(e){function a(t,a){Object.defineProperty(t,"innerHTML",{enumerable:a.enumerable,configurable:!0,get:a.get,set:function(t){var l=this,r=void 0;if(M(this)&&(r=[],U(e,this,(function(e){e!==l&&r.push(e)}))),a.set.call(this,t),r)for(var o=0;o<r.length;o++){var i=r[o];1===i.__CE_state&&e.disconnectedCallback(i)}return this.ownerDocument.__CE_registry?z(e,this):F(e,this),t}})}function l(t,a){t.insertAdjacentElement=function(t,l){var r=M(l);return t=a.call(this,t,l),r&&K(e,l),M(t)&&V(e,l),t}}function r(t,a){function l(t,a){for(var l=[];t!==a;t=t.nextSibling)l.push(t);for(a=0;a<l.length;a++)z(e,l[a])}t.insertAdjacentHTML=function(e,t){if("beforebegin"===(e=e.toLowerCase())){var r=this.previousSibling;a.call(this,e,t),l(r||this.parentNode.firstChild,this)}else if("afterbegin"===e)r=this.firstChild,a.call(this,e,t),l(this.firstChild,r);else if("beforeend"===e)r=this.lastChild,a.call(this,e,t),l(r||this.firstChild,null);else{if("afterend"!==e)throw new SyntaxError("The value provided ("+String(e)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");r=this.nextSibling,a.call(this,e,t),l(this.nextSibling,r)}}}m&&(Element.prototype.attachShadow=function(t){if(t=m.call(this,t),e.j&&!t.__CE_patched){t.__CE_patched=!0;for(var a=0;a<e.m.length;a++)e.m[a](t)}return this.__CE_shadowRoot=t}),u&&u.get?a(Element.prototype,u):A&&A.get?a(HTMLElement.prototype,A):function(e,t){e.j=!0,e.g.push(t)}(e,(function(e){a(e,{enumerable:!0,configurable:!0,get:function(){return n.call(this,!0).innerHTML},set:function(e){var a="template"===this.localName,l=a?this.content:this,r=t.call(document,this.namespaceURI,this.localName);for(r.innerHTML=e;0<l.childNodes.length;)c.call(l,l.childNodes[0]);for(e=a?r.content:r;0<e.childNodes.length;)s.call(l,e.childNodes[0])}})})),Element.prototype.setAttribute=function(t,a){if(1!==this.__CE_state)return f.call(this,t,a);var l=g.call(this,t);f.call(this,t,a),a=g.call(this,t),e.attributeChangedCallback(this,t,l,a,null)},Element.prototype.setAttributeNS=function(t,a,l){if(1!==this.__CE_state)return y.call(this,t,a,l);var r=v.call(this,t,a);y.call(this,t,a,l),l=v.call(this,t,a),e.attributeChangedCallback(this,a,r,l,t)},Element.prototype.removeAttribute=function(t){if(1!==this.__CE_state)return b.call(this,t);var a=g.call(this,t);b.call(this,t),null!==a&&e.attributeChangedCallback(this,t,a,null,null)},Element.prototype.removeAttributeNS=function(t,a){if(1!==this.__CE_state)return k.call(this,t,a);var l=v.call(this,t,a);k.call(this,t,a);var r=v.call(this,t,a);l!==r&&e.attributeChangedCallback(this,a,l,r,t)},L?l(HTMLElement.prototype,L):w&&l(Element.prototype,w),I?r(HTMLElement.prototype,I):C&&r(Element.prototype,C),re(e,Element.prototype,{prepend:x,append:D}),function(e){function t(t){return function(a){for(var l=[],r=0;r<arguments.length;++r)l[r]=arguments[r];r=[];for(var o=[],i=0;i<l.length;i++){var n=l[i];if(n instanceof Element&&M(n)&&o.push(n),n instanceof DocumentFragment)for(n=n.firstChild;n;n=n.nextSibling)r.push(n);else r.push(n)}for(t.apply(this,l),l=0;l<o.length;l++)K(e,o[l]);if(M(this))for(l=0;l<r.length;l++)(o=r[l])instanceof Element&&V(e,o)}}var a=Element.prototype;void 0!==_&&(a.before=t(_)),void 0!==E&&(a.after=t(E)),void 0!==T&&(a.replaceWith=function(t){for(var a=[],l=0;l<arguments.length;++l)a[l]=arguments[l];l=[];for(var r=[],o=0;o<a.length;o++){var i=a[o];if(i instanceof Element&&M(i)&&r.push(i),i instanceof DocumentFragment)for(i=i.firstChild;i;i=i.nextSibling)l.push(i);else l.push(i)}for(o=M(this),T.apply(this,a),a=0;a<r.length;a++)K(e,r[a]);if(o)for(K(e,this),a=0;a<l.length;a++)(r=l[a])instanceof Element&&V(e,r)}),void 0!==B&&(a.remove=function(){var t=M(this);B.call(this),t&&K(e,this)})}(e)}R.prototype.connectedCallback=function(e){var t=e.__CE_definition;if(t.connectedCallback)try{t.connectedCallback.call(e)}catch(e){X(e)}},R.prototype.disconnectedCallback=function(e){var t=e.__CE_definition;if(t.disconnectedCallback)try{t.disconnectedCallback.call(e)}catch(e){X(e)}},R.prototype.attributeChangedCallback=function(e,t,a,l,r){var o=e.__CE_definition;if(o.attributeChangedCallback&&-1<o.observedAttributes.indexOf(t))try{o.attributeChangedCallback.call(e,t,a,l,r)}catch(e){X(e)}},G.prototype.resolve=function(e){if(this.g)throw Error("Already resolved.");this.g=e,this.l(e)},J.prototype.G=function(e){var t=this.g.readyState;for("interactive"!==t&&"complete"!==t||Z(this),t=0;t<e.length;t++)for(var a=e[t].addedNodes,l=0;l<a.length;l++)z(this.h,a[l])},Q.prototype.H=function(e,t){var a=this;if(!(t instanceof Function))throw new TypeError("Custom element constructor getters must be functions.");ee(this,e),this.s.set(e,t),this.v.push(e),this.i||(this.i=!0,this.o((function(){return ae(a)})))},Q.prototype.define=function(e,t){var a=this;if(!(t instanceof Function))throw new TypeError("Custom element constructors must be functions.");ee(this,e),te(this,e,t),this.v.push(e),this.i||(this.i=!0,this.o((function(){return ae(a)})))},Q.prototype.upgrade=function(e){z(this.h,e)},Q.prototype.get=function(e){if(e=le(this,e))return e.constructorFunction},Q.prototype.whenDefined=function(e){if(!P(e))return Promise.reject(new SyntaxError("'"+e+"' is not a valid custom element name."));var t=this.B.get(e);if(t)return t.F;t=new G,this.B.set(e,t);var a=this.u.has(e)||this.s.has(e);return e=-1===this.v.indexOf(e),a&&e&&t.resolve(void 0),t.F},Q.prototype.polyfillWrapFlushCallback=function(e){this.D&&Z(this.D);var t=this.o;this.o=function(a){return e((function(){return t(a)}))}},window.CustomElementRegistry=Q,Q.prototype.define=Q.prototype.define,Q.prototype.upgrade=Q.prototype.upgrade,Q.prototype.get=Q.prototype.get,Q.prototype.whenDefined=Q.prototype.whenDefined,Q.prototype.polyfillDefineLazy=Q.prototype.H,Q.prototype.polyfillWrapFlushCallback=Q.prototype.polyfillWrapFlushCallback;var ie={};var ne=window.customElements;function se(){var t=new R;!function(t){function a(){var a=this.constructor,l=document.__CE_registry.C.get(a);if(!l)throw Error("Failed to construct a custom element: The constructor was not registered with `customElements`.");var r=l.constructionStack;if(0===r.length)return r=e.call(document,l.localName),Object.setPrototypeOf(r,a.prototype),r.__CE_state=1,r.__CE_definition=l,q(t,r),r;var o=r.length-1,i=r[o];if(i===ie)throw Error("Failed to construct '"+l.localName+"': This element was already constructed.");return r[o]=ie,Object.setPrototypeOf(i,a.prototype),q(t,i),i}a.prototype=S.prototype,Object.defineProperty(HTMLElement.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:a}),window.HTMLElement=a}(t),function(e){Document.prototype.createElement=function(t){return $(e,this,t,null)},Document.prototype.importNode=function(t,l){return t=a.call(this,t,!!l),this.__CE_registry?z(e,t):F(e,t),t},Document.prototype.createElementNS=function(t,a){return $(e,this,a,t)},re(e,Document.prototype,{prepend:l,append:r})}(t),re(t,DocumentFragment.prototype,{prepend:o,append:i}),function(e){function t(t,a){Object.defineProperty(t,"textContent",{enumerable:a.enumerable,configurable:!0,get:a.get,set:function(t){if(this.nodeType===Node.TEXT_NODE)a.set.call(this,t);else{var l=void 0;if(this.firstChild){var r=this.childNodes,o=r.length;if(0<o&&M(this)){l=Array(o);for(var i=0;i<o;i++)l[i]=r[i]}}if(a.set.call(this,t),l)for(t=0;t<l.length;t++)K(e,l[t])}}})}Node.prototype.insertBefore=function(t,a){if(t instanceof DocumentFragment){var l=W(t);if(t=d.call(this,t,a),M(this))for(a=0;a<l.length;a++)V(e,l[a]);return t}return l=t instanceof Element&&M(t),a=d.call(this,t,a),l&&K(e,t),M(this)&&V(e,t),a},Node.prototype.appendChild=function(t){if(t instanceof DocumentFragment){var a=W(t);if(t=s.call(this,t),M(this))for(var l=0;l<a.length;l++)V(e,a[l]);return t}return a=t instanceof Element&&M(t),l=s.call(this,t),a&&K(e,t),M(this)&&V(e,t),l},Node.prototype.cloneNode=function(t){return t=n.call(this,!!t),this.ownerDocument.__CE_registry?z(e,t):F(e,t),t},Node.prototype.removeChild=function(t){var a=t instanceof Element&&M(t),l=c.call(this,t);return a&&K(e,t),l},Node.prototype.replaceChild=function(t,a){if(t instanceof DocumentFragment){var l=W(t);if(t=h.call(this,t,a),M(this))for(K(e,a),a=0;a<l.length;a++)V(e,l[a]);return t}l=t instanceof Element&&M(t);var r=h.call(this,t,a),o=M(this);return o&&K(e,a),l&&K(e,t),o&&V(e,t),r},p&&p.get?t(Node.prototype,p):function(e,t){e.j=!0,e.m.push(t)}(e,(function(e){t(e,{enumerable:!0,configurable:!0,get:function(){for(var e=[],t=this.firstChild;t;t=t.nextSibling)t.nodeType!==Node.COMMENT_NODE&&e.push(t.textContent);return e.join("")},set:function(e){for(;this.firstChild;)c.call(this,this.firstChild);null!=e&&""!==e&&s.call(this,document.createTextNode(e))}})}))}(t),oe(t),t=new Q(t),document.__CE_registry=t,Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:t})}ne&&!ne.forcePolyfill&&"function"==typeof ne.define&&"function"==typeof ne.get||se(),window.__CE_installPolyfill=se}).call(self),(()=>{"use strict";if(window.jsu)return!1;const e=[],t=document,a=new WeakMap,l=new WeakMap,r=Symbol(),o={delay:(e=0)=>new Promise((t=>{setTimeout(t,e)})),ua:()=>{let e="Other",t="Other";try{e=navigator.userAgentData.platform}catch(e){}try{let e=navigator.userAgentData.brands.filter((e=>!/^[^a-z]*NOT[^a-z]/i.test(e.brand)));e=e.filter((t=>"CHROMIUM"!==t.brand.toUpperCase()||1===e.length)),e.length>0&&(t=e[0].brand+" "+(e[0].version||""))}catch(e){}return{os:e.trim(),browser:t.trim()}},xhr:(t,a={})=>new Promise(((l,r)=>{const o=new XMLHttpRequest,i=e.push({url:t,xhr:o})-1;a.mimeType&&o.overrideMimeType(a.mimeType),o.open(a.method||"GET",t,!0),["load","error","timeout","abort"].forEach((t=>{o.addEventListener(t,(()=>{e[i]=null,"load"===t&&o.status<400?l(o):r(o)}))}));let n=null;a.data&&(n=new FormData,Object.entries(a.data).forEach((([e,t])=>{"object"==typeof t&&(t=JSON.stringify(t)),n.append(e,t)}))),a.files&&(null===n&&(n=new FormData),a.files.forEach((e=>{e.files.forEach((t=>{n.append(e.name+"[]",t)}))}))),a.header&&Object.entries(a.header).forEach((([e,t])=>{o.setRequestHeader(e,t)})),Object.entries(a).forEach((([e,t])=>{"method"!==e&&"data"!==e&&"header"!==e&&(o[e]=t)})),o.send(n)})),cancelXhr:(t=null)=>{e.forEach((e=>{e&&e.xhr&&e.xhr.readyState&&e.xhr.abort&&(null===t||e.url===t)&&(e.xhr.abort(),e=null)}))}};class i{constructor(e,a=!0){let l=e;if("string"==typeof e&&(!1===a||e.indexOf("<")>-1)){const a=t.createElement("div");a.innerHTML=e,l=a.childNodes}this._fillNodeList(l)}static _isDefined(e){return null!=e}static _forEach(e,t,a=!1){const l=e.length;if(a){for(let r=l-1;r>=0;r--)if(i._isDefined(e[r].forEach))i._forEach(e[r],t,a);else if(!1===t(e[r],r))break}else for(let r=0;r<l;r++)if(i._isDefined(e[r].forEach))i._forEach(e[r],t,a);else if(!1===t(e[r],r))break}_fillNodeList(e){if(i._isDefined(e))if(e instanceof i)this[r]=e.get();else if("string"==typeof e)this[r]=t.querySelectorAll(e);else if(e instanceof Node||e instanceof HTMLDocument||e instanceof Window)this[r]=[e];else if(e instanceof NodeList||e instanceof HTMLCollection)this[r]=e;else{if("object"!=typeof e)throw new DOMException("invalid parameter for jsu");this[r]=[],i._isDefined(e.forEach)||(e=[e]),e.forEach((e=>{if(null!==e){const t=e=>{-1===this[r].indexOf(e)&&this[r].push(e)};e instanceof i?e.forEach(t):Array.isArray(e)||e instanceof NodeList||e instanceof HTMLCollection||/^\[object (HTMLCollection|NodeList|Object)\]$/.test(e.toString())?i._forEach(e,t):this[r].push(e)}}))}else this[r]=[];this.forEach(((e,t)=>{this[t]=e}))}forEach(e,t=!1){return i._forEach(this[r],e,t),this}css(e,t){let a=!1;const l=i._isDefined(e),o=i._isDefined(t),n=[];return this.forEach((r=>{l&&o&&"string"==typeof e?(r.style[e]=t,a=!0):l&&("string"==typeof e?n.push(window.getComputedStyle(r)[e]):"object"==typeof e&&(a=!0,Object.keys(e).forEach((t=>{"string"==typeof t&&(r.style[t]=e[t])}))))})),a?this:this[r].length>1?n:n[0]}attr(e,t){let a=!1;const l=i._isDefined(e),o=i._isDefined(t),n=[];return this.forEach((r=>{const s=(e,t)=>{a=!0,i._isDefined(r[e])?r[e]=t:r.setAttribute(e,t)};var d;l&&o&&"string"==typeof e?s(e,t):l&&("string"==typeof e?n.push((d=e,i._isDefined(r[d])?r[d]:r.getAttribute(d))):"object"==typeof e&&Object.keys(e).forEach((t=>{"string"==typeof t&&s(t,e[t])})))})),a?this:this[r].length>1?n:n[0]}removeAttr(e){return this.forEach((t=>{t.removeAttribute(e)})),this}static _addEventListener(e,t){let l=a.get(e);i._isDefined(l)||(l={},a.set(e,l)),l[t.event]||(l[t.event]=[]),l[t.event].push({fn:t.fn,name:t.name||t.event+"_"+ +new Date+Math.random().toString(36).substring(2,14),opts:t.opts,wantsUntrusted:t.wantsUntrusted}),e.addEventListener(t.event,t.fn,t.opts,t.wantsUntrusted)}static _cloneEventListener(e,t){const l=a.get(e);i._isDefined(l)&&Object.keys(l).forEach((e=>{l[e].forEach((a=>{i._addEventListener(t,{event:e,fn:a.fn,opts:a.opts,wantsUntrusted:a.wantsUntrusted})}))})),t.children&&i._forEach(t.children,((t,a)=>{i._cloneEventListener(e.children[a],t)}))}static _addData(e,t,a){let r=l.get(e);i._isDefined(r)||(r={},l.set(e,r)),r[t]=a}static _cloneData(e,t){const a=l.get(e);i._isDefined(a)&&Object.keys(a).forEach((e=>{i._addData(t,e,a[e])})),t.children&&i._forEach(t.children,((t,a)=>{i._cloneData(e.children[a],t)}))}static _cloneElement(e){const t=[];return e.forEach((e=>{const a=e.cloneNode(!0);i._cloneEventListener(e,a),i._cloneData(e,a),t.push(a)})),new i(t)}clone(){return i._cloneElement(this)}data(e,t){let a=!1;const o=i._isDefined(e),n=i._isDefined(t),s=[];return this.forEach((r=>{const d=l.get(r),c=i._isDefined(d);o&&n?(a=!0,i._addData(r,e,t)):o?"string"==typeof e?s.push(c?d[e]:void 0):"object"==typeof e&&(a=!0,Object.keys(e).forEach((t=>{"string"==typeof t&&i._addData(r,t,e[t])}))):s.push(c?d:{})})),a?this:this[r].length>1?s:s[0]}removeData(e){const t=!i._isDefined(e);return this.forEach((a=>{const r=l.get(a);i._isDefined(r)&&(t?l.delete(a):i._isDefined(r[e])&&delete r[e])})),this}on(e,t,a,l,r){const o=(e,t)=>{Object.keys(t).forEach((a=>{try{Object.defineProperty(e,a,{value:t[a]})}catch(e){}}))};let n=a;"function"==typeof a?n=l:r=l,void 0===n&&(n=null),void 0===r&&(r=null);const s="string"==typeof t;return this.forEach((l=>{e.split(/\s+/g).forEach((e=>{const d=e.split(/\./);i._addEventListener(l,{event:d[0],name:d[1],fn:e=>{if(o(e,{type:d[0]}),s){const r={preventDefault:()=>{e.preventDefault()},stopPropagation:()=>{e.stopPropagation()}};i._forEach(l.querySelectorAll(":scope "+t),(t=>{let i=e.target;for(;i&&i!==l;){if(i===t){const t=d[0].startsWith("key")?new KeyboardEvent(d[0],e):new MouseEvent(d[0],e);o(t,{preventDefault:r.preventDefault,stopPropagation:r.stopPropagation,currentTarget:i,target:e.target}),a(t)}i=i.parentNode}}))}else"function"==typeof t&&t(e)},opts:n,wantsUntrusted:r})}))}),!0),this}off(e){return this.forEach((t=>{const l=a.get(t);if(i._isDefined(l)){e.split(/\s+/g).forEach((e=>{const a=e.split(/\./);"*"===a[0]?Object.entries(l).forEach((([e,r])=>{i._forEach(r,((r,o)=>{void 0!==a[1]&&a[1]!==r.name||(t.removeEventListener(e,r.fn),l[e].splice(o,1))}),!0)})):l[a[0]]&&i._forEach(l[a[0]],((e,r)=>{void 0!==a[1]&&a[1]!==e.name||(t.removeEventListener(a[0],e.fn),l[a[0]].splice(r,1))}),!0)}))}})),this}trigger(e,t){return e.split(/\s+/g).forEach((e=>{const a=e.split(/\./),l=new CustomEvent(a[0],t);this.forEach((e=>{e.dispatchEvent(l)}))})),this}addClass(e){return"object"!=typeof e&&(e=[e]),this.forEach((t=>{e.forEach((e=>{t.classList.contains(e)||t.classList.add(e)}))})),this}removeClass(e){return"object"!=typeof e&&(e=[e]),this.forEach((t=>{e.forEach((e=>{t.classList.contains(e)&&t.classList.remove(e)}))})),this}toggleClass(e){return this.forEach((t=>{t.classList.toggle(e)})),this}hasClass(e){const t=[];return this.forEach((a=>{t.push(a.classList.contains(e))})),this[r].length>1?t:t[0]}_realDimension(e,t=!1){const a=[];let l="width",o=["left","right"];return"h"===e&&(l="height",o=["top","bottom"]),this.forEach((e=>{const r=e.getBoundingClientRect(),i=window.getComputedStyle(e);let n=parseFloat((r[l]+"").replace(/,/g,"."));t&&o.forEach((e=>{const t=i.getPropertyValue("margin-"+e);n+=parseFloat((t+"").replace(/,/g,"."))})),a.push(n)})),this[r].length>1?a:a[0]}realWidth(e=!1){return this._realDimension("w",e)}realHeight(e=!1){return this._realDimension("h",e)}find(e){const t=[];return this.forEach((a=>{a instanceof HTMLIFrameElement?t.push(a.contentDocument.querySelectorAll(":scope "+e)):t.push(a.querySelectorAll(":scope "+e))})),new i(t)}children(e){const t=[];return e||(e="*"),this.forEach((a=>{t.push(a.querySelectorAll(":scope > "+e))})),new i(t)}_htmlText(e,t){const a=i._isDefined(e);let l=a?this:"";return this.forEach((r=>{a?r[t]=e:l+=r[t]})),l}html(e){return this._htmlText(e,"innerHTML")}text(e){return this._htmlText(e,"innerText")}remove(){this.forEach((e=>{e&&e.parentElement&&(a.delete(e),l.delete(e),e.parentElement.removeChild(e))}))}_moveElement(e,t,a=!0){if(Array.isArray(e))e.forEach((e=>{this._moveElement(e,t,a)}));else{"string"==typeof e&&e.indexOf("<")>-1&&(a=!1);const l=new i(e,a);this.forEach((e=>{i._cloneElement(l).forEach((a=>{switch(t){case"append":e.appendChild(a);break;case"prepend":e.insertBefore(a,e.firstChild);break;case"before":e.parentNode.insertBefore(a,e);break;case"after":e.parentNode.insertBefore(a,e.nextSibling)}}))})),l.remove()}return this}_moveElementTo(e,t){const a=[];return new i(e).forEach((e=>{i._cloneElement(this).forEach((l=>{switch(t){case"append":e.appendChild(l);break;case"prepend":e.insertBefore(l,e.firstChild);break;case"before":e.parentNode.insertBefore(l,e);break;case"after":e.parentNode.insertBefore(l,e.nextSibling)}a.push(l)}))})),this.remove(),new i(a)}append(e,t){return this._moveElement(e,"append",t)}appendTo(e){return this._moveElementTo(e,"append")}prepend(e,t=!0){return this._moveElement(e,"prepend",t)}prependTo(e){return this._moveElementTo(e,"prepend")}before(e,t=!0){return this._moveElement(e,"before",t)}insertBefore(e){return this._moveElementTo(e,"before")}after(e,t=!0){return this._moveElement(e,"after",t)}insertAfter(e){return this._moveElementTo(e,"after")}_nextPrev(e,t){const a=i._isDefined(e),l=[];return this.forEach((r=>{const o="prev"===t?r.previousElementSibling:r.nextElementSibling;i._isDefined(o)&&(!a||i._isDefined(o.matches)&&o.matches(e))&&l.push(o)})),new i(l)}next(e){return this._nextPrev(e,"next")}prev(e){return this._nextPrev(e,"prev")}_siblings(e,t="siblings"){const a=i._isDefined(e),l=[];return this.forEach((r=>{let o=null;const n=[];for("siblings"===t&&r.parentNode.firstElementChild?(o=r.parentNode.firstElementChild,t="next"):"previous"!==t&&"next"!==t||(o=r[t+"ElementSibling"]);o&&o.matches;)o===r||a&&!o.matches(e)||n.push(o),o=o[t+"ElementSibling"];l.push(new i(n))})),this[r].length>1?new i(l):l[0]}siblings(e){return this._siblings(e)}nextAll(e){return this._siblings(e,"next")}prevAll(e){return this._siblings(e,"previous")}parent(e){const t=i._isDefined(e),a=[];return this.forEach((l=>{let r=l.parentNode;!t||i._isDefined(r.matches)&&r.matches(e)||(r=null),a.push(new i(r))})),this[r].length>1?new i(a):a[0]}parents(e){const t=i._isDefined(e),a=[];return this.forEach((l=>{const r=[];let o=l.parentNode;for(;o&&o.matches&&o!==this;)t&&!o.matches(e)||r.push(o),o=o.parentNode;a.push(new i(r))})),this[r].length>1?new i(a):a[0]}document(){const e=[];return this.forEach((t=>{e.push(new i(t.ownerDocument))})),this[r].length>1?new i(e):e[0]}eq(e){return e<0&&(e=this[r].length+e),new i(this[r][e])}get(e){return i._isDefined(e)?(e<0&&(e=this[r].length+e),this[r][e]):this[r]}length(){return this[r].length}}(()=>{const e=e=>new i(e);Object.entries(o).forEach((([t,a])=>{e[t]=a})),window.jsu=e})()})(),(e=>{"use strict";e.api=chrome,e.opts={ids:{page:{iframe:"redeviation-bs-sidebar",overlay:"redeviation-bs-overlay",newtab:"redeviation-bs-newtab",indicator:"redeviation-bs-indicator"},sidebar:{sidebar:"sidebar",infoBox:"infoBox",bookmarkBox:{all:"bookmarkBox",search:"bookmarkBoxSearch"}},overlay:{urlCheckResult:"results"}},classes:{active:"active",visible:"visible",hidden:"hidden",disabled:"disabled",success:"success",selected:"selected",premium:"premium",error:"error",info:"info",add:"add",cancel:"cancel",close:"close",hover:"hover",loading:"loading",building:"building",initLoading:"initLoading",page:{dark:"dark",visible:"redeviation-bs-visible",hideMask:"redeviation-bs-hideMask",hover:"redeviation-bs-hover",noscroll:"redeviation-bs-noscroll",hasLeftsideBack:"redeviation-bs-has-lsb",style:"redeviation-bs-style",fullHeight:"redeviation-bs-fullHeight",noAnimations:"noAnimations",highContrast:"highContrast"},sidebar:{extLoaded:"loaded",selectionMode:"selectionMode",openedOnce:"openedOnce",sidepanel:"sidepanel",permanent:"permanent",cached:"cached",mark:"mark",hideRoot:"hideRoot",dirAnimated:"animated",dirOpened:"opened",dirArrow:"has-arrow",bookmarkDir:"dir",dirIcon:"icon",separator:"separator",bookmarkLink:"link",bookmarkLabel:"label",entryPinned:"pinned",menu:"menu",sort:"sort",fixed:"fixed",lockPinned:"lockPinned",lastHover:"lastHover",copied:"copied",filterBox:"filter",search:"search",searchBox:"searchBox",searchClose:"searchClose",searchVisible:"searchVisible",breadcrumb:"breadcrumb",removeSelected:"removeSelected",openSelected:"openSelected",removeMask:"removeMask",removed:"removed",restored:"restored"},tooltip:{wrapper:"tooltip"},contextmenu:{wrapper:"contextmenu",top:"top",list:"list",icons:"icons",right:"right",separator:"separator"},drag:{trigger:"drag",helper:"dragHelper",isDragged:"isDragged",cancel:"dragCancel",dragHover:"dragHover",snap:"snap",dragInitial:"dragInitial"},scrollBox:{wrapper:"scrollBox",hideScrollbar:"hideScrollbar",scrolled:"scrolled"},checkbox:{box:"checkbox",clicked:"clicked",focus:"focus"},overlay:{modal:"modal",preview:"preview",previewUrl:"previewUrl",action:"action",progressBar:"progressBar",buttonWrapper:"buttons",checkUrlProgressLabel:"progressLabel",urlCheckLoading:"urlCheckLoading",urlCheckCategories:"categories",urlCheckAction:"urlCheckAction",urlCheckHide:"urlCheckHide",urlCheckResults:"urlCheckResults"},newtab:{customBackground:"customBackground",smallContent:"small",suggestions:"suggestions",edit:"edit",link:"link",editLinkTooltip:"editLinkTooltip",permanentSidebar:"permanentSidebar",listening:"listening",remove:"remove",infoBar:"infoBar",upload:"upload",save:"save"},onboarding:{slide:"slide",skip:"skip",close:"close",settings:"settings",toggleArea:"toggleArea",appearance:"appearance",finished:"finished",highlightIcon:"highlightIcon",hideOpenTypeIcon:"hideOpenType",video:"video",large:"large",small:"small"},settings:{tabs:{content:"tab"},color:{field:"color",mask:"colorMask"},radio:{wrapper:"radioWrapper"},translation:{select:"languageSelect",category:"category",thanks:"thanks",edit:"edit",progress:"progress",mark:"mark",requiredInfo:"requiredInfo",amountInfo:"amountInfo",empty:"empty",back:"back",goto:"goto"},toggleArea:{fullHeight:"fullHeight",dragged:"dragged",dragging:"dragging"},appearance:{preview:{fullHeight:"redeviation-bs-fullHeight"}},support:{onlySuggestions:"onlySuggestions",answer:"answer",noHeight:"noHeight",absolute:"absolute"},hideable:"hideable",inactive:"inactive",revert:"revert",highlight:"highlight",lazyloaded:"lazyloaded",sub:"sub",desc:"desc",box:"box",dialog:"dialog",boxWrapper:"boxWrapper",contentBox:"contentBox",incomplete:"incomplete",suggestion:"suggestion"}},attr:{uid:"data-redeviation-bs-uid",src:"data-src",position:"data-pos",type:"data-type",name:"data-name",value:"data-value",theme:"data-theme",sort:"data-sort",direction:"data-direction",style:"data-style",id:"data-id",i18n:"data-i18n",i18nReplaces:"data-i18nReplaces",onboarding:{openType:"data-openType",surface:"data-surface"},settings:{appearance:"data-appearance",success:"data-successtext",hideOnFalse:"data-hideOnFalse",save:"data-save",restore:"data-restore",range:{min:"data-min",max:"data-max",step:"data-step",unit:"data-unit",infinity:"data-infinity"},color:{alpha:"data-alpha",suggestions:"data-suggestions"},field:{placeholder:"data-placeholder"},translation:{releaseStatus:"data-status",language:"data-lang"}}},events:{loaded:"redeviation-bs-loaded",elementsCreated:"redeviation-bs-created",openSidebar:"redeviation-bs-sidebar-open",sidebarOpened:"redeviation-bs-sidebar-opened",overlayClosed:"redeviation-bs-overlay-closed",systemColorChanged:"redeviation-bs-system-color-changed",checkboxChanged:"redeviation-bs-checkbox-changed",scrollBoxLastPart:"redeviation-bs-scrollbox-lastpart",premiumPurchased:"redeviation-bs-premiumPurchased",showFeedbackForm:"redeviation-bs-feedback",lsbLoaded:"redeviation-lsb-loaded",pageChanged:"redeviation-bs-pageChanged"},website:{info:{landing:"https://extensions.redeviation.com/",privacyPolicy:"https://extensions.redeviation.com/privacy/bs",changelog:"https://extensions.redeviation.com/changelog/bs",uninstall:"https://extensions.redeviation.com/uninstall/bs"},premium:{checkout:"https://extensions.redeviation.com/premium/bs/checkout",checkLicenseKey:"https://extensions.redeviation.com/ajax/premium/bs/check"},feedback:{form:"https://extensions.redeviation.com/ajax/feedback",suggestions:"https://extensions.redeviation.com/ajax/feedback/suggestions"},translation:{info:"https://extensions.redeviation.com/ajax/translation/bs/info",langvars:"https://extensions.redeviation.com/ajax/translation/bs/langvars",submit:"https://extensions.redeviation.com/ajax/translation/bs/submit"},api:{checkStatus:"https://extensions.redeviation.com/ajax/status/bs",evaluate:"https://extensions.redeviation.com/api/evaluate/log"}},urlAliases:{Edge:{"chrome://newtab/":"edge://newtab/","chrome://bookmarks":"edge://favorites","chrome://extensions/shortcuts":"edge://extensions/shortcuts","chrome://settings/syncSetup":"edge://settings/profiles/sync","https://extensions.redeviation.com/img/illustration/video_sidepanel.mp4":"https://extensions.redeviation.com/img/illustration/edge/video_sidepanel.mp4","https://extensions.redeviation.com/img/illustration/video_overlay.mp4":"https://extensions.redeviation.com/img/illustration/edge/video_overlay.mp4"},Opera:{"chrome://newtab/":"chrome://startpageshared/","chrome://bookmarks":"opera://bookmarks","chrome://extensions/shortcuts":"opera://settings/keyboardShortcuts"}},leftsideBackSelector:"div#redeviation-lsb-indicator.redeviation-lsb-visible",manifest:e.api.runtime.getManifest(),demoMode:!1},e.isDev="Dev"===e.opts.manifest.version_name||!("update_url"in e.opts.manifest),e.copyrightDate=2016,e.browserName="Chrome",/EDG\//i.test(navigator.userAgent)?e.browserName="Edge":/OPERA|OPR\//i.test(navigator.userAgent)?e.browserName="Opera":/FIREFOX\//i.test(navigator.userAgent)&&(e.api=browser,e.browserName="Firefox"),e.cl=e.opts.classes,e.attr=e.opts.attr,e.BookmarkHelper=function(t){this.removeEntry=async a=>{const l=t.helper.entry.getDataById(a);if(l&&l.url){const a=t.helper.list.getActiveBookmarkBox().find("a["+e.attr.id+"='"+l.id+"']");a.data("restore",l);let r=8;const o=e("<span></span>").addClass(e.cl.sidebar.removeMask).append("<em>"+t.helper.i18n.get("sidebar_deleted")+"</em>").append("<span>"+t.helper.i18n.get("sidebar_undo_deletion")+" ("+(r+1)+")</span>").appendTo(a),i=o.children("span"),n=setInterval((()=>{(r<0||0===i.length())&&(clearInterval(n),a.remove()),i.text(t.helper.i18n.get("sidebar_undo_deletion")+" ("+r+")"),r-=1}),1e3);e.delay(100).then((()=>{a.addClass(e.cl.sidebar.removed),o.children("span")[0].offsetTop>0&&o.children("em").remove()})),t.helper.selection.deselect(l.id),await this.performDeletion(l.id,!0)}else t.helper.overlay.create("delete",t.helper.i18n.get("contextmenu_delete_dir"),l)},this.editEntry=async e=>{const a=t.helper.model.getData("u/additionalInfo");a[e.id]={desc:e.additionalInfo};const l=await t.helper.model.call("updateBookmark",{id:e.id,title:e.title,url:e.url,preventReload:!0});return await t.helper.model.setData({"u/additionalInfo":a}),l},this.restoreEntry=async a=>{if(a&&a.length()>0){const l=a.data("restore");a.removeClass(e.cl.sidebar.removed).addClass(e.cl.sidebar.restored),await e.delay(500),a.children("span."+e.cl.sidebar.removeMask).remove();const r=await t.helper.model.call("createBookmark",l),o=[];if(r&&r.created){a.attr(e.attr.id,r.created);const i=t.helper.model.getData("u/additionalInfo");i[l.id]&&(i[r.created]=i[l.id],o.push(t.helper.model.setData({"u/additionalInfo":i})))}o.push(t.helper.entry.init()),await Promise.all(o)}},this.performDeletion=async(e,a=!1)=>{await t.helper.model.call("deleteBookmark",{id:e,preventReload:a})},this.pinEntry=async e=>{const l=t.helper.model.getData("u/pinnedEntries");let r=-1;Object.values(l).forEach((e=>{r=Math.max(r,e.index)})),l[e.id]={index:r+1},await a(l)},this.unpinEntry=async e=>{const l=t.helper.model.getData("u/pinnedEntries");delete l[e.id],await a(l)},this.getBookmarkIndexInDirectory=async(e,a)=>{const l=await t.helper.model.call("bookmarks",{id:a});if(l.bookmarks&&l.bookmarks[0]&&l.bookmarks[0].children){const r=t.helper.model.getData("u/sort"),o=t.helper.entry.getDataById(e),i=l.bookmarks[0].children;return a!==o.parentId&&(i.push(o),o.parentId=a),t.helper.utility.sortEntries(i,r),i.findIndex((t=>e===t.id))}return-1},this.reorderPinnedEntries=async e=>{const l=t.helper.model.getData("u/pinnedEntries");let r=0;if(e.prevId){const a=t.helper.entry.getDataById(e.prevId);r=a.pinnedIndex+1}Object.keys(l).forEach((a=>{+a==+e.id?(l[a].index=r,t.helper.entry.addData(a,"pinnedIndex",r)):l[a].index>=r&&(l[a].index++,t.helper.entry.addData(a,"pinnedIndex",l[a].index))})),await a(l)};const a=async e=>{await Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"}),t.helper.model.setData({"u/pinnedEntries":e})])}},e.CheckboxHelper=function(t){const a={};this.get=(t,a,l="checkbox",r="default")=>{const o=e("<div></div>").html("<input type='checkbox' />").data("uid",Math.random().toString(36).substring(2,14)).attr(e.attr.type,l).attr(e.attr.style,r).addClass(e.cl.checkbox.box);return a&&(o.children("input[type='checkbox']").attr(a),a[e.attr.name]&&o.attr(e.attr.name,a[e.attr.name])),this.isChecked(o)&&o.addClass(e.cl.active),this.initEvents(o,t),o},this.initEvents=(t,a)=>{t.on("mousedown",(t=>{t.preventDefault(),t.stopPropagation(),e(t.currentTarget).addClass(e.cl.checkbox.focus)})).on("click",(t=>{t.preventDefault(),t.stopPropagation(),r(e(t.currentTarget),a)})),a.on("click",(()=>{t.removeClass(e.cl.checkbox.focus)}))},this.isChecked=e=>e.find("input[type='checkbox']")[0].checked;const l=(a,l)=>{const r=a.children("input[type='checkbox']");r.trigger("change"),t.helper.utility&&t.helper.utility.triggerEvent("checkboxChanged",{container:a,checkbox:r,checked:a.hasClass(e.cl.active)},l.document()[0])},r=(t,o)=>{t.addClass(e.cl.checkbox.clicked),t.removeClass(e.cl.checkbox.focus),t.toggleClass(e.cl.active);const i=t.hasClass(e.cl.active),n=t.children("input[type='checkbox']");if("radio"===t.attr(e.attr.type)&&t.attr(e.attr.name))if(o){const a=t.attr(e.attr.name);t.addClass(e.cl.active),i&&(n.attr("checked",!0),l(t,o)),o.find("div."+e.cl.checkbox.box+"["+e.attr.type+"='radio']["+e.attr.name+"='"+a+"']").forEach((a=>{const l=e(a);a!==t[0]&&this.isChecked(l)&&r(l)}))}else n.attr("checked",!1);else n.attr("checked",i),l(t,o);const s=t.data("uid");a[s]&&clearTimeout(a[s]),a[s]=setTimeout((()=>{t.removeClass(e.cl.checkbox.clicked)}),300)}},e.ContextmenuHelper=function(t){let a=null,l=0,r=null;const o={};this.create=async(r,o)=>{const p=t.helper.model.getData(["b/sidebarPosition","a/styles"]);if(a=p.sidebarPosition,p.styles&&p.styles.sidebarWidth&&(l=parseInt(p.styles.sidebarWidth)),t.helper.toggle.addSidebarHoverClass(),t.helper.tooltip.close(),i(r,o))"menu"!==r&&"sort"!==r||this.close();else{this.close(),o.addClass(e.cl.active);const a=e("<div></div>").addClass(e.cl.contextmenu.wrapper).html("<ul class='"+e.cl.contextmenu.list+"'></ul><ul class='"+e.cl.contextmenu.icons+"'></ul>").attr(e.attr.type,r).data("elm",o).appendTo(t.elm.sidebar);let l=r;const i=o.attr(e.attr.id);switch(i&&a.attr(e.attr.id,i),r){case"list":{c(a,o);const e=t.helper.entry.getDataById(i);l=e&&e.isDir?"directory":"bookmark";break}case"separator":d(a,o);break;case"menu":s(a,o);break;case"sort":n(a,o)}u(a),h(a,o,r),await e.delay(),a.addClass(e.cl.visible)}},this.close=async()=>{const a=t.elm.iframeBody.find("div."+e.cl.contextmenu.wrapper);a.forEach((t=>{e(t).removeClass(e.cl.visible),e(t).data("elm").removeClass(e.cl.active)})),await e.delay(500),a.remove(),t.helper.toggle.removeSidebarHoverClass()};const i=(a,l)=>{const r=l.attr(e.attr.id),o=l.attr(e.attr.value);let i="div."+e.cl.contextmenu.wrapper+"["+e.attr.type+"='"+a+"']";return r?i+="["+e.attr.id+"='"+r+"']":o&&(i+="["+e.attr.value+"='"+o+"']"),t.elm.sidebar.find(i).length()>0},n=a=>{const l=t.helper.utility.getSortList(),r=t.helper.list.getSort(),o=a.children("ul."+e.cl.contextmenu.list);a.children("ul."+e.cl.contextmenu.icons).remove(),Object.keys(l).forEach((l=>{const i=l.replace(/([A-Z])/g,"_$1").toLowerCase();e("<li></li>").append(t.helper.checkbox.get(t.elm.iframeBody,{[e.attr.name]:"sort",[e.attr.value]:l},"radio")).append("<a "+e.attr.name+"='sort'>"+t.helper.i18n.get("sort_label_"+i)+"</a>").appendTo(o),l===r.name&&a.find("input["+e.attr.name+"='sort']["+e.attr.value+"='"+l+"']").parent("div."+e.cl.checkbox.box).trigger("click")}))},s=a=>{const l=a.children("ul."+e.cl.contextmenu.list),r=a.children("ul."+e.cl.contextmenu.icons);e("<li></li>").append(t.helper.checkbox.get(t.elm.iframeBody,{[e.attr.name]:"toggleHidden"})).append("<a "+e.attr.name+"='toggleHidden'>"+t.helper.i18n.get("contextmenu_toggle_hidden")+"</a>").appendTo(l),t.helper.model.getData("u/showHidden")&&a.find("input["+e.attr.name+"='toggleHidden']").parent("div."+e.cl.checkbox.box).trigger("click"),e("<li></li>").append("<a "+e.attr.name+"='select'>"+t.helper.i18n.get("contextmenu_select_entries")+"</a>").appendTo(l),e("<li></li>").append("<a "+e.attr.name+"='reload'>"+t.helper.i18n.get("contextmenu_reload_sidebar")+"</a>").appendTo(l);const o=t.elm.bookmarkBox.all.children("ul"),i=o.hasClass(e.cl.sidebar.hideRoot);let n=!1;o.find("a."+e.cl.sidebar.dirOpened).forEach((t=>{if(!1===i||e(t).parents("li").length()>1)return n=!0,!1})),n&&e("<li></li>").append("<a "+e.attr.name+"='closeAll'>"+t.helper.i18n.get("contextmenu_close_all_directories")+"</a>").appendTo(l),r.append("<li><a "+e.attr.name+"='settings' title='"+t.helper.i18n.get("settings_title",null,!0)+"'></a></li>").append("<li><a "+e.attr.name+"='bookmarkManager' title='"+t.helper.i18n.get("contextmenu_bookmark_manager",null,!0)+"'></a></li>").append("<li class='"+e.cl.contextmenu.right+"'><a "+e.attr.name+"='keyboardShortcuts' title='"+t.helper.i18n.get("contextmenu_keyboard_shortcuts",null,!0)+"'></a></li>")},d=(a,l)=>{const r=l.attr(e.attr.id),o=t.helper.entry.getDataById(r);if(o&&o.parents&&o.parents.length>0){const l=a.children("ul."+e.cl.contextmenu.list);l.append("<li><a "+e.attr.name+"='edit'>"+t.helper.i18n.get("contextmenu_edit_separator")+"</a></li>"),l.append("<li><a "+e.attr.name+"='delete'>"+t.helper.i18n.get("contextmenu_delete_separator")+"</a></li>")}a.children("ul."+e.cl.contextmenu.icons).remove()},c=(a,l)=>{const r=l.attr(e.attr.id),o=t.helper.entry.getDataById(r);if(!o)return;const i=t.helper.model.getData("u/sort"),n=o.isDir?"_dir":"_bookmark",s=a.children("ul."+e.cl.contextmenu.list),d=a.children("ul."+e.cl.contextmenu.icons),c=l.parents("div."+e.cl.sidebar.entryPinned).length()>0;if(t.helper.search.isResultsVisible()&&s.append("<li><a "+e.attr.name+"='showInDir'>"+t.helper.i18n.get("contextmenu_show_in_dir")+"</a></li>"),o.isDir){const a=o.children.filter((e=>e.url&&!e.url.startsWith("about:blank")));s.append("<li><a "+e.attr.name+"='add' "+e.attr.type+"='bookmark'>"+t.helper.i18n.get("contextmenu_add_bookmark")+"</a></li>"),a.length>0&&s.append("<li><a "+e.attr.name+"='openChildren'>"+t.helper.i18n.get("contextmenu_open_children")+" <span>("+a.length+")</span></a></li>"),o.children.length>0&&s.append("<li><a "+e.attr.name+"='checkBookmarks'>"+t.helper.i18n.get("contextmenu_check_bookmarks")+"</a></li>")}else"newtab"===t.helper.model.getData("b/linkAction")?s.append("<li><a "+e.attr.name+"='currentTab'>"+t.helper.i18n.get("contextmenu_current_tab")+"</a></li>"):s.append("<li><a "+e.attr.name+"='newTab'>"+t.helper.i18n.get("contextmenu_new_tab")+"</a></li>"),s.append("<li><a "+e.attr.name+"='newWindow'>"+t.helper.i18n.get("contextmenu_new_window")+"</a></li>"),!1===e.api.extension.inIncognitoContext&&s.append("<li><a "+e.attr.name+"='newIncognito'>"+t.helper.i18n.get("contextmenu_new_tab_incognito")+"</a></li>");if(c||(l.hasClass(e.cl.selected)?s.append("<li><a "+e.attr.name+"='deselect'>"+t.helper.i18n.get("contextmenu_deselect_"+(o.isDir?"dir":"bookmark"))+"</a></li>"):s.append("<li><a "+e.attr.name+"='select'>"+t.helper.i18n.get("contextmenu_select_"+(o.isDir?"dir":"bookmark"))+"</a></li>")),d.append("<li><a "+e.attr.name+"='infos' title='"+t.helper.i18n.get("contextmenu_infos",null,!0)+"'></a></li>"),o.parents.length>0&&d.append("<li><a "+e.attr.name+"='edit' title='"+t.helper.i18n.get("contextmenu_edit"+n,null,!0)+"'></a></li>").append("<li><a "+e.attr.name+"='delete' title='"+t.helper.i18n.get("contextmenu_delete"+n,null,!0)+"'></a></li>"),o.isDir){const a=e("<li></li>").html("<a "+e.attr.name+"='add' title='"+t.helper.i18n.get("contextmenu_add",null,!0)+"'></a>").appendTo(d),l=e("<ul></ul>").attr(e.attr.name,"add").append("<li><a "+e.attr.type+"='bookmark' title='"+t.helper.i18n.get("overlay_label_bookmark",null,!0)+"'></a></li>").append("<li><a "+e.attr.type+"='dir' title='"+t.helper.i18n.get("overlay_label_dir",null,!0)+"'></a></li>").appendTo(a);"custom"===i.name&&l.append("<li><a "+e.attr.type+"='separator' title='"+t.helper.i18n.get("overlay_label_separator",null,!0)+"'></a></li>")}else d.append("<li><a "+e.attr.name+"='copyToClipboard' title='"+t.helper.i18n.get("contextmenu_copy",null,!0)+"'></a></li>"),o.pinned?d.append("<li class='"+e.cl.contextmenu.right+"'><a "+e.attr.name+"='unpin' title='"+t.helper.i18n.get("contextmenu_unpin",null,!0)+"'></a></li>"):d.append("<li class='"+e.cl.contextmenu.right+"'><a "+e.attr.name+"='pin' title='"+t.helper.i18n.get("contextmenu_pin",null,!0)+"'></a></li>");t.helper.entry.isVisible(r)?d.append("<li class='"+e.cl.contextmenu.right+"'><a "+e.attr.name+"='hide' title='"+t.helper.i18n.get("contextmenu_hide_from_sidebar",null,!0)+"'></a></li>"):!1===t.helper.search.isResultsVisible()&&l.parents("li."+e.cl.hidden).length()<=1&&d.append("<li class='"+e.cl.contextmenu.right+"'><a "+e.attr.name+"='showHidden' title='"+t.helper.i18n.get("contextmenu_show_in_sidebar",null,!0)+"'></a></li>")},h=(r,o,i)=>{const n=r.realWidth(),s=r.realHeight(),d=o[0].getBoundingClientRect(),c=d.top+d.height;if(c+s>=window.innerHeight?r.css("top",c-s).addClass(e.cl.contextmenu.top):r.css("top",c+"px"),"sort"!==i&&"menu"!==i){const e={left:o.parent("li")[0].offsetLeft,right:"auto"};t.helper.i18n.isRtl()?(e.left=d.width-n,"left"===a&&e.left<0&&(e.left=0)):"right"===a&&e.left+n>l&&(e.left="auto",e.right=0),["left","right"].forEach((t=>{"number"==typeof e[t]&&(e[t]+="px"),r.css(t,e[t])}))}};o.settings=()=>{t.helper.model.call("openLink",{href:e.api.runtime.getURL("html/settings.html"),newTab:!0})},o.checkbox=t=>{t.eventObj.stopPropagation(),e(t.elm).prev("div."+e.cl.checkbox.box).trigger("click")},o.bookmarkManager=()=>{t.helper.model.call("openLink",{href:"chrome://bookmarks",newTab:!0,active:!0})},o.newIncognito=e=>{e.data&&t.helper.utility.openUrl(e.data,"incognito")},o.newWindow=e=>{e.data&&(t.helper.utility.openUrl(e.data,"newWindow"),t.helper.toggle.closeSidebar())},o.currentTab=e=>{e.data&&t.helper.utility.openUrl(e.data)},o.newTab=e=>{if(e.data){const a="foreground"===t.helper.model.getData("b/newTab");t.helper.utility.openUrl(e.data,"newTab",a),a&&t.helper.toggle.closeSidebar()}},o.delete=e=>{t.helper.bookmark.removeEntry(e.data.id)},o.showHidden=async e=>{t.startLoading();const a=t.helper.model.getData("u/hiddenEntries");delete a[e.id],await t.helper.model.setData({"u/hiddenEntries":a}),await t.helper.model.call("removeCache",{name:"htmlList"}),await t.helper.model.call("removeCache",{name:"htmlPinnedEntries"}),t.helper.model.call("reload",{type:"Hide"})},o.openChildren=e=>{if(e.data){const a=e.data.children.filter((e=>e.url&&!e.url.startsWith("about:blank")));a.length>t.helper.model.getData("b/openChildrenWarnLimit")?t.helper.overlay.create(e.name,t.helper.i18n.get("contextmenu_open_children"),e.data):t.helper.utility.openAllBookmarks(a)}},o.pin=async e=>{await t.helper.bookmark.pinEntry(e.data),t.helper.model.call("reload",{type:"Pin"})},o.unpin=async e=>{await t.helper.bookmark.unpinEntry(e.data),t.helper.model.call("reload",{type:"Unpin"})},o.copyToClipboard=async a=>{const l=t.helper.entry.getDataById(a.id);if(l&&l.url&&t.helper.utility.copyToClipboard(l.url)){const a=t.helper.list.getActiveBookmarkBox().find("a["+e.attr.id+"='"+l.id+"']");e(a).children("span."+e.cl.sidebar.copied).remove();const r=e("<span></span>").addClass(e.cl.sidebar.copied).text(t.helper.i18n.get("sidebar_copied_to_clipboard")).appendTo(a);await e.delay(100),e(a).addClass(e.cl.sidebar.copied),await e.delay(1500),e(a).removeClass(e.cl.sidebar.copied),await e.delay(500),r.remove()}},o.showInDir=async a=>{const l=t.helper.entry.getDataById(a.id);if(l&&l.parents){const r=async o=>{if(l.parents[o]){const a=t.elm.bookmarkBox.all.find("ul > li > a."+e.cl.sidebar.bookmarkDir+"["+e.attr.id+"='"+l.parents[o]+"']");a.hasClass(e.cl.sidebar.dirOpened)||await t.helper.list.toggleBookmarkDir(a,!0,!1),await r(o+1)}else{await Promise.all([t.helper.list.cacheList(),t.helper.search.clearSearch()]);const l=t.elm.bookmarkBox.all.find("ul > li > a["+e.attr.id+"='"+a.id+"']");t.helper.scroll.setScrollPos(t.elm.bookmarkBox.all,l[0].offsetTop-50),l.addClass(e.cl.sidebar.mark)}};await r(0)}},o.select=e=>{e.id?t.helper.selection.select(e.id):t.helper.selection.start()},o.deselect=e=>{t.helper.selection.deselect(e.id)},o.reload=async()=>{await t.helper.model.setData({"u/openStates":{}}),t.helper.model.call("reload",{type:"Force"})},o.closeAll=async()=>{const a=t.elm.bookmarkBox.all.children("ul"),l=a.hasClass(e.cl.sidebar.hideRoot),r=[];a.find("a."+e.cl.sidebar.dirOpened).forEach((a=>{(!1===l||e(a).parents("li").length()>1)&&r.push(t.helper.list.toggleBookmarkDir(e(a),!1,!1))})),await Promise.all(r),t.helper.list.cacheList()};const p=t=>{r&&clearTimeout(r),t.find("ul["+e.attr.name+"='add']").addClass(e.cl.visible)},m=t=>{r&&clearTimeout(r),r=setTimeout((()=>{t.find("ul["+e.attr.name+"='add']").removeClass(e.cl.visible)}),300)},u=a=>{a.find("input["+e.attr.name+"='sort']").on("change",(a=>{if(a.currentTarget.checked){const l=e(a.currentTarget).attr(e.attr.value);t.helper.list.updateSort(l),this.close()}})),a.find("input["+e.attr.name+"='toggleHidden']").on("change",(async a=>{t.startLoading(),await Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"}),t.helper.model.setData({"u/showHidden":t.helper.checkbox.isChecked(e(a.currentTarget).parent("div"))})]),t.helper.model.call("reload",{type:"ToggleHidden"}),this.close()})),a.on("mouseleave",(t=>{e(t.currentTarget).find("a").removeClass(e.cl.hover)})),a.find("ul["+e.attr.name+"='add']").on("mouseenter",(()=>{p(a)})).on("mouseleave",(()=>{m(a)})),a.find("> ul > li > a").on("mouseenter",(t=>{const l=e(t.currentTarget);a.find("a").removeClass(e.cl.hover),l.addClass(e.cl.hover),l.parents("ul."+e.cl.contextmenu.icons).length()>0&&"add"===l.attr(e.attr.name)&&p(a)})).on("mouseleave",(t=>{e(t.currentTarget).removeClass(e.cl.hover),m(a)})),a.find("a").on("click",(l=>{l.preventDefault();let r=l.currentTarget;const i=e(r).parents("ul").eq(0).prev("a");i.length()>0&&(r=i);const n={elm:r,eventObj:l,name:e(r).attr(e.attr.name),id:a.attr(e.attr.id)};n.data=n.id?t.helper.entry.getDataById(n.id):{},n.data.overlayType=e(l.currentTarget).attr(e.attr.type),"sort"!==n.name&&"toggleHidden"!==n.name||(n.name="checkbox"),"function"==typeof o[n.name]?o[n.name](n):t.helper.overlay.create(n.name,e(n.elm).attr("title")||e(n.elm).text(),n.data)}))}},e.DragDropHelper=function(t){let a=null,l=null,r=!1,o=null,i=0,n=null,s=null;const d={running:!1,posY:null,previousDelta:0,fpsLimit:30};this.init=async()=>{l=t.helper.model.getData("b/sidebarPosition"),r=t.helper.model.getData("b/dndCreationDialog"),v(),h()},this.cancel=async()=>{const a=t.elm.iframeBody.children("a."+e.cl.drag.helper),l=t.elm.bookmarkBox.all.find("li."+e.cl.drag.dragInitial),r=a.data("elm");r&&r.insertAfter(l).removeClass(e.cl.drag.isDragged),l.remove(),a.remove(),t.elm.iframeBody.removeClass([e.cl.drag.isDragged,e.cl.drag.cancel]),t.elm.iframeBody.find("li."+e.cl.drag.dragHover).removeClass(e.cl.drag.dragHover),await e.delay(500),t.helper.toggle.removeSidebarHoverClass()};const c=e=>{let a=0;if("object"==typeof e){a=e[0].getBoundingClientRect().left}else a=+e;return"right"===l&&(a=window.innerWidth-a),"object"==typeof e?.6*e.realWidth()+a>t.elm.sidebar.realWidth():a>t.elm.sidebar.realWidth()},h=()=>{t.elm.iframeBody.on("dragenter",(()=>{const a=e("body");a.attr("id")===e.opts.ids.page.newtab&&a.hasClass(e.cl.newtab.edit)||(t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elm.iframeBody.addClass(e.cl.drag.isDragged),t.helper.toggle.addSidebarHoverClass(),s=t.helper.model.getData("u/sort"),d.running||window.requestAnimationFrame(m))})).on("drop dragend",(async a=>{if(a.preventDefault(),a.stopPropagation(),d.posY=null,t.elm.iframeBody.find("li."+e.cl.drag.dragHover).removeClass(e.cl.drag.dragHover),t.elm.iframeBody.hasClass(e.cl.drag.isDragged)){if(!c(a.pageX)&&!1===t.helper.search.isResultsVisible()){const l=t.elm.bookmarkBox.all.find("li."+e.cl.drag.isDragged).eq(0);if(l&&l.length()>0){const o=a.dataTransfer.getData("URL");let i=a.dataTransfer.getData("text/plain"),n=null,s=null;try{if(e.api.tabs){const t=await e.api.tabs.query({active:!0,currentWindow:!0});t&&t[0]&&(n=t[0].url||"",s=t[0].title||"")}}catch(e){console.error(e)}if(n&&n===o)i=s||"";else if(location.href===o)i=document.title||"";else if(i===o){const t=a.dataTransfer.getData("text/html");i=t&&t.length>0?e("<div></div>").html(t).text():""}const d={index:l.prevAll("li").length(),parentId:l.parent("ul").prev("a").attr(e.attr.id),title:i.trim(),url:o},c=()=>{t.helper.overlay.create("add",t.helper.i18n.get("contextmenu_add"),{values:d})};if(!1===r&&d.title&&d.url){(await t.helper.model.call("createBookmark",d)).error&&c()}else c()}}t.elm.iframeBody.removeClass([e.cl.drag.isDragged,e.cl.drag.cancel]),t.helper.toggle.removeSidebarHoverClass()}})),t.elm.iframeBody.on("dragleave",(()=>{a&&clearInterval(a),a=setTimeout((async()=>{t.elm.iframeBody.find("li."+e.cl.drag.dragHover).removeClass(e.cl.drag.dragHover),t.elm.iframeBody.find("li."+e.cl.drag.isDragged).remove(),t.elm.iframeBody.removeClass([e.cl.drag.isDragged,e.cl.drag.cancel]),t.helper.toggle.removeSidebarHoverClass()}),100)})).on("dragenter",(async()=>{await e.delay(0),a&&clearInterval(a)}))},p=t=>{let a="bookmark";return"selection"===t?a=t:t.data("type")?a=t.data("type"):(t.hasClass(e.cl.sidebar.bookmarkDir)?a="directory":t.parents("div."+e.cl.sidebar.entryPinned).length()>0&&(a="pinned"),t.data("type",a)),a},m=e=>{window.requestAnimationFrame(m);const a=e-d.previousDelta;if(!(d.fpsLimit&&a<1e3/d.fpsLimit)){if(null!==d.posY){const e=t.elm.bookmarkBox.all[0].offsetTop,a=t.elm.bookmarkBox.all[0].offsetHeight,l=t.helper.scroll.getScrollPos(t.elm.bookmarkBox.all);let r=null;d.posY-e<60?r=l-Math.pow((50-d.posY+e)/10,2):d.posY+60>a&&(r=l+Math.pow((d.posY+50-a)/10,2)),r&&t.helper.scroll.setScrollPos(t.elm.bookmarkBox.all,r)}d.previousDelta=e}},u=async()=>{g();const a=t.elm.iframeBody.children("a."+e.cl.drag.helper);if(c(a))this.cancel();else{a.addClass(e.cl.drag.snap);const l=t.elm.bookmarkBox.all.find("li."+e.cl.drag.dragInitial);let r=a.data("elm");const o=r.children("a"),i=p(o),n=r.parent("ul"),d=n.prev("a").attr(e.attr.id),c=o.attr(e.attr.id);let h=0;if("custom"===s.name)r.prevAll("li").forEach((e=>{e!==l&&h++}));else{const a=await t.helper.bookmark.getBookmarkIndexInDirectory(c,d);if(-1===a)r=r.appendTo(n);else{const t=n.children(`li:not(.${e.cl.drag.dragInitial})`).eq(a);r=r.insertAfter(t)}}t.elm.iframeBody.removeClass(e.cl.drag.isDragged),t.elm.iframeBody.find("li."+e.cl.drag.dragHover).removeClass(e.cl.drag.dragHover),await e.delay();const m=r[0].getBoundingClientRect();a.css({top:m.top+"px",left:m.left+"px"}),await e.delay(200),r.removeClass(e.cl.drag.isDragged),l.remove(),a.remove(),"pinned"===i?t.helper.bookmark.reorderPinnedEntries({id:c,prevId:r.prev("li").children("a").attr(e.attr.id)}):(await t.helper.model.call("moveBookmark",{id:c,parentId:d,index:h}),t.helper.selection.isEnabled()&&t.helper.selection.moveSelection(d,h,r)),await e.delay(300),t.helper.toggle.removeSidebarHoverClass()}},g=(t=null)=>{null===n||null!==t&&n.id===t.attr(e.attr.id)||(n.elm.removeClass(e.cl.drag.dragHover),clearTimeout(n.instance),n=null)},f=(a,l,r)=>{let h=null,m=null,u=0,f=0;if("dragover"===a){if(u=r-20,f=l,u===i)return!1;i=u,t.elm.bookmarkBox.all.find("li."+e.cl.drag.isDragged).remove(),m=e("<li></li>").html("<a>&nbsp;</a>").addClass(e.cl.drag.isDragged)}else{if(h=t.elm.iframeBody.children("a."+e.cl.drag.helper),0===h.length())return;const a=h.data("startPos");u=r-a.top,f=l-a.left,h.css({top:u+"px",left:f+"px"}),m=h.data("elm")}if(t.elm.iframeBody.find("li."+e.cl.drag.dragHover).removeClass(e.cl.drag.dragHover),c(h||f))return g(),t.elm.iframeBody.addClass(e.cl.drag.cancel),!1;t.elm.iframeBody.removeClass(e.cl.drag.cancel);const v=p(m.children("a"));let y,k={elm:null};if("pinned"===v?y=[t.elm.pinnedBox.find("> ul > li")]:(d.posY=r,y=[t.elm.bookmarkBox.all.find("a."+e.cl.sidebar.dirOpened+" + ul > li"),t.elm.bookmarkBox.all.find("> ul > li > a."+e.cl.sidebar.dirOpened).parent("li")]),y.some((t=>{t&&t.forEach((t=>{const a=e(t);if(a[0]!==m[0]&&!a.hasClass(e.cl.drag.dragInitial)){const t=a[0].getBoundingClientRect(),l=u-t.top;if(t.top>u)return!1;if(null===k.elm||k.diff>l){const t=a.children("a").eq(0).hasClass(e.cl.sidebar.bookmarkDir);k="custom"===s.name||t?{elm:a,height:a[0].offsetHeight,diff:l}:{elm:a.parents("li").eq(0),height:a[0].offsetHeight,diff:l}}}}))})),k.elm&&k.elm!==o){o=k.elm;const a=k.elm.children("a").eq(0),l=k.elm.parents("li").eq(0),r=!l||0===l.length(),i=a.hasClass(e.cl.sidebar.bookmarkDir),d=k.diff/k.height*100;if(g(a),0===k.elm.nextAll("li:not(."+e.cl.drag.isDragged+")").length()&&d>80)h&&l.parents("ul")[0]!==t.elm.bookmarkBox.all.find("> ul")[0]&&b(h,m.insertAfter(l));else if(i&&(d<60||"custom"!==s.name)){if(a.hasClass(e.cl.sidebar.dirOpened))b(h,m.prependTo(a.next("ul")));else if(a.hasClass(e.cl.sidebar.dirAnimated))0===a.next("ul").length()&&(a.addClass(e.cl.sidebar.dirOpened),e("<ul></ul>").insertAfter(a));else if(null===n){n={id:a.attr(e.attr.id),elm:a.addClass(e.cl.drag.dragHover)};const l=t.helper.model.getData("b/dndOpenDirDelay");n.instance=setTimeout((()=>{t.helper.list.toggleBookmarkDir(a)}),1e3*+l)}}else r&&"pinned"!==v||(g(),b(h,m.insertAfter(k.elm)))}else"pinned"===v&&b(h,m.prependTo(t.elm.pinnedBox.children("ul")))},b=(t,a)=>{t&&t.data("elm",a),"custom"!==s.name&&a.parents("li").eq(0).addClass(e.cl.drag.dragHover)},v=()=>{t.elm.bookmarkBox.all.on("mousedown","span."+e.cl.drag.trigger,(a=>{t.helper.toggle.addSidebarHoverClass(),((a,l,r)=>{t.helper.contextmenu.close(),t.helper.tooltip.close();const o=e(a).parent("a").removeClass(e.cl.sidebar.dirOpened),i=o.attr(e.attr.id),n=t.helper.entry.getDataById(i);if(null===n)return!1;t.helper.selection.isEnabled()&&t.helper.selection.select(i),s=t.helper.model.getData("u/sort");const c=o.parent("li"),h=c.parent("ul").prev("a");t.elm.iframeBody.addClass(e.cl.drag.isDragged),c.clone().addClass(e.cl.drag.dragInitial).insertAfter(c);const p=o.clone().appendTo(t.elm.iframeBody);t.helper.selection.isEnabled()&&e("<span></span>").addClass(e.cl.selected).text(t.helper.selection.getSelectedAmount()).appendTo(p);const u=o[0].getBoundingClientRect();let g=0;c.prevAll("li").forEach((t=>{e(t).hasClass(e.cl.drag.dragInitial)||g++})),p.removeAttr("title").css({top:u.top+"px",left:u.left+"px",width:o.realWidth()+"px"}).data({elm:c,isDir:!!n.isDir,parentId:h.length()>0?h.attr(e.attr.id):null,index:g,startPos:{top:r-u.top,left:l-u.left}}).addClass(e.cl.drag.helper),c.addClass(e.cl.drag.isDragged),d.running||window.requestAnimationFrame(m)})(a.currentTarget,a.pageX,a.pageY),f(a.type,a.pageX,a.pageY)})),t.elm.iframeBody.on("mouseup",(async a=>{d.posY=null,t.elm.iframeBody.hasClass(e.cl.drag.isDragged)&&(a.preventDefault(),a.stopPropagation(),0===a.buttons?await u():(await e.delay(0),await this.cancel()))})),t.elm.iframeBody.on("wheel",(a=>{if(t.elm.iframeBody.hasClass(e.cl.drag.isDragged)){a.stopPropagation();const e=t.elm.bookmarkBox.all[0].scrollTop;t.helper.scroll.setScrollPos(t.elm.bookmarkBox.all,e-a.wheelDelta,300)}}),{passive:!0}),t.elm.iframeBody.on("mousemove dragover",(a=>{!t.elm.iframeBody.hasClass(e.cl.drag.isDragged)||1!==a.buttons&&0!==a.button||(a.preventDefault(),a.stopPropagation(),f(a.type,a.pageX,a.pageY))})),t.elm.iframeBody.on("contextmenu","a."+e.cl.drag.helper,(e=>{e.preventDefault(),e.stopPropagation()}))}},e.EntryHelper=function(e){let t=!1,a={},l={},r={},o={bookmarks:{},directories:{},pinned:{}};this.init=async(e=null)=>{await this.update(e),t=!0},this.initOnce=async()=>{t||await this.init()},this.getAmount=t=>{if(i(),0===Object.keys(a).length&&(a=e.helper.model.getData("u/entryAmounts")),a&&a[t]){let e=a[t].visible;return l.showHidden&&(e+=a[t].hidden),e}return null},this.getAllDataByType=e=>Object.values(o[e]||{}),this.getDataById=e=>{let t=null;return"object"==typeof o.bookmarks[e]?(t=o.bookmarks[e],"object"==typeof o.pinned[e]&&(t.pinnedIndex=o.pinned[e].index)):"object"==typeof o.directories[e]&&(t=o.directories[e]),t},this.getParentsById=e=>{const t=[];try{let a=this.getDataById(e).parentId;for(;a;){const e=this.getDataById(a);e&&t.push(e),a=e&&e.parentId?e.parentId:null}}catch(e){}return t},this.addData=(e,t,a)=>{"object"==typeof o.bookmarks[e]?("pinnedIndex"===t&&"object"==typeof o.pinned[e]&&(o.pinned[e].index=a),o.bookmarks[e][t]=a):"object"==typeof o.directories[e]&&(o.directories[e][t]=a)},this.isSeparator=e=>{let t=!1;return"object"==typeof o.bookmarks[e]&&(t=o.bookmarks[e].url.startsWith("about:blank")&&/^[-_]{3,}/.test(o.bookmarks[e].title)&&/[-_]{3,}$/.test(o.bookmarks[e].title)),t},this.isVisible=e=>{let t=!1;return"object"==typeof o.bookmarks[e]?t=!1===o.bookmarks[e].hidden:"object"==typeof o.directories[e]&&(t=!1===o.directories[e].hidden),t},this.update=(t=null)=>new Promise((l=>{i();const s=[e.helper.model.call("viewAmounts")];null===t&&s.push(e.helper.model.call("bookmarks",{id:0})),Promise.all(s).then((i=>{r=i[0],null===t&&i[1]&&i[1].bookmarks&&i[1].bookmarks[0]&&i[1].bookmarks[0].children&&(t=i[1].bookmarks[0].children),o={bookmarks:{},directories:{},pinned:{}},a={bookmarks:{visible:0,hidden:0},directories:{visible:0,hidden:0},pinned:{visible:0,hidden:0}},n(t),e.helper.model.setData({"u/entryAmounts":a}),l()}))}));const i=()=>{l=e.helper.model.getData(["u/hiddenEntries","u/additionalInfo","u/pinnedEntries","u/showHidden"])},n=(e,t=[],a=!1)=>{e&&e.forEach((e=>{const o=[...t];"0"!==e.parentId&&o.push(e.parentId),e.additionalInfo=l.additionalInfo[e.id]||{},e.hidden=a||!0===l.hiddenEntries[e.id],e.parents=o,e.views={startDate:+new Date(Math.max(e.dateAdded,r.counterStartDate)),total:0},e.url?d(e):e.children&&s(e)}))},s=e=>{e.childrenAmount={bookmarks:0,directories:0,total:0},e.parents.forEach((e=>{"root________"!==e&&o.directories[e].childrenAmount.directories++})),o.directories[e.id]=e,n(e.children,e.parents,e.hidden),e.isDir=!0,e.childrenAmount.total=e.childrenAmount.bookmarks+e.childrenAmount.directories,e.views.perMonth=Math.round(e.views.total/c(e.views.startDate)*100)/100,a.directories[e.hidden?"hidden":"visible"]++},d=e=>{let t=0,i=0;if(r.viewAmounts[e.id]&&(t=r.viewAmounts[e.id].c,i=r.viewAmounts[e.id].d||0),e.views.total=t,e.views.lastView=i,e.views.perMonth=Math.round(t/c(e.views.startDate)*100)/100,e.parents.forEach((e=>{o.directories[e]&&(o.directories[e].childrenAmount.bookmarks++,o.directories[e].views.total+=t,o.directories[e].views.lastView=Math.max(o.directories[e].views.lastView||0,i))})),e.pinned=!1,o.bookmarks[e.id]=e,!1===this.isSeparator(e.id)&&a.bookmarks[e.hidden?"hidden":"visible"]++,l.pinnedEntries[e.id]){e.pinned=!0;const t=Object.assign({},e);t.index=l.pinnedEntries[e.id].index,delete t.parents,delete t.parentId,o.pinned[e.id]=t,a.pinned[e.hidden?"hidden":"visible"]++}},c=e=>Math.max(1,Math.round((+new Date-e)/2627999942.4))},e.FontHelper=function(e){const t={general:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:500,ExtraBold:500,Black:500},fa:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:500,Bold:600,ExtraBold:600,Black:600},ar:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:500,Bold:600,ExtraBold:600,Black:600},he:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:500,Bold:600,ExtraBold:600,Black:600},ja:{Thin:100,ExtraLight:100,Light:100,Normal:200,Medium:300,SemiBold:400,Bold:500,ExtraBold:500,Black:500},zh_CN:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:400,ExtraBold:500,Black:500},zh_TW:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:400,ExtraBold:500,Black:500}};this.getFontWeights=()=>{const a=e.helper.i18n.getLanguage();let l={...t.general};t[a]&&(l={...t[a]});const r={};for(const e in l)r["fontWeight"+e]=l[e];return r}},e.I18nHelper=function(t){let a=null,l={},r=null;this.init=async()=>{const e=await t.helper.model.call("langvars");a=e.language,l=e.vars,r=e.dir},this.getLanguage=()=>a,this.isRtl=()=>"rtl"===r,this.getUILanguage=()=>e.api.i18n.getUILanguage(),this.getDefaultLanguage=()=>e.opts.manifest.default_locale,this.getLocaleSortCollator=()=>new Intl.Collator([this.getUILanguage(),this.getDefaultLanguage()]),this.getLocaleDate=e=>("number"==typeof e&&(e=new Date(e)),e.toLocaleDateString([this.getUILanguage(),this.getDefaultLanguage()],{year:"numeric",month:"2-digit",day:"2-digit"})),this.parseHtml=t=>{e(t).find("["+e.attr.i18n+"]").forEach((t=>{let a=null;const l=e(t).attr(e.attr.i18n);if(l){let r=[];const o=e(t).attr(e.attr.i18nReplaces);o&&(r=o.split(",")),a=this.get(l,r)}a?(e(t).removeAttr(e.attr.i18n),e(t).html(a)):e(t).remove()}))},this.get=(t,a=[],r=!1)=>{let o="";const i=l[t];return i&&i.message&&(o=i.message,o=o.replace(/\{browserName\}/gi,e.browserName),a&&a.length>0&&a.forEach(((e,t)=>{o=o.replace(new RegExp("\\{"+(t+1)+"\\}"),e)})),o=o.replace(/\[b\](.*)\[\/b\]/,"<strong>$1</strong>"),o=o.replace(/\[a\](.*)\[\/a\]/,"<a href='#'>$1</a>"),o=o.replace(/\[em\](.*)\[\/em\]/,"<em>$1</em>")),r&&(o=o.replace(/'/g,"&#x27;")),o}},e.KeyboardHelper=function(t){let a=!1;this.init=async()=>{r()},this.initOverlayEvents=a=>{e(a[0].contentDocument).on("keydown",(e=>{if("Escape"===e.key||"Esc"===e.key)e.preventDefault(),t.helper.overlay.closeOverlay();else if("Enter"===e.key){const t=a[0].contentDocument.activeElement;null!==t&&"TEXTAREA"===t.tagName||(e.preventDefault(),o(a))}else"Tab"===e.key&&(e.preventDefault(),s(a))}))};const l=()=>{let a=!1;return t.elm.iframe.hasClass(e.cl.page.visible)&&document&&document.activeElement&&(a=document.activeElement===t.elm.iframe[0]),a},r=()=>{e([document,t.elm.iframeDocument]).on("keydown.bs",(async a=>{if(!l())return;const r=["PageDown","PageUp","Home","End","Space"],o=t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']"),s=t.elm.sidebar.find("div."+e.cl.contextmenu.wrapper).length()>0,u=t.elm.iframeBody.hasClass(e.cl.drag.isDragged);if(r.indexOf(a.key)>-1||r.indexOf(a.code)>-1)t.helper.scroll.focus(),await e.delay(300),c();else if("ArrowDown"===a.key||"Tab"===a.key&&!a.shiftKey)if(a.preventDefault(),s)d("next");else{h("next");const a=t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']");a[0]&&a[0].blur()}else"ArrowUp"===a.key||"Tab"===a.key&&a.shiftKey?(a.preventDefault(),s?d("prev"):h("prev")):"Enter"===a.key?(a.preventDefault(),s?i():n(a.shiftKey,a.ctrlKey||a.metaKey)):"Escape"===a.key||"Esc"===a.key?(a.preventDefault(),u?t.helper.dragndrop.cancel():s?t.helper.contextmenu.close():t.helper.search.isResultsVisible()?t.helper.search.clearSearch():t.helper.toggle.closeSidebar()):"Delete"===a.key&&t.helper.selection.isEnabled()?(a.preventDefault(),p(),t.helper.selection.deleteSelected()):"Delete"===a.key&&o.length()>0&&o[0]!==t.elm.iframeDocument[0].activeElement?(a.preventDefault(),p()):"f"!==a.key||!a.ctrlKey&&!a.metaKey||a.ctrlKey===a.metaKey||a.shiftKey?"c"===a.key&&(a.ctrlKey||a.metaKey)?(a.preventDefault(),m()):"Shift"!==a.key&&"Control"!==a.key&&"Command"!==a.key&&o.length()>0&&o[0]!==t.elm.iframeDocument[0].activeElement&&o[0].focus():(a.preventDefault(),t.helper.search.showSearchField())})).on("keyup.bs",(()=>{if(!l())return;const a=t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']");if(a&&a.length()>0){a[0].value.length>0&&!t.elm.header.hasClass(e.cl.sidebar.searchVisible)&&(t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elm.header.addClass(e.cl.sidebar.searchVisible))}}))},o=a=>{const l=a.find("menu["+e.attr.name+"='select'] > a."+e.cl.hover);l.length()>0?l.trigger("click"):t.helper.overlay.performAction()},i=()=>{const a=t.elm.sidebar.find("div."+e.cl.contextmenu.wrapper).find("a."+e.cl.hover);a.length()>0&&a.trigger("click")},n=(a,l)=>{const r=t.helper.list.getActiveBookmarkBox().find("ul > li > a."+e.cl.hover+", ul > li > a."+e.cl.sidebar.mark);if(r.length()>0)if(a){let a="list";r.hasClass(e.cl.sidebar.separator)&&(a="separator"),t.helper.contextmenu.create(a,r)}else t.helper.sidebarEvents.handleEntryClick(r,{ctrlKey:l})},s=t=>{const a=t.find("menu["+e.attr.name+"='select'] > a."+e.cl.hover),l=t[0].contentDocument;if(a.length()>0){let l=null;l=a.next("a").length()>0?a.next("a"):t.find("menu["+e.attr.name+"='select'] > a").eq(0),t.find("menu["+e.attr.name+"='select'] > a."+e.cl.hover).removeClass(e.cl.hover),l.addClass(e.cl.hover)}else if("INPUT"===l.activeElement.tagName){const a=e(l.activeElement).parent("li");let r=null;r=a.length()>0&&a.next("li").length()>0?a.next("li").find("input,text,area,select").eq(0):t.find("input,text,area,select").eq(0),r&&r.length()>0&&r[0].focus()}else t.find("input").length()>0?t.find("input")[0].focus():t.find("menu["+e.attr.name+"='select']").length()>0&&t.find("menu["+e.attr.name+"='select'] > a").eq(0).addClass(e.cl.hover)},d=a=>{const l=t.elm.sidebar.find("div."+e.cl.contextmenu.wrapper);let r=null;l.find("a."+e.cl.hover).length()>0&&(r=l.find("a."+e.cl.hover).eq(0));let o=l.find("a").eq(0);null!==r&&("next"===a?r.parent("li").next("li").length()>0?o=r.parent("li").next("li").children("a"):r.parents("ul").eq(0).next("ul").length()>0&&(o=r.parents("ul").eq(0).next("ul").find("> li > a").eq(0)):"prev"===a&&(r.parent("li").prev("li").length()>0?o=r.parent("li").prev("li").children("a"):r.parents("ul").eq(0).prev("ul").length()>0&&(o=r.parents("ul").eq(0).prev("ul").find("> li > a").eq(-1)))),l.find("a."+e.cl.hover).removeClass(e.cl.hover),o.addClass(e.cl.hover)},c=()=>{const a=t.helper.list.getActiveBookmarkBox(),l=t.helper.scroll.getScrollPos(a);a.find("ul > li").forEach((t=>{if(t.offsetTop>l+50)return a.find("ul > li > a."+e.cl.hover).removeClass(e.cl.hover),a.find("ul > li > a."+e.cl.sidebar.mark).removeClass(e.cl.sidebar.mark),e(t).children("a").addClass([e.cl.hover,e.cl.sidebar.lastHover]),!1}))},h=a=>{const l=t.helper.list.getActiveBookmarkBox(),r=t.helper.scroll.getScrollPos(l);let o=null;if(l.find("ul > li > a."+e.cl.sidebar.mark).length()>0?o=l.find("ul > li > a."+e.cl.sidebar.mark).eq(0).parent("li"):l.find("ul > li > a."+e.cl.hover).length()>0?o=l.find("ul > li > a."+e.cl.hover).eq(0).parent("li"):l.find("ul > li > a."+e.cl.sidebar.lastHover).length()>0?o=l.find("ul > li > a."+e.cl.sidebar.lastHover).eq(0).parent("li"):l.find("ul > li").forEach((t=>{if(t.offsetTop>=r)return o=e(t),!1})),o){const i=o.children("a");let n=null;if(i.hasClass(e.cl.hover)||i.hasClass(e.cl.sidebar.mark)?"prev"===a?n=(t=>{let a=null;if(t.prev("li").length()>0){let l=t.prev("li").children("a");for(;l.hasClass(e.cl.sidebar.dirOpened)&&l.next("ul").length()>0&&l.next("ul").children("li").length()>0;)l=l.next("ul").find("> li:last-child > a");a=l}else{const e=t.parents("li").eq(0);e.length()>0&&(a=e.children("a"))}return a})(o):"next"===a&&(n=(t=>{const a=t.children("a");let l=null;if(a.hasClass(e.cl.sidebar.dirOpened)&&a.next("ul").length()>0&&a.next("ul").children("li").length()>0)l=a.next("ul").find("> li:first-child > a");else if(t.next("li").length()>0)l=t.next("li").children("a");else{let e=!1,a=0;for(;!1===e;){const r=t.parents("li").eq(a);r.length()>0?r.next("li").length()>0?(l=r.next("li").children("a"),e=!0):a++:e=!0}}return l})(o)):n=i,n&&n[0]){l.find("ul > li > a."+e.cl.hover).removeClass(e.cl.hover),l.find("ul > li > a."+e.cl.sidebar.mark).removeClass(e.cl.sidebar.mark),n.addClass([e.cl.hover,e.cl.sidebar.lastHover]);const a=n[0].offsetTop-r,o=window.innerHeight-a,i=150+t.elm.pinnedBox[0].offsetHeight;a<0?t.helper.scroll.setScrollPos(l,n[0].offsetTop):o<i&&t.helper.scroll.setScrollPos(l,r+(i-o))}}},p=()=>{if(!a){a=!0;const l=t.helper.list.getActiveBookmarkBox().find("> ul a."+e.cl.hover).eq(0);l.length()>0&&0===l.children("span."+e.cl.sidebar.removeMask).length()&&t.helper.bookmark.removeEntry(l.attr(e.attr.id)).then((()=>{a=!1}))}},m=()=>{const a=t.helper.list.getActiveBookmarkBox().find("> ul a."+e.cl.hover).eq(0);if(a.length()>0){const l=t.helper.entry.getDataById(a.attr(e.attr.id));if(l&&l.url&&t.helper.utility.copyToClipboard(l.url)){e(a).children("span."+e.cl.sidebar.copied).remove();const l=e("<span></span>").addClass(e.cl.sidebar.copied).text(t.helper.i18n.get("sidebar_copied_to_clipboard")).appendTo(a);e.delay(100).then((()=>(e(a).addClass(e.cl.sidebar.copied),e.delay(1500)))).then((()=>(e(a).removeClass(e.cl.sidebar.copied),e.delay(500)))).then((()=>{l.remove()}))}}}},e.Linkchecker=function(t){const a={};let l=!1;this.run=(e,l)=>{a.modal=e,a.body=e.parents("body"),"default"!==t.helper.model.getUserType()?o(l):r()};const r=()=>{const l=e("<p></p>").addClass(e.cl.premium).html("<span>"+t.helper.i18n.get("premium_restricted_text")+"</span>").appendTo(a.modal);e("<a></a>").text(t.helper.i18n.get("more_link")).appendTo(l).on("click",(a=>{a.preventDefault(),t.helper.model.call("openLink",{href:e.api.runtime.getURL("html/settings.html#premium"),newTab:!0})})),t.helper.overlay.setCloseButtonLabel("close")},o=async l=>{a.buttonWrapper=a.modal.find("menu."+e.cl.overlay.buttonWrapper),a.loader=t.helper.template.loading().appendTo(a.modal),a.desc=e("<p></p>").text(t.helper.i18n.get("overlay_check_bookmarks_loading")).appendTo(a.modal);const r=y(l);a.progressBar=e("<div></div>").addClass(e.cl.overlay.progressBar).html("<div></div>").appendTo(a.modal),a.progressLabel=e("<span></span>").addClass(e.cl.overlay.checkUrlProgressLabel).html("<span>0</span>/<span>"+r.bookmarks.length.toLocaleString()+"</span>").appendTo(a.modal),e.delay(200).then((()=>{a.modal.addClass(e.cl.overlay.urlCheckLoading)})),c();const o={count:0,changed:[],broken:[],duplicate:[],empty:[]};b(r.directories,o),await v(r.bookmarks,o),i(o)},i=l=>{const r=l.count>0;delete l.count,a.desc.remove(),a.progressBar.remove(),a.progressLabel.remove(),r&&a.modal.addClass(e.cl.overlay.urlCheckResults),e.delay(r?500:0).then((()=>{if(a.loader.remove(),a.modal.removeClass(e.cl.overlay.urlCheckLoading),t.helper.overlay.setCloseButtonLabel("close"),!1===r)f();else{a.menu=e("<menu></menu>").addClass(e.cl.overlay.urlCheckCategories).appendTo(a.modal),a.results={},a.actions={};let r=null;Object.entries(l).forEach((([l,o])=>{const i=e("<li></li>").html("<a>"+t.helper.i18n.get("overlay_check_bookmarks_menu_"+l)+"<span></span></a>").attr(e.attr.name,l).appendTo(a.menu);if(o.length>0&&null===r&&(r=i.children("a")),"duplicate"!==l){let r="overlay_check_bookmarks_update";"broken"!==l&&"empty"!==l||(r="overlay_check_bookmarks_remove"),a.actions[l]=e("<a></a>").addClass(e.cl.overlay.urlCheckAction).attr(e.attr.name,l).text(t.helper.i18n.get(r+"_selected")).appendTo(a.buttonWrapper)}a.results[l]=t.helper.scroll.add(e.opts.ids.overlay.urlCheckResult+"_"+l,e("<ul></ul>").appendTo(a.modal)),o.forEach((t=>{const r=e("<li></li>").data("entry",t).appendTo(a.results[l].children("ul"));switch(l){case"broken":case"changed":d(t,r);break;case"duplicate":s(t,r);break;case"empty":n(t,r)}}))})),g(),h(),r&&r.trigger("click")}}))},n=(l,r)=>{const o=t.helper.entry.getParentsById(l.id);if(o.length>0){t.helper.checkbox.get(a.body,{checked:"checked"}).appendTo(r);const i=e("<ul></ul>").addClass(e.cl.sidebar.breadcrumb).appendTo(r);o.forEach((t=>{e("<li></li>").text(t.title).prependTo(i)})),e("<li></li>").text(l.title).appendTo(i)}else r.remove();e("<a></a>").addClass(e.cl.overlay.urlCheckAction).appendTo(r)},s=async(a,l)=>{const r=e("<a></a>").addClass(e.cl.info).attr({href:a.url,title:a.label,target:"_blank"}).html(a.label).appendTo(l),o=e("<ul></ul>").attr(e.attr.type,"duplicates").appendTo(l);a.duplicates.forEach((a=>{a.duplicate=!0;const l=e("<li></li>").data("entry",a).appendTo(o);e("<strong></strong>").html(a.title).appendTo(l);const r=t.helper.entry.getParentsById(a.id);if(r.length>0){const t=e("<ul></ul>").addClass(e.cl.sidebar.breadcrumb).appendTo(l);r.forEach((a=>{e("<li></li>").text(a.title).prependTo(t)}))}e("<a></a>").addClass(e.cl.overlay.urlCheckAction).appendTo(l)})),e("<a></a>").addClass(e.cl.overlay.urlCheckHide).appendTo(l);const i=await t.helper.model.call("favicon",{url:a.url});i&&e("<img src='"+i+"' />").insertBefore(r)},d=async(l,r)=>{t.helper.checkbox.get(a.body,{checked:"checked"}).appendTo(r),e("<strong></strong>").text(l.title).appendTo(r);const o=e("<ul></ul>").attr(e.attr.type,"urls").appendTo(r);["url","newUrl"].forEach((t=>{if(l[t]){const a=e("<li></li>").appendTo(o);e("<a></a>").attr({href:l[t],title:l[t],target:"_blank"}).html(l[t]).appendTo(a)}})),e("<a></a>").addClass(e.cl.overlay.urlCheckHide).appendTo(r),e("<a></a>").addClass(e.cl.overlay.urlCheckAction).appendTo(r);const i=await t.helper.model.call("favicon",{url:l.url});i&&e("<img src='"+i+"' />").insertAfter(r.children("div."+e.cl.checkbox.box))},c=()=>{e(document).on(e.opts.events.overlayClosed,(()=>{l&&(l=!1,t.helper.model.call("reload",{type:"Update"}))}))},h=()=>{a.menu.find("a").on("click",(t=>{t.preventDefault();const l=e(t.currentTarget).parent("li"),r=l.attr(e.attr.name);a.results&&a.results[r]&&(a.menu.children("li").removeClass(e.cl.active),l.addClass(e.cl.active),["results","actions"].forEach((t=>{a[t]&&Object.entries(a[t]).forEach((([t,a])=>{r===t?a.addClass(e.cl.visible):a.removeClass(e.cl.visible)}))})))})),Object.entries(a.results).forEach((([t,a])=>{a.find("a."+e.cl.overlay.urlCheckAction).on("click",(t=>{t.preventDefault();const a=e(t.currentTarget).parent("li"),l=a.data("entry");a.css("height",a[0].offsetHeight+"px"),e.delay().then((()=>(a.addClass(e.cl.hidden),Promise.all([u(l),e.delay(500)])))).then((()=>{a.remove(),g()}))})),a.find("a."+e.cl.overlay.urlCheckHide).on("click",(t=>{t.preventDefault();const a=e(t.currentTarget).parent("li"),l=a.data("entry");a.css("height",a[0].offsetHeight+"px"),e.delay().then((()=>(a.addClass(e.cl.hidden),m(l),e.delay(500)))).then((()=>{a.remove(),g()}))}))})),a.buttonWrapper.find("a."+e.cl.overlay.urlCheckAction).on("click",(t=>{t.preventDefault();const l=e(t.currentTarget).attr(e.attr.name);if(a.results&&a.results[l]){const t=[];a.results[l].find("> ul > li").forEach((a=>{e(a).find("input[type='checkbox']")[0].checked&&(t.push(e(a).data("entry")),e(a).remove())})),p(t).then((()=>{g()}))}}))},p=async e=>{for(const t of e)await u(t)},m=e=>{const a=t.helper.model.getData("u/linkcheckerIgnored");let l=e.id;const r={type:"unknown"};e.broken?(l=e.url,r.type="broken"):e.duplicates?(l=e.label,r.type="duplicate"):e.url!==e.newUrl&&(l=e.url,r.type="outdated",r.newUrl=e.newUrl),a[l]=r,t.helper.model.setData({"u/linkcheckerIgnored":a})},u=async e=>{if(l=!0,e.broken||e.duplicate||e.children&&0===e.children.length)await t.helper.bookmark.performDeletion(e.id,!0);else if(e.url!==e.newUrl){const a=e.additionalInfo&&e.additionalInfo.desc?e.additionalInfo.desc:null;await t.helper.bookmark.editEntry({id:e.id,title:e.title,url:e.newUrl,additionalInfo:a})}},g=()=>{let l=!0;Object.entries(a.results).forEach((([r,o])=>{let i=o.find("> ul > li").length();"duplicate"===r&&o.find("> ul > li").forEach((t=>{const a=e(t).find("> ul > li").length();0===a?(e(t).remove(),i--):1===a&&i--})),a.menu.find("li["+e.attr.name+"='"+r+"'] > a > span").text("("+i+")"),0===i?(o.children("ul,p").remove(),e("<p></p>").html("<span>"+t.helper.i18n.get("overlay_check_bookmarks_no_results_"+r)+"</span>").appendTo(o),a.actions&&a.actions[r]&&a.actions[r].remove()):l=!1})),l&&f()},f=()=>{a.modal.addClass(e.cl.overlay.urlCheckLoading),e.delay().then((()=>(a.modal.removeClass(e.cl.overlay.urlCheckResults),a.modal.find("menu."+e.cl.overlay.urlCheckCategories).remove(),["results","actions"].forEach((e=>{a[e]&&Object.values(a[e]).forEach((e=>{e.remove()}))})),e("<p></p>").addClass(e.cl.success).text(t.helper.i18n.get("overlay_check_bookmarks_no_results")).appendTo(a.modal),e.delay(500)))).then((()=>{a.modal.removeClass(e.cl.overlay.urlCheckLoading)}))},b=(e,t)=>{e.forEach((e=>{0===e.children.length&&(t.empty.push(e),t.count++)}))},v=(l,r)=>new Promise((o=>{let i=0;const n=[],s=l.length,d=t.helper.model.getData("u/linkcheckerIgnored"),c=e=>new Promise((l=>{let o=0;for(const c of e){let h=!1;const p=()=>{h||(h=!0,i++,o++,a.progressBar.children("div").css("width",i/s*100+"%"),a.progressLabel.children("span").eq(0).text(i.toLocaleString()),o>=e.length&&l())},m=setTimeout(p,1e4);t.helper.model.call("checkUrl",{url:c.url}).then((e=>{clearTimeout(m),e.duplicateInfo.duplicates.length>0&&-1===n.indexOf(e.duplicateInfo.label)&&(d[e.duplicateInfo.label]||(r.duplicate.push({label:e.duplicateInfo.label,url:c.url,duplicates:e.duplicateInfo.duplicates}),n.push(e.duplicateInfo.label),r.count++)),d[c.url]||(!1===e.httpInfo.success?(r.broken.push({id:c.id,title:c.title,url:c.url,broken:!0}),r.count++):e.httpInfo.url!==c.url&&(r.changed.push({id:c.id,title:c.title,url:c.url,newUrl:e.httpInfo.url,additionalInfo:c.additionalInfo}),r.count++))})).finally(p)}}));(async()=>{let t=0,a=[];for(const e of l)t++,a.push(e),(Object.keys(a).length>=5||t===l.length)&&(await c(a),a=[]);await e.delay(500),o(r)})()})),y=e=>{const a={bookmarks:[],directories:[]},l=e=>{e.forEach((e=>{e.url&&!1===t.helper.utility.isUrlOnBlacklist(e.url)?a.bookmarks.push(e):e.children&&(a.directories.push(e),l(e.children))}))};return l(e),a}},e.ListHelper=function(t){let a=0,l={},r=0;this.init=async()=>{t.elm.bookmarkBox.all.addClass(e.cl.active),Object.values(t.elm.bookmarkBox).forEach((a=>{a.on(e.opts.events.scrollBoxLastPart,(()=>{const l=a.children("ul"),r=l.data("remainingEntries");r&&r.length>0&&(this.addBookmarkDir(r,l,!1,!1),(t.refreshRun||!1===t.elm.iframe.hasClass(e.cl.page.visible))&&t.helper.scroll.restoreScrollPos(a))}))}));const a=t.helper.model.getData("b/dirOpenDuration");r=1e3*+a,this.updateBookmarkBox()},this.getSort=()=>l,this.updateSort=(e,a)=>{const r=t.helper.utility.getSortList();r[e]&&(void 0===a&&(a=r[e].dir),l={name:e,dir:"ASC"===a?"ASC":"DESC"},t.startLoading(),Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"}),t.helper.model.setData({"u/sort":l})]).then((()=>{t.helper.model.call("reload",{scrollTop:!0,type:"Sort"})})))},this.updateDirection=e=>{this.updateSort(l.name,e)},this.updateBookmarkBox=()=>new Promise((a=>{t.startLoading(),l=t.helper.model.getData("u/sort");const r=t.helper.model.getData("u/viewAsTree");t.elm.sidebar.attr(e.attr.sort,l.name+(r||"custom"===l.name?"":"-flat")),t.elm.bookmarkBox.all.children("a["+e.attr.name+"='add']").remove();const i=t.elm.bookmarkBox.all.children("ul");let s;t.updateBookmarkBoxStart=+new Date,s=t.helper.model.getData("u/viewAsTree")||"custom"===l.name?Promise.all([t.helper.model.call("getCache",{name:"htmlList"}),t.helper.model.call("getCache",{name:"htmlPinnedEntries"})]):new Promise((e=>{e()})),t.helper.scroll.focus(),s.then((a=>a&&a[0]&&a[0].val?(a[1]&&a[1].val?(t.elm.pinnedBox.html(a[1].val),t.helper.model.getData("u/lockPinned")&&(t.elm.lockPinned.addClass(e.cl.sidebar.fixed),t.elm.pinnedBox.addClass(e.cl.sidebar.fixed)),o(t.elm.pinnedBox),n(t.elm.pinnedBox)):t.elm.pinnedBox.addClass(e.cl.hidden),h(i,a[0].val)):p(i))).then((()=>{a()}))})),this.toggleBookmarkDir=(a,l,o=!0)=>new Promise((i=>{a.addClass(e.cl.sidebar.dirAnimated);const n=a.attr(e.attr.id);let s=a.next("ul");const c=s.length()>0,h=!0===t.refreshRun||!1===t.elm.iframe.hasClass(e.cl.page.visible),p=a.hasClass(e.cl.sidebar.dirOpened)&&c,m=t.helper.model.getData("b/rememberState");void 0===l&&(l=h||!1===t.helper.model.getData("b/animations"));const u=()=>{!1===h&&!1===p&&!0===t.helper.model.getData("b/rememberOpenStatesSubDirectories")&&this.restoreOpenStates(s);let l=o&&!h&&!t.helper.search.isResultsVisible();("nothing"===m||"openStatesRoot"===m&&1!==a.parents("ul:not(."+e.cl.sidebar.hideRoot+")").length())&&(l=!1),l?this.cacheList().then(i):i()};if(p)d(a,s,!1,l).then(u);else{if(t.helper.model.getData("b/dirAccordion")&&!0===o){const o=t.helper.search.isResultsVisible()?"search":"all";e([t.elm.bookmarkBox[o].find("a."+e.cl.sidebar.dirOpened),t.elm.bookmarkBox[o].find("a."+e.cl.sidebar.dirAnimated+":not("+e.cl.sidebar.dirOpened+")")]).forEach((t=>{if(t!==a[0]&&0===e(t).next("ul").find("a["+e.attr.id+"='"+n+"']").length()){let a=0;e(t).hasClass(e.cl.sidebar.dirAnimated)&&(a=r),e.delay(l?0:a).then((()=>{e(t).addClass(e.cl.sidebar.dirOpened),this.toggleBookmarkDir(e(t),l,!1).then(u)}))}}))}c?d(a,s,!0,l).then(u):t.helper.model.call("bookmarks",{id:n}).then((t=>{t.bookmarks&&t.bookmarks[0]&&t.bookmarks[0].children&&(s=e("<ul></ul>").insertAfter(a),this.addBookmarkDir(t.bookmarks[0].children,s),d(a,s,!0,l).then(u))}))}})),this.cacheList=()=>(t.log("Cache sidebar html"),Promise.all([t.helper.model.call("setCache",{name:"htmlList",val:t.elm.bookmarkBox.all.children("ul").html()}),t.helper.model.call("setCache",{name:"htmlPinnedEntries",val:t.elm.pinnedBox.html()})])),this.getActiveBookmarkBox=()=>{let a=null;return Object.values(t.elm.bookmarkBox).some((t=>{if(t.hasClass(e.cl.active))return a=t,!0})),a},this.handleSidebarWidthChange=()=>{const a=t.elm.header.children("a"),l=t.elm.header.children("h1");l.removeClass(e.cl.hidden),l.children("span").removeClass(e.cl.hidden),["label","amount"].forEach((t=>{let r=null;a.forEach((a=>{if(null===r)r=a.offsetTop;else if(a.offsetTop>2*r||0===l[0].offsetTop)return"label"===t?l.children("span").addClass(e.cl.hidden):"amount"===t&&l.addClass(e.cl.hidden),!1}))})),t.helper.selection.isEnabled()&&t.helper.selection.handleSidebarWidthChange()},this.updateSidebarHeader=()=>{if(t.helper.selection.isEnabled())return void t.helper.selection.updateSidebarHeader();let a="";const l=t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']");l.length()>0&&l[0]&&l[0].value&&(a=l[0].value),t.elm.header.text("");const r=t.helper.entry.getAmount("bookmarks");e("<h1></h1>").html("<strong>"+r+"</strong> <span>"+t.helper.i18n.get("header_bookmarks"+(1===r?"_single":""))+"</span>").attr("title",r+" "+t.helper.i18n.get("header_bookmarks"+(1===r?"_single":""),null,!0)).appendTo(t.elm.header),e("<a></a>").addClass(e.cl.sidebar.search).appendTo(t.elm.header),e("<a></a>").addClass(e.cl.sidebar.sort).appendTo(t.elm.header),e("<a></a>").addClass(e.cl.sidebar.menu).appendTo(t.elm.header),this.handleSidebarWidthChange(),e("<div></div>").addClass(e.cl.sidebar.searchBox).append("<input type='text' autocomplete='off' value='"+a.replace(/'/g,"&#x27;")+"' placeholder='"+t.helper.i18n.get("sidebar_search_placeholder",null,!0)+"' />").append("<a class='"+e.cl.sidebar.searchClose+"'></a>").appendTo(t.elm.header)},this.restoreOpenStates=(l,r=!1)=>{let o=!1;const i=t.helper.model.getData(["b/rememberState","u/openStates"]),n=()=>{!o&&r&&0===a&&e.delay(100).then((()=>{m()}))};"all"!==i.rememberState&&"openStatesAndPos"!==i.rememberState&&"openStates"!==i.rememberState&&"openStatesRoot"!==i.rememberState||Object.entries(i.openStates).forEach((([t,s])=>{if(!0===s){const s=l.find("> li > a."+e.cl.sidebar.bookmarkDir+"["+e.attr.id+"='"+t+"']:not(."+e.cl.sidebar.dirOpened+")");s.length()>0&&("openStatesRoot"===i.rememberState&&1!==s.parents("ul").length()&&!1!==r||(o=!0,a++,this.toggleBookmarkDir(s).then((()=>{a--,o=!1,n()}))))}})),n()},this.updateSortFilter=()=>{t.elm.filterBox.removeClass(e.cl.hidden).text("");let a=0;if("custom"===l.name)t.elm.filterBox.addClass(e.cl.hidden);else{const r=t.helper.model.getData(["u/viewAsTree","u/mostViewedPerMonth"]),o=l.name.replace(/([A-Z])/g,"_$1").toLowerCase();e("<a></a>").attr(e.attr.direction,l.dir).text(t.helper.i18n.get("sort_label_"+o)).appendTo(t.elm.filterBox);const i=e("<ul></ul>").appendTo(t.elm.filterBox);!1===t.helper.search.isResultsVisible()&&e("<li></li>").append(t.helper.checkbox.get(t.elm.iframeBody,{[e.attr.name]:"viewAsTree",checked:r.viewAsTree?"checked":""})).append("<a>"+t.helper.i18n.get("sort_view_as_tree")+"</a>").appendTo(i),"mostUsed"===l.name&&e("<li></li>").append(t.helper.checkbox.get(t.elm.iframeBody,{[e.attr.name]:"mostViewedPerMonth",checked:r.mostViewedPerMonth?"checked":""})).append("<a>"+t.helper.i18n.get("sort_most_used_per_month")+"</a>").appendTo(i),0===i.children("li").length()&&i.remove(),a=t.elm.filterBox.realHeight()}Object.values(t.elm.bookmarkBox).forEach((e=>{e.css("padding-top",a)})),t.elm.pinnedBox.css("top",t.helper.model.getData("u/lockPinned")?-a:0)},this.addBookmarkDir=(a,o,n=!0,s=!0)=>{let d=!1;const c=n&&"custom"===l.name&&o.prev("a").length()>0,h=t.helper.model.getData(["a/directoryArrows","a/showBookmarkIcons","a/showDirectoryIcons","u/showHidden"]);o.parents("li").length()>0&&o.css("transition","height "+r+"ms");let p=0;return o.removeData("remainingEntries"),s&&t.helper.utility.sortEntries(a,l),a.some(((l,r)=>{if((h.showHidden||t.helper.entry.isVisible(l.id))&&(l.children||l.url)&&(e.opts.demoMode&&(l.children?l.title="Directory "+(r+1):(l.title="Bookmark "+(r+1),l.url="https://example.com/")),(!1===t.helper.entry.isSeparator(l.id)||c)&&i(l,o,{config:h,asTree:n}),l.url&&p++,d=!0,!1===n&&p>=100)){const e=a.slice(r+1);return e.length>0&&o.data("remainingEntries",e),!0}})),d};const o=t=>{t.find("div."+e.cl.checkbox.box).removeClass(e.cl.active),t.find("a."+e.cl.sidebar.mark).removeClass(e.cl.sidebar.mark),t.find("a."+e.cl.hover).removeClass(e.cl.hover),t.find("a."+e.cl.selected).removeClass(e.cl.selected),t.find("li."+e.cl.drag.dragHover).removeClass(e.cl.drag.dragHover),t.find("a."+e.cl.drag.dragHover).removeClass(e.cl.drag.dragHover),t.find("a."+e.cl.sidebar.lastHover).removeClass(e.cl.sidebar.lastHover),t.find("li."+e.cl.drag.dragInitial).removeClass(e.cl.drag.dragInitial),t.find("li."+e.cl.drag.isDragged).remove();const a=t.find("a."+e.cl.sidebar.removed).parent("li");a&&a.length()>0&&a.remove()},i=(a,l,r)=>{const o=e("<li></li>").appendTo(l),i=a.title&&a.title.trim().length?a.title:"",n=e("<a></a>").appendTo(o),d=e("<span></span>").addClass(e.cl.sidebar.bookmarkLabel).text(i.trim()).appendTo(n),c=e("<span></span>").addClass(e.cl.drag.trigger).appendTo(n);if(a.id&&n.attr(e.attr.id,a.id),!1===t.helper.entry.isVisible(a.id)&&o.addClass(e.cl.hidden),t.helper.entry.isSeparator(a.id)){n.addClass(e.cl.sidebar.separator);const t=a.title.replace(/(^[-_]+|[-_]+$)/g,"").trim();t.length>0&&d.attr(e.attr.name,t),d.text("")}else a.children?(n.addClass(e.cl.sidebar.bookmarkDir),e("<span></span>").addClass(e.cl.add).insertBefore(c),r.config.showDirectoryIcons&&n.prepend("<span class='"+e.cl.sidebar.dirIcon+"'></span>"),r.config.directoryArrows&&n.addClass(e.cl.sidebar.dirArrow)):a.url&&(n.addClass(e.cl.sidebar.bookmarkLink),r.config.showBookmarkIcons&&(e.opts.demoMode?n.prepend("<span class='"+e.cl.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"'></span>"):s(n,a.url)));return r.pinnedBox||t.helper.checkbox.get(t.elm.iframeBody,{[e.attr.name]:"select"}).prependTo(n),o},n=(a,l=!1)=>new Promise((r=>{const o=[];a.find("a."+e.cl.sidebar.bookmarkLink+" > img["+e.attr.value+"]").forEach((t=>{const a=e(t).parent("a"),l=e(t).attr(e.attr.value);o.push(s(a,l))})),o.length>0?(t.log("Detected: Missing bookmark favicons"),Promise.all(o).then((()=>{l?this.cacheList().then(r):r()}))):r()})),s=async(a,l)=>{a.children("img").remove();const r=e("<img />").prependTo(a);r.attr(e.attr.value,l);const o=await t.helper.model.call("favicon",{url:l});if(o){const a=t.elm.iframe.hasClass(e.cl.page.visible);r.attr(a?"src":e.attr.src,o)}r.removeAttr(e.attr.value)},d=(a,l,o,i)=>new Promise((n=>{if(l.css("height",l[0].scrollHeight+"px"),!1===o&&e.delay(50).then((()=>{l.css("height",0)})),!0===t.refreshRun)this.restoreOpenStates(l,!0);else{const l=t.helper.model.getData("u/openStates");l[a.attr(e.attr.id)]=o,!1===o&&!1===t.helper.model.getData("b/rememberOpenStatesSubDirectories")?c(a,l):!1===t.helper.search.isResultsVisible()&&t.helper.model.setData({"u/openStates":l})}e.delay(i?20:r).then((()=>{if(!1===o)a.removeClass(e.cl.sidebar.dirOpened);else if(a.addClass(e.cl.sidebar.dirOpened),t.helper.model.getData("b/dirAccordion")&&!1===t.refreshRun){const e=t.helper.search.isResultsVisible()?"search":"all";t.helper.scroll.getScrollPos(t.elm.bookmarkBox[e])>a[0].offsetTop&&t.helper.scroll.setScrollPos(t.elm.bookmarkBox[e],a[0].offsetTop,300)}l.css("height",""),a.removeClass(e.cl.sidebar.dirAnimated),n()}))})),c=(a,l)=>{a.next("ul").find("a."+e.cl.sidebar.bookmarkDir).forEach((t=>{l[e(t).attr(e.attr.id)]=!1,e.delay(500).then((()=>{e(t).removeClass(e.cl.sidebar.dirOpened)}))})),!1===t.helper.search.isResultsVisible()&&t.helper.model.setData({"u/openStates":l})},h=async(a,l)=>{t.log("Load html from cache"),a.html(l),o(a),a.find("div."+e.cl.checkbox.box).forEach((a=>{t.helper.checkbox.initEvents(e(a),t.elm.iframeBody)})),n(a,!0),t.elm.bookmarkBox.all.addClass(e.cl.sidebar.cached),this.updateSidebarHeader(),this.updateSortFilter(),1===a.children("li").length()&&(a.addClass(e.cl.sidebar.hideRoot),e("<a></a>").attr(e.attr.name,"add").insertAfter(a)),await e.delay(100),m()},p=a=>new Promise((r=>{t.log("Load html from object");let o=[];const n=t.helper.model.getData("u/viewAsTree");t.elm.bookmarkBox.all.removeClass(e.cl.sidebar.cached),t.helper.model.call("bookmarks",{id:0}).then((l=>(t.refreshRun=!0,a.removeClass(e.cl.sidebar.hideRoot).text(""),l.bookmarks&&l.bookmarks[0]&&l.bookmarks[0].children&&(o=l.bookmarks[0].children),t.helper.entry.init(o)))).then((()=>{this.updateSidebarHeader(),(()=>{const a=t.helper.model.getData(["a/directoryArrows","a/showBookmarkIcons","a/showDirectoryIcons","u/showHidden"]);t.elm.lockPinned.removeClass(e.cl.sidebar.fixed),t.elm.pinnedBox.removeClass([e.cl.hidden,e.cl.sidebar.fixed]),t.elm.pinnedBox.children("ul").remove();const r=t.helper.entry.getAllDataByType("pinned");if(0===r.length)t.elm.pinnedBox.addClass(e.cl.hidden);else{t.helper.utility.sortEntries(r,l);const o=e("<ul></ul>").appendTo(t.elm.pinnedBox);t.helper.model.getData("u/lockPinned")&&(t.elm.lockPinned.addClass(e.cl.sidebar.fixed),t.elm.pinnedBox.addClass(e.cl.sidebar.fixed)),r.forEach((e=>{(a.showHidden||t.helper.entry.isVisible(e.id))&&i(e,o,{config:a,asTree:!1,pinnedBox:!0})}))}})(),n||"custom"===l.name?(this.addBookmarkDir(o,a,!0),1===a.children("li").length()?(a.addClass(e.cl.sidebar.hideRoot),e("<a></a>").attr(e.attr.name,"add").insertAfter(a),this.toggleBookmarkDir(a.find("> li > a."+e.cl.sidebar.bookmarkDir).eq(0))):this.restoreOpenStates(a,!0)):(this.addBookmarkDir(t.helper.entry.getAllDataByType("bookmarks"),a,!1),m()),this.updateSortFilter(),r()}))})),m=()=>{t.helper.scroll.restoreScrollPos(t.elm.bookmarkBox.all).then((()=>{t.initImages(),t.endLoading(200),t.refreshRun=!1,!t.helper.model.getData("u/viewAsTree")&&"custom"!==l.name||t.elm.bookmarkBox.all.hasClass(e.cl.sidebar.cached)||this.cacheList(),t.loaded()}))}},e.ModelHelper=function(t){const a={default:{textColor:{light:"#646464",dark:"#c8c8c8"},bookmarksDirColor:{light:"#646464",dark:"#c8c8c8"},sidebarMaskColor:{light:"rgba(255, 255, 255, 0.8)",dark:"rgba(0, 0, 0, 0.6)"},overlayMaskColor:{light:"rgba(0, 0, 0, 0.5)",dark:"rgba(0, 0, 0, 0.5)"},hoverColor:{light:"#f5f5f5",dark:"#555555"},colorScheme:{light:"#1b82f1",dark:"#1f4d80"},foregroundColor:{light:"#ffffff",dark:"#333333"},icon:{forLight:"#555555",forDark:"#ffffff"}},glass:{sidebarMaskColor:{light:"rgba(0, 0, 0, 0)",dark:"rgba(0, 0, 0, 0)"},overlayMaskColor:{light:"rgba(255, 255, 255, 0.5)",dark:"rgba(0, 0, 0, 0.3)"},textColor:{light:"#444444",dark:"#dfdfdf"},bookmarksDirColor:{light:"#444444",dark:"#dfdfdf"},hoverColor:{light:"rgba(0, 0, 0, 0.05)",dark:"rgba(255, 255, 255, 0.1)"}}},l=["textColor","hoverColor","sidebarMaskColor","bookmarksDirColor","overlayMaskColor"],r={u:{openStates:{},hiddenEntries:{},additionalInfo:{},scrollPos:0,separators:{},customCss:"",pinnedEntries:{},lockPinned:!0,translationHelp:!0,translationThanked:!1,entryAmounts:{},linkcheckerIgnored:{},lastOpened:null,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{overlayEnabled:!0,animations:!0,preventPageScroll:!1,toggleArea:{width:2,widthWindowed:20,height:100,top:0},blacklist:[],whitelist:[],sidebarPosition:"left",iconAction:"sidepanel",openAction:"mousedown",newTab:"foreground",newTabPosition:"afterCurrent",visibility:"always",linkAction:"current",dirAccordion:!1,preventWindowed:!1,preventWebapp:!1,rememberState:"openStatesAndPos",rememberOpenStatesSubDirectories:!0,newEntryPosition:"append",tooltipDelay:.5,tooltipContent:"all",tooltipAdditionalInfo:!0,dndCreationDialog:!1,closeOnTabChange:!0,openChildrenWarnLimit:10,dirOpenDuration:.4,scrollBarHide:1.5,openDelay:0,closeTimeout:1,dndOpenDirDelay:.5,refocusWebsite:!1},a:{theme:"default",showIndicator:!0,showIndicatorIcon:!0,surface:"light",highContrast:!1,directoryArrows:!1,showBookmarkIcons:!0,showDirectoryIcons:!0,devModeIconBadge:!0,styles:{colorScheme:a.default.colorScheme.light,foregroundColor:a.default.foregroundColor.light,textColor:null,hoverColor:null,indicatorWidth:"24px",indicatorIconSize:"24px",indicatorIconColor:"#ffffff",indicatorColor:"rgba(0,0,0,0.5)",iconShape:"bookmark",iconColor:"auto",sidebarWidth:"350px",sidebarHeaderHeight:"50px",sidebarMaskColor:null,bookmarksFontSize:"14px",directoriesIconSize:"16px",bookmarksIconSize:"16px",bookmarksLineHeight:"38px",bookmarksDirIcon:"dir-1",bookmarksDirColor:null,bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",scrollBarWidth:"11px",tooltipFontSize:"9px",overlayMaskColor:null,overlayHeaderHeight:"50px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',backgroundTransparency:.8,backgroundBlur:"7px"}},n:{override:!1,faviconShape:"new-1",faviconColor:"#545454",faviconBackground:"transparent",faviconPadding:10,autoOpen:!0,focusOmnibox:!1,searchSuggestQueries:!0,searchSuggestBookmarks:!0,searchSuggestHistory:!0,searchField:"show",searchEngine:"google",searchEngineCustom:{title:"",homepage:"",queryUrl:""},gridType:"topPages",gridMaxCols:4,gridMaxRows:2,customGridLinks:[],topLinks:[],topLinksPosition:"right",website:"",searchSuggestionNextKeys:["ArrowDown","Tab"],searchSuggestionPrevKeys:["ArrowUp","Tab"]}};let o={},i=null;this.init=async()=>{await n()};const n=async()=>{if(!e.api.storage)return;const t=["utility","behaviour","appearance","newtab"],a={};for(const l of t){const t=await e.api.storage["utility"===l?"local":"sync"].get([l]);a[l]=t[l]||{}}if(o=a,null===i){const e=await this.call("userType");e&&e.userType&&(i=e.userType)}},s=e=>{switch(e){case"u":return"utility";case"b":return"behaviour";case"a":return"appearance";case"n":return"newtab"}return null};this.getUserType=()=>i,this.getAllData=()=>o,this.getSurfaceColorDependentStyles=()=>l,this.getDefaultData=()=>{const e={};return Object.entries(r).forEach((([t,a])=>{const l=s(t);l&&(e[l]=a)})),e},this.getDefaultColors=(e="default")=>Object.assign({},a.default,a[e]),this.getData=(e,i=!1)=>{let n=e;"string"==typeof n&&(n=[n]);let d={};if(n.forEach((e=>{const n=e.split("/")[0],c=e.split("/")[1];let h=null;const p=s(n);if(p&&o[p]&&(!0===i||void 0===o[p][c]?void 0!==r[n]&&void 0!==r[n][c]&&(h=r[n][c]):h=o[p][c]),"a/styles"===e){const e=this.getData("a/surface"),o="auto"===e?t.helper.stylesheet.getSystemSurface():e,i=this.getData("a/theme");h=Object.assign({},r.a.styles,h);for(const t of l)null!==h[t]&&"auto"!==e||(a[i]&&a[i][t]?h[t]=a[i][t][o]:h[t]=a.default[t][o]);"auto"!==e||h.colorScheme!==a.default.colorScheme.light&&h.colorScheme!==a.default.colorScheme.dark||(h.colorScheme=a.default.colorScheme[o]),t.helper.font&&Object.assign(h,t.helper.font.getFontWeights())}d[c]=h})),"string"==typeof e){const t=e.split("/")[1];d=d[t]}return d},this.setData=t=>new Promise((a=>{n().then((()=>{Object.keys(t).forEach((e=>{const a=e.split("/")[0],l=e.split("/")[1],r=t[e];switch(a){case"u":o.utility[l]=r;break;case"b":o.behaviour[l]=r;break;case"a":o.appearance[l]=r;break;case"n":o.newtab[l]=r}}));let l=0;const r=(e=1)=>{l+=e,l>=4&&a()};try{e.api.storage.local.set({utility:o.utility},(()=>{e.api.runtime.lastError,r()})),e.api.storage.sync.set({behaviour:o.behaviour,appearance:o.appearance,newtab:o.newtab},(()=>{e.api.runtime.lastError,r(3)}))}catch(e){a()}}))})),this.call=async(t,a={},l=0)=>{let r=!1;a.type=t;let o=await e.api.runtime.sendMessage(a).catch((e=>{e&&(""+e).includes("Could not establish connection")?r=!0:console.error(e)}));return r&&l<50&&(await e.delay(100),o=await this.call(t,a,l+1)),o}},e.OverlayHelper=function(t){let a={};const l={tab:"&#8633;",shift:"&#8679;",cmd:"&#8984;",enter:"&#9166;"};this.create=(e,l,r)=>{switch(t.helper.tooltip.close(),a=t.helper.template.overlay(e,l),a.overlay.data("info",r||{}),this.setCloseButtonLabel("infos"===e?"close":"cancel"),e){case"delete":s(r);break;case"deleteSelected":n(r);break;case"edit":t.helper.entry.isSeparator(r.id)?d(r):c(r);break;case"infos":g(r);break;case"add":u(r);break;case"hide":m(r);break;case"openChildren":h(r);break;case"openSelected":p(r);break;case"checkBookmarks":t.helper.linkchecker.run(a.modal,r.children);break;case"keyboardShortcuts":i(r)}a.modal.find("input").length()>0&&a.modal.find("input")[0].focus(),t.helper.keyboard.initOverlayEvents(a.overlay),T()},this.performAction=()=>{const l=a.overlay.data("info");switch(a.modal.attr(e.attr.type)){case"delete":k(l);break;case"deleteSelected":y(l);break;case"hide":v(l);break;case"openChildren":f(l);break;case"openSelected":b(l);break;case"edit":t.helper.entry.isSeparator(l.id)?C(l):x(l);break;case"add":E(l)}},this.closeOverlay=()=>{t.helper.utility.triggerEvent("overlayClosed"),t.elm.bookmarkBox.all.find("li."+e.cl.drag.isDragged).remove(),a.overlay.removeClass(e.cl.page.visible),"sidepanel"===t.helper.utility.getPageType()&&a.modal.removeClass(e.cl.visible),t.helper.scroll.focus(),e.delay(400).then((()=>{a.overlay.remove()}))},this.setCloseButtonLabel=(l="close")=>{a.buttonWrapper.children("a."+e.cl.close).text(t.helper.i18n.get("overlay_"+l))},this.isOpened=()=>e("#"+e.opts.ids.page.overlay).length()>0;const r=l=>{if(l.additionalInfo&&l.additionalInfo.desc){const r=e("<div></div>").addClass(e.cl.info).appendTo(a.modal);e("<h3></h3>").text(t.helper.i18n.get("overlay_bookmark_additional_info")).appendTo(r),e("<p></p>").text(l.additionalInfo.desc).appendTo(r)}},o=(l,r)=>{const o=e("<"+(l.isDir?"span":"a")+"></"+(l.isDir?"span":"a")+">").attr("title",l.title).addClass(e.cl.overlay.preview).text(l.title).appendTo(a.modal);l.isDir?o.prepend("<span class='"+e.cl.sidebar.dirIcon+"'></span>"):e.opts.demoMode?o.prepend("<span class='"+e.cl.sidebar.dirIcon+"' data-color='"+(Math.floor(10*Math.random())+1)+"'></span>"):t.helper.model.call("favicon",{url:l.url}).then((e=>{e.img&&o.prepend("<img src='"+e.img+"' />")})),r&&!0===r&&!0!==l.isDir&&e("<a></a>").addClass(e.cl.overlay.previewUrl).attr("title",l.url).text(l.url).insertAfter(o)},i=()=>{const r=e("<div></div>").addClass(e.cl.scrollBox.wrapper).appendTo(a.modal),o=e("<div></div>").append("<h3>"+t.helper.i18n.get("settings_open_action")+"</h3>").appendTo(r);e("<a></a>").text(t.helper.i18n.get("settings_keyboard_shortcut_button")).appendTo(o).on("click",(e=>{e.preventDefault(),t.helper.model.call("openLink",{href:"chrome://extensions/shortcuts",newTab:!0,active:!0})}));const i=e("<ul></ul>").appendTo(o),n={tab:[["&#8593;"],["&#8595;"],["tab"]],enter:[["enter"]],shift_enter:[["shift","enter"]],ctrl_c:[["macOS"===e.ua().os?"cmd":"ctrl","c"]],del:[["del"]],esc:[["esc"]]};Object.entries(n).forEach((([a,r])=>{const o=[];r.forEach((e=>{e=e.map((e=>{let a="<i>";return a+=t.helper.i18n.get("keyboard_shortcuts_key_"+e)||e,l[e]&&(a+=" "+l[e]),a+="</i>",a})),o.push("<strong>"+e.join("+")+"</strong>")})),e("<li></li>").html(o.join(", ")).append("<span>"+t.helper.i18n.get("keyboard_shortcuts_"+a+"_desc")+"</span>").appendTo(i)})),this.setCloseButtonLabel("close")},n=l=>{e("<p></p>").text(t.helper.i18n.get("overlay_delete_selected_confirm")).appendTo(a.modal),e("<p></p>").addClass(e.cl.selected).html("<strong>"+l.length+"</strong> <span>"+t.helper.i18n.get("header_selected_entries")+"</span>").appendTo(a.modal),e("<a></a>").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_delete")).appendTo(a.buttonWrapper)},s=l=>{e("<p></p>").text(t.helper.i18n.get("overlay_delete_"+(l.isDir?"dir":"bookmark")+"_confirm")).appendTo(a.modal),o(l),r(l),e("<a></a>").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_delete")).appendTo(a.buttonWrapper)},d=l=>{const r=e("<ul></ul>").appendTo(a.modal),o=l.title.replace(/'/g,"&#x27;").replace(/(^[-_]+|[-_]+$)/g,"").trim();e("<li></li>").html("<span>"+t.helper.i18n.get("overlay_separator_title_desc")+"</span>").appendTo(r),e("<li></li>").append("<label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label>").append("<input type='text' name='title' value='"+o+"' />").appendTo(r),e("<a></a>").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(a.buttonWrapper)},c=l=>{o(l);const r=e("<ul></ul>").appendTo(a.modal);e("<li></li>").append("<label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label>").append("<input type='text' name='title' value='"+l.title.replace(/'/g,"&#x27;")+"' />").appendTo(r),l.isDir||e("<li></li>").append("<label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label>").append("<input type='text' name='url' value='"+l.url.replace(/'/g,"&#x27;")+"' />").appendTo(r);const i=e("<li></li>").addClass(e.cl.info).append("<label>"+t.helper.i18n.get("overlay_bookmark_additional_info")+"</label>").appendTo(r),n=e("<textarea name='info'></textarea>").appendTo(i);n[0].value=l.additionalInfo&&l.additionalInfo.desc||"",i.append("<span>"+t.helper.i18n.get("settings_not_synced")+"</span>"),n.on("focus",(()=>{i.addClass(e.cl.active)})).on("blur",(()=>{i.removeClass(e.cl.active)})),e("<a></a>").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(a.buttonWrapper)},h=l=>{const r=l.children.filter((e=>e.url&&!e.url.startsWith("about:blank"))),i=t.helper.i18n.get("overlay_confirm_open_children",[r.length]);e("<p></p>").text(i).appendTo(a.modal),o(l),e("<a></a>").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_open_children")).appendTo(a.buttonWrapper)},p=l=>{const r=t.helper.i18n.get("overlay_confirm_open_selected",[l.length]);e("<p></p>").text(r).appendTo(a.modal),e("<a></a>").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_open_children")).appendTo(a.buttonWrapper)},m=l=>{e("<p></p>").text(t.helper.i18n.get("overlay_hide_"+(l.isDir?"dir":"bookmark")+"_confirm")).appendTo(a.modal),o(l),r(l),e("<a></a>").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_hide_from_sidebar")).appendTo(a.buttonWrapper)},u=l=>{const r=t.helper.model.getData("u/sort"),o=e("<a></a>").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(a.buttonWrapper),i=e("<menu></menu>").attr(e.attr.name,"select").appendTo(a.modal),n={bookmark:e("<a></a>").attr(e.attr.type,"bookmark").attr("title",t.helper.i18n.get("overlay_label_bookmark")).appendTo(i),dir:e("<a></a>").attr(e.attr.type,"dir").attr("title",t.helper.i18n.get("overlay_label_dir")).appendTo(i)};"custom"===r.name&&(n.separator=e("<a></a>").attr(e.attr.type,"separator").attr("title",t.helper.i18n.get("overlay_label_separator")).appendTo(i)),i.on("mouseleave",(t=>{e(t.currentTarget).children("a").removeClass(e.cl.hover)})),i.children("a").on("mouseenter",(t=>{i.children("a").removeClass(e.cl.hover),e(t.currentTarget).addClass(e.cl.hover)})).on("mouseleave",(t=>{e(t.currentTarget).removeClass(e.cl.hover)})).on("click",(async r=>{r.preventDefault();const n=e(r.currentTarget),s=n.attr(e.attr.type),d=e("<ul></ul>").attr(e.attr.type,s).appendTo(a.modal);let c="",h="";if("bookmark"===s){c=document.title||"",h=location.href;try{if(e.api.tabs){const t=await e.api.tabs.query({active:!0,currentWindow:!0});t&&t[0]&&(c=t[0].title||"",h=t[0].url||"")}}catch(e){console.error(e)}}l&&l.values&&(c=(l.values.title||"").trim(),h=(l.values.url||"").trim()),d.append("<li><h2>"+n.attr("title")+"</h2></li>"),"separator"===s&&d.append("<li><span>"+t.helper.i18n.get("overlay_separator_title_desc")+"</span></li>"),d.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label><input type='text' name='title' value='"+c.replace(/'/g,"&#x27;")+"' /></li>"),"bookmark"===s&&d.append("<li><label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label><input type='text' name='url' value='"+h.replace(/'/g,"&#x27;")+"'  /></li>");if("custom"===t.helper.model.getData("u/sort").name&&(!l.values||void 0===l.values.index)){d.append("<li><label>"+t.helper.i18n.get("overlay_add_position")+"</label><select name='position'> <option value='append'>"+t.helper.i18n.get("overlay_add_position_append")+"</option> <option value='prepend'>"+t.helper.i18n.get("overlay_add_position_prepend")+"</option></select></li>");const e=t.helper.model.getData("b/newEntryPosition");d.find("select[name='position'] > option[value='"+e+"']").length()>0&&(d.find("select[name='position']")[0].value=e)}i.addClass(e.cl.hidden),i.children("a").removeClass(e.cl.hover),await e.delay(l&&l.values?0:100),d.addClass(e.cl.visible),d.find("input")[0].focus(),o.addClass(e.cl.visible)})),l.overlayType&&n[l.overlayType]?n[l.overlayType].trigger("click"):l&&l.values&&n.bookmark.trigger("click")},g=l=>{o(l,!0);const i=t.helper.entry.getParentsById(l.id);if(i.length>0){const t=e("<ul></ul>").addClass(e.cl.sidebar.breadcrumb).appendTo(a.modal);i.forEach((a=>{e("<li></li>").text(a.title).prependTo(t)}))}r(l);const n=e("<ul></ul>").appendTo(a.modal),s=new Date(l.dateAdded);if(e("<li></li>").html(t.helper.i18n.get("overlay_bookmark_created_date")+" "+t.helper.i18n.getLocaleDate(s)).appendTo(n),l.isDir){const a=e("<li></li>").addClass(e.cl.tooltip.wrapper).append("<span>"+l.childrenAmount.total+"</span>").append(" "+t.helper.i18n.get("overlay_dir_children"),!1).appendTo(n);e("<ul></ul>").append("<li>"+l.childrenAmount.bookmarks+" "+t.helper.i18n.get("overlay_dir_children_bookmarks")+"</li>").append("<li>"+l.childrenAmount.directories+" "+t.helper.i18n.get("overlay_dir_children_dirs")+"</li>").appendTo(a)}const d=e("<li></li>").addClass(e.cl.tooltip.wrapper).append("<span>"+l.views.total+"</span>").append(" "+t.helper.i18n.get("overlay_bookmark_views"+(1===l.views.total?"_single":"")),!1).appendTo(n),c=new Date(l.views.startDate);e("<ul></ul>").append("<li>"+t.helper.i18n.get("overlay_bookmark_views_since")+" "+t.helper.i18n.getLocaleDate(c)+"</li>").append("<li>"+l.views.perMonth+" "+t.helper.i18n.get("overlay_bookmark_views"+(1===l.views.perMonth?"_single":""))+" "+t.helper.i18n.get("overlay_bookmark_views_per_month")+"</li>").appendTo(d)},f=e=>{this.closeOverlay();const a=e.children.filter((e=>e.url&&!e.url.startsWith("about:blank")));t.helper.utility.openAllBookmarks(a)},b=e=>{this.closeOverlay(),t.helper.utility.openAllBookmarks(e)},v=e=>{t.startLoading(),this.closeOverlay();const a=t.helper.model.getData("u/hiddenEntries");a[e.id]=!0,t.helper.model.setData({"u/hiddenEntries":a}).then((()=>Promise.all([t.helper.model.call("removeCache",{name:"htmlList"}),t.helper.model.call("removeCache",{name:"htmlPinnedEntries"})]))).then((()=>{t.helper.model.call("reload",{type:"Hide"})}))},y=async a=>{t.startLoading();for(const l of a)t.elm.bookmarkBox.all.find("a["+e.attr.id+"='"+l.id+"']").parent("li").remove(),await t.helper.bookmark.performDeletion(l.id,!0);t.helper.model.call("reload",{type:"Hide"}),this.closeOverlay()},k=a=>{this.closeOverlay(),t.elm.bookmarkBox.all.find("a["+e.attr.id+"='"+a.id+"']").parent("li").remove(),t.helper.bookmark.performDeletion(a.id)},w=l=>{const r=a.modal.find("input[name='title']").removeClass(e.cl.error),o=a.modal.find("input[name='url']").removeClass(e.cl.error),i=a.modal.find("select[name='position']"),n=a.modal.find("textarea[name='info']"),s={errors:!1,values:{title:r[0].value.trim(),url:l?null:o[0].value.trim(),position:i.length()>0?i[0].value:t.helper.model.getData("b/newEntryPosition"),additionalInfo:n.length()>0&&n[0].value||null}};return 0===s.values.title.length&&(r.addClass(e.cl.error),s.errors=!0),l||0!==s.values.url.length||(o.addClass(e.cl.error),s.errors=!0),null!==s.values.url&&0!==s.values.url.search(/^[\w-]+\:/)&&(s.values.url="http://"+s.values.url),s},C=async e=>{const l=a.modal.find("input[name='title']")[0].value.trim(),r=Math.floor(99999*Math.random())+1e4;await t.helper.bookmark.editEntry({id:e.id,title:l.length>0?"---- "+l+" ----":"----------",url:"about:blank?"+r}),t.helper.model.call("reload",{type:"Edit"}),this.closeOverlay()},x=async l=>{const r=w(l.isDir);if(!1===r.errors){(await t.helper.bookmark.editEntry({id:l.id,title:r.values.title,url:r.values.url,additionalInfo:r.values.additionalInfo})).error?a.modal.find("input[name='url']").addClass(e.cl.error):(t.helper.model.call("reload",{type:"Edit"}),this.closeOverlay())}},D=(a,l)=>{if("prepend"===l)return 0;return t.elm.bookmarkBox.all.find("ul > li > a["+e.attr.id+"='"+a+"'] + ul").children("li").length()},_=e=>{const l=a.modal.find("input[name='title']")[0].value.trim(),r=a.modal.find("select[name='position'")[0].value,o=Math.floor(99999*Math.random())+1e4,i=e.id||null;t.helper.model.call("createBookmark",{title:l.length>0?"---- "+l+" ----":"----------",url:"about:blank?"+o,parentId:e.id||null,index:D(i,r)}).then((()=>{this.closeOverlay()}))},E=l=>{if("separator"===a.modal.children("ul").attr(e.attr.type))_(l);else{const r=w(0===a.modal.find("input[name='url']").length());if(!1===r.errors){const o={title:r.values.title,url:r.values.url,parentId:l.id||null,index:0};l&&l.values?(l.values.index&&(o.index=l.values.index),l.values.parentId&&(o.parentId=l.values.parentId)):o.index=D(o.parentId,r.values.position),t.helper.model.call("createBookmark",o).then((t=>{t.error?a.modal.find("input[name='url']").addClass(e.cl.error):this.closeOverlay()}))}}},T=()=>{const l=a.overlay.find("body");"auto"===t.helper.model.getData("a/surface")&&e(document).on(e.opts.events.systemColorChanged,(()=>{"dark"===t.helper.stylesheet.getSystemSurface()?l.addClass(e.cl.page.dark):l.removeClass(e.cl.page.dark)}));let r=null;l.on("mousedown",(e=>{r=e.target})).on("click",(e=>{"BODY"===e.target.tagName&&"BODY"===r.tagName&&this.closeOverlay()})),a.modal.find("a."+e.cl.close).on("click",(e=>{e.preventDefault(),this.closeOverlay()})),a.modal.on("click","a."+e.cl.overlay.action,(e=>{e.preventDefault(),this.performAction()})),a.modal.on("focus","input",(t=>{e(t.currentTarget).removeClass(e.cl.error)})),a.modal.find("a."+e.cl.overlay.preview+", a."+e.cl.overlay.previewUrl).on("click",(e=>{e.preventDefault(),t.helper.utility.openUrl(a.overlay.data("info"),"newTab")}))}},e.ScrollHelper=function(t){let a=+new Date;const l={},r=[];let o=0;this.init=()=>{const e=t.helper.model.getData("b/scrollBarHide");o=1e3*+e},this.add=(t,a)=>{const l=e("<div id='"+t+"' class='"+e.cl.scrollBox.wrapper+"' tabindex='0'></div>").insertBefore(a);return a=a.appendTo(l),l.data({list:a}),r.push(l),d(l),l},this.focus=()=>{t.elm.iframe.hasClass(e.cl.page.visible)&&null!==t.elm.iframeDocument&&t.helper.toggle.sidebarHoveredOnce()&&t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']")[0]!==t.elm.iframeDocument[0].activeElement&&r.forEach((t=>{t.hasClass(e.cl.active)&&t[0].focus()}))},this.restoreScrollPos=a=>new Promise((l=>{const r=t.helper.model.getData(["b/rememberState","u/scrollPos"]);"all"===r.rememberState||"openStatesAndPos"===r.rememberState?(this.setScrollPos(a,r.scrollPos),e.delay(100).then(l)):l()})),this.setScrollPos=(e,t,a=0)=>{if(0===a)e[0].scrollTop=t,this.update(e);else{const l=e[0].scrollTop;let r=0;const o=()=>{r+=1/60;const i=r/(a/1e3),n=Math.sin(i*(Math.PI/2));i<1?(window.requestAnimationFrame(o),e[0].scrollTop=l+(t-l)*n):(e[0].scrollTop=t,this.update(e))};o()}},this.getScrollPos=e=>e[0].scrollTop,this.update=a=>{t.helper.contextmenu.close(),t.helper.tooltip.close();const r=s(a),d=i(a),c=a[0].scrollTop;a.attr("id")===e.opts.ids.sidebar.bookmarkBox.all&&n(c),c>10?a.addClass(e.cl.scrollBox.scrolled):a.removeClass(e.cl.scrollBox.scrolled);const h=a.data("lastPos")||0;c>h?a.attr(e.attr.direction,"down"):c<h?a.attr(e.attr.direction,"up"):a.removeAttr(e.attr.direction),a.data("lastPos",c),(d-c<2*r||d===c&&0===r)&&a.trigger(e.opts.events.scrollBoxLastPart),o>0&&(t.elm.iframe.hasClass(e.cl.page.visible)?(a.removeClass(e.cl.scrollBox.hideScrollbar),clearTimeout(l[a.attr("id")]),l[a.attr("id")]=setTimeout((()=>{a.addClass(e.cl.scrollBox.hideScrollbar)}),o)):a.addClass(e.cl.scrollBox.hideScrollbar)),this.focus()};const i=t=>{let a=0;return t.children().forEach((t=>{a+=e(t).realHeight(!0)})),a},n=e=>{!1===t.refreshRun&&(clearTimeout(l._scrollPos),+new Date-a>500?(a=+new Date,t.helper.model.setData({"u/scrollPos":e})):l._scrollPos=setTimeout((()=>{n(e)}),500))},s=e=>e.realHeight()-parseInt(e.css("padding-top")),d=e=>{e.on("scroll",(()=>{this.update(e)}))}},e.SearchHelper=function(t){let a=null;this.searchVal="",this.init=()=>{i()},this.isResultsVisible=()=>t.elm.bookmarkBox.search.hasClass(e.cl.active),this.clearSearch=()=>new Promise((a=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elm.header.removeClass(e.cl.sidebar.searchVisible),this.update("").then(a)})),this.showSearchField=()=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),t.elm.header.addClass(e.cl.sidebar.searchVisible),t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']")[0].focus()},this.update=(a=null)=>new Promise((r=>{const i=t.elm.header.find("div."+e.cl.sidebar.searchBox+" > input[type='text']");i&&i.length()>0?(null===a?a=i[0].value:i[0].value=a,a&&a.length>0?l(i,a).then(r):o(i).then(r)):r()}));const l=(a,l)=>new Promise((o=>{t.elm.bookmarkBox.all.removeClass(e.cl.active).removeClass(e.cl.scrollBox.scrolled),t.elm.bookmarkBox.search.addClass(e.cl.active),t.helper.scroll.focus(),t.helper.list.updateSortFilter(),this.searchVal=l,l!==a.data("lastVal")&&(t.startLoading(),a.data("lastVal",l),t.helper.entry.initOnce().then((()=>(t.helper.scroll.setScrollPos(t.elm.bookmarkBox.search,0),r(l)))).then((a=>{t.elm.bookmarkBox.search.children("p").remove();let l=!1;const r=t.elm.bookmarkBox.search.children("ul");r.text(""),a.length>0&&(l=t.helper.list.addBookmarkDir(a,r,!1)),!1===l&&e("<p></p>").text(t.helper.i18n.get("sidebar_search_no_results")).appendTo(t.elm.bookmarkBox.search),t.endLoading(100),o()})))})),r=async e=>{const a=e.toLowerCase(),l=[],r=(await t.helper.model.call("searchBookmarks",{searchVal:e})).bookmarks||[];r.forEach((e=>{l.push(e.id)}));t.helper.entry.getAllDataByType("directories").forEach(((e,t)=>{e.title.toLowerCase().indexOf(a)>-1&&(e.index=-1e3+t,r.push(e),l.push(e.id))}));const o=t.helper.model.getData("u/additionalInfo");return Object.entries(o).forEach((([e,o])=>{if(o&&o.desc&&o.desc.toLocaleLowerCase().indexOf(a)>-1&&-1===l.indexOf(e)){const a=t.helper.entry.getDataById(e);a&&(a.isDir&&(a.index=-1e3+a.index),r.push(a))}})),r},o=a=>new Promise((l=>{a.removeData("lastVal"),this.searchVal="",this.isResultsVisible()&&(t.startLoading(),t.elm.bookmarkBox.all.addClass(e.cl.active),t.elm.bookmarkBox.search.removeClass([e.cl.active,e.cl.scrollBox.scrolled]),t.elm.bookmarkBox.search.removeAttr(e.attr.direction),t.helper.scroll.restoreScrollPos(t.elm.bookmarkBox.all),t.helper.scroll.focus(),t.endLoading()),t.helper.list.updateSortFilter(),l()})),i=()=>{t.elm.header.on("click","a."+e.cl.sidebar.search,(e=>{e.preventDefault(),e.stopPropagation(),this.showSearchField()})),t.elm.header.on("click","a."+e.cl.sidebar.searchClose,(e=>{e.preventDefault(),e.stopPropagation(),this.clearSearch()})),t.elm.header.on("keyup","div."+e.cl.sidebar.searchBox+" > input[type='text']",(e=>{e.preventDefault(),a&&(clearTimeout(a),a=null),a=setTimeout((()=>{this.update()}),300)})).on("keydown","div."+e.cl.sidebar.searchBox+" > input[type='text']",(e=>{if(e.key&&"ENTER"===e.key.toUpperCase()){const a=t.elm.bookmarkBox.search.find("> ul > li");1===a.length()&&t.helper.sidebarEvents.handleEntryClick(a.eq(0).children("a"),{ctrlKey:e.ctrlKey||e.metaKey})}}))}},e.SelectionHelper=function(t){let a={};this.start=()=>{t.elm.sidebar.addClass(e.cl.sidebar.selectionMode),t.elm.header.addClass(e.cl.sidebar.selectionMode),this.updateSidebarHeader(),r()},this.leave=()=>{t.elm.sidebar.removeClass(e.cl.sidebar.selectionMode),t.elm.header.removeClass(e.cl.sidebar.selectionMode),a=[],r(),t.helper.list.updateSidebarHeader(),t.helper.search.searchVal&&t.helper.search.update(t.helper.search.searchVal)},this.isEnabled=()=>t.elm.sidebar.hasClass(e.cl.sidebar.selectionMode),this.getSelectedAmount=()=>Object.keys(a).length,this.reset=()=>{a=[],this.isEnabled()&&(this.updateSidebarHeader(),r())},this.select=e=>{this.start(),a[e]=t.helper.entry.getDataById(e),this.updateSidebarHeader(),r()},this.deselect=e=>{a[e]&&(delete a[e],this.updateSidebarHeader(),r())},this.moveSelection=async(a,r,o)=>{const i=t.helper.model.getData("u/sort"),n=l(),s=n.reverse(),d=o.children("a").attr(e.attr.id),c=o.parent("ul");for(const l of s){if(l.id===d)continue;const r=l.elm.parent("li");if("custom"===i.name)r.insertAfter(o);else{const o=await t.helper.bookmark.getBookmarkIndexInDirectory(l.id,a);if(-1===o)r.appendTo(c);else if(0===o)r.prependTo(c);else{const t=c.children(`li:not(.${e.cl.drag.dragInitial})`).eq(o-1);r.insertAfter(t)}}}for(const e of n)e.id!==d&&(await t.helper.model.call("moveBookmark",{id:e.id,parentId:a,index:r+1}),r++)},this.openSelected=async()=>{const e=l(),r=[];let o=!1;for(const t of e){const e=a[t.id];if(e.children){o=!0;for(const t of e.children)t.url&&!t.url.startsWith("about:blank")&&r.push(t)}else r.push(e)}o&&r.length>t.helper.model.getData("b/openChildrenWarnLimit")?t.helper.overlay.create("openSelected",t.helper.i18n.get("contextmenu_open_children"),r):t.helper.utility.openAllBookmarks(r)},this.deleteSelected=async()=>{const e=l();if(0!==e.length)if(!0===e[e.length-1].dir)t.helper.overlay.create("deleteSelected",t.helper.i18n.get("overlay_delete_selected"),e);else{for(const a of e)await t.helper.bookmark.removeEntry(a.id);this.reset()}},this.handleSidebarWidthChange=()=>{const a=t.elm.header.children("a."+e.cl.cancel),l=t.elm.header.children("a."+e.cl.sidebar.removeSelected);a[0]&&l[0]&&a[0].offsetTop>2*l[0].offsetTop&&a.attr(e.attr.type,"compact")},this.updateSidebarHeader=()=>{t.elm.header.text("");const l=Object.keys(a).length;e("<h1></h1>").html("<strong>"+l+"</strong> <span>"+t.helper.i18n.get("header_selected_entries")+"</span>").attr("title",l+" "+t.helper.i18n.get("header_selected_entries",null,!0)).appendTo(t.elm.header),e("<a></a>").addClass(e.cl.sidebar.openSelected).appendTo(t.elm.header),e("<a></a>").addClass(e.cl.sidebar.removeSelected).appendTo(t.elm.header),e("<a></a>").addClass(e.cl.cancel).text(t.helper.i18n.get("overlay_cancel")).appendTo(t.elm.header),t.helper.list.handleSidebarWidthChange(),this.handleSidebarWidthChange()};const l=()=>{const l=[],r=t.helper.list.getActiveBookmarkBox();return Object.entries(a).forEach((([t,a])=>{const o=r.find("> ul a["+e.attr.id+"='"+t+"']");l.push({elm:o,id:t,dir:!!a.isDir,offsetTop:o[0].offsetTop})})),l.sort(((e,t)=>e.dir!==t.dir?e.dir?1:-1:e.offsetTop-t.offsetTop)),l},r=()=>{const l=t.helper.list.getActiveBookmarkBox();l.find("> ul a["+e.attr.id+"]."+e.cl.selected).forEach((l=>{const r=e(l),o=e(r).attr(e.attr.id);t.helper.checkbox.isChecked(r)&&!a[o]&&r.find("div."+e.cl.checkbox.box).trigger("click"),r.removeClass(e.cl.selected)})),Object.keys(a).forEach((a=>{const r=t.helper.entry.getDataById(a),o=l.find("> ul a["+e.attr.id+"='"+r.id+"']");t.helper.checkbox.isChecked(e(o))||e(o).find("div."+e.cl.checkbox.box).trigger("click"),o.addClass(e.cl.selected)}))}},e.SidebarEventsHelper=function(t){let a=null,l=null,r=null,o=!1,i=null,n=null;const s=150,d=1800;this.init=async()=>{i=t.helper.model.getData("b/sidebarPosition"),n=t.helper.model.getData("a/surface"),m(),p(),u(),g(),"sidepanel"===t.helper.utility.getPageType()&&h(),"premium"===t.helper.model.getUserType()&&f()},this.handleEntryClick=(a,l)=>{const r=t.helper.entry.getDataById(a.attr(e.attr.id));if(!r)return!1;const o=t.helper.model.getData(["b/newTab","b/linkAction"]),i=4===l.buttons||l.ctrlKey||l.metaKey;if(r.isDir&&!a.hasClass(e.cl.sidebar.dirAnimated))if(i){const e=r.children.filter((e=>e.url&&!e.url.startsWith("about:blank")));e.length>t.helper.model.getData("b/openChildrenWarnLimit")?t.helper.overlay.create("openChildren",t.helper.i18n.get("contextmenu_open_children"),r):t.helper.utility.openAllBookmarks(e)}else t.helper.list.toggleBookmarkDir(a);else if(!r.isDir)if(i){const e=l.shiftKey||"background"===o.newTab&&"newtab"===o.linkAction;t.helper.utility.openUrl(r,"newTab",e)}else"newtab"===o.linkAction?t.helper.utility.openUrl(r,"newTab","foreground"===o.newTab):t.helper.selection.isEnabled()&&0===a.parents("div."+e.cl.sidebar.entryPinned).length()?c(a):t.helper.utility.openUrl(r,"default",!0)};const c=a=>{const l=a.attr(e.attr.id);a.hasClass(e.cl.selected)?t.helper.selection.deselect(l):t.helper.selection.select(l)},h=()=>{e(window).on("resize.bs",(async()=>{await t.helper.list.handleSidebarWidthChange()})),e(document).on("mouseenter.bs",(()=>{l&&clearTimeout(l)})),e(document).on("mouseleave.bs",(()=>{l=setTimeout((()=>{t.helper.contextmenu.close(),t.helper.tooltip.close()}),1e3)}))},p=async()=>{t.elm.filterBox.on("click","a["+e.attr.direction+"]",(a=>{a.preventDefault();const l="ASC"===e(a.target).attr(e.attr.direction)?"DESC":"ASC";t.helper.list.updateDirection(l)})).on("click","div."+e.cl.checkbox.box+" + a",(t=>{t.preventDefault(),e(t.target).prev("div["+e.attr.name+"]").trigger("click")}))},m=async()=>{Object.values(t.elm.bookmarkBox).forEach(((l,r)=>{const i=[l];0===r&&i.push(t.elm.pinnedBox),e(i).on("click mousedown","> ul a",(a=>{a.preventDefault();const l=e(a.target);if(!l.hasClass(e.cl.drag.trigger)&&!l.hasClass(e.cl.sidebar.separator)&&!l.parent().hasClass(e.cl.sidebar.removeMask)&&("click"===a.type||4===a.buttons&&"mousedown"===a.type||t.refreshRun))if(l.hasClass(e.cl.add)){const a=l.parent("a").attr(e.attr.id);t.helper.overlay.create("add",t.helper.i18n.get("contextmenu_add"),t.helper.entry.getDataById(a))}else this.handleEntryClick(e(a.currentTarget),a)})).on("dblclick","> ul a",(a=>{const l=e(a.currentTarget);if(l.hasClass(e.cl.sidebar.bookmarkDir)&&!l.hasClass(e.cl.sidebar.dirOpened)){const a=l=>{e.delay().then((()=>{l.next("ul").find("> li > a."+e.cl.sidebar.bookmarkDir+":not(."+e.cl.sidebar.dirOpened+")").forEach((l=>{t.helper.list.toggleBookmarkDir(e(l),!1,!1).then((()=>{a(e(l))}))}))}))};a(l)}})).on("mouseover","> ul a",(r=>{if(!1===t.helper.overlay.isOpened()){const o=e(r.currentTarget),i=o.attr(e.attr.id);l.find("a."+e.cl.hover).removeClass(e.cl.hover),l.find("a."+e.cl.sidebar.lastHover).removeClass(e.cl.sidebar.lastHover),o.hasClass(e.cl.sidebar.mark)||o.addClass([e.cl.hover,e.cl.sidebar.lastHover]),a&&clearTimeout(a),a=setTimeout((()=>{l.find("a["+e.attr.id+"='"+i+"']").removeClass(e.cl.sidebar.mark)}),500),t.helper.tooltip.create(o)}})).on("contextmenu","> ul a",(a=>{a.preventDefault();let l="list";e(a.target).hasClass(e.cl.sidebar.separator)&&(l="separator"),e(a.currentTarget).removeClass(e.cl.sidebar.mark),t.helper.contextmenu.create(l,e(a.currentTarget))})).on("mouseleave",(a=>{t.helper.tooltip.close(),e(a.currentTarget).find("a."+e.cl.hover).removeClass(e.cl.hover)})).on("click","span."+e.cl.sidebar.removeMask+" > span",(async a=>{a.preventDefault();const l=e(a.target).parents("a").eq(0);!1===o&&(o=!0,await t.helper.bookmark.restoreEntry(l),await e.delay(500),o=!1)})).on("mouseover","> a["+e.attr.name+"='add']",(a=>{a.preventDefault(),l.find("a."+e.cl.hover).removeClass(e.cl.hover),t.helper.tooltip.close()})).on("click","> a["+e.attr.name+"='add']",(a=>{a.preventDefault();const l=t.elm.bookmarkBox.all.children("ul > li > a").eq(0).attr(e.attr.id);t.helper.overlay.create("add",t.helper.i18n.get("contextmenu_add"),t.helper.entry.getDataById(l))}))}))},u=async()=>{const a=()=>{r&&clearTimeout(r)},l=()=>{a(),r=setTimeout((()=>{t.elm.lockPinned.removeClass(e.cl.active),t.helper.toggle.removeSidebarHoverClass()}),500)};t.elm.pinnedBox.on("mouseenter",(()=>{a(),t.elm.lockPinned.addClass(e.cl.active)})).on("mouseleave",(()=>{l()})),t.elm.lockPinned.on("mouseenter",(()=>{a()})).on("mouseleave",(()=>{l()})).on("click",(async a=>{a.preventDefault(),a.stopPropagation(),t.elm.lockPinned.toggleClass(e.cl.sidebar.fixed),t.elm.pinnedBox.toggleClass(e.cl.sidebar.fixed);const l=t.elm.pinnedBox.hasClass(e.cl.sidebar.fixed);await t.helper.model.setData({"u/lockPinned":l}),!1===l&&(t.helper.scroll.setScrollPos(t.elm.bookmarkBox.all,0,200),t.elm.lockPinned.removeClass(e.cl.active)),t.helper.toggle.removeSidebarHoverClass(),t.helper.list.updateSortFilter()}))},g=async()=>{e(document).on(e.opts.events.systemColorChanged,(()=>{t.helper.model.call("reloadIcon"),"auto"===n&&("dark"===t.helper.stylesheet.getSystemSurface()?t.elm.iframeBody.addClass(e.cl.page.dark):t.elm.iframeBody.removeClass(e.cl.page.dark))})),t.elm.iframeBody.on("click",(()=>{t.helper.contextmenu.close(),t.helper.tooltip.close()})),e(document).on(e.opts.events.premiumPurchased,(a=>{a.detail&&a.detail.licenseKey&&(e(document).off(e.opts.events.premiumPurchased),t.helper.model.call("activatePremium",{licenseKey:a.detail.licenseKey}))})).on(e.opts.events.showFeedbackForm,(()=>{e("div[data-name='redeviation-extension']").removeAttr(e.attr.name),t.helper.model.call("openLink",{href:e.api.runtime.getURL("html/settings.html#support"),newTab:!1})})),e(t.elm.iframeDocument).on(e.opts.events.checkboxChanged,(async a=>{const l=a.detail.checkbox.attr(e.attr.name);"viewAsTree"===l||"mostViewedPerMonth"===l?(await t.helper.model.setData({["u/"+l]:a.detail.checked}),t.startLoading(),t.helper.model.call("reload",{scrollTop:!0,type:"Sort"})):"select"===l&&c(e(a.detail.container).parent())})),e.api.runtime.onMessage.removeListener(b),e.api.runtime.onMessage.addListener(b),["menu","sort"].forEach((a=>{t.elm.header.on("click contextmenu","a."+e.cl.sidebar[a],(l=>{l.preventDefault(),l.stopPropagation(),t.helper.contextmenu.create(a,e(l.currentTarget))}))})),t.elm.header.on("click contextmenu","a."+e.cl.sidebar.removeSelected,(e=>{e.preventDefault(),e.stopPropagation(),t.helper.selection.deleteSelected()})),t.elm.header.on("click contextmenu","a."+e.cl.sidebar.openSelected,(e=>{e.preventDefault(),e.stopPropagation(),t.helper.selection.openSelected()})),t.elm.header.on("click contextmenu","a."+e.cl.cancel,(e=>{e.preventDefault(),e.stopPropagation(),t.helper.selection.leave()})),t.elm.iframeBody.on("click","#"+e.opts.ids.sidebar.reloadInfo+" a",(e=>{e.preventDefault(),location.reload(!0)})),t.elm.iframeBody.on("click","#"+e.opts.ids.sidebar.infoBox+" a",(a=>{a.preventDefault();const l=t.elm.iframeBody.find("#"+e.opts.ids.sidebar.infoBox),r=t.elm.iframeBody.find("#"+e.opts.ids.sidebar.infoBox).attr(e.attr.type);if(l.removeClass(e.cl.visible),"shareInfo"===r&&t.helper.model.call("updateShareInfo",{config:!1,activity:!1}),e(a.currentTarget).hasClass(e.cl.info)){let a=null;switch(r){case"premium":a="html/settings.html#premium";break;case"translation":a="html/settings.html#language_translate";break;case"shareInfo":a="html/settings.html#infos_permissions"}a&&t.helper.model.call("openLink",{href:e.api.runtime.getURL(a),newTab:!0})}}))},f=async()=>{t.elm.widthDrag.on("mousemove",(()=>{t.elm.widthDrag.addClass(e.cl.hover)})).on("mouseleave",(()=>{t.elm.widthDrag.removeClass(e.cl.hover)})).on("mousedown",(()=>{t.helper.contextmenu.close(),t.helper.tooltip.close(),t.helper.toggle.addSidebarHoverClass(),t.elm.widthDrag.addClass(e.cl.drag.isDragged)})),t.elm.iframeBody.on("mousemove",(a=>{if(t.elm.widthDrag.hasClass(e.cl.drag.isDragged)&&1===a.buttons){a.preventDefault(),a.stopPropagation();let e=t.elm.widthDrag.data("dragInfo");e||(e={start:a.clientX,width:t.elm.sidebar.realWidth()},t.elm.widthDrag.data("dragInfo",e));let l=a.clientX-e.start;"right"===i&&(l*=-1),t.helper.toggle.addSidebarHoverClass();let r=e.width+l;r=Math.min(r,d),r=Math.max(r,s),t.elm.sidebar.css("width",r+"px"),t.helper.list.handleSidebarWidthChange()}})).on("mouseup",(async()=>{if(t.elm.widthDrag.data("dragInfo")){t.elm.widthDrag.removeData("dragInfo");const a=t.helper.model.getData("a/styles");await e.delay();const l=Math.round(t.elm.sidebar.realWidth());isNaN(l)||(a.sidebarWidth=l+"px",t.helper.model.setData({"a/styles":a}),t.elm.iframe.hasClass(e.cl.page.hideMask)&&t.elm.iframe.data("width",l+50)),t.helper.toggle.removeSidebarHoverClass(),t.elm.widthDrag.removeClass(e.cl.drag.isDragged)}}))},b=async a=>{if(a&&a.action&&(null===a.reinitialized||t.initialized>a.reinitialized))if("reload"===a.action){let l=!0;if("Removed"===a.type||"Created"===a.type&&!0===o){const a=t.helper.list.getActiveBookmarkBox();(a.find("a."+e.cl.sidebar.restored).length()>0||a.find("span."+e.cl.sidebar.removeMask).length()>0)&&(l=!1)}if(l){let l=0;a.scrollTop&&(t.helper.scroll.setScrollPos(t.elm.bookmarkBox.all,0),l=100),t.needsReload=!0,await e.delay(l),t.reload()}}else"toggleSidebar"===a.action&&(t.helper.model.call("clearNotWorkingTimeout"),t.elm.iframe.hasClass(e.cl.page.visible)?t.helper.toggle.closeSidebar():(t.helper.toggle.setSidebarHoveredOnce(!0),t.helper.toggle.openSidebar()))}},e.StylesheetHelper=function(t){const a=["overlay","sidebar","content"],l=[];let r="",o="",i=!1;this.init=e=>{e&&e.defaultVal&&!0===e.defaultVal&&(i=!0),o=t.helper.model.getData("a/theme"),r=t.helper.model.getData("u/customCss");const a=t.helper.model.getData("a/surface");window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(async()=>{const e=this.getSystemSurface();if(t.helper.model.call("systemColorChanged",{surface:e}),t.helper.utility&&t.helper.utility.triggerEvent("systemColorChanged",e),"auto"===a)for(const e of l)await n(e.files,e.head,!0)}));const s=this.getSystemSurface();t.helper.model.call("systemColorChanged",{surface:s})},this.getSystemSurface=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",this.getStylesheetFilesWithThemes=e=>{const t=e;return o&&"default"!==o&&e.forEach((e=>{a.includes(e)&&t.push("themes/"+o+"/"+e)})),t},this.addStylesheets=async(a,l=null)=>{null===l?l=e(document):e.cl&&e.cl.page&&!1===t.helper.model.getData("b/animations")&&e.cl.page.noAnimations&&l.find("body").addClass(e.cl.page.noAnimations);let r=null;r=0===l.find("head").length()?l.find("body"):l.find("head"),await n(a,r)};const n=async(a,o,n=!1)=>{!1===n&&l.push({files:a,head:o});const s=t.helper.model.getData("a/styles",i),d=this.getStylesheetFilesWithThemes(a);for(const t of d){const a=await e.xhr(e.api.runtime.getURL("css/"+t+".css"),{mimeType:"text/css"});if(a.response){let l=a.response;l+=r,Object.keys(s).forEach((e=>{l=l.replace(new RegExp('"?%'+e+'"?',"g"),s[e])})),e.cl&&e.cl.page&&e.cl.page.style&&e.attr&&e.attr.name?(o.find("style."+e.cl.page.style+"["+e.attr.name+"='"+t+"']").remove(),o.append("<style class='"+e.cl.page.style+"' "+e.attr.name+"='"+t+"'>"+l+"</style>")):o.append("<style>"+l+"</style>")}}}},e.TemplateHelper=function(t){this.loading=()=>e('<svg class="loading" width="36px" height="36px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><circle fill="none" stroke-width="3" stroke-linecap="round" cx="18" cy="18" r="16"></circle></svg>'),this.overlay=(a,l)=>{const r={},o=t.helper.model.getData(["a/theme","b/animations","a/surface","a/highContrast"]);r.overlay=e("<iframe></iframe>").attr("id",e.opts.ids.page.overlay).addClass("notranslate").attr("aria-hidden","true").attr(e.attr.theme,o.theme).appendTo("body"),t.helper.stylesheet.addStylesheets(["overlay"],r.overlay);const i=r.overlay.find("body");i.attr(e.attr.theme,o.theme).attr("aria-hidden","true"),i.parent("html").attr("dir",t.helper.i18n.isRtl()?"rtl":"ltr"),r.modal=e("<div></div>").attr(e.attr.type,a).addClass(e.cl.overlay.modal).appendTo(i),!1===o.animations&&r.overlay.addClass(e.cl.page.noAnimations),"sidepanel"===t.helper.utility.getPageType()&&(r.modal.addClass(e.cl.sidebar.sidepanel),r.overlay.addClass(e.cl.sidebar.sidepanel)),"dark"===o.surface||"auto"===o.surface&&"dark"===t.helper.stylesheet.getSystemSurface()?i.addClass(e.cl.page.dark):o.highContrast&&i.addClass(e.cl.page.highContrast);const n=e("<header></header>").appendTo(r.modal);return e("<h1></h1>").text(l).appendTo(n),e("<a></a>").addClass(e.cl.close).appendTo(n),r.buttonWrapper=e("<menu></menu>").addClass(e.cl.overlay.buttonWrapper).appendTo(r.modal),e("<a></a>").addClass(e.cl.close).appendTo(r.buttonWrapper),r.overlay[0].focus(),e.delay(100).then((()=>{r.modal.addClass(e.cl.visible),r.overlay.addClass(e.cl.page.visible)})),r}},e.ToggleHelper=function(t){const a={},l={};let r=0,o=!1,i=!1,n=null,s=null,d=null,c=null,h=null,p=null,m=null,u=null,g=null,f=null;this.init=async()=>{const l=t.helper.model.getData(["a/theme","b/toggleArea","b/preventPageScroll","a/showIndicator","a/showIndicatorIcon","a/styles","b/sidebarPosition","b/openDelay","b/openAction","b/preventWindowed","b/preventWebapp","b/refocusWebsite","n/autoOpen"]),o=t.helper.utility.getPageType();t.elm.indicator=e("<div></div>").attr("id",e.opts.ids.page.indicator).attr(e.attr.theme,l.theme).appendTo("body"),!1===t.helper.model.getData("b/animations")&&t.elm.indicator.addClass(e.cl.page.noAnimations),document.activeElement&&(f=document.activeElement),Object.entries(l.toggleArea).forEach((([e,t])=>{a[e]=+t})),r=1e3*+l.openDelay,n="sidepanel"===o?"right":l.sidebarPosition,s=l.preventPageScroll,d=l.preventWindowed,c=l.preventWebapp,g=l.refocusWebsite,t.elm.indicator.css({height:a.height+"%",top:a.top+"%"}),100===a.height&&t.elm.indicator.addClass(e.cl.page.fullHeight),t.elm.iframe.attr(e.attr.position,n),t.elm.sidebar.attr(e.attr.position,n),l.styles&&(l.styles.indicatorWidth&&(h=parseInt(l.styles.indicatorWidth)),l.styles.sidebarWidth&&(p=parseInt(l.styles.sidebarWidth))),l.showIndicator&&"sidepanel"!==o&&"icon"!==l.openAction&&"mousemove"!==l.openAction&&(t.elm.indicator.html("<div></div>").attr(e.attr.position,n),l.showIndicatorIcon&&e("<span></span>").appendTo(t.elm.indicator.children("div")),e.delay(50).then((()=>{t.elm.indicator.addClass(e.cl.page.visible)}))),w(),b(),(("newtab_website"===o||"newtab_replacement"===o||"newtab_fallback"===o)&&l.autoOpen||"sidepanel"===o)&&this.openSidebar(),!1===v()&&t.elm.iframe.addClass(e.cl.page.hideMask)},this.closeSidebar=()=>{t.elm.sidebar.hasClass(e.cl.sidebar.permanent)||(k("close"),k("open"),t.helper.contextmenu.close(),t.helper.tooltip.close(),t.helper.dragndrop.cancel(),t.elm.iframe.removeClass(e.cl.page.visible),e("body").removeClass(e.cl.page.noscroll),k("indicator"),t.elm.indicator.removeClass(e.cl.page.hover),g&&f&&"function"==typeof f.focus&&f.focus({preventScroll:!0}))},this.openSidebar=()=>{t.helper.model.call("infoToDisplay").then((e=>{e&&e.info&&("shareInfo"!==e.info&&"premium"!==e.info&&"translation"!==e.info||t.addInfoBox(e.info))})),t.elm.sidebar.hasClass(e.cl.sidebar.openedOnce)||(t.elm.sidebar.addClass(e.cl.sidebar.openedOnce),t.helper.list.handleSidebarWidthChange(),this.markLastUsed()),t.elm.iframe.hasClass(e.cl.page.visible)||t.helper.model.call("track",{name:"action",value:{name:"sidebar",value:t.helper.utility.getPageType()}}),t.elm.iframe.addClass(e.cl.page.visible),t.initImages(),s&&e("body").addClass(e.cl.page.noscroll),e.delay(t.helper.model.getData("b/animations")?300:0).then((()=>t.helper.entry.initOnce())).then((()=>{t.helper.scroll.focus()})),e(document).trigger("mousemove.bs"),t.helper.utility.triggerEvent("sidebarOpened")},this.markLastUsed=()=>{const a=t.helper.model.getData(["u/lastOpened","b/rememberState"]);if("all"===a.rememberState&&a.lastOpened){const l=t.elm.bookmarkBox.all.find("ul > li > a["+e.attr.id+"='"+a.lastOpened+"']");l&&l.length()>0&&(l.addClass(e.cl.sidebar.mark),t.helper.model.setData({"u/lastOpened":null}))}},this.sidebarHoveredOnce=()=>i,this.setSidebarHoveredOnce=()=>{i=!0},this.addSidebarHoverClass=()=>{t.elm.iframe.addClass(e.cl.page.hover),t.elm.iframe.css("width",""),i=!0},this.removeSidebarHoverClass=()=>{const a=t.elm.iframeBody.find("div."+e.cl.contextmenu.wrapper),l=t.elm.iframeBody.find("div."+e.cl.tooltip.wrapper);if(!(0!==a.length()||0!==l.length()||t.elm.iframeBody.hasClass(e.cl.drag.isDragged)||t.elm.widthDrag.hasClass(e.cl.drag.isDragged)||t.elm.widthDrag.hasClass(e.cl.hover)||t.elm.lockPinned.hasClass(e.cl.active))){t.elm.iframe.removeClass(e.cl.page.hover);const a=t.elm.iframe.data("width");a&&t.elm.iframe.css("width",a+"px")}};const b=async()=>{e(document).on("focus","input,textarea",(e=>{f=e.target}),{capture:!0}),t.elm.iframeBody.on("click",(a=>{if(a.clientX){let l=a.clientX;const r=t.elm.sidebar.realWidth();"right"===n&&(l=v()?window.innerWidth-l+(p||r)-1:t.elm.iframe.realWidth()-l),l>r&&t.elm.iframe.hasClass(e.cl.page.visible)&&!1===t.elm.widthDrag.hasClass(e.cl.drag.isDragged)&&this.closeSidebar()}})),e(document).on(e.opts.events.openSidebar+".bs",(()=>{this.openSidebar()})),e(document).on("mousedown.bs click.bs",(a=>{a.isTrusted&&t.elm.iframe.hasClass(e.cl.page.visible)&&this.closeSidebar()})),e(window).on("keydown.bs",(()=>{u=+new Date})).on("keyup.bs",(()=>{u=null})),t.elm.sidebar.on("mouseleave",(a=>{if((a.toElement||a.relatedTarget)&&(e.delay(100).then((()=>{this.removeSidebarHoverClass()})),!1===t.helper.overlay.isOpened()&&!1===t.elm.iframeBody.hasClass(e.cl.drag.isDragged)&&!1===t.elm.widthDrag.hasClass(e.cl.drag.isDragged))){const a=t.helper.model.getData("b/closeTimeout");-1!=+a&&(l.close=setTimeout((()=>{!1===t.elm.iframeBody.hasClass(e.cl.drag.isDragged)&&!1===t.elm.widthDrag.hasClass(e.cl.drag.isDragged)&&this.closeSidebar()}),1e3*+a))}})).on("mouseenter",(()=>{this.addSidebarHoverClass(),k("close")})),e(document).on("visibilitychange.bs",(()=>{if(document.hidden&&!1===t.helper.overlay.isOpened()){t.elm.indicator.removeClass(e.cl.page.hover);t.helper.model.getData("b/closeOnTabChange")&&t.elm.iframe.hasClass(e.cl.page.visible)&&this.closeSidebar()}})).on("mouseleave.bs",(()=>{k("open"),k("indicator"),t.elm.indicator.removeClass(e.cl.page.hover)})).on("mousemove.bs",(a=>{if(a.isTrusted&&y(a.clientX,a.clientY)){const a=+new Date-(m||0);l.indicator||(l.indicator=setTimeout((()=>{t.elm.indicator.addClass(e.cl.page.hover)}),Math.max(r-a,0)))}else k("indicator"),t.elm.indicator.removeClass(e.cl.page.hover)}),{passive:!0});const a=t.helper.model.getData("b/openAction");"icon"!==a&&e(document).on(a+".bs dragover.bs",(e=>{let t=!1;if("dragover"===e.type){const a=e.dataTransfer;t=a&&a.types&&(a.types.indexOf?-1!==a.types.indexOf("text/plain"):a.types.contains("text/plain"))}else t="mousedown"!==e.type||0===e.button;e.isTrusted&&t&&y(e.clientX,e.clientY)?(e.stopPropagation(),e.preventDefault(),"mousemove"===a?l.open||(l.open=setTimeout((()=>{this.openSidebar()}),r)):(0===r||null===m||+new Date-m>r)&&this.openSidebar()):k("open")}))},v=()=>{const e=t.helper.utility.getPageType(),a=t.helper.model.getData("a/styles"),l=t.helper.model.getData("n/autoOpen"),r=a.sidebarMaskColor||null;return!(("newtab_website"===e||"newtab_replacement"===e||"newtab_fallback"===e)&&l||"sidepanel"===e||"onboarding"===e||"transparent"===r)},y=(l,r)=>{let i=!1;if(c&&t.helper.utility.isWebapp());else if(d&&t.helper.utility.isWindowed());else if(document.fullscreen||document.webkitIsFullScreen);else if(null!==u&&+new Date-u<500);else if(null!=l&&(l>0||r>0||o)){o=!0,"right"===n&&(l=window.innerWidth-l-1);let s=a.width;t.helper.utility.isWindowed()&&(s=a.widthWindowed);const d={w:s,h:r/window.innerHeight*100};t.elm.indicator.hasClass(e.cl.page.hover)&&h>d.w&&(d.w=h),i=l<d.w&&d.h>=a.top&&d.h<=a.top+a.height}return!1===i?m=null:null===m&&(m=+new Date),i},k=e=>{l[e]&&(clearTimeout(l[e]),l[e]=null)},w=async()=>{e(e.opts.leftsideBackSelector).length()>0?t.elm.indicator.addClass(e.cl.page.hasLeftsideBack):e(document).on(e.opts.events.lsbLoaded+".bs",(a=>{a.detail.showIndicator&&t.elm.indicator.addClass(e.cl.page.hasLeftsideBack)}))}},e.TooltipHelper=function(t){let a={},l={},r={},o=!1;this.init=async()=>{l=t.helper.model.getData(["b/tooltipContent","b/tooltipAdditionalInfo","b/tooltipDelay","b/sidebarPosition"]),o="sidepanel"===t.helper.utility.getPageType(),r=t.helper.model.getData("a/styles"),l.scrollBarWidth=+r.scrollBarWidth.toString().replace("px","")},this.create=r=>{const o=r.attr(e.attr.id);if(o&&!1===t.helper.entry.isSeparator(o)){t.helper.toggle.addSidebarHoverClass(),d(o);const c=t.elm.iframeBody.find("div."+e.cl.tooltip.wrapper+"["+e.attr.id+"='"+o+"']");if(c.length()>0)n(c,r),s(c,r);else if(-1!=+l.tooltipDelay){const d=t.helper.entry.getDataById(o);if(d){const c=e("<div></div>").addClass(e.cl.tooltip.wrapper).attr(e.attr.id,o).appendTo(t.elm.iframeBody);i(c,d),a[o]&&(clearTimeout(a[o]),a[o]=null),n(c,r),s(c,r),a[o]=setTimeout((()=>{c.addClass(e.cl.visible)}),1e3*+l.tooltipDelay)}}}else d()},this.close=()=>{d()};const i=(a,r)=>{if("all"!==l.tooltipContent&&"title"!==l.tooltipContent||e("<h3></h3>").text(r.title).appendTo(a),r.isDir?e("<span></span>").text(r.children.length+" "+t.helper.i18n.get("sidebar_dir_children")).appendTo(a):"all"!==l.tooltipContent&&"url"!==l.tooltipContent||e("<span></span>").text(r.url).appendTo(a),t.helper.search.isResultsVisible()){const l=t.helper.entry.getParentsById(r.id);if(l.length>0){const t=e("<ul></ul>").addClass(e.cl.sidebar.breadcrumb).appendTo(a);l.forEach((a=>{e("<li></li>").text(a.title).prependTo(t)}))}}if(l.tooltipAdditionalInfo&&r.additionalInfo&&r.additionalInfo.desc){const t=r.additionalInfo.desc.replace(/\n/g,"<br />");e("<p></p>").html(t).appendTo(a)}},n=(e,t)=>{let a=t[0].getBoundingClientRect().top;a+=o?t.realHeight():t.realHeight()/2-e.realHeight()/2,e.css("top",a+"px")},s=(e,a)=>{const i=t.helper.i18n.isRtl();if(o){const t=a[0].getBoundingClientRect().left,l=+r.bookmarksHorizontalPadding.toString().replace("px","");e.css(i?"right":"left",t+l/2+"px")}else{const r={l:t.elm.sidebar.realWidth()-l.scrollBarWidth,r:a.realWidth()+10};"right"===l.sidebarPosition?e.css("right",r[i?"l":"r"]+"px"):e.css("left",r[i?"r":"l"]+"px")}},d=async(l=null)=>{Object.values(a).forEach((e=>{e&&clearTimeout(a[e])})),a={};const r=t.elm.iframeBody.find("div."+e.cl.tooltip.wrapper+(l?":not(["+e.attr.id+"='"+l+"'])":""));let o=!1;r.forEach((t=>{if(e(t).hasClass(e.cl.visible))return o=!0,!1})),r.removeClass(e.cl.visible),await e.delay(o?300:0),r.remove(),t.helper.toggle.removeSidebarHoverClass()}},e.UtilityHelper=function(t){this.openUrl=async(e,a="default",l=!0)=>{if(t.helper.model.setData({"u/lastOpened":e.id}),"incognito"===a)await t.helper.model.call("openLink",{href:e.url,incognito:!0});else if("newWindow"===a)await t.helper.model.call("openLink",{id:e.id,href:e.url,newWindow:!0});else{const r="newTab"===a;e.url.startsWith("javascript:")&&!1===r?location.href=e.url:await t.helper.model.call("openLink",{parentId:e.parentId,id:e.id,href:e.url,newTab:"newTab"===a,position:t.helper.model.getData("b/newTabPosition"),active:l})}},this.openAllBookmarks=async e=>{const a=t.helper.model.getData("b/newTabPosition");"afterCurrent"!==a&&"beforeFirst"!==a||e.reverse();for(const t of e)await this.openUrl(t,"newTab",!1)},this.triggerEvent=(t,a={},l=null)=>{(l||document).dispatchEvent(new CustomEvent(e.opts.events[t],{detail:a,bubbles:!0,cancelable:!1}))},this.copyToClipboard=a=>{const l=e("<textarea></textarea>").text(a).appendTo(t.elm.iframeBody);l[0].select();let r=!1;try{r=t.elm.iframeDocument[0].execCommand("copy")}catch(e){}return l.remove(),r},this.isUrlOnBlacklist=e=>{if(!e||0===e.trim().length)return!0;let t=!1;return["about:","https?://192.168.","192.168.","https?://localhost","localhost","https?://127.0.0.","127.0.0.","javascript:","file://","chrome://","edge://","extension://","chrome-extension://"].some((a=>{if(0===e.search(new RegExp(a,"gi")))return t=!0,!0})),t},this.getSortList=()=>({custom:{dir:"ASC"},alphabetical:{dir:"ASC"},url:{dir:"ASC"},mostUsed:{dir:"DESC"},recentlyUsed:{dir:"DESC"},recentlyAdded:{dir:"DESC"}}),this.capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1),this.sortEntries=(e,a)=>{if(e.length>1){const l=t.helper.i18n.getLocaleSortCollator(),r=(t,l)=>{e.sort(((e,r)=>{const o=!!e.children,i=!!r.children;return"custom"!==a.name&&o!==i?o?-1:1:(t===a.dir?1:-1)*l(e,r)}))};switch(a.name){case"custom":r("ASC",((e,t)=>e.index-t.index));break;case"alphabetical":r("ASC",((e,t)=>l.compare(e.title,t.title)));break;case"url":r("ASC",((e,t)=>{if(!e.url||!t.url)return e.index-t.index;const a=e.url.replace(/^https?:\/\//,"").replace(/^www\./,""),r=t.url.replace(/^https?:\/\//,"").replace(/^www\./,"");return l.compare(a,r)}));break;case"recentlyAdded":r("DESC",((e,t)=>t.dateAdded-e.dateAdded));break;case"mostUsed":{const e=t.helper.model.getData("u/mostViewedPerMonth");r("DESC",((a,r)=>{const o=t.helper.entry.getDataById(a.id),i=t.helper.entry.getDataById(r.id),n=o?o.views[e?"perMonth":"total"]:0,s=i?i.views[e?"perMonth":"total"]:0;return n===s?l.compare(a.title,r.title):s-n}));break}case"recentlyUsed":r("DESC",((e,a)=>{const r=t.helper.entry.getDataById(e.id),o=t.helper.entry.getDataById(a.id),i=r?r.views.lastView:0,n=o?o.views.lastView:0;return i===n?l.compare(e.title,a.title):n-i}))}}},this.getIconImageData=async e=>{const a=await t.helper.model.call("iconImageData",{name:e.shape,color:e.color,padding:e.padding,background:e.background});if(a){const e=document.createElement("canvas");e.width=128,e.height=128;const t=e.getContext("2d"),l=t.createImageData(128,128);for(const e in l.data)l.data[e]=a.data[e];return t.putImageData(l,0,0),e.toDataURL("image/x-icon")}return""},this.isWindowed=()=>window.screenX>100||window.screenY>50||Math.abs(window.screen.availWidth-window.innerWidth)>50||window.navigator&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent&&window.navigator.userAgent.search(/[/\s-_]mobile[/\s-_]/i)>-1,this.isWebapp=()=>window.matchMedia("(display-mode: standalone)").matches,this.getPageType=()=>{const t=location.href;let a="other",l=!1;return Object.entries({newtab_default:["https?://www\\.google\\..+/_/chrome/newtab"],newtab_fallback:[e.api.runtime.getURL("html/newtab.html")+".*[?&]type=\\w+"],newtab_replacement:[e.api.runtime.getURL("html/newtab.html")],sidepanel:[e.api.runtime.getURL("html/sidepanel.html")],newtab_website:[".*[?&]bs_nt=1(&|#|$)"],website:["https?://"],onboarding:["chrome\\-extension://.*/intro.html","extension://.*/intro.html"],chrome:["chrome://","edge://"],extension:["chrome\\-extension://","extension://"],local:["file://"]}).some((([e,r])=>{if(r.some((r=>{if(0===t.search(new RegExp(r,"gi")))return a=e,l=!0,!0})),l)return!0})),a}};(new function(){const t=Math.random().toString(36).slice(2),a="bookmark-sidebar-"+Math.random().toString(36).slice(2);let l={},r=null,o=!1;this.initialized=null,this.refreshRun=!0,this.elm={},this.needsReload=!1,this.state=null,this.run=async()=>{e("html").attr(e.attr.uid,t);const a=h();s(),n(),e(document).on("visibilitychange.bs",(async()=>{!0!==document.hidden&&(null===this.initialized?await i():this.needsReload&&this.reload())}),{capture:!1}),await i(!1===a)};const i=async(t=!1)=>{!1!==o||!t&&!0===document.hidden||(o=!0,await this.helper.model.init(),d()?(await this.helper.i18n.init(),this.helper.stylesheet.init(),await this.helper.stylesheet.addStylesheets(["content"]),await m(),await this.helper.stylesheet.addStylesheets(["sidebar"],this.elm.iframeDocument),this.elm.iframe&&this.elm.iframe[0]&&(this.elm.iframeBody.parent("html").attr("dir",this.helper.i18n.isRtl()?"rtl":"ltr"),this.helper.toggle.init(),this.helper.list.init(),this.helper.scroll.init(),this.helper.tooltip.init(),this.helper.sidebarEvents.init(),this.helper.dragndrop.init(),this.helper.keyboard.init(),""===document.referrer&&this.helper.model.call("increaseViewCounter",{url:location.href}))):(e.api.runtime.onMessage.addListener((e=>{e&&e.action&&"toggleSidebar"===e.action&&this.helper.model.call("setNotWorkingReason",{reason:this.state})})),this.log("Don't load sidebar for url '"+location.href+"'")))};this.reload=async()=>{!1===o&&!1===document.hidden&&(this.needsReload=!1,o=!0,await this.helper.model.init(),await this.helper.i18n.init(),await this.helper.entry.init(),await this.helper.list.updateBookmarkBox(),this.helper.selection.reset(),this.helper.search.update())},this.log=t=>{if(e.isDev){const e=["padding: 0 0 5px 0","font-size:90%","color:#666"].join(";");console.log("%c[] %cBookmark Sidebar %c-> %c"+t,e,e+";color:#30bfa9;font-weight:bold",e+";color:#000;font-weight:bold",e)}},this.loaded=()=>{if(!this.elm.iframeBody.hasClass(e.cl.sidebar.extLoaded)){const t=this.helper.model.getData(["b/animations","b/toggleArea","a/showIndicator"]);this.elm.iframeBody.addClass(e.cl.sidebar.extLoaded),this.helper.list.updateSidebarHeader(),this.helper.search.init(),this.elm.iframe.hasClass(e.cl.page.visible)&&this.helper.toggle.markLastUsed(),!0===t.animations&&this.elm.iframe.removeClass(e.cl.page.noAnimations),c(),this.initialized=+new Date,this.state="loaded",this.log("Finished loading in "+(this.initialized-this.updateBookmarkBoxStart)+"ms"),this.log("User type: "+this.helper.model.getUserType()),this.helper.utility.triggerEvent("loaded",{config:{toggleArea:t.toggleArea,showIndicator:t.showIndicator},elm:{iframe:this.elm.iframe,sidebar:this.elm.sidebar},helper:this.helper})}o=!1},this.startLoading=()=>{this.elm.sidebar.addClass(e.cl.loading),l.timeout&&clearTimeout(l.timeout),void 0!==l.loader&&0!==l.loader.length()||(l.loader=this.helper.template.loading().appendTo(this.elm.sidebar))},this.endLoading=(t=500)=>{l.timeout=setTimeout((()=>{this.elm.sidebar.removeClass(e.cl.loading),l.loader&&l.loader.remove(),l={}}),t)},this.initImages=()=>{e.delay().then((()=>{this.elm.iframe.hasClass(e.cl.page.visible)&&this.elm.sidebar.find("img["+e.attr.src+"]").forEach((t=>{const a=e(t),l=a.attr(e.attr.src);a.removeAttr(e.attr.src),a.attr("src",l)}))}))},this.addInfoBox=t=>{this.elm.sidebar.find("#"+e.opts.ids.sidebar.infoBox).remove();const a=e("<div></div>").attr("id",e.opts.ids.sidebar.infoBox).attr(e.attr.type,t).prependTo(this.elm.sidebar);"premium"===t?e("<p></p>").text(this.helper.i18n.get("premium_popup_text")).appendTo(a):"translation"===t?e("<p></p>").text(this.helper.i18n.get("settings_translation_incomplete_info")).appendTo(a):"shareInfo"===t&&e("<p></p>").text(this.helper.i18n.get("contribute_notice")).appendTo(a),e("<a></a>").text(this.helper.i18n.get("more_link")).addClass(e.cl.info).appendTo(a),e("<a></a>").text(this.helper.i18n.get("overlay_close")).addClass(e.cl.close).appendTo(a),e.delay(500).then((()=>{a.addClass(e.cl.visible)}))};const n=()=>{let t;const a=()=>{t=e.api.runtime.connect({name:"keepalive"}),t.onDisconnect.addListener(a),t.onMessage.addListener((e=>{console.log("keepalive message: ",e)}))};a()},s=()=>{this.helper={model:new e.ModelHelper(this),toggle:new e.ToggleHelper(this),entry:new e.EntryHelper(this),selection:new e.SelectionHelper(this),list:new e.ListHelper(this),scroll:new e.ScrollHelper(this),template:new e.TemplateHelper(this),i18n:new e.I18nHelper(this),font:new e.FontHelper(this),sidebarEvents:new e.SidebarEventsHelper(this),search:new e.SearchHelper(this),stylesheet:new e.StylesheetHelper(this),dragndrop:new e.DragDropHelper(this),checkbox:new e.CheckboxHelper(this),keyboard:new e.KeyboardHelper(this),bookmark:new e.BookmarkHelper(this),overlay:new e.OverlayHelper(this),utility:new e.UtilityHelper(this),contextmenu:new e.ContextmenuHelper(this),tooltip:new e.TooltipHelper(this),linkchecker:new e.Linkchecker(this)}},d=()=>{const t="sidepanel"===this.helper.utility.getPageType(),a=0===location.href.indexOf(e.api.runtime.getURL("html/newtab.html"));if(!this.helper.model.getData("b/overlayEnabled")&&!t&&!a)return!1;const l=this.helper.model.getData("b/visibility");if("always"===l||t||a)return!0;if("blacklist"===l||"whitelist"===l){let e=!0;const t=this.helper.model.getData("b/"+l);let a=!1;return t.some((e=>{e=(e=(e=e.replace(/^https?:\/\//i,"")).replace(/([.?&])/g,"\\$1")).replace(/\*/g,".*");const t=new RegExp(e);if(-1!==location.href.search(t))return a=!0,!0})),"blacklist"===l?(e=!1===a,!1===e&&(this.state="blacklisted")):"whitelist"===l&&(e=!0===a,!1===e&&(this.state="notWhitelisted")),e}return!0},c=()=>{null!==r&&clearTimeout(r),r=setTimeout((async()=>{const l=e("html").attr(e.attr.uid);if(void 0===l||t===+l){0!==e(a).length()&&this.elm.iframeDocument&&this.elm.iframeDocument[0].body&&0!==this.elm.iframeDocument[0].body.childElementCount?c():(this.log("Detected: Sidebar missing from DOM"),h(),await i(!0))}}),2e3)},h=()=>{let t=!1;const a=[];["#"+e.opts.ids.page.iframe,"#"+e.opts.ids.page.overlay,"div#"+e.opts.ids.page.indicator].forEach((t=>{a.push(e(t))}));const l=e(a);return e(document).off("*.bs"),e(window).off("*.bs"),l.length()>0&&(l.remove(),t=!0,this.log("Destroyed old instance")),t},p=()=>{if(document.createElement(a).constructor!==HTMLElement)return;const t=this;class l extends HTMLElement{constructor(){super(),this.content=this.attachShadow({mode:"closed"})}connectedCallback(){this.content.innerHTML="<iframe style='margin:0;padding: 0;border: none;width: 100%;height: 100%;'></iframe>",t.elm.iframeDocument=e(this.content.querySelector("iframe").contentDocument)}}customElements.define(a,l)},m=async()=>{p();const t=this.helper.utility.getPageType(),l=this.helper.model.getData(["a/theme","a/surface","a/highContrast"]);this.elm.iframe=e(`<${a} id="${e.opts.ids.page.iframe}"></${a}>`).addClass(["notranslate",e.cl.page.noAnimations]).attr("aria-hidden","true").attr(e.attr.theme,l.theme).appendTo("body"),this.elm.iframeBody=this.elm.iframeDocument.find("body"),this.elm.iframeBody.attr(e.attr.theme,l.theme).attr("aria-hidden","true"),this.elm.sidebar=e('<section id="'+e.opts.ids.sidebar.sidebar+'"></section>').appendTo(this.elm.iframeBody),"sidepanel"===t&&(this.elm.iframe.addClass(e.cl.sidebar.sidepanel),this.elm.sidebar.addClass([e.cl.sidebar.sidepanel,e.cl.sidebar.permanent])),this.elm.bookmarkBox={},["all","search"].forEach((t=>{this.elm.bookmarkBox[t]=this.helper.scroll.add(e.opts.ids.sidebar.bookmarkBox[t],e("<ul></ul>").appendTo(this.elm.sidebar))})),this.elm.widthDrag=e("<span></span>").addClass(e.cl.drag.trigger),"premium"===this.helper.model.getUserType()&&"sidepanel"!==t&&(this.elm.widthDrag=this.elm.widthDrag.appendTo(this.elm.sidebar)),this.elm.filterBox=e("<div></div>").addClass([e.cl.sidebar.filterBox,e.cl.hidden]).appendTo(this.elm.sidebar),this.elm.pinnedBox=e("<div></div>").addClass(e.cl.sidebar.entryPinned).prependTo(this.elm.bookmarkBox.all),this.elm.lockPinned=e("<a></a>").addClass(e.cl.sidebar.lockPinned).html("<span></span>").appendTo(this.elm.sidebar),this.elm.header=e("<header></header>").prependTo(this.elm.sidebar),"dark"===l.surface||"auto"===l.surface&&"dark"===this.helper.stylesheet.getSystemSurface()?this.elm.iframeBody.addClass(e.cl.page.dark):!0===l.highContrast&&this.elm.iframeBody.addClass(e.cl.page.highContrast),this.helper.utility.triggerEvent("elementsCreated",{elm:{iframe:this.elm.iframe,sidebar:this.elm.sidebar},helper:this.helper})}}).run()})(jsu);