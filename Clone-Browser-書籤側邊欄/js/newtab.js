/*! (c) Philipp Koenig under MS-RSL */
(()=>{"use strict";if(window.jsu)return!1;const e=[],t=document,a=new WeakMap,r=new WeakMap,i=Symbol(),n={delay:(e=0)=>new Promise((t=>{setTimeout(t,e)})),ua:()=>{let e="Other",t="Other";try{e=navigator.userAgentData.platform}catch(e){}try{let e=navigator.userAgentData.brands.filter((e=>!/^[^a-z]*NOT[^a-z]/i.test(e.brand)));e=e.filter((t=>"CHROMIUM"!==t.brand.toUpperCase()||1===e.length)),e.length>0&&(t=e[0].brand+" "+(e[0].version||""))}catch(e){}return{os:e.trim(),browser:t.trim()}},xhr:(t,a={})=>new Promise(((r,i)=>{const n=new XMLHttpRequest,s=e.push({url:t,xhr:n})-1;a.mimeType&&n.overrideMimeType(a.mimeType),n.open(a.method||"GET",t,!0),["load","error","timeout","abort"].forEach((t=>{n.addEventListener(t,(()=>{e[s]=null,"load"===t&&n.status<400?r(n):i(n)}))}));let o=null;a.data&&(o=new FormData,Object.entries(a.data).forEach((([e,t])=>{"object"==typeof t&&(t=JSON.stringify(t)),o.append(e,t)}))),a.files&&(null===o&&(o=new FormData),a.files.forEach((e=>{e.files.forEach((t=>{o.append(e.name+"[]",t)}))}))),a.header&&Object.entries(a.header).forEach((([e,t])=>{n.setRequestHeader(e,t)})),Object.entries(a).forEach((([e,t])=>{"method"!==e&&"data"!==e&&"header"!==e&&(n[e]=t)})),n.send(o)})),cancelXhr:(t=null)=>{e.forEach((e=>{e&&e.xhr&&e.xhr.readyState&&e.xhr.abort&&(null===t||e.url===t)&&(e.xhr.abort(),e=null)}))}};class s{constructor(e,a=!0){let r=e;if("string"==typeof e&&(!1===a||e.indexOf("<")>-1)){const a=t.createElement("div");a.innerHTML=e,r=a.childNodes}this._fillNodeList(r)}static _isDefined(e){return null!=e}static _forEach(e,t,a=!1){const r=e.length;if(a){for(let i=r-1;i>=0;i--)if(s._isDefined(e[i].forEach))s._forEach(e[i],t,a);else if(!1===t(e[i],i))break}else for(let i=0;i<r;i++)if(s._isDefined(e[i].forEach))s._forEach(e[i],t,a);else if(!1===t(e[i],i))break}_fillNodeList(e){if(s._isDefined(e))if(e instanceof s)this[i]=e.get();else if("string"==typeof e)this[i]=t.querySelectorAll(e);else if(e instanceof Node||e instanceof HTMLDocument||e instanceof Window)this[i]=[e];else if(e instanceof NodeList||e instanceof HTMLCollection)this[i]=e;else{if("object"!=typeof e)throw new DOMException("invalid parameter for jsu");this[i]=[],s._isDefined(e.forEach)||(e=[e]),e.forEach((e=>{if(null!==e){const t=e=>{-1===this[i].indexOf(e)&&this[i].push(e)};e instanceof s?e.forEach(t):Array.isArray(e)||e instanceof NodeList||e instanceof HTMLCollection||/^\[object (HTMLCollection|NodeList|Object)\]$/.test(e.toString())?s._forEach(e,t):this[i].push(e)}}))}else this[i]=[];this.forEach(((e,t)=>{this[t]=e}))}forEach(e,t=!1){return s._forEach(this[i],e,t),this}css(e,t){let a=!1;const r=s._isDefined(e),n=s._isDefined(t),o=[];return this.forEach((i=>{r&&n&&"string"==typeof e?(i.style[e]=t,a=!0):r&&("string"==typeof e?o.push(window.getComputedStyle(i)[e]):"object"==typeof e&&(a=!0,Object.keys(e).forEach((t=>{"string"==typeof t&&(i.style[t]=e[t])}))))})),a?this:this[i].length>1?o:o[0]}attr(e,t){let a=!1;const r=s._isDefined(e),n=s._isDefined(t),o=[];return this.forEach((i=>{const l=(e,t)=>{a=!0,s._isDefined(i[e])?i[e]=t:i.setAttribute(e,t)};var c;r&&n&&"string"==typeof e?l(e,t):r&&("string"==typeof e?o.push((c=e,s._isDefined(i[c])?i[c]:i.getAttribute(c))):"object"==typeof e&&Object.keys(e).forEach((t=>{"string"==typeof t&&l(t,e[t])})))})),a?this:this[i].length>1?o:o[0]}removeAttr(e){return this.forEach((t=>{t.removeAttribute(e)})),this}static _addEventListener(e,t){let r=a.get(e);s._isDefined(r)||(r={},a.set(e,r)),r[t.event]||(r[t.event]=[]),r[t.event].push({fn:t.fn,name:t.name||t.event+"_"+ +new Date+Math.random().toString(36).substring(2,14),opts:t.opts,wantsUntrusted:t.wantsUntrusted}),e.addEventListener(t.event,t.fn,t.opts,t.wantsUntrusted)}static _cloneEventListener(e,t){const r=a.get(e);s._isDefined(r)&&Object.keys(r).forEach((e=>{r[e].forEach((a=>{s._addEventListener(t,{event:e,fn:a.fn,opts:a.opts,wantsUntrusted:a.wantsUntrusted})}))})),t.children&&s._forEach(t.children,((t,a)=>{s._cloneEventListener(e.children[a],t)}))}static _addData(e,t,a){let i=r.get(e);s._isDefined(i)||(i={},r.set(e,i)),i[t]=a}static _cloneData(e,t){const a=r.get(e);s._isDefined(a)&&Object.keys(a).forEach((e=>{s._addData(t,e,a[e])})),t.children&&s._forEach(t.children,((t,a)=>{s._cloneData(e.children[a],t)}))}static _cloneElement(e){const t=[];return e.forEach((e=>{const a=e.cloneNode(!0);s._cloneEventListener(e,a),s._cloneData(e,a),t.push(a)})),new s(t)}clone(){return s._cloneElement(this)}data(e,t){let a=!1;const n=s._isDefined(e),o=s._isDefined(t),l=[];return this.forEach((i=>{const c=r.get(i),d=s._isDefined(c);n&&o?(a=!0,s._addData(i,e,t)):n?"string"==typeof e?l.push(d?c[e]:void 0):"object"==typeof e&&(a=!0,Object.keys(e).forEach((t=>{"string"==typeof t&&s._addData(i,t,e[t])}))):l.push(d?c:{})})),a?this:this[i].length>1?l:l[0]}removeData(e){const t=!s._isDefined(e);return this.forEach((a=>{const i=r.get(a);s._isDefined(i)&&(t?r.delete(a):s._isDefined(i[e])&&delete i[e])})),this}on(e,t,a,r,i){const n=(e,t)=>{Object.keys(t).forEach((a=>{try{Object.defineProperty(e,a,{value:t[a]})}catch(e){}}))};let o=a;"function"==typeof a?o=r:i=r,void 0===o&&(o=null),void 0===i&&(i=null);const l="string"==typeof t;return this.forEach((r=>{e.split(/\s+/g).forEach((e=>{const c=e.split(/\./);s._addEventListener(r,{event:c[0],name:c[1],fn:e=>{if(n(e,{type:c[0]}),l){const i={preventDefault:()=>{e.preventDefault()},stopPropagation:()=>{e.stopPropagation()}};s._forEach(r.querySelectorAll(":scope "+t),(t=>{let s=e.target;for(;s&&s!==r;){if(s===t){const t=c[0].startsWith("key")?new KeyboardEvent(c[0],e):new MouseEvent(c[0],e);n(t,{preventDefault:i.preventDefault,stopPropagation:i.stopPropagation,currentTarget:s,target:e.target}),a(t)}s=s.parentNode}}))}else"function"==typeof t&&t(e)},opts:o,wantsUntrusted:i})}))}),!0),this}off(e){return this.forEach((t=>{const r=a.get(t);if(s._isDefined(r)){e.split(/\s+/g).forEach((e=>{const a=e.split(/\./);"*"===a[0]?Object.entries(r).forEach((([e,i])=>{s._forEach(i,((i,n)=>{void 0!==a[1]&&a[1]!==i.name||(t.removeEventListener(e,i.fn),r[e].splice(n,1))}),!0)})):r[a[0]]&&s._forEach(r[a[0]],((e,i)=>{void 0!==a[1]&&a[1]!==e.name||(t.removeEventListener(a[0],e.fn),r[a[0]].splice(i,1))}),!0)}))}})),this}trigger(e,t){return e.split(/\s+/g).forEach((e=>{const a=e.split(/\./),r=new CustomEvent(a[0],t);this.forEach((e=>{e.dispatchEvent(r)}))})),this}addClass(e){return"object"!=typeof e&&(e=[e]),this.forEach((t=>{e.forEach((e=>{t.classList.contains(e)||t.classList.add(e)}))})),this}removeClass(e){return"object"!=typeof e&&(e=[e]),this.forEach((t=>{e.forEach((e=>{t.classList.contains(e)&&t.classList.remove(e)}))})),this}toggleClass(e){return this.forEach((t=>{t.classList.toggle(e)})),this}hasClass(e){const t=[];return this.forEach((a=>{t.push(a.classList.contains(e))})),this[i].length>1?t:t[0]}_realDimension(e,t=!1){const a=[];let r="width",n=["left","right"];return"h"===e&&(r="height",n=["top","bottom"]),this.forEach((e=>{const i=e.getBoundingClientRect(),s=window.getComputedStyle(e);let o=parseFloat((i[r]+"").replace(/,/g,"."));t&&n.forEach((e=>{const t=s.getPropertyValue("margin-"+e);o+=parseFloat((t+"").replace(/,/g,"."))})),a.push(o)})),this[i].length>1?a:a[0]}realWidth(e=!1){return this._realDimension("w",e)}realHeight(e=!1){return this._realDimension("h",e)}find(e){const t=[];return this.forEach((a=>{a instanceof HTMLIFrameElement?t.push(a.contentDocument.querySelectorAll(":scope "+e)):t.push(a.querySelectorAll(":scope "+e))})),new s(t)}children(e){const t=[];return e||(e="*"),this.forEach((a=>{t.push(a.querySelectorAll(":scope > "+e))})),new s(t)}_htmlText(e,t){const a=s._isDefined(e);let r=a?this:"";return this.forEach((i=>{a?i[t]=e:r+=i[t]})),r}html(e){return this._htmlText(e,"innerHTML")}text(e){return this._htmlText(e,"innerText")}remove(){this.forEach((e=>{e&&e.parentElement&&(a.delete(e),r.delete(e),e.parentElement.removeChild(e))}))}_moveElement(e,t,a=!0){if(Array.isArray(e))e.forEach((e=>{this._moveElement(e,t,a)}));else{"string"==typeof e&&e.indexOf("<")>-1&&(a=!1);const r=new s(e,a);this.forEach((e=>{s._cloneElement(r).forEach((a=>{switch(t){case"append":e.appendChild(a);break;case"prepend":e.insertBefore(a,e.firstChild);break;case"before":e.parentNode.insertBefore(a,e);break;case"after":e.parentNode.insertBefore(a,e.nextSibling)}}))})),r.remove()}return this}_moveElementTo(e,t){const a=[];return new s(e).forEach((e=>{s._cloneElement(this).forEach((r=>{switch(t){case"append":e.appendChild(r);break;case"prepend":e.insertBefore(r,e.firstChild);break;case"before":e.parentNode.insertBefore(r,e);break;case"after":e.parentNode.insertBefore(r,e.nextSibling)}a.push(r)}))})),this.remove(),new s(a)}append(e,t){return this._moveElement(e,"append",t)}appendTo(e){return this._moveElementTo(e,"append")}prepend(e,t=!0){return this._moveElement(e,"prepend",t)}prependTo(e){return this._moveElementTo(e,"prepend")}before(e,t=!0){return this._moveElement(e,"before",t)}insertBefore(e){return this._moveElementTo(e,"before")}after(e,t=!0){return this._moveElement(e,"after",t)}insertAfter(e){return this._moveElementTo(e,"after")}_nextPrev(e,t){const a=s._isDefined(e),r=[];return this.forEach((i=>{const n="prev"===t?i.previousElementSibling:i.nextElementSibling;s._isDefined(n)&&(!a||s._isDefined(n.matches)&&n.matches(e))&&r.push(n)})),new s(r)}next(e){return this._nextPrev(e,"next")}prev(e){return this._nextPrev(e,"prev")}_siblings(e,t="siblings"){const a=s._isDefined(e),r=[];return this.forEach((i=>{let n=null;const o=[];for("siblings"===t&&i.parentNode.firstElementChild?(n=i.parentNode.firstElementChild,t="next"):"previous"!==t&&"next"!==t||(n=i[t+"ElementSibling"]);n&&n.matches;)n===i||a&&!n.matches(e)||o.push(n),n=n[t+"ElementSibling"];r.push(new s(o))})),this[i].length>1?new s(r):r[0]}siblings(e){return this._siblings(e)}nextAll(e){return this._siblings(e,"next")}prevAll(e){return this._siblings(e,"previous")}parent(e){const t=s._isDefined(e),a=[];return this.forEach((r=>{let i=r.parentNode;!t||s._isDefined(i.matches)&&i.matches(e)||(i=null),a.push(new s(i))})),this[i].length>1?new s(a):a[0]}parents(e){const t=s._isDefined(e),a=[];return this.forEach((r=>{const i=[];let n=r.parentNode;for(;n&&n.matches&&n!==this;)t&&!n.matches(e)||i.push(n),n=n.parentNode;a.push(new s(i))})),this[i].length>1?new s(a):a[0]}document(){const e=[];return this.forEach((t=>{e.push(new s(t.ownerDocument))})),this[i].length>1?new s(e):e[0]}eq(e){return e<0&&(e=this[i].length+e),new s(this[i][e])}get(e){return s._isDefined(e)?(e<0&&(e=this[i].length+e),this[i][e]):this[i]}length(){return this[i].length}}(()=>{const e=e=>new s(e);Object.entries(n).forEach((([t,a])=>{e[t]=a})),window.jsu=e})()})(),(e=>{"use strict";e.api=chrome,e.opts={ids:{page:{iframe:"redeviation-bs-sidebar",overlay:"redeviation-bs-overlay",newtab:"redeviation-bs-newtab",indicator:"redeviation-bs-indicator"},sidebar:{sidebar:"sidebar",infoBox:"infoBox",bookmarkBox:{all:"bookmarkBox",search:"bookmarkBoxSearch"}},overlay:{urlCheckResult:"results"}},classes:{active:"active",visible:"visible",hidden:"hidden",disabled:"disabled",success:"success",selected:"selected",premium:"premium",error:"error",info:"info",add:"add",cancel:"cancel",close:"close",hover:"hover",loading:"loading",building:"building",initLoading:"initLoading",page:{dark:"dark",visible:"redeviation-bs-visible",hideMask:"redeviation-bs-hideMask",hover:"redeviation-bs-hover",noscroll:"redeviation-bs-noscroll",hasLeftsideBack:"redeviation-bs-has-lsb",style:"redeviation-bs-style",fullHeight:"redeviation-bs-fullHeight",noAnimations:"noAnimations",highContrast:"highContrast"},sidebar:{extLoaded:"loaded",selectionMode:"selectionMode",openedOnce:"openedOnce",sidepanel:"sidepanel",permanent:"permanent",cached:"cached",mark:"mark",hideRoot:"hideRoot",dirAnimated:"animated",dirOpened:"opened",dirArrow:"has-arrow",bookmarkDir:"dir",dirIcon:"icon",separator:"separator",bookmarkLink:"link",bookmarkLabel:"label",entryPinned:"pinned",menu:"menu",sort:"sort",fixed:"fixed",lockPinned:"lockPinned",lastHover:"lastHover",copied:"copied",filterBox:"filter",search:"search",searchBox:"searchBox",searchClose:"searchClose",searchVisible:"searchVisible",breadcrumb:"breadcrumb",removeSelected:"removeSelected",openSelected:"openSelected",removeMask:"removeMask",removed:"removed",restored:"restored"},tooltip:{wrapper:"tooltip"},contextmenu:{wrapper:"contextmenu",top:"top",list:"list",icons:"icons",right:"right",separator:"separator"},drag:{trigger:"drag",helper:"dragHelper",isDragged:"isDragged",cancel:"dragCancel",dragHover:"dragHover",snap:"snap",dragInitial:"dragInitial"},scrollBox:{wrapper:"scrollBox",hideScrollbar:"hideScrollbar",scrolled:"scrolled"},checkbox:{box:"checkbox",clicked:"clicked",focus:"focus"},overlay:{modal:"modal",preview:"preview",previewUrl:"previewUrl",action:"action",progressBar:"progressBar",buttonWrapper:"buttons",checkUrlProgressLabel:"progressLabel",urlCheckLoading:"urlCheckLoading",urlCheckCategories:"categories",urlCheckAction:"urlCheckAction",urlCheckHide:"urlCheckHide",urlCheckResults:"urlCheckResults"},newtab:{customBackground:"customBackground",smallContent:"small",suggestions:"suggestions",edit:"edit",link:"link",editLinkTooltip:"editLinkTooltip",permanentSidebar:"permanentSidebar",listening:"listening",remove:"remove",infoBar:"infoBar",upload:"upload",save:"save"},onboarding:{slide:"slide",skip:"skip",close:"close",settings:"settings",toggleArea:"toggleArea",appearance:"appearance",finished:"finished",highlightIcon:"highlightIcon",hideOpenTypeIcon:"hideOpenType",video:"video",large:"large",small:"small"},settings:{tabs:{content:"tab"},color:{field:"color",mask:"colorMask"},radio:{wrapper:"radioWrapper"},translation:{select:"languageSelect",category:"category",thanks:"thanks",edit:"edit",progress:"progress",mark:"mark",requiredInfo:"requiredInfo",amountInfo:"amountInfo",empty:"empty",back:"back",goto:"goto"},toggleArea:{fullHeight:"fullHeight",dragged:"dragged",dragging:"dragging"},appearance:{preview:{fullHeight:"redeviation-bs-fullHeight"}},support:{onlySuggestions:"onlySuggestions",answer:"answer",noHeight:"noHeight",absolute:"absolute"},hideable:"hideable",inactive:"inactive",revert:"revert",highlight:"highlight",lazyloaded:"lazyloaded",sub:"sub",desc:"desc",box:"box",dialog:"dialog",boxWrapper:"boxWrapper",contentBox:"contentBox",incomplete:"incomplete",suggestion:"suggestion"}},attr:{uid:"data-redeviation-bs-uid",src:"data-src",position:"data-pos",type:"data-type",name:"data-name",value:"data-value",theme:"data-theme",sort:"data-sort",direction:"data-direction",style:"data-style",id:"data-id",i18n:"data-i18n",i18nReplaces:"data-i18nReplaces",onboarding:{openType:"data-openType",surface:"data-surface"},settings:{appearance:"data-appearance",success:"data-successtext",hideOnFalse:"data-hideOnFalse",save:"data-save",restore:"data-restore",range:{min:"data-min",max:"data-max",step:"data-step",unit:"data-unit",infinity:"data-infinity"},color:{alpha:"data-alpha",suggestions:"data-suggestions"},field:{placeholder:"data-placeholder"},translation:{releaseStatus:"data-status",language:"data-lang"}}},events:{loaded:"redeviation-bs-loaded",elementsCreated:"redeviation-bs-created",openSidebar:"redeviation-bs-sidebar-open",sidebarOpened:"redeviation-bs-sidebar-opened",overlayClosed:"redeviation-bs-overlay-closed",systemColorChanged:"redeviation-bs-system-color-changed",checkboxChanged:"redeviation-bs-checkbox-changed",scrollBoxLastPart:"redeviation-bs-scrollbox-lastpart",premiumPurchased:"redeviation-bs-premiumPurchased",showFeedbackForm:"redeviation-bs-feedback",lsbLoaded:"redeviation-lsb-loaded",pageChanged:"redeviation-bs-pageChanged"},website:{info:{landing:"https://extensions.redeviation.com/",privacyPolicy:"https://extensions.redeviation.com/privacy/bs",changelog:"https://extensions.redeviation.com/changelog/bs",uninstall:"https://extensions.redeviation.com/uninstall/bs"},premium:{checkout:"https://extensions.redeviation.com/premium/bs/checkout",checkLicenseKey:"https://extensions.redeviation.com/ajax/premium/bs/check"},feedback:{form:"https://extensions.redeviation.com/ajax/feedback",suggestions:"https://extensions.redeviation.com/ajax/feedback/suggestions"},translation:{info:"https://extensions.redeviation.com/ajax/translation/bs/info",langvars:"https://extensions.redeviation.com/ajax/translation/bs/langvars",submit:"https://extensions.redeviation.com/ajax/translation/bs/submit"},api:{checkStatus:"https://extensions.redeviation.com/ajax/status/bs",evaluate:"https://extensions.redeviation.com/api/evaluate/log"}},urlAliases:{Edge:{"chrome://newtab/":"edge://newtab/","chrome://bookmarks":"edge://favorites","chrome://extensions/shortcuts":"edge://extensions/shortcuts","chrome://settings/syncSetup":"edge://settings/profiles/sync","https://extensions.redeviation.com/img/illustration/video_sidepanel.mp4":"https://extensions.redeviation.com/img/illustration/edge/video_sidepanel.mp4","https://extensions.redeviation.com/img/illustration/video_overlay.mp4":"https://extensions.redeviation.com/img/illustration/edge/video_overlay.mp4"},Opera:{"chrome://newtab/":"chrome://startpageshared/","chrome://bookmarks":"opera://bookmarks","chrome://extensions/shortcuts":"opera://settings/keyboardShortcuts"}},leftsideBackSelector:"div#redeviation-lsb-indicator.redeviation-lsb-visible",manifest:e.api.runtime.getManifest(),demoMode:!1},e.isDev="Dev"===e.opts.manifest.version_name||!("update_url"in e.opts.manifest),e.copyrightDate=2016,e.browserName="Chrome",/EDG\//i.test(navigator.userAgent)?e.browserName="Edge":/OPERA|OPR\//i.test(navigator.userAgent)?e.browserName="Opera":/FIREFOX\//i.test(navigator.userAgent)&&(e.api=browser,e.browserName="Firefox"),e.cl=e.opts.classes,e.attr=e.opts.attr,e.I18nHelper=function(t){let a=null,r={},i=null;this.init=async()=>{const e=await t.helper.model.call("langvars");a=e.language,r=e.vars,i=e.dir},this.getLanguage=()=>a,this.isRtl=()=>"rtl"===i,this.getUILanguage=()=>e.api.i18n.getUILanguage(),this.getDefaultLanguage=()=>e.opts.manifest.default_locale,this.getLocaleSortCollator=()=>new Intl.Collator([this.getUILanguage(),this.getDefaultLanguage()]),this.getLocaleDate=e=>("number"==typeof e&&(e=new Date(e)),e.toLocaleDateString([this.getUILanguage(),this.getDefaultLanguage()],{year:"numeric",month:"2-digit",day:"2-digit"})),this.parseHtml=t=>{e(t).find("["+e.attr.i18n+"]").forEach((t=>{let a=null;const r=e(t).attr(e.attr.i18n);if(r){let i=[];const n=e(t).attr(e.attr.i18nReplaces);n&&(i=n.split(",")),a=this.get(r,i)}a?(e(t).removeAttr(e.attr.i18n),e(t).html(a)):e(t).remove()}))},this.get=(t,a=[],i=!1)=>{let n="";const s=r[t];return s&&s.message&&(n=s.message,n=n.replace(/\{browserName\}/gi,e.browserName),a&&a.length>0&&a.forEach(((e,t)=>{n=n.replace(new RegExp("\\{"+(t+1)+"\\}"),e)})),n=n.replace(/\[b\](.*)\[\/b\]/,"<strong>$1</strong>"),n=n.replace(/\[a\](.*)\[\/a\]/,"<a href='#'>$1</a>"),n=n.replace(/\[em\](.*)\[\/em\]/,"<em>$1</em>")),i&&(n=n.replace(/'/g,"&#x27;")),n}},e.FontHelper=function(e){const t={general:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:500,ExtraBold:500,Black:500},fa:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:500,Bold:600,ExtraBold:600,Black:600},ar:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:500,Bold:600,ExtraBold:600,Black:600},he:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:500,Bold:600,ExtraBold:600,Black:600},ja:{Thin:100,ExtraLight:100,Light:100,Normal:200,Medium:300,SemiBold:400,Bold:500,ExtraBold:500,Black:500},zh_CN:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:400,ExtraBold:500,Black:500},zh_TW:{Thin:100,ExtraLight:100,Light:100,Normal:300,Medium:400,SemiBold:400,Bold:400,ExtraBold:500,Black:500}};this.getFontWeights=()=>{const a=e.helper.i18n.getLanguage();let r={...t.general};t[a]&&(r={...t[a]});const i={};for(const e in r)i["fontWeight"+e]=r[e];return i}},e.StylesheetHelper=function(t){const a=["overlay","sidebar","content"],r=[];let i="",n="",s=!1;this.init=e=>{e&&e.defaultVal&&!0===e.defaultVal&&(s=!0),n=t.helper.model.getData("a/theme"),i=t.helper.model.getData("u/customCss");const a=t.helper.model.getData("a/surface");window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(async()=>{const e=this.getSystemSurface();if(t.helper.model.call("systemColorChanged",{surface:e}),t.helper.utility&&t.helper.utility.triggerEvent("systemColorChanged",e),"auto"===a)for(const e of r)await o(e.files,e.head,!0)}));const l=this.getSystemSurface();t.helper.model.call("systemColorChanged",{surface:l})},this.getSystemSurface=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",this.getStylesheetFilesWithThemes=e=>{const t=e;return n&&"default"!==n&&e.forEach((e=>{a.includes(e)&&t.push("themes/"+n+"/"+e)})),t},this.addStylesheets=async(a,r=null)=>{null===r?r=e(document):e.cl&&e.cl.page&&!1===t.helper.model.getData("b/animations")&&e.cl.page.noAnimations&&r.find("body").addClass(e.cl.page.noAnimations);let i=null;i=0===r.find("head").length()?r.find("body"):r.find("head"),await o(a,i)};const o=async(a,n,o=!1)=>{!1===o&&r.push({files:a,head:n});const l=t.helper.model.getData("a/styles",s),c=this.getStylesheetFilesWithThemes(a);for(const t of c){const a=await e.xhr(e.api.runtime.getURL("css/"+t+".css"),{mimeType:"text/css"});if(a.response){let r=a.response;r+=i,Object.keys(l).forEach((e=>{r=r.replace(new RegExp('"?%'+e+'"?',"g"),l[e])})),e.cl&&e.cl.page&&e.cl.page.style&&e.attr&&e.attr.name?(n.find("style."+e.cl.page.style+"["+e.attr.name+"='"+t+"']").remove(),n.append("<style class='"+e.cl.page.style+"' "+e.attr.name+"='"+t+"'>"+r+"</style>")):n.append("<style>"+r+"</style>")}}}},e.UtilityHelper=function(t){this.openUrl=async(e,a="default",r=!0)=>{if(t.helper.model.setData({"u/lastOpened":e.id}),"incognito"===a)await t.helper.model.call("openLink",{href:e.url,incognito:!0});else if("newWindow"===a)await t.helper.model.call("openLink",{id:e.id,href:e.url,newWindow:!0});else{const i="newTab"===a;e.url.startsWith("javascript:")&&!1===i?location.href=e.url:await t.helper.model.call("openLink",{parentId:e.parentId,id:e.id,href:e.url,newTab:"newTab"===a,position:t.helper.model.getData("b/newTabPosition"),active:r})}},this.openAllBookmarks=async e=>{const a=t.helper.model.getData("b/newTabPosition");"afterCurrent"!==a&&"beforeFirst"!==a||e.reverse();for(const t of e)await this.openUrl(t,"newTab",!1)},this.triggerEvent=(t,a={},r=null)=>{(r||document).dispatchEvent(new CustomEvent(e.opts.events[t],{detail:a,bubbles:!0,cancelable:!1}))},this.copyToClipboard=a=>{const r=e("<textarea></textarea>").text(a).appendTo(t.elm.iframeBody);r[0].select();let i=!1;try{i=t.elm.iframeDocument[0].execCommand("copy")}catch(e){}return r.remove(),i},this.isUrlOnBlacklist=e=>{if(!e||0===e.trim().length)return!0;let t=!1;return["about:","https?://192.168.","192.168.","https?://localhost","localhost","https?://127.0.0.","127.0.0.","javascript:","file://","chrome://","edge://","extension://","chrome-extension://"].some((a=>{if(0===e.search(new RegExp(a,"gi")))return t=!0,!0})),t},this.getSortList=()=>({custom:{dir:"ASC"},alphabetical:{dir:"ASC"},url:{dir:"ASC"},mostUsed:{dir:"DESC"},recentlyUsed:{dir:"DESC"},recentlyAdded:{dir:"DESC"}}),this.capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1),this.sortEntries=(e,a)=>{if(e.length>1){const r=t.helper.i18n.getLocaleSortCollator(),i=(t,r)=>{e.sort(((e,i)=>{const n=!!e.children,s=!!i.children;return"custom"!==a.name&&n!==s?n?-1:1:(t===a.dir?1:-1)*r(e,i)}))};switch(a.name){case"custom":i("ASC",((e,t)=>e.index-t.index));break;case"alphabetical":i("ASC",((e,t)=>r.compare(e.title,t.title)));break;case"url":i("ASC",((e,t)=>{if(!e.url||!t.url)return e.index-t.index;const a=e.url.replace(/^https?:\/\//,"").replace(/^www\./,""),i=t.url.replace(/^https?:\/\//,"").replace(/^www\./,"");return r.compare(a,i)}));break;case"recentlyAdded":i("DESC",((e,t)=>t.dateAdded-e.dateAdded));break;case"mostUsed":{const e=t.helper.model.getData("u/mostViewedPerMonth");i("DESC",((a,i)=>{const n=t.helper.entry.getDataById(a.id),s=t.helper.entry.getDataById(i.id),o=n?n.views[e?"perMonth":"total"]:0,l=s?s.views[e?"perMonth":"total"]:0;return o===l?r.compare(a.title,i.title):l-o}));break}case"recentlyUsed":i("DESC",((e,a)=>{const i=t.helper.entry.getDataById(e.id),n=t.helper.entry.getDataById(a.id),s=i?i.views.lastView:0,o=n?n.views.lastView:0;return s===o?r.compare(e.title,a.title):o-s}))}}},this.getIconImageData=async e=>{const a=await t.helper.model.call("iconImageData",{name:e.shape,color:e.color,padding:e.padding,background:e.background});if(a){const e=document.createElement("canvas");e.width=128,e.height=128;const t=e.getContext("2d"),r=t.createImageData(128,128);for(const e in r.data)r.data[e]=a.data[e];return t.putImageData(r,0,0),e.toDataURL("image/x-icon")}return""},this.isWindowed=()=>window.screenX>100||window.screenY>50||Math.abs(window.screen.availWidth-window.innerWidth)>50||window.navigator&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent&&window.navigator.userAgent.search(/[/\s-_]mobile[/\s-_]/i)>-1,this.isWebapp=()=>window.matchMedia("(display-mode: standalone)").matches,this.getPageType=()=>{const t=location.href;let a="other",r=!1;return Object.entries({newtab_default:["https?://www\\.google\\..+/_/chrome/newtab"],newtab_fallback:[e.api.runtime.getURL("html/newtab.html")+".*[?&]type=\\w+"],newtab_replacement:[e.api.runtime.getURL("html/newtab.html")],sidepanel:[e.api.runtime.getURL("html/sidepanel.html")],newtab_website:[".*[?&]bs_nt=1(&|#|$)"],website:["https?://"],onboarding:["chrome\\-extension://.*/intro.html","extension://.*/intro.html"],chrome:["chrome://","edge://"],extension:["chrome\\-extension://","extension://"],local:["file://"]}).some((([e,i])=>{if(i.some((i=>{if(0===t.search(new RegExp(i,"gi")))return a=e,r=!0,!0})),r)return!0})),a}},e.CheckboxHelper=function(t){const a={};this.get=(t,a,r="checkbox",i="default")=>{const n=e("<div></div>").html("<input type='checkbox' />").data("uid",Math.random().toString(36).substring(2,14)).attr(e.attr.type,r).attr(e.attr.style,i).addClass(e.cl.checkbox.box);return a&&(n.children("input[type='checkbox']").attr(a),a[e.attr.name]&&n.attr(e.attr.name,a[e.attr.name])),this.isChecked(n)&&n.addClass(e.cl.active),this.initEvents(n,t),n},this.initEvents=(t,a)=>{t.on("mousedown",(t=>{t.preventDefault(),t.stopPropagation(),e(t.currentTarget).addClass(e.cl.checkbox.focus)})).on("click",(t=>{t.preventDefault(),t.stopPropagation(),i(e(t.currentTarget),a)})),a.on("click",(()=>{t.removeClass(e.cl.checkbox.focus)}))},this.isChecked=e=>e.find("input[type='checkbox']")[0].checked;const r=(a,r)=>{const i=a.children("input[type='checkbox']");i.trigger("change"),t.helper.utility&&t.helper.utility.triggerEvent("checkboxChanged",{container:a,checkbox:i,checked:a.hasClass(e.cl.active)},r.document()[0])},i=(t,n)=>{t.addClass(e.cl.checkbox.clicked),t.removeClass(e.cl.checkbox.focus),t.toggleClass(e.cl.active);const s=t.hasClass(e.cl.active),o=t.children("input[type='checkbox']");if("radio"===t.attr(e.attr.type)&&t.attr(e.attr.name))if(n){const a=t.attr(e.attr.name);t.addClass(e.cl.active),s&&(o.attr("checked",!0),r(t,n)),n.find("div."+e.cl.checkbox.box+"["+e.attr.type+"='radio']["+e.attr.name+"='"+a+"']").forEach((a=>{const r=e(a);a!==t[0]&&this.isChecked(r)&&i(r)}))}else o.attr("checked",!1);else o.attr("checked",s),r(t,n);const l=t.data("uid");a[l]&&clearTimeout(a[l]),a[l]=setTimeout((()=>{t.removeClass(e.cl.checkbox.clicked)}),300)}},e.TemplateHelper=function(t){this.loading=()=>e('<svg class="loading" width="36px" height="36px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><circle fill="none" stroke-width="3" stroke-linecap="round" cx="18" cy="18" r="16"></circle></svg>'),this.overlay=(a,r)=>{const i={},n=t.helper.model.getData(["a/theme","b/animations","a/surface","a/highContrast"]);i.overlay=e("<iframe></iframe>").attr("id",e.opts.ids.page.overlay).addClass("notranslate").attr("aria-hidden","true").attr(e.attr.theme,n.theme).appendTo("body"),t.helper.stylesheet.addStylesheets(["overlay"],i.overlay);const s=i.overlay.find("body");s.attr(e.attr.theme,n.theme).attr("aria-hidden","true"),s.parent("html").attr("dir",t.helper.i18n.isRtl()?"rtl":"ltr"),i.modal=e("<div></div>").attr(e.attr.type,a).addClass(e.cl.overlay.modal).appendTo(s),!1===n.animations&&i.overlay.addClass(e.cl.page.noAnimations),"sidepanel"===t.helper.utility.getPageType()&&(i.modal.addClass(e.cl.sidebar.sidepanel),i.overlay.addClass(e.cl.sidebar.sidepanel)),"dark"===n.surface||"auto"===n.surface&&"dark"===t.helper.stylesheet.getSystemSurface()?s.addClass(e.cl.page.dark):n.highContrast&&s.addClass(e.cl.page.highContrast);const o=e("<header></header>").appendTo(i.modal);return e("<h1></h1>").text(r).appendTo(o),e("<a></a>").addClass(e.cl.close).appendTo(o),i.buttonWrapper=e("<menu></menu>").addClass(e.cl.overlay.buttonWrapper).appendTo(i.modal),e("<a></a>").addClass(e.cl.close).appendTo(i.buttonWrapper),i.overlay[0].focus(),e.delay(100).then((()=>{i.modal.addClass(e.cl.visible),i.overlay.addClass(e.cl.page.visible)})),i}},e.ModelHelper=function(t){const a={default:{textColor:{light:"#646464",dark:"#c8c8c8"},bookmarksDirColor:{light:"#646464",dark:"#c8c8c8"},sidebarMaskColor:{light:"rgba(255, 255, 255, 0.8)",dark:"rgba(0, 0, 0, 0.6)"},overlayMaskColor:{light:"rgba(0, 0, 0, 0.5)",dark:"rgba(0, 0, 0, 0.5)"},hoverColor:{light:"#f5f5f5",dark:"#555555"},colorScheme:{light:"#1b82f1",dark:"#1f4d80"},foregroundColor:{light:"#ffffff",dark:"#333333"},icon:{forLight:"#555555",forDark:"#ffffff"}},glass:{sidebarMaskColor:{light:"rgba(0, 0, 0, 0)",dark:"rgba(0, 0, 0, 0)"},overlayMaskColor:{light:"rgba(255, 255, 255, 0.5)",dark:"rgba(0, 0, 0, 0.3)"},textColor:{light:"#444444",dark:"#dfdfdf"},bookmarksDirColor:{light:"#444444",dark:"#dfdfdf"},hoverColor:{light:"rgba(0, 0, 0, 0.05)",dark:"rgba(255, 255, 255, 0.1)"}}},r=["textColor","hoverColor","sidebarMaskColor","bookmarksDirColor","overlayMaskColor"],i={u:{openStates:{},hiddenEntries:{},additionalInfo:{},scrollPos:0,separators:{},customCss:"",pinnedEntries:{},lockPinned:!0,translationHelp:!0,translationThanked:!1,entryAmounts:{},linkcheckerIgnored:{},lastOpened:null,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{overlayEnabled:!0,animations:!0,preventPageScroll:!1,toggleArea:{width:2,widthWindowed:20,height:100,top:0},blacklist:[],whitelist:[],sidebarPosition:"left",iconAction:"sidepanel",openAction:"mousedown",newTab:"foreground",newTabPosition:"afterCurrent",visibility:"always",linkAction:"current",dirAccordion:!1,preventWindowed:!1,preventWebapp:!1,rememberState:"openStatesAndPos",rememberOpenStatesSubDirectories:!0,newEntryPosition:"append",tooltipDelay:.5,tooltipContent:"all",tooltipAdditionalInfo:!0,dndCreationDialog:!1,closeOnTabChange:!0,openChildrenWarnLimit:10,dirOpenDuration:.4,scrollBarHide:1.5,openDelay:0,closeTimeout:1,dndOpenDirDelay:.5,refocusWebsite:!1},a:{theme:"default",showIndicator:!0,showIndicatorIcon:!0,surface:"light",highContrast:!1,directoryArrows:!1,showBookmarkIcons:!0,showDirectoryIcons:!0,devModeIconBadge:!0,styles:{colorScheme:a.default.colorScheme.light,foregroundColor:a.default.foregroundColor.light,textColor:null,hoverColor:null,indicatorWidth:"24px",indicatorIconSize:"24px",indicatorIconColor:"#ffffff",indicatorColor:"rgba(0,0,0,0.5)",iconShape:"bookmark",iconColor:"auto",sidebarWidth:"350px",sidebarHeaderHeight:"50px",sidebarMaskColor:null,bookmarksFontSize:"14px",directoriesIconSize:"16px",bookmarksIconSize:"16px",bookmarksLineHeight:"38px",bookmarksDirIcon:"dir-1",bookmarksDirColor:null,bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",scrollBarWidth:"11px",tooltipFontSize:"9px",overlayMaskColor:null,overlayHeaderHeight:"50px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',backgroundTransparency:.8,backgroundBlur:"7px"}},n:{override:!1,faviconShape:"new-1",faviconColor:"#545454",faviconBackground:"transparent",faviconPadding:10,autoOpen:!0,focusOmnibox:!1,searchSuggestQueries:!0,searchSuggestBookmarks:!0,searchSuggestHistory:!0,searchField:"show",searchEngine:"google",searchEngineCustom:{title:"",homepage:"",queryUrl:""},gridType:"topPages",gridMaxCols:4,gridMaxRows:2,customGridLinks:[],topLinks:[],topLinksPosition:"right",website:"",searchSuggestionNextKeys:["ArrowDown","Tab"],searchSuggestionPrevKeys:["ArrowUp","Tab"]}};let n={},s=null;this.init=async()=>{await o()};const o=async()=>{if(!e.api.storage)return;const t=["utility","behaviour","appearance","newtab"],a={};for(const r of t){const t=await e.api.storage["utility"===r?"local":"sync"].get([r]);a[r]=t[r]||{}}if(n=a,null===s){const e=await this.call("userType");e&&e.userType&&(s=e.userType)}},l=e=>{switch(e){case"u":return"utility";case"b":return"behaviour";case"a":return"appearance";case"n":return"newtab"}return null};this.getUserType=()=>s,this.getAllData=()=>n,this.getSurfaceColorDependentStyles=()=>r,this.getDefaultData=()=>{const e={};return Object.entries(i).forEach((([t,a])=>{const r=l(t);r&&(e[r]=a)})),e},this.getDefaultColors=(e="default")=>Object.assign({},a.default,a[e]),this.getData=(e,s=!1)=>{let o=e;"string"==typeof o&&(o=[o]);let c={};if(o.forEach((e=>{const o=e.split("/")[0],d=e.split("/")[1];let h=null;const p=l(o);if(p&&n[p]&&(!0===s||void 0===n[p][d]?void 0!==i[o]&&void 0!==i[o][d]&&(h=i[o][d]):h=n[p][d]),"a/styles"===e){const e=this.getData("a/surface"),n="auto"===e?t.helper.stylesheet.getSystemSurface():e,s=this.getData("a/theme");h=Object.assign({},i.a.styles,h);for(const t of r)null!==h[t]&&"auto"!==e||(a[s]&&a[s][t]?h[t]=a[s][t][n]:h[t]=a.default[t][n]);"auto"!==e||h.colorScheme!==a.default.colorScheme.light&&h.colorScheme!==a.default.colorScheme.dark||(h.colorScheme=a.default.colorScheme[n]),t.helper.font&&Object.assign(h,t.helper.font.getFontWeights())}c[d]=h})),"string"==typeof e){const t=e.split("/")[1];c=c[t]}return c},this.setData=t=>new Promise((a=>{o().then((()=>{Object.keys(t).forEach((e=>{const a=e.split("/")[0],r=e.split("/")[1],i=t[e];switch(a){case"u":n.utility[r]=i;break;case"b":n.behaviour[r]=i;break;case"a":n.appearance[r]=i;break;case"n":n.newtab[r]=i}}));let r=0;const i=(e=1)=>{r+=e,r>=4&&a()};try{e.api.storage.local.set({utility:n.utility},(()=>{e.api.runtime.lastError,i()})),e.api.storage.sync.set({behaviour:n.behaviour,appearance:n.appearance,newtab:n.newtab},(()=>{e.api.runtime.lastError,i(3)}))}catch(e){a()}}))})),this.call=async(t,a={},r=0)=>{let i=!1;a.type=t;let n=await e.api.runtime.sendMessage(a).catch((e=>{e&&(""+e).includes("Could not establish connection")?i=!0:console.error(e)}));return i&&r<50&&(await e.delay(100),n=await this.call(t,a,r+1)),n}},e.EntryHelper=function(e){let t=!1,a={},r={},i={},n={bookmarks:{},directories:{},pinned:{}};this.init=async(e=null)=>{await this.update(e),t=!0},this.initOnce=async()=>{t||await this.init()},this.getAmount=t=>{if(s(),0===Object.keys(a).length&&(a=e.helper.model.getData("u/entryAmounts")),a&&a[t]){let e=a[t].visible;return r.showHidden&&(e+=a[t].hidden),e}return null},this.getAllDataByType=e=>Object.values(n[e]||{}),this.getDataById=e=>{let t=null;return"object"==typeof n.bookmarks[e]?(t=n.bookmarks[e],"object"==typeof n.pinned[e]&&(t.pinnedIndex=n.pinned[e].index)):"object"==typeof n.directories[e]&&(t=n.directories[e]),t},this.getParentsById=e=>{const t=[];try{let a=this.getDataById(e).parentId;for(;a;){const e=this.getDataById(a);e&&t.push(e),a=e&&e.parentId?e.parentId:null}}catch(e){}return t},this.addData=(e,t,a)=>{"object"==typeof n.bookmarks[e]?("pinnedIndex"===t&&"object"==typeof n.pinned[e]&&(n.pinned[e].index=a),n.bookmarks[e][t]=a):"object"==typeof n.directories[e]&&(n.directories[e][t]=a)},this.isSeparator=e=>{let t=!1;return"object"==typeof n.bookmarks[e]&&(t=n.bookmarks[e].url.startsWith("about:blank")&&/^[-_]{3,}/.test(n.bookmarks[e].title)&&/[-_]{3,}$/.test(n.bookmarks[e].title)),t},this.isVisible=e=>{let t=!1;return"object"==typeof n.bookmarks[e]?t=!1===n.bookmarks[e].hidden:"object"==typeof n.directories[e]&&(t=!1===n.directories[e].hidden),t},this.update=(t=null)=>new Promise((r=>{s();const l=[e.helper.model.call("viewAmounts")];null===t&&l.push(e.helper.model.call("bookmarks",{id:0})),Promise.all(l).then((s=>{i=s[0],null===t&&s[1]&&s[1].bookmarks&&s[1].bookmarks[0]&&s[1].bookmarks[0].children&&(t=s[1].bookmarks[0].children),n={bookmarks:{},directories:{},pinned:{}},a={bookmarks:{visible:0,hidden:0},directories:{visible:0,hidden:0},pinned:{visible:0,hidden:0}},o(t),e.helper.model.setData({"u/entryAmounts":a}),r()}))}));const s=()=>{r=e.helper.model.getData(["u/hiddenEntries","u/additionalInfo","u/pinnedEntries","u/showHidden"])},o=(e,t=[],a=!1)=>{e&&e.forEach((e=>{const n=[...t];"0"!==e.parentId&&n.push(e.parentId),e.additionalInfo=r.additionalInfo[e.id]||{},e.hidden=a||!0===r.hiddenEntries[e.id],e.parents=n,e.views={startDate:+new Date(Math.max(e.dateAdded,i.counterStartDate)),total:0},e.url?c(e):e.children&&l(e)}))},l=e=>{e.childrenAmount={bookmarks:0,directories:0,total:0},e.parents.forEach((e=>{"root________"!==e&&n.directories[e].childrenAmount.directories++})),n.directories[e.id]=e,o(e.children,e.parents,e.hidden),e.isDir=!0,e.childrenAmount.total=e.childrenAmount.bookmarks+e.childrenAmount.directories,e.views.perMonth=Math.round(e.views.total/d(e.views.startDate)*100)/100,a.directories[e.hidden?"hidden":"visible"]++},c=e=>{let t=0,s=0;if(i.viewAmounts[e.id]&&(t=i.viewAmounts[e.id].c,s=i.viewAmounts[e.id].d||0),e.views.total=t,e.views.lastView=s,e.views.perMonth=Math.round(t/d(e.views.startDate)*100)/100,e.parents.forEach((e=>{n.directories[e]&&(n.directories[e].childrenAmount.bookmarks++,n.directories[e].views.total+=t,n.directories[e].views.lastView=Math.max(n.directories[e].views.lastView||0,s))})),e.pinned=!1,n.bookmarks[e.id]=e,!1===this.isSeparator(e.id)&&a.bookmarks[e.hidden?"hidden":"visible"]++,r.pinnedEntries[e.id]){e.pinned=!0;const t=Object.assign({},e);t.index=r.pinnedEntries[e.id].index,delete t.parents,delete t.parentId,n.pinned[e.id]=t,a.pinned[e.hidden?"hidden":"visible"]++}},d=e=>Math.max(1,Math.round((+new Date-e)/2627999942.4))},e.EditHelper=function(t){let a=!1;this.init=async()=>{e("<a></a>").addClass(e.cl.newtab.edit).appendTo(t.elm.body),r(),location.href.search(/#edit$/i)>-1&&o()},this.isEditMode=()=>a;const r=()=>{t.elm.body.on("click","a."+e.cl.newtab.edit,(e=>{e.preventDefault(),a||o()}))},i=async()=>{const a=+new Date,r=t.helper.template.loading().appendTo(t.elm.body);t.elm.body.addClass(e.cl.loading);const i=t.helper.search.getCurrentSearchEngine(),s=i.name;delete i.name;const o=t.helper.checkbox.isChecked(t.elm.search.wrapper.find("["+e.attr.name+"='searchSuggestQueries']")),l=t.helper.checkbox.isChecked(t.elm.search.wrapper.find("["+e.attr.name+"='searchSuggestBookmarks']")),c=t.helper.checkbox.isChecked(t.elm.search.wrapper.find("["+e.attr.name+"='searchSuggestHistory']")),d=t.elm.gridLinks.children("select["+e.attr.type+"='type']")[0].value,h={"n/searchField":t.elm.search.wrapper.children("select["+e.attr.type+"='searchField']")[0].value,"n/searchEngine":s,"n/searchEngineCustom":i,"n/searchSuggestQueries":o,"n/searchSuggestBookmarks":l,"n/searchSuggestHistory":c,"n/gridType":d,"n/topLinksPosition":t.elm.topLinks.children("select")[0].value,"n/topLinks":n(t.elm.topLinks.find("> ul > li > a"))};"premium"===t.helper.model.getUserType()&&(h["n/gridMaxCols"]=+t.elm.gridLinks.find("select["+e.attr.type+"='cols']")[0].value,h["n/gridMaxRows"]=+t.elm.gridLinks.find("select["+e.attr.type+"='rows']")[0].value),"custom"===d&&(h["n/customGridLinks"]=n(t.elm.gridLinks.find("> ul > li > a"),!0)),await t.helper.model.setData(h);const p=t.elm.body.css("background-image").replace(/(^url\("?|"?\)$)/g,"");await e.api.storage.local.set({newtabBackground_1:p&&"none"!==p?p:null}),await e.delay(Math.max(0,1e3-(+new Date-a))),t.elm.body.removeClass(e.cl.loading),r.remove()},n=(t,a=!1)=>{const r=[];return t.forEach((t=>{const i=e(t).text().trim(),n=(e(t).data("href")||"").trim();i&&i.length>0&&n&&n.length>0?r.push({title:i,url:n}):a&&r.push({title:"",url:""})})),r},s=async()=>{a=!1,history.pushState({},null,location.href.replace(/#edit/g,"")),t.elm.body.removeClass(e.cl.newtab.edit),t.elm.search.wrapper.children("a."+e.cl.newtab.edit).remove(),t.elm.search.wrapper.children("select").remove(),t.elm.search.wrapper.children("["+e.attr.name+"='searchSuggest']").remove(),t.elm.topLinks.children("select").remove(),t.elm.gridLinks.children("select").remove(),t.elm.gridLinks.children("div["+e.attr.type+"='gridsize']").remove(),u(t.elm.gridLinks,"> ul > li > a"),u(t.elm.topLinks,"> ul > li > a"),t.helper.search.updateSearchEngine(t.helper.model.getData("n/searchEngine"),t.helper.model.getData("n/searchEngineCustom")),t.helper.search.setVisibility(t.helper.model.getData("n/searchField")),t.helper.search.setSearchSuggestion("queries",t.helper.model.getData("n/searchSuggestQueries")),t.helper.search.setSearchSuggestion("bookmarks",t.helper.model.getData("n/searchSuggestBookmarks")),t.helper.search.setSearchSuggestion("history",t.helper.model.getData("n/searchSuggestHistory")),t.helper.gridLinks.setType(t.helper.model.getData("n/gridType")),t.helper.gridLinks.setMaxCols(t.helper.model.getData("n/gridMaxCols")),t.helper.gridLinks.setMaxRows(t.helper.model.getData("n/gridMaxRows")),t.helper.topLinks.refreshEntries();const r=await t.getBackground();t.setBackground(r),await e.delay(500),e("menu."+e.cl.newtab.infoBar).remove()},o=async()=>{a=!0,history.pushState({},null,location.href.replace(/#edit/g,"")+"#edit");const r=e("<menu></menu>").addClass(e.cl.newtab.infoBar).append("<a class='"+e.cl.cancel+"'>"+t.helper.i18n.get("overlay_cancel")+"</a>").append("<a class='"+e.cl.newtab.save+"'>"+t.helper.i18n.get("settings_save")+"</a>").appendTo(t.elm.body),n=e("<div></div>").addClass(e.cl.newtab.upload).appendTo(r);"premium"===t.helper.model.getUserType()?(e("<a></a>").addClass(e.cl.newtab.remove).appendTo(n),e("<div></div>").html("<span>"+t.helper.i18n.get("newtab_upload_background")+'</span><input type="file" accept="image/*" />').appendTo(n)):(n.attr("title",t.helper.i18n.get("premium_restricted_text")),e("<span></span>").text(t.helper.i18n.get("settings_menu_premium")).addClass(e.cl.premium).appendTo(n),e("<div></div>").html("<span>"+t.helper.i18n.get("newtab_upload_background")+"</span>").appendTo(n)),e("menu."+e.cl.newtab.infoBar+" > a").on("click",(async t=>{t.preventDefault();const a=e(t.currentTarget);a.hasClass(e.cl.cancel)?await s():a.hasClass(e.cl.newtab.save)&&(await i(),await s())})),"premium"===t.helper.model.getUserType()?(e("menu."+e.cl.newtab.infoBar+" > div."+e.cl.newtab.upload+" input").on("change",(a=>{if(a.currentTarget.files){const r=new FileReader;r.onload=a=>{try{t.elm.body.addClass(e.cl.newtab.customBackground).css("background-image","url("+a.target.result+")")}catch(a){}},r.readAsDataURL(a.currentTarget.files[0])}})),e("menu."+e.cl.newtab.infoBar+" > div."+e.cl.newtab.upload+" a."+e.cl.newtab.remove).on("click",(()=>{t.elm.body.removeClass(e.cl.newtab.customBackground).css("background-image","")}))):e("menu."+e.cl.newtab.infoBar+" > div."+e.cl.newtab.upload).on("click",(()=>{t.helper.model.call("openLink",{href:e.api.runtime.getURL("html/settings.html#premium"),newTab:!0})})),await e.delay(),t.elm.body.addClass(e.cl.newtab.edit),m(),g(),c(),h(),d(),e(document).off("click.edit").on("click.edit",(()=>{e("div."+e.cl.newtab.editLinkTooltip).remove()}));for(let t=0;t<25;t++)await e.delay(100),e(window).trigger("resize")},l=(a,r,i,n="empty")=>{e("div."+e.cl.newtab.editLinkTooltip).remove();const s=(r.data("href")||"").trim(),o=e("<div></div>").addClass(e.cl.newtab.editLinkTooltip).append("<label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label>").append("<input type='text' value='"+i.text().trim().replace(/'/g,"&#x27;")+"' "+e.attr.type+"='label' />").append("<label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label>").append("<input type='text' value='"+s.replace(/'/g,"&#x27;")+"' "+e.attr.type+"='url' />").append("<button type='submit' "+e.attr.type+"='delete'>"+t.helper.i18n.get("overlay_delete")+"</button>").append("<button type='submit' "+e.attr.type+"='close'>"+t.helper.i18n.get("overlay_close")+"</button>").appendTo(a);o.on("click",(t=>{"BUTTON"!==t.target.tagName?t.stopPropagation():"delete"===e(t.target).attr(e.attr.type)&&("empty"===n?(r.removeAttr("href").removeData("href").attr(e.attr.value,"empty"),i.html("&nbsp;")):"delete"===n&&(i.remove(),r.remove()))})),o.find("input[type='text']").on("change input",(t=>{let a=t.currentTarget.value.trim();switch(e(t.currentTarget).attr(e.attr.type)){case"url":r.removeAttr("href").removeData("href"),a&&a.length>0?(0!==a.search(/^[\w-]+:\/\//)&&(a="http://"+a),r.data("href",a).attr(e.attr.value,"url")):r.attr(e.attr.value,"empty");break;case"label":a&&a.length>0?i.text(a.trim()):i.html("&nbsp;")}}))},c=()=>{const a=e("<select></select>").addClass(e.cl.newtab.edit).attr(e.attr.type,"type").prependTo(t.elm.gridLinks),r=t.helper.gridLinks.getAllTypes(),i=t.helper.model.getData("n/gridType");Object.keys(r).forEach((n=>{const s=t.helper.i18n.get("newtab_grid_links_"+r[n]);e("<option value='"+n+"' "+(i===n?"selected":"")+"></option>").text(s).appendTo(a)})),a.on("input change",(e=>{t.helper.gridLinks.setType(e.currentTarget.value)}))},d=()=>{const a=t.helper.model.getData("n/topLinksPosition"),r=e("<select></select>").addClass(e.cl.newtab.edit).appendTo(t.elm.topLinks);["left","right"].forEach((i=>{e("<option value='"+i+"' "+(a===i?"selected":"")+"></option>").text(t.helper.i18n.get("settings_sidebar_position_"+i)).appendTo(r)})),r.on("input change",(a=>{t.elm.topLinks.attr(e.attr.position,a.currentTarget.value)}));e("<a class='"+e.cl.add+"'></a>").prependTo(t.elm.topLinks).on("click",(async()=>{const a=e("<li></li>").append("<a>&nbsp;</a>").prependTo(t.elm.topLinks.children("ul"));await e.delay();const r=a.children("a").eq(0);l(a,r,r,"delete"),p(t.elm.topLinks,"> ul > li > a")})),t.elm.topLinks.off("click.edit").on("click.edit","> ul > li > a",(t=>{t.stopPropagation(),t.preventDefault();const a=e(t.currentTarget),r=a.parent("li");l(r,a,a,"delete")})),p(t.elm.topLinks,"> ul > li > a")},h=()=>{t.elm.gridLinks.off("click.edit").on("click.edit","> ul > li > a",(a=>{if("custom"===t.elm.gridLinks.attr(e.attr.type)){a.stopPropagation(),a.preventDefault();const t=e(a.currentTarget),r=t.parent("li"),i=t.children("span").eq(0);l(r,t,i)}})),p(t.elm.gridLinks,"> ul > li > a")},p=(t,a)=>{let r=null;t.find(a).attr("draggable","draggable"),t.off("dragstart.edit").on("dragstart.edit",a,(t=>{r=t.currentTarget,e("div."+e.cl.newtab.editLinkTooltip).remove()})),t.off("dragenter.edit").on("dragenter.edit",a,(t=>{e(t.currentTarget).addClass(e.cl.drag.dragHover)})),t.off("dragover.edit").on("dragover.edit",a,(e=>{e.preventDefault()})),t.off("dragleave.edit").on("dragleave.edit",a,(t=>{e(t.currentTarget).removeClass(e.cl.drag.dragHover)})),t.off("dragend.edit").on("dragend.edit",a,(async()=>{t.find(a).removeClass(e.cl.drag.dragHover),await e.delay(),r=null})),t.off("drop.edit").on("drop.edit",a,(i=>{if(i.preventDefault(),t.find(a).removeClass(e.cl.drag.dragHover),r===i.currentTarget)return;const n=i.currentTarget.nextElementSibling,s=i.currentTarget.parentNode;r===n?s.insertBefore(r,i.currentTarget):(r.replaceWith(i.currentTarget),s.insertBefore(r,n))}))},u=(e,t)=>{e.find(t).removeAttr("draggable"),e.off("click.edit"),e.off("dragstart.edit"),e.off("dragenter.edit"),e.off("dragover.edit"),e.off("dragleave.edit"),e.off("dragend.edit"),e.off("drop.edit")},g=()=>{const a=e("<div></div>").attr(e.attr.type,"gridsize").html("<strong>"+t.helper.i18n.get("newtab_grid_links_grid_size")+"</strong>").prependTo(t.elm.gridLinks);["Cols","Rows"].forEach((r=>{const i=t.helper.model.getData("n/gridMax"+r),s=e("<select></select>").addClass(e.cl.newtab.edit).attr(e.attr.type,r.toLowerCase()).appendTo(a);for(let t=1;t<10;t++)e("<option value='"+t+"' "+(i===t?"selected":"")+"></option>").text(t).appendTo(s);s.on("input change",(async a=>{const i=n(t.elm.gridLinks.find("> ul > li > a"),!0);await t.helper.gridLinks["setMax"+r](a.currentTarget.value),t.elm.gridLinks.find("> ul > li > a").forEach(((t,a)=>{if(!i[a])return!1;e(t).data("href",i[a].url).attr("href",i[a].url).attr(e.attr.value,"url"),e(t).children("span").eq(0).text(i[a].title)}))}))})),e("<span></span>").text("x").insertAfter(a.children("select").eq(0)),"premium"!==t.helper.model.getUserType()&&(a.addClass(e.cl.premium).attr("title",t.helper.i18n.get("premium_restricted_text")),a.find("select").attr("disabled","disabled"),e("<span></span>").text(t.helper.i18n.get("settings_menu_premium")).addClass(e.cl.premium).appendTo(a),a.on("click",(()=>{t.helper.model.call("openLink",{href:e.api.runtime.getURL("html/settings.html#premium"),newTab:!0})})))},m=()=>{const a=e("<select></select>").addClass(e.cl.newtab.edit).attr(e.attr.type,"searchField").prependTo(t.elm.search.wrapper),r=t.helper.model.getData("n/searchField");["show","hide"].forEach((i=>{const n=t.helper.i18n.get("newtab_search_field_"+i);e("<option value='"+i+"' "+(r===i?"selected":"")+"></option>").text(n).appendTo(a)})),a.on("input change",(e=>{t.helper.search.setVisibility(e.currentTarget.value)}));const i=e("<div></div>").attr(e.attr.name,"searchSuggest").prependTo(t.elm.search.wrapper);["queries","bookmarks","history"].forEach((a=>{const r="searchSuggest"+t.helper.utility.capitalizeFirstLetter(a),n=t.helper.checkbox.get(t.elm.body,{[e.attr.name]:r},"checkbox").appendTo(i);e("<span></span>").html(t.helper.i18n.get("newtab_search_suggest_"+a)).insertAfter(n),t.helper.model.getData("n/"+r)&&n.trigger("click"),n.children("input[type='checkbox']").on("change",(e=>{t.helper.search.setSearchSuggestion(a,e.currentTarget.checked)}))}));e("<a></a>").addClass(e.cl.newtab.edit).appendTo(t.elm.search.wrapper).on("click",(e=>{e.preventDefault(),t.helper.overlay.create("searchEngine",t.helper.i18n.get("newtab_search_engine_headline"))}))}},e.FallbackHelper=function(t){this.init=async()=>{const i=new URL(location.href).searchParams.get("type");null!==i&&(t.elm.gridLinks.addClass(e.cl.hidden),t.elm.fallbackInfo.addClass(e.cl.active),n(i),a(i),"new_tab"!==i&&"fallback"!==i||!1!==t.helper.model.getData("n/override")||r())};const a=a=>{t.elm.fallbackInfo.children("a").on("click",(t=>{t.preventDefault();let r="general";switch(a){case"notWhitelisted":case"blacklisted":r="filter"}e.api.tabs.create({url:e.api.runtime.getURL("html/settings.html#support_error_"+r)})}))},r=()=>{const a=e("<div></div>").appendTo(t.elm.fallbackInfo),r=t.helper.checkbox.get(t.elm.body,{},"checkbox","switch").appendTo(a);e("<span></span>").html(t.helper.i18n.get("newtab_fallback_set_as_new_tab")).insertAfter(r),r.children("input[type='checkbox']").on("change",(t=>{t.currentTarget.checked?e.api.permissions.request({permissions:["tabs","topSites","history"]},(e=>{e?i(!0):r.trigger("click")})):i(!1)}))},i=a=>{e.api.storage.sync.get(["newtab"],(r=>{const i=r.newtab||{};i.override=a,e.api.storage.sync.set({newtab:i},(()=>{t.enabledSetAsNewtab=!0,t.helper.model.call("reinitialize")}))}))},n=a=>{const r={headline:"newtab_fallback_headline_general",desc:"newtab_fallback_desc",link:"more_link"};switch(a){case"new_tab":case"system":case"extension_page":case"webstore":r.headline="newtab_fallback_headline_"+a;break;case"notWhitelisted":case"blacklisted":r.headline="newtab_fallback_headline_url_filter"}e("<h2></h2>").text(t.helper.i18n.get(r.headline)).appendTo(t.elm.fallbackInfo),e("<p></p>").text(t.helper.i18n.get(r.desc)).appendTo(t.elm.fallbackInfo),e("<a></a>").text(t.helper.i18n.get(r.link)).appendTo(t.elm.fallbackInfo)}},e.GridLinksHelper=function(t){let a=null,r=0,i=0,n=!1;const s={topPages:"default",mostUsed:"most_used",recentlyUsed:"recently_used",custom:"custom",hidden:"hidden"};this.init=async()=>{o(),t.elm.gridLinks.html("<ul></ul>"),a=t.helper.model.getData("n/gridType"),r=t.helper.model.getData("n/gridMaxCols"),i=t.helper.model.getData("n/gridMaxRows"),c(),setInterval((()=>{document.hidden&&c()}),18e4)},this.getAllTypes=()=>s,this.setType=async e=>{a=e,await c()},this.setMaxCols=async e=>{r!==e&&(r=e,await c())},this.setMaxRows=async e=>{i!==e&&(i=e,await c())},this.handleWindowResize=async()=>{const e=l(),a=t.elm.gridLinks.children("ul").data("total");e.total!==a&&await c()};const o=()=>{e(window).on("resize.gridLinks",(()=>{this.handleWindowResize()}),{passive:!0}),t.elm.gridLinks.on("click auxclick","> ul > li > a",(a=>{"custom"===t.elm.gridLinks.attr(e.attr.type)&&t.elm.body.hasClass(e.cl.newtab.edit)||(a.preventDefault(),0!==a.button&&1!==a.button||t.helper.model.call("openLink",{href:e(a.currentTarget).data("href"),newTab:"auxclick"===a.type,position:t.helper.model.getData("b/newTabPosition"),active:"auxclick"!==a.type}))}))},l=()=>{const a={cols:r,rows:i},n={w:t.elm.content[0].offsetWidth||window.innerWidth,h:t.elm.content[0].offsetHeight||window.innerHeight};for(!t.helper.edit.isEditMode()&&t.elm.search.wrapper.hasClass(e.cl.hidden)||(n.h-=t.elm.search.wrapper[0].offsetHeight+150);145*a.cols>n.w&&a.cols>0;)a.cols--;for(;121*a.rows>n.h&&a.rows>0;)a.rows--;return a.total=a.cols*a.rows,a},c=async()=>{t.elm.gridLinks.attr(e.attr.type,a);const r=t.elm.gridLinks.children("ul");if(r.removeClass(e.cl.visible),"hidden"===a)!1===t.helper.edit.isEditMode()&&r.data("total",0).html("");else if(!1===n){n=!0;const[a]=await Promise.all([d(),e.delay(200)]),i=l();r.html("").data("total",i.total).css("grid-template-columns","1fr ".repeat(i.cols).trim());for(const i of a){const a=e("<li></li>").appendTo(r),n=e("<a></a>").attr({href:i.url,title:i.title,[e.attr.value]:0===i.url.length?"empty":"url"}).data("href",i.url).appendTo(a);void 0!==i.visible&&!1===i.visible&&a.addClass("hidden"),e("<span></span>").text(i.title).appendTo(n);const s=await t.helper.model.call("favicon",{url:i.url});if(s){const t=e("<img />").attr("src",s);e("<div></div>").append(t).prependTo(n)}"custom"===t.elm.gridLinks.attr(e.attr.type)&&t.elm.body.hasClass(e.cl.newtab.edit)&&n.attr("draggable","draggable")}await e.delay(100),r.addClass(e.cl.visible),n=!1}},d=async()=>{const r=l();if(r.total>0)switch(a){case"mostUsed":case"recentlyUsed":return await(async()=>{await t.helper.entry.init()})(),p(a);case"custom":return h();default:if(e.api.topSites&&e.api.topSites.get){const t=await e.api.topSites.get();return void 0===e.api.runtime.lastError&&t?t.slice(0,r.total):[]}}return[]},h=()=>{const e=[],a=l(),r=t.helper.model.getData("n/customGridLinks"),i=Math.max(a.total,r?r.length:0);for(let t=0;t<i;t++){let i=r&&r[t]?{...r[t]}:{};i.title&&i.url||(i={title:"",url:""}),i.visible=a.total>t,e.push(i)}return e},p=e=>{const a=l(),r=[],i=t.helper.model.getData("u/showHidden"),n=t.helper.entry.getAllDataByType("bookmarks");return t.helper.utility.sortEntries(n,{name:e,dir:"DESC"}),n.some((e=>{if((i||t.helper.entry.isVisible(e.id))&&!1===t.helper.entry.isSeparator(e.id)&&0!==e.url.search(/^file:\/\//)&&(r.push(e),r.length>=a.total))return!0})),r}},e.OverlayHelper=function(t){let a={};this.create=(r,n)=>{if(a=t.helper.template.overlay(r,n),a.buttonWrapper.children("a."+e.cl.close).text(t.helper.i18n.get("overlay_close")),"searchEngine"===r)i();o()};const r=async()=>{t.helper.utility.triggerEvent("overlayClosed"),a.overlay.removeClass(e.cl.page.visible),await e.delay(400),a.overlay.remove()},i=()=>{const r=e("<div></div>").addClass(e.cl.scrollBox.wrapper).appendTo(a.modal),i=e("<ul></ul>").appendTo(r),n=t.helper.search.getSearchEngineList(),s=t.helper.search.getCurrentSearchEngine();Object.entries(n).forEach((([r,n])=>{const o=e("<li></li>").append(t.helper.checkbox.get(a.overlay.find("body"),{[e.attr.name]:"searchEngine",[e.attr.value]:r},"radio")).append("<a>"+n.name+"</a>").appendTo(i);n.favicon&&e("<img />").attr("src",n.favicon).prependTo(o.children("a")),s.name===r&&o.find("input["+e.attr.name+"='searchEngine']["+e.attr.value+"='"+r+"']").parent("div."+e.cl.checkbox.box).trigger("click")}));const o=e("<ul></ul>").attr(e.attr.type,"custom").appendTo(r);"custom"===s.name&&o.addClass(e.cl.visible),e("<li></li>").append("<label>"+t.helper.i18n.get("newtab_search_engine_custom_title")+"</label>").append("<input type='text' name='title' value='"+s.title.replace(/'/g,"&#x27;")+"' />").appendTo(o),e("<li></li>").append("<label>"+t.helper.i18n.get("newtab_search_engine_custom_url_homepage")+"</label>").append("<input type='text' name='homepage' value='"+s.homepage.replace(/'/g,"&#x27;")+"' placeholder='https://example.com' />").appendTo(o),e("<li></li>").append("<label>"+t.helper.i18n.get("newtab_search_engine_custom_url_results")+"</label>").append("<input type='text' name='queryUrl' value='"+s.queryUrl.replace(/'/g,"&#x27;")+"' placeholder='https://example.com/?q={1}' />").appendTo(o),e("<a></a>").addClass(e.cl.overlay.action).text(t.helper.i18n.get("overlay_save")).appendTo(a.buttonWrapper)},n=()=>{let t=null;return a.modal.find("input[type='checkbox']").forEach((a=>{if(a.checked)return t=e(a).attr(e.attr.value),!1})),t},s=async()=>{const e=n();e&&t.helper.search.updateSearchEngine(e,{title:a.modal.find("input[name='title']")[0].value,homepage:a.modal.find("input[name='homepage']")[0].value,queryUrl:a.modal.find("input[name='queryUrl']")[0].value}),await r()},o=()=>{let t=null;a.overlay.find("body").on("mousedown",(e=>{t=e.target})).on("click",(e=>{"BODY"===e.target.tagName&&"BODY"===t.tagName&&r()})),a.modal.find("a."+e.cl.close).on("click",(e=>{e.preventDefault(),r()})),a.modal.on("click","a",(async t=>{t.preventDefault();const r=e(t.currentTarget),i=r.prev("div."+e.cl.checkbox.box);i.length()>0&&i.trigger("click"),r.hasClass(e.cl.overlay.action)&&await(async()=>{"searchEngine"===a.modal.attr(e.attr.type)&&await s()})()})),a.modal.find("input[type='checkbox']").on("change",(async()=>{await e.delay();const t=a.modal.find("ul["+e.attr.type+"='custom']");"custom"===n()?t.addClass(e.cl.visible):t.removeClass(e.cl.visible)}))}},e.SearchHelper=function(t){let a={},r={},i={},n=!1,s=[],o=[];const l={queries:!0,bookmarks:!0,history:!0},c={google:{name:"Google",url:"https://www.google.com/",queryUrl:"https://www.google.com/search?q={1}",favicon:"https://www.google.com/favicon.ico",sorting:10},bing:{name:"Bing",url:"https://www.bing.com/",queryUrl:"https://www.bing.com/search?q={1}",favicon:"https://www.bing.com/favicon.ico",sorting:20},yandex:{name:"Yandex",url:"https://yandex.com/",queryUrl:"https://yandex.com/search/?text={1}",favicon:"https://yandex.com/favicon.ico",sorting:30,lang:{ru:{name:"",url:"https://yandex.ru/",queryUrl:"https://yandex.ru/search/?text={1}",sorting:15},uk:{name:"",url:"https://yandex.ua/",queryUrl:"https://yandex.ua/search/?text={1}",sorting:15},tr:{url:"https://yandex.com.tr/",queryUrl:"https://yandex.com.tr/search/?text={1}",sorting:15}}},baidu:{name:"Baidu",url:"https://www.baidu.com/",queryUrl:"https://www.baidu.com/s?wd={1}",favicon:"https://www.baidu.com/favicon.ico",sorting:40,lang:{"zh-CN":{name:"",sorting:5}}},custom:{sorting:50}};this.init=async()=>{d(),u(),s=t.helper.model.getData("n/searchSuggestionNextKeys"),o=t.helper.model.getData("n/searchSuggestionPrevKeys"),this.updateSearchEngine(t.helper.model.getData("n/searchEngine"),t.helper.model.getData("n/searchEngineCustom")),this.setVisibility(t.helper.model.getData("n/searchField")),this.setSearchSuggestion("queries",t.helper.model.getData("n/searchSuggestQueries")),this.setSearchSuggestion("bookmarks",t.helper.model.getData("n/searchSuggestBookmarks")),this.setSearchSuggestion("history",t.helper.model.getData("n/searchSuggestHistory"))},this.setSearchSuggestion=(e,t)=>{l[e]=t,a={}},this.setVisibility=a=>{"hide"===a?t.elm.search.wrapper.addClass(e.cl.hidden):t.elm.search.wrapper.removeClass(e.cl.hidden)},this.updateSearchEngine=(e,a={})=>{if(i[e]){r={name:e,title:a.title||"",homepage:a.homepage||"",queryUrl:a.queryUrl||""};const n="custom"===r.name&&r.title?r.title:i[e].label;t.elm.search.field.attr("placeholder",t.helper.i18n.get("newtab_search_placeholder",[n]))}},this.focusSearch=()=>{!1===t.elm.search.wrapper.hasClass(e.cl.hidden)?(!1===n&&(n=!0,t.elm.search.field[0].value=(window.cachedKeys||[]).join("")),t.elm.search.field[0].focus()):t.elm.sidebar&&t.elm.sidebar.iframe&&t.helper.model.getData("n/autoOpen")&&(e(document).trigger(e.opts.events.openSidebar),t.elm.sidebar.iframe[0].focus())},this.getCurrentSearchEngine=()=>r,this.getSearchEngineList=()=>i;const d=()=>{const e=t.helper.i18n.getUILanguage(),a=[];Object.entries(c).forEach((([r,i])=>{if("custom"===r){const e=t.helper.model.getData("n/searchEngineCustom");i.name=t.helper.i18n.get("newtab_search_engine_custom"),i.label=e.title,i.url=e.homepage,i.queryUrl=e.queryUrl}const n={alias:r,name:i.name,label:i.label||i.name,favicon:i.favicon||null,url:i.url,queryUrl:i.queryUrl,sorting:i.sorting};i.lang&&i.lang[e]&&Object.entries(i.lang[e]).forEach((([e,t])=>{n[e]=t})),n.name&&a.push(n)})),a.sort(((e,t)=>(e.sorting||9999)-(t.sorting||9999))),i={},a.forEach((e=>{i[e.alias]=e}))},h=a=>{const r=e("ul."+e.cl.newtab.suggestions+" > li."+e.cl.active);let i="next"===a?0:-1;r.length()>0&&(i=r.prevAll("li").length()+("next"===a?1:-1),r.removeClass(e.cl.active));let n=!1;if(i>=0){const a=e("ul."+e.cl.newtab.suggestions+" > li").eq(i);a.length()>0&&(n=!0,a.addClass(e.cl.active),t.elm.search.field[0].value=(a.attr(e.attr.src)||a.text()).trim())}!1===n&&(t.elm.search.field[0].value=t.elm.search.field.data("typedVal")||"")},p=(e,a={})=>{if(!e||0===e.trim().length)return;const n=e=>{t.helper.model.call("openLink",{href:e,newTab:a.newtab||!1,position:t.helper.model.getData("b/newTabPosition"),active:!a.newtab})};if(0===e.search(/https?\:\/\//)||0===e.search(/s?ftps?\:\/\//)||0===e.search(/chrome\:\/\//))n(e);else if(i[r.name]){let t="";"custom"===r.name&&r.queryUrl?t=r.queryUrl:i[r.name].queryUrl&&(t=i[r.name].queryUrl),t&&(!1===t.includes("{1}")&&(t+="{1}"),n(t.replace("{1}",encodeURIComponent(e))))}},u=()=>{t.elm.search.speechSearch.on("click",(e=>{e.preventDefault(),g()})),t.elm.search.wrapper.on("submit",(e=>{e.preventDefault();const a=t.elm.search.field[0].value.trim();if(a&&a.trim().length>0)p(a);else if(i[r.name]){let e="";"custom"===r.name&&r.homepage?e=r.homepage:i[r.name].url&&(e=i[r.name].url),e&&t.helper.model.call("openLink",{href:e,newTab:!1})}})),t.elm.search.field.on("keyup click",(async r=>{if(r.preventDefault(),r.stopPropagation(),s.includes(r.key)&&!r.shiftKey)h("next");else if(o.includes(r.key))h("prev");else if(!["Enter","Shift","Control","Meta","Alt"].includes(r.key)){const i=r.currentTarget.value.trim();t.elm.search.field.data("typedVal",i);const n=await(async r=>{if(!r)return[];if(a[r])return a[r];let i,n,s;l.queries&&(i=await e.xhr("http://google.com/complete/search?client=chrome&q="+encodeURIComponent(r),{responseType:"json"})),l.bookmarks&&r.length>=2&&(n=await t.helper.model.call("searchBookmarks",{searchVal:r})),l.history&&r.length>=3&&e.api.history&&(s=await t.helper.model.call("searchHistory",{searchVal:r}));const o=[],c=[];let d=2;l.queries||d++,l.bookmarks&&l.history||d++;try{if(n&&n.bookmarks&&n.bookmarks.length>0){let e=0;n.bookmarks.some((t=>{if(t.url&&(o.push({type:"bookmark",label:t.title,url:t.url}),e++,e>=d))return!0}))}}catch(e){}try{if(s&&s.history&&s.history.length>0){let e=0;s.history.some((t=>{if(t.url&&(o.push({type:"history",label:t.title,url:t.url}),e++,e>=d))return!0}))}}catch(e){}try{i.response&&i.response.length>1&&i.response[0]===r&&i.response[1].forEach(((e,t)=>{let a=e;"NAVIGATION"===i.response[4]["google:suggesttype"][t]?(a=a.replace(/^https?:\/\//,""),a=a.replace(/\/$/,""),a=a.replace(/^www\./,""),o.push({type:"url",url:e,label:a})):c.push({type:"word",label:a})}))}catch(e){}const h=[...o,...c];return a[r]=h,h})(i);if(t.elm.search.field.data("typedVal")!==i)return;if(e("ul."+e.cl.newtab.suggestions).remove(),0===n.length)return;const s=e("<ul></ul>").addClass(e.cl.newtab.suggestions).insertAfter(t.elm.search.field);n.some(((t,a)=>{const r=e("<li></li>").attr(e.attr.type,t.type).text(t.label).appendTo(s);if(t.url&&r.attr({title:t.url,[e.attr.src]:t.url}).append("<span>"+t.url+"</span>"),a>5)return!0})),s.css({top:t.elm.search.field[0].offsetTop+"px",left:t.elm.search.field[0].offsetLeft+"px"})}})),e(document).on("mousemove","ul."+e.cl.newtab.suggestions+" > li",(t=>{e("ul."+e.cl.newtab.suggestions+" > li").removeClass(e.cl.active),e(t.currentTarget).addClass(e.cl.active)})).on("click auxclick","ul."+e.cl.newtab.suggestions+" > li",(t=>{t.preventDefault(),t.stopPropagation();const a=(e(t.currentTarget).attr(e.attr.src)||e(t.currentTarget).text()).trim();p(a,{newtab:"auxclick"===t.type})})),e(document).on("keydown",(a=>{"f"===a.key&&(a.ctrlKey||a.metaKey)&&(a.preventDefault(),t.sidebarHelper&&t.sidebarHelper.search&&t.elm.sidebar&&t.elm.sidebar.iframe&&(e(document).trigger(e.opts.events.openSidebar),t.elm.sidebar.iframe[0].focus(),t.sidebarHelper.search.showSearchField()))})),e(document).on("click",(()=>{e("ul."+e.cl.newtab.suggestions).remove(),!1===t.helper.edit.isEditMode()&&this.focusSearch()})),e(window).on("resize",(()=>{e("ul."+e.cl.newtab.suggestions).remove()}),{passive:!0})},g=()=>{const a=window.webkitSpeechRecognition||window.SpeechRecognition;if(a){if(t.elm.search.wrapper.hasClass(e.cl.newtab.listening)&&t.elm.search.wrapper.data("recognition"))return void t.elm.search.wrapper.data("recognition").stop();const r=new a;t.elm.search.wrapper.data("recognition",r);let i=!1;r.continuous=!1,r.interimResults=!0,r.start(),r.onresult=e=>{let a="",r=!1;for(let t=e.resultIndex;t<e.results.length;++t)a+=e.results[t][0].transcript,e.results[t].isFinal&&(r=!0);a.length>0&&(t.elm.search.field[0].value=a,i=!0),r&&p(a)},r.onstart=()=>{t.elm.search.wrapper.addClass(e.cl.newtab.listening),t.elm.search.field[0].value=t.helper.i18n.get("newtab_speech_search_listening")+" ..."},r.onend=()=>{t.elm.search.wrapper.removeClass(e.cl.newtab.listening),!1===i&&(t.elm.search.field[0].value="")},r.onerror=e=>{r.stop(),r.onend(null),"not-allowed"===e.error&&alert(t.helper.i18n.get("newtab_speech_search_error"))}}}},e.TopLinksHelper=function(t){this.init=async()=>{this.refreshEntries(),a()},this.refreshEntries=()=>{const a=t.helper.model.getData("n/topLinks"),r=t.helper.model.getData("n/topLinksPosition");t.elm.topLinks.attr(e.attr.position,r),t.elm.topLinks.children("ul").remove();const i=e("<ul></ul>").appendTo(t.elm.topLinks);a&&a.length>0&&a.forEach((t=>{const a=e("<li></li>").appendTo(i);e("<a></a>").text(t.title).appendTo(a).data("href",t.url).attr("href",t.url)}))};const a=()=>{t.elm.topLinks.on("click auxclick","> ul > li  > a",(a=>{t.elm.body.hasClass(e.cl.newtab.edit)||(a.preventDefault(),0!==a.button&&1!==a.button||t.helper.model.call("openLink",{href:e(a.currentTarget).data("href"),newTab:"auxclick"===a.type,position:t.helper.model.getData("b/newTabPosition"),active:"auxclick"!==a.type}))}))}};(new function(){this.elm={body:e("body"),content:e("section#content"),topLinks:e("section#content > nav"),search:{wrapper:e("form#search"),field:e("form#search > input[type='text']"),submit:e("form#search > button[type='submit']"),speechSearch:e("form#search > a.speechSearch")},fallbackInfo:e("div#fallbackInfo"),gridLinks:e("div#gridLinks")},this.sidebarHelper={},this.enabledSetAsNewtab=!1,this.run=async()=>{i(),t();const n=this.helper.template.loading().appendTo(this.elm.body);this.elm.body.addClass(e.cl.initLoading).attr("id",e.opts.ids.page.newtab),await this.helper.model.init(),this.helper.stylesheet.init();const s=this.helper.model.getData(["a/surface","a/highContrast","b/sidebarPosition"]);"dark"===s.surface||"auto"===s.surface&&"dark"===this.helper.stylesheet.getSystemSurface()?this.elm.body.addClass(e.cl.page.dark):!0===s.highContrast&&this.elm.body.addClass(e.cl.page.highContrast),this.elm.body.attr(e.attr.position,s.sidebarPosition),await Promise.all([r(),this.helper.i18n.init(),this.helper.stylesheet.addStylesheets(["newtab"],e(document))]),this.elm.body.parent("html").attr("dir",this.helper.i18n.isRtl()?"rtl":"ltr"),this.helper.i18n.parseHtml(document);const[o]=await Promise.all([this.getBackground(),this.helper.gridLinks.init(),this.helper.topLinks.init(),this.helper.search.init(),this.helper.fallback.init(),this.helper.edit.init(),a(),e.delay(500)]);n.remove(),this.setBackground(o),this.elm.body.removeClass([e.cl.building,e.cl.initLoading]),e(window).trigger("resize"),this.helper.model.getData("n/autoOpen")||!1!==this.elm.search.wrapper.hasClass(e.cl.hidden)||this.helper.search.focusSearch()},this.getBackground=async()=>{if("premium"===this.helper.model.getUserType()){const t=await e.api.storage.local.get(["newtabBackground_1"]);if(t&&t.newtabBackground_1)return t.newtabBackground_1}return null},this.setBackground=t=>{t?this.elm.body.addClass(e.cl.newtab.customBackground).css("background-image","url("+t+")"):this.elm.body.removeClass(e.cl.newtab.customBackground).css("background-image","")};const t=()=>{this.helper={model:new e.ModelHelper(this),template:new e.TemplateHelper(this),i18n:new e.I18nHelper(this),font:new e.FontHelper(this),stylesheet:new e.StylesheetHelper(this),checkbox:new e.CheckboxHelper(this),utility:new e.UtilityHelper(this),search:new e.SearchHelper(this),overlay:new e.OverlayHelper(this),entry:new e.EntryHelper(this),topLinks:new e.TopLinksHelper(this),gridLinks:new e.GridLinksHelper(this),fallback:new e.FallbackHelper(this),edit:new e.EditHelper(this)}},a=async()=>{e.api.runtime.onMessage.addListener((e=>{e&&e.action&&"reinitialize"===e.action&&!1===this.enabledSetAsNewtab&&location.reload(!0)})),"auto"===this.helper.model.getData("a/surface")&&e(document).on(e.opts.events.systemColorChanged,(()=>{"dark"===this.helper.stylesheet.getSystemSurface()?this.elm.body.addClass(e.cl.page.dark):this.elm.body.removeClass(e.cl.page.dark)})),e(document).on("keydown",(t=>{"Tab"===t.key&&this.elm.sidebar.sidebar.hasClass(e.cl.sidebar.permanent)&&(t.preventDefault(),this.elm.sidebar.iframe[0].focus())})),this.helper.model.getData("n/autoOpen")&&e(window).on("resize",(async()=>{if(this.elm.sidebar&&this.elm.sidebar.iframe&&this.elm.sidebar.sidebar){const t=this.elm.sidebar.sidebar.realWidth();window.innerWidth-t>=500?(this.elm.sidebar.sidebar.addClass(e.cl.sidebar.permanent),t>0&&this.elm.content.addClass(e.cl.newtab.smallContent),e(document).trigger(e.opts.events.openSidebar),await e.delay(500),e(document).trigger("click")):(this.elm.sidebar.sidebar.removeClass(e.cl.sidebar.permanent),this.elm.content.removeClass(e.cl.newtab.smallContent)),this.helper.gridLinks.handleWindowResize()}}),{passive:!0})},r=async()=>{const t=this.helper.model.getData(["n/faviconShape","n/faviconColor","n/faviconBackground","n/faviconPadding"]),a=await this.helper.utility.getIconImageData({shape:t.faviconShape,color:t.faviconColor,background:t.faviconBackground,padding:t.faviconPadding});e("<link />").attr({rel:"icon",href:a}).appendTo(document.head)},i=()=>new Promise((t=>{e("["+e.attr.type+"='script_sidebar']").remove();const a=[e.opts.events.loaded,e.opts.events.elementsCreated].join(" ");e(document).off(a).on(a,(t=>{this.elm.sidebar=t.detail.elm,this.sidebarHelper=t.detail.helper,e(window).trigger("resize")})),e.opts.manifest.content_scripts[0].css.forEach((t=>{e("<link />").attr({href:e.api.runtime.getURL(t),type:"text/css",rel:"stylesheet",[e.attr.type]:"script_sidebar"}).appendTo("head")}));const r=(a=0)=>{let i=e.opts.manifest.content_scripts[0].js[a];if(void 0!==i){const t=document.createElement("script");document.head.appendChild(t),t.onload=()=>r(a+1),i.includes("://")||(i="/"+i),t.src=i,e(t).attr(e.attr.type,"script_sidebar")}else t()};r()}))}).run()})(jsu);