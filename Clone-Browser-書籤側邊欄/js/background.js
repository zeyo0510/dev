/*! (c) Philipp Koenig under MS-RSL */
self.window=self,self.document={},(()=>{"use strict";if(window.jsu)return!1;const e=[],t=document,a=new WeakMap,i=new WeakMap,n=Symbol(),s={delay:(e=0)=>new Promise((t=>{setTimeout(t,e)})),ua:()=>{let e="Other",t="Other";try{e=navigator.userAgentData.platform}catch(e){}try{let e=navigator.userAgentData.brands.filter((e=>!/^[^a-z]*NOT[^a-z]/i.test(e.brand)));e=e.filter((t=>"CHROMIUM"!==t.brand.toUpperCase()||1===e.length)),e.length>0&&(t=e[0].brand+" "+(e[0].version||""))}catch(e){}return{os:e.trim(),browser:t.trim()}},xhr:(t,a={})=>new Promise(((i,n)=>{const s=new XMLHttpRequest,r=e.push({url:t,xhr:s})-1;a.mimeType&&s.overrideMimeType(a.mimeType),s.open(a.method||"GET",t,!0),["load","error","timeout","abort"].forEach((t=>{s.addEventListener(t,(()=>{e[r]=null,"load"===t&&s.status<400?i(s):n(s)}))}));let o=null;a.data&&(o=new FormData,Object.entries(a.data).forEach((([e,t])=>{"object"==typeof t&&(t=JSON.stringify(t)),o.append(e,t)}))),a.files&&(null===o&&(o=new FormData),a.files.forEach((e=>{e.files.forEach((t=>{o.append(e.name+"[]",t)}))}))),a.header&&Object.entries(a.header).forEach((([e,t])=>{s.setRequestHeader(e,t)})),Object.entries(a).forEach((([e,t])=>{"method"!==e&&"data"!==e&&"header"!==e&&(s[e]=t)})),s.send(o)})),cancelXhr:(t=null)=>{e.forEach((e=>{e&&e.xhr&&e.xhr.readyState&&e.xhr.abort&&(null===t||e.url===t)&&(e.xhr.abort(),e=null)}))}};class r{constructor(e,a=!0){let i=e;if("string"==typeof e&&(!1===a||e.indexOf("<")>-1)){const a=t.createElement("div");a.innerHTML=e,i=a.childNodes}this._fillNodeList(i)}static _isDefined(e){return null!=e}static _forEach(e,t,a=!1){const i=e.length;if(a){for(let n=i-1;n>=0;n--)if(r._isDefined(e[n].forEach))r._forEach(e[n],t,a);else if(!1===t(e[n],n))break}else for(let n=0;n<i;n++)if(r._isDefined(e[n].forEach))r._forEach(e[n],t,a);else if(!1===t(e[n],n))break}_fillNodeList(e){if(r._isDefined(e))if(e instanceof r)this[n]=e.get();else if("string"==typeof e)this[n]=t.querySelectorAll(e);else if(e instanceof Node||e instanceof HTMLDocument||e instanceof Window)this[n]=[e];else if(e instanceof NodeList||e instanceof HTMLCollection)this[n]=e;else{if("object"!=typeof e)throw new DOMException("invalid parameter for jsu");this[n]=[],r._isDefined(e.forEach)||(e=[e]),e.forEach((e=>{if(null!==e){const t=e=>{-1===this[n].indexOf(e)&&this[n].push(e)};e instanceof r?e.forEach(t):Array.isArray(e)||e instanceof NodeList||e instanceof HTMLCollection||/^\[object (HTMLCollection|NodeList|Object)\]$/.test(e.toString())?r._forEach(e,t):this[n].push(e)}}))}else this[n]=[];this.forEach(((e,t)=>{this[t]=e}))}forEach(e,t=!1){return r._forEach(this[n],e,t),this}css(e,t){let a=!1;const i=r._isDefined(e),s=r._isDefined(t),o=[];return this.forEach((n=>{i&&s&&"string"==typeof e?(n.style[e]=t,a=!0):i&&("string"==typeof e?o.push(window.getComputedStyle(n)[e]):"object"==typeof e&&(a=!0,Object.keys(e).forEach((t=>{"string"==typeof t&&(n.style[t]=e[t])}))))})),a?this:this[n].length>1?o:o[0]}attr(e,t){let a=!1;const i=r._isDefined(e),s=r._isDefined(t),o=[];return this.forEach((n=>{const l=(e,t)=>{a=!0,r._isDefined(n[e])?n[e]=t:n.setAttribute(e,t)};var c;i&&s&&"string"==typeof e?l(e,t):i&&("string"==typeof e?o.push((c=e,r._isDefined(n[c])?n[c]:n.getAttribute(c))):"object"==typeof e&&Object.keys(e).forEach((t=>{"string"==typeof t&&l(t,e[t])})))})),a?this:this[n].length>1?o:o[0]}removeAttr(e){return this.forEach((t=>{t.removeAttribute(e)})),this}static _addEventListener(e,t){let i=a.get(e);r._isDefined(i)||(i={},a.set(e,i)),i[t.event]||(i[t.event]=[]),i[t.event].push({fn:t.fn,name:t.name||t.event+"_"+ +new Date+Math.random().toString(36).substring(2,14),opts:t.opts,wantsUntrusted:t.wantsUntrusted}),e.addEventListener(t.event,t.fn,t.opts,t.wantsUntrusted)}static _cloneEventListener(e,t){const i=a.get(e);r._isDefined(i)&&Object.keys(i).forEach((e=>{i[e].forEach((a=>{r._addEventListener(t,{event:e,fn:a.fn,opts:a.opts,wantsUntrusted:a.wantsUntrusted})}))})),t.children&&r._forEach(t.children,((t,a)=>{r._cloneEventListener(e.children[a],t)}))}static _addData(e,t,a){let n=i.get(e);r._isDefined(n)||(n={},i.set(e,n)),n[t]=a}static _cloneData(e,t){const a=i.get(e);r._isDefined(a)&&Object.keys(a).forEach((e=>{r._addData(t,e,a[e])})),t.children&&r._forEach(t.children,((t,a)=>{r._cloneData(e.children[a],t)}))}static _cloneElement(e){const t=[];return e.forEach((e=>{const a=e.cloneNode(!0);r._cloneEventListener(e,a),r._cloneData(e,a),t.push(a)})),new r(t)}clone(){return r._cloneElement(this)}data(e,t){let a=!1;const s=r._isDefined(e),o=r._isDefined(t),l=[];return this.forEach((n=>{const c=i.get(n),h=r._isDefined(c);s&&o?(a=!0,r._addData(n,e,t)):s?"string"==typeof e?l.push(h?c[e]:void 0):"object"==typeof e&&(a=!0,Object.keys(e).forEach((t=>{"string"==typeof t&&r._addData(n,t,e[t])}))):l.push(h?c:{})})),a?this:this[n].length>1?l:l[0]}removeData(e){const t=!r._isDefined(e);return this.forEach((a=>{const n=i.get(a);r._isDefined(n)&&(t?i.delete(a):r._isDefined(n[e])&&delete n[e])})),this}on(e,t,a,i,n){const s=(e,t)=>{Object.keys(t).forEach((a=>{try{Object.defineProperty(e,a,{value:t[a]})}catch(e){}}))};let o=a;"function"==typeof a?o=i:n=i,void 0===o&&(o=null),void 0===n&&(n=null);const l="string"==typeof t;return this.forEach((i=>{e.split(/\s+/g).forEach((e=>{const c=e.split(/\./);r._addEventListener(i,{event:c[0],name:c[1],fn:e=>{if(s(e,{type:c[0]}),l){const n={preventDefault:()=>{e.preventDefault()},stopPropagation:()=>{e.stopPropagation()}};r._forEach(i.querySelectorAll(":scope "+t),(t=>{let r=e.target;for(;r&&r!==i;){if(r===t){const t=c[0].startsWith("key")?new KeyboardEvent(c[0],e):new MouseEvent(c[0],e);s(t,{preventDefault:n.preventDefault,stopPropagation:n.stopPropagation,currentTarget:r,target:e.target}),a(t)}r=r.parentNode}}))}else"function"==typeof t&&t(e)},opts:o,wantsUntrusted:n})}))}),!0),this}off(e){return this.forEach((t=>{const i=a.get(t);if(r._isDefined(i)){e.split(/\s+/g).forEach((e=>{const a=e.split(/\./);"*"===a[0]?Object.entries(i).forEach((([e,n])=>{r._forEach(n,((n,s)=>{void 0!==a[1]&&a[1]!==n.name||(t.removeEventListener(e,n.fn),i[e].splice(s,1))}),!0)})):i[a[0]]&&r._forEach(i[a[0]],((e,n)=>{void 0!==a[1]&&a[1]!==e.name||(t.removeEventListener(a[0],e.fn),i[a[0]].splice(n,1))}),!0)}))}})),this}trigger(e,t){return e.split(/\s+/g).forEach((e=>{const a=e.split(/\./),i=new CustomEvent(a[0],t);this.forEach((e=>{e.dispatchEvent(i)}))})),this}addClass(e){return"object"!=typeof e&&(e=[e]),this.forEach((t=>{e.forEach((e=>{t.classList.contains(e)||t.classList.add(e)}))})),this}removeClass(e){return"object"!=typeof e&&(e=[e]),this.forEach((t=>{e.forEach((e=>{t.classList.contains(e)&&t.classList.remove(e)}))})),this}toggleClass(e){return this.forEach((t=>{t.classList.toggle(e)})),this}hasClass(e){const t=[];return this.forEach((a=>{t.push(a.classList.contains(e))})),this[n].length>1?t:t[0]}_realDimension(e,t=!1){const a=[];let i="width",s=["left","right"];return"h"===e&&(i="height",s=["top","bottom"]),this.forEach((e=>{const n=e.getBoundingClientRect(),r=window.getComputedStyle(e);let o=parseFloat((n[i]+"").replace(/,/g,"."));t&&s.forEach((e=>{const t=r.getPropertyValue("margin-"+e);o+=parseFloat((t+"").replace(/,/g,"."))})),a.push(o)})),this[n].length>1?a:a[0]}realWidth(e=!1){return this._realDimension("w",e)}realHeight(e=!1){return this._realDimension("h",e)}find(e){const t=[];return this.forEach((a=>{a instanceof HTMLIFrameElement?t.push(a.contentDocument.querySelectorAll(":scope "+e)):t.push(a.querySelectorAll(":scope "+e))})),new r(t)}children(e){const t=[];return e||(e="*"),this.forEach((a=>{t.push(a.querySelectorAll(":scope > "+e))})),new r(t)}_htmlText(e,t){const a=r._isDefined(e);let i=a?this:"";return this.forEach((n=>{a?n[t]=e:i+=n[t]})),i}html(e){return this._htmlText(e,"innerHTML")}text(e){return this._htmlText(e,"innerText")}remove(){this.forEach((e=>{e&&e.parentElement&&(a.delete(e),i.delete(e),e.parentElement.removeChild(e))}))}_moveElement(e,t,a=!0){if(Array.isArray(e))e.forEach((e=>{this._moveElement(e,t,a)}));else{"string"==typeof e&&e.indexOf("<")>-1&&(a=!1);const i=new r(e,a);this.forEach((e=>{r._cloneElement(i).forEach((a=>{switch(t){case"append":e.appendChild(a);break;case"prepend":e.insertBefore(a,e.firstChild);break;case"before":e.parentNode.insertBefore(a,e);break;case"after":e.parentNode.insertBefore(a,e.nextSibling)}}))})),i.remove()}return this}_moveElementTo(e,t){const a=[];return new r(e).forEach((e=>{r._cloneElement(this).forEach((i=>{switch(t){case"append":e.appendChild(i);break;case"prepend":e.insertBefore(i,e.firstChild);break;case"before":e.parentNode.insertBefore(i,e);break;case"after":e.parentNode.insertBefore(i,e.nextSibling)}a.push(i)}))})),this.remove(),new r(a)}append(e,t){return this._moveElement(e,"append",t)}appendTo(e){return this._moveElementTo(e,"append")}prepend(e,t=!0){return this._moveElement(e,"prepend",t)}prependTo(e){return this._moveElementTo(e,"prepend")}before(e,t=!0){return this._moveElement(e,"before",t)}insertBefore(e){return this._moveElementTo(e,"before")}after(e,t=!0){return this._moveElement(e,"after",t)}insertAfter(e){return this._moveElementTo(e,"after")}_nextPrev(e,t){const a=r._isDefined(e),i=[];return this.forEach((n=>{const s="prev"===t?n.previousElementSibling:n.nextElementSibling;r._isDefined(s)&&(!a||r._isDefined(s.matches)&&s.matches(e))&&i.push(s)})),new r(i)}next(e){return this._nextPrev(e,"next")}prev(e){return this._nextPrev(e,"prev")}_siblings(e,t="siblings"){const a=r._isDefined(e),i=[];return this.forEach((n=>{let s=null;const o=[];for("siblings"===t&&n.parentNode.firstElementChild?(s=n.parentNode.firstElementChild,t="next"):"previous"!==t&&"next"!==t||(s=n[t+"ElementSibling"]);s&&s.matches;)s===n||a&&!s.matches(e)||o.push(s),s=s[t+"ElementSibling"];i.push(new r(o))})),this[n].length>1?new r(i):i[0]}siblings(e){return this._siblings(e)}nextAll(e){return this._siblings(e,"next")}prevAll(e){return this._siblings(e,"previous")}parent(e){const t=r._isDefined(e),a=[];return this.forEach((i=>{let n=i.parentNode;!t||r._isDefined(n.matches)&&n.matches(e)||(n=null),a.push(new r(n))})),this[n].length>1?new r(a):a[0]}parents(e){const t=r._isDefined(e),a=[];return this.forEach((i=>{const n=[];let s=i.parentNode;for(;s&&s.matches&&s!==this;)t&&!s.matches(e)||n.push(s),s=s.parentNode;a.push(new r(n))})),this[n].length>1?new r(a):a[0]}document(){const e=[];return this.forEach((t=>{e.push(new r(t.ownerDocument))})),this[n].length>1?new r(e):e[0]}eq(e){return e<0&&(e=this[n].length+e),new r(this[n][e])}get(e){return r._isDefined(e)?(e<0&&(e=this[n].length+e),this[n][e]):this[n]}length(){return this[n].length}}(()=>{const e=e=>new r(e);Object.entries(s).forEach((([t,a])=>{e[t]=a})),window.jsu=e})()})(),(e=>{"use strict";e.api=chrome,e.opts={ids:{page:{iframe:"redeviation-bs-sidebar",overlay:"redeviation-bs-overlay",newtab:"redeviation-bs-newtab",indicator:"redeviation-bs-indicator"},sidebar:{sidebar:"sidebar",infoBox:"infoBox",bookmarkBox:{all:"bookmarkBox",search:"bookmarkBoxSearch"}},overlay:{urlCheckResult:"results"}},classes:{active:"active",visible:"visible",hidden:"hidden",disabled:"disabled",success:"success",selected:"selected",premium:"premium",error:"error",info:"info",add:"add",cancel:"cancel",close:"close",hover:"hover",loading:"loading",building:"building",initLoading:"initLoading",page:{dark:"dark",visible:"redeviation-bs-visible",hideMask:"redeviation-bs-hideMask",hover:"redeviation-bs-hover",noscroll:"redeviation-bs-noscroll",hasLeftsideBack:"redeviation-bs-has-lsb",style:"redeviation-bs-style",fullHeight:"redeviation-bs-fullHeight",noAnimations:"noAnimations",highContrast:"highContrast"},sidebar:{extLoaded:"loaded",selectionMode:"selectionMode",openedOnce:"openedOnce",sidepanel:"sidepanel",permanent:"permanent",cached:"cached",mark:"mark",hideRoot:"hideRoot",dirAnimated:"animated",dirOpened:"opened",dirArrow:"has-arrow",bookmarkDir:"dir",dirIcon:"icon",separator:"separator",bookmarkLink:"link",bookmarkLabel:"label",entryPinned:"pinned",menu:"menu",sort:"sort",fixed:"fixed",lockPinned:"lockPinned",lastHover:"lastHover",copied:"copied",filterBox:"filter",search:"search",searchBox:"searchBox",searchClose:"searchClose",searchVisible:"searchVisible",breadcrumb:"breadcrumb",removeSelected:"removeSelected",openSelected:"openSelected",removeMask:"removeMask",removed:"removed",restored:"restored"},tooltip:{wrapper:"tooltip"},contextmenu:{wrapper:"contextmenu",top:"top",list:"list",icons:"icons",right:"right",separator:"separator"},drag:{trigger:"drag",helper:"dragHelper",isDragged:"isDragged",cancel:"dragCancel",dragHover:"dragHover",snap:"snap",dragInitial:"dragInitial"},scrollBox:{wrapper:"scrollBox",hideScrollbar:"hideScrollbar",scrolled:"scrolled"},checkbox:{box:"checkbox",clicked:"clicked",focus:"focus"},overlay:{modal:"modal",preview:"preview",previewUrl:"previewUrl",action:"action",progressBar:"progressBar",buttonWrapper:"buttons",checkUrlProgressLabel:"progressLabel",urlCheckLoading:"urlCheckLoading",urlCheckCategories:"categories",urlCheckAction:"urlCheckAction",urlCheckHide:"urlCheckHide",urlCheckResults:"urlCheckResults"},newtab:{customBackground:"customBackground",smallContent:"small",suggestions:"suggestions",edit:"edit",link:"link",editLinkTooltip:"editLinkTooltip",permanentSidebar:"permanentSidebar",listening:"listening",remove:"remove",infoBar:"infoBar",upload:"upload",save:"save"},onboarding:{slide:"slide",skip:"skip",close:"close",settings:"settings",toggleArea:"toggleArea",appearance:"appearance",finished:"finished",highlightIcon:"highlightIcon",hideOpenTypeIcon:"hideOpenType",video:"video",large:"large",small:"small"},settings:{tabs:{content:"tab"},color:{field:"color",mask:"colorMask"},radio:{wrapper:"radioWrapper"},translation:{select:"languageSelect",category:"category",thanks:"thanks",edit:"edit",progress:"progress",mark:"mark",requiredInfo:"requiredInfo",amountInfo:"amountInfo",empty:"empty",back:"back",goto:"goto"},toggleArea:{fullHeight:"fullHeight",dragged:"dragged",dragging:"dragging"},appearance:{preview:{fullHeight:"redeviation-bs-fullHeight"}},support:{onlySuggestions:"onlySuggestions",answer:"answer",noHeight:"noHeight",absolute:"absolute"},hideable:"hideable",inactive:"inactive",revert:"revert",highlight:"highlight",lazyloaded:"lazyloaded",sub:"sub",desc:"desc",box:"box",dialog:"dialog",boxWrapper:"boxWrapper",contentBox:"contentBox",incomplete:"incomplete",suggestion:"suggestion"}},attr:{uid:"data-redeviation-bs-uid",src:"data-src",position:"data-pos",type:"data-type",name:"data-name",value:"data-value",theme:"data-theme",sort:"data-sort",direction:"data-direction",style:"data-style",id:"data-id",i18n:"data-i18n",i18nReplaces:"data-i18nReplaces",onboarding:{openType:"data-openType",surface:"data-surface"},settings:{appearance:"data-appearance",success:"data-successtext",hideOnFalse:"data-hideOnFalse",save:"data-save",restore:"data-restore",range:{min:"data-min",max:"data-max",step:"data-step",unit:"data-unit",infinity:"data-infinity"},color:{alpha:"data-alpha",suggestions:"data-suggestions"},field:{placeholder:"data-placeholder"},translation:{releaseStatus:"data-status",language:"data-lang"}}},events:{loaded:"redeviation-bs-loaded",elementsCreated:"redeviation-bs-created",openSidebar:"redeviation-bs-sidebar-open",sidebarOpened:"redeviation-bs-sidebar-opened",overlayClosed:"redeviation-bs-overlay-closed",systemColorChanged:"redeviation-bs-system-color-changed",checkboxChanged:"redeviation-bs-checkbox-changed",scrollBoxLastPart:"redeviation-bs-scrollbox-lastpart",premiumPurchased:"redeviation-bs-premiumPurchased",showFeedbackForm:"redeviation-bs-feedback",lsbLoaded:"redeviation-lsb-loaded",pageChanged:"redeviation-bs-pageChanged"},website:{info:{landing:"https://extensions.redeviation.com/",privacyPolicy:"https://extensions.redeviation.com/privacy/bs",changelog:"https://extensions.redeviation.com/changelog/bs",uninstall:"https://extensions.redeviation.com/uninstall/bs"},premium:{checkout:"https://extensions.redeviation.com/premium/bs/checkout",checkLicenseKey:"https://extensions.redeviation.com/ajax/premium/bs/check"},feedback:{form:"https://extensions.redeviation.com/ajax/feedback",suggestions:"https://extensions.redeviation.com/ajax/feedback/suggestions"},translation:{info:"https://extensions.redeviation.com/ajax/translation/bs/info",langvars:"https://extensions.redeviation.com/ajax/translation/bs/langvars",submit:"https://extensions.redeviation.com/ajax/translation/bs/submit"},api:{checkStatus:"https://extensions.redeviation.com/ajax/status/bs",evaluate:"https://extensions.redeviation.com/api/evaluate/log"}},urlAliases:{Edge:{"chrome://newtab/":"edge://newtab/","chrome://bookmarks":"edge://favorites","chrome://extensions/shortcuts":"edge://extensions/shortcuts","chrome://settings/syncSetup":"edge://settings/profiles/sync","https://extensions.redeviation.com/img/illustration/video_sidepanel.mp4":"https://extensions.redeviation.com/img/illustration/edge/video_sidepanel.mp4","https://extensions.redeviation.com/img/illustration/video_overlay.mp4":"https://extensions.redeviation.com/img/illustration/edge/video_overlay.mp4"},Opera:{"chrome://newtab/":"chrome://startpageshared/","chrome://bookmarks":"opera://bookmarks","chrome://extensions/shortcuts":"opera://settings/keyboardShortcuts"}},leftsideBackSelector:"div#redeviation-lsb-indicator.redeviation-lsb-visible",manifest:e.api.runtime.getManifest(),demoMode:!1},e.isDev="Dev"===e.opts.manifest.version_name||!("update_url"in e.opts.manifest),e.copyrightDate=2016,e.browserName="Chrome",/EDG\//i.test(navigator.userAgent)?e.browserName="Edge":/OPERA|OPR\//i.test(navigator.userAgent)?e.browserName="Opera":/FIREFOX\//i.test(navigator.userAgent)&&(e.api=browser,e.browserName="Firefox"),e.cl=e.opts.classes,e.attr=e.opts.attr,e.AnalyticsHelper=function(t){let a=!1;const i={config:["configuration"],activity:["bookmarks","action"]},n=["behaviour","appearance","newtab","language"];this.init=async()=>{await s(),setInterval((async()=>{await s()}),25e3)};const s=async()=>{try{await p()?await d():(console.error("Failed to send analytics data"),await c())}catch(e){console.error("Error while sending analytics data",e)}};this.track=async e=>{await l(e.name,e.value,e.always)},this.trackUserData=async()=>{const i=+t.helper.model.getData("lastTrackDate"),n=+(new Date).setHours(0,0,0,0);if(!1===a&&n>i){if(a=!0,await t.helper.model.setData("lastTrackDate",n),await t.helper.model.init(),i&&+t.helper.model.getData("lastTrackDate")===n){(await h()).find((e=>"version"===e.type))?(console.error("Drop stack as it still has data from the day before"),await d()):await c();const a=t.helper.model.getShareInfo();let i="not_set";!0===a.config&&!0===a.activity?i="all":!0===a.config&&!1===a.activity?i="config":!1===a.config&&!0===a.activity?i="activity":!1===a.config&&!1===a.activity&&(i="nothing");const n=e.ua();await l("browser",n.browser),await l("os",n.os),await l("version",e.opts.manifest.version_name),await l("language",t.helper.language.getLanguage()),await l("shareInfo",i),await l("runtimeId",e.api.runtime.id),await l("userType",(await t.helper.model.getUserType()).userType);const s=t.helper.model.getData("installationDate");s&&await l("installationYear",new Date(s).getFullYear()),!0===a.activity&&await r(),!0===a.config&&await o()}a=!1}};const r=async()=>{const e=await t.helper.bookmarks.getById({id:0});let a=0;const i=e=>{for(let t=0;t<e.length;t++){const n=e[t];n.url?a++:n.children&&i(n.children)}};e&&e.bookmarks&&e.bookmarks[0]&&e.bookmarks[0].children&&e.bookmarks[0].children.length>0&&i(e.bookmarks[0].children),await l("bookmarks",a)},o=async()=>{const t=async(e,a)=>{for(const i in a){let n=a[i];if("newtab_searchEngineCustom"===e)return;if("newtab"===e&&"topLinks"===i)n=n.length;else if("newtab"===e&&"shortcuts"===i)n=n.length;else{if("newtab"===e&&"customGridLinks"===i)return;"utility"===e&&"pinnedEntries"===i&&"object"==typeof n?n=Object.keys(n).length:"behaviour"!==e||"blacklist"!==i&&"whitelist"!==i?"appearance_styles"===e&&"fontFamily"===i&&(n.split(",").length>=3&&(n="default"),n=n.replace(/(^'*)|('*$)/g,"")):n=n.length}"object"==typeof n?await t(e+"_"+i,n):("string"!=typeof n&&(n=JSON.stringify(n)),("newtab"===e&&"website"===i||"utility"===e&&"customCss"===i||"utility"===e&&"newtabBackground"===i)&&(n=n&&n.length>0?"true":"false"),await l("configuration",{name:e+"_"+i,value:n}))}};let a=!1;const i=await e.api.storage.sync.get(n);for(const e in i)"newtab"===e&&("object"==typeof i[e]&&void 0!==i[e].override&&!0===i[e].override?a=!0:i[e]={override:!1}),"object"==typeof i[e]&&await t(e,i[e]);const s=await e.api.storage.local.get(["utility","newtabBackground_1"]);if(s.utility){const e={};["lockPinned","pinnedEntries","customCss"].forEach((t=>{void 0!==s.utility[t]&&(e[t]=s.utility[t])})),void 0!==s.utility.sort&&(e.sortType=s.utility.sort.name,e.sortDetail=s.utility.sort.name+"-"+s.utility.sort.dir),a&&(e.newtabBackground=s.newtabBackground_1||""),await t("utility",e)}},l=async(a,n,s=!1)=>{let r=!0;if(!1===s){const e=t.helper.model.getShareInfo();Object.entries(i).some((([t,i])=>{if(i.indexOf(a)>-1)return r=!0===e[t],!0}))}if(r){const t={type:a};"object"==typeof n?t.values=n:t.value=""+n;const i=await h();i.push(t),await e.api.storage.local.set({analytics_stack:i})}},c=async()=>{const e=t.helper.model.getShareInfo(),a=await h();let i=30;!0===e.activity&&(i=50),!0===e.config&&(i=300),a.length>i&&(console.error("Drop stack as it grew too big already"),await d())},h=async()=>(await e.api.storage.local.get(["analytics_stack"])).analytics_stack||[],d=async()=>{await e.api.storage.local.set({analytics_stack:[]})},p=async()=>{const t=await h();if(t.length<=0)return!0;const a=new FormData;if(a.append("stack",JSON.stringify(t)),a.append("uid",(e=>{const t=(JSON.stringify(e)||"").replace(/[\s\n\r\t]/g,"");let a=0;if(0===t.length)return a;for(let e=0;e<t.length;e++)a=(a<<5)-a+t.charCodeAt(e),a|=0;return Math.abs(a)})(t)),a.append("tz",(new Date).getTimezoneOffset()),e.isDev)return console.log(`POST request to ${e.opts.website.api.evaluate}`,t),!0;const i=await fetch(e.opts.website.api.evaluate,{method:"POST",responseType:"json",timeout:3e4,body:a});return!i||i.status<500}},e.Bookmarks=function(t){this.getById=async t=>{try{if(0==+t.id){return{bookmarks:await e.api.bookmarks.getTree()}}return{bookmarks:await e.api.bookmarks.getSubTree(""+t.id)}}catch(e){return console.error(e,t),{error:e}}},this.getBySearchVal=async t=>{try{return{bookmarks:await e.api.bookmarks.search(t.searchVal)}}catch(e){return console.error(e),{error:e}}},this.update=async a=>{const i={title:a.title};a.url&&(i.url=a.url),a.preventReload&&(t.preventReload=!0);let n={updated:a.id};try{await e.api.bookmarks.update(""+a.id,i),await Promise.all([t.helper.cache.remove({name:"htmlList"}),t.helper.cache.remove({name:"htmlPinnedEntries"})]),await t.helper.viewAmount.increaseById(a.id,0)}catch(e){console.error(e),n={error:e}}return a.preventReload&&(t.preventReload=!1),n},this.create=async a=>{const i=await this.getById({id:a.parentId}),n={parentId:a.parentId,index:i.bookmarks?Math.min(i.bookmarks[0].children.length,a.index||0):0,title:a.title,url:a.url?a.url:null};a.preventReload&&(t.preventReload=!0);let s={};try{s=await e.api.bookmarks.create(n),await Promise.all([t.helper.cache.remove({name:"htmlList"}),t.helper.cache.remove({name:"htmlPinnedEntries"})]),await t.helper.viewAmount.increaseById(s.id,0)}catch(e){console.error(e),s={error:e}}return a.preventReload&&(t.preventReload=!1),s},this.remove=async a=>{a.preventReload&&(t.preventReload=!0);let i={deleted:a.id};try{await e.api.bookmarks.removeTree(""+a.id),await Promise.all([t.helper.cache.remove({name:"htmlList"}),t.helper.cache.remove({name:"htmlPinnedEntries"})])}catch(e){console.error(e),i={error:e}}return a.preventReload&&(t.preventReload=!1),i},this.move=async a=>{const i={parentId:""+a.parentId,index:a.index};return await e.api.bookmarks.move(""+a.id,i),await Promise.all([t.helper.cache.remove({name:"htmlList"}),t.helper.cache.remove({name:"htmlPinnedEntries"})]),{moved:a.id}},this.getFavicon=async t=>/OPERA|OPR\//i.test(navigator.userAgent)?`https://www.google.com/s2/favicons?domain=${encodeURIComponent(t.url)}&sz=32`:e.api.runtime.getURL("_favicon")+"?pageUrl="+encodeURIComponent(t.url)+"&size=32"},e.BrowserActionHelper=function(t){let a=null,i=0,n=null;this.init=async()=>{if(e.api.sidePanel){e.api.sidePanel.setPanelBehavior({openPanelOnActionClick:!0});const t=await e.api.storage.sync.get(["behaviour"]);t&&t.behaviour&&t.behaviour.iconAction&&"sidepanel"!==t.behaviour.iconAction&&e.api.sidePanel.setPanelBehavior({openPanelOnActionClick:!1})}await this.initContextmenus()},this.initContextmenus=async()=>{const a=await t.helper.language.getLangVars();await e.api.contextMenus.removeAll();const i=Math.random().toString(36).substring(2,14);e.api.contextMenus.create({id:"bsChangelog_"+i,title:a.vars.settings_menu_infos_changelog.message,contexts:["action"]}),e.api.contextMenus.create({id:"bsPrivacy_"+i,title:a.vars.settings_menu_infos_privacy.message,contexts:["action"]}),e.api.contextMenus.onClicked.addListener((e=>{e.menuItemId==="bsChangelog_"+i?t.helper.utility.openLink({hrefName:"changelog",newTab:!0,params:{lang:t.helper.language.getUILanguage()}}):e.menuItemId==="bsPrivacy_"+i&&t.helper.utility.openLink({hrefName:"privacyPolicy",newTab:!0,params:{lang:t.helper.language.getUILanguage()}})}))},this.setReason=async e=>{e.reason&&(n=e.reason)},this.clearTimeout=async()=>{a&&(clearTimeout(a),a=null)},this.reloadSidepanel=async()=>{const t=+new Date;t-i>1e3&&e.api.sidePanel&&(i=t,await e.api.sidePanel.setOptions({path:"html/sidepanel.html?uid="+Math.random().toString(36).substring(2,14)}))},this.toggleSidebar=async()=>{const i=await e.api.tabs.query({active:!0,currentWindow:!0});if(i&&i.length>0){const n=i[0],o=n.url||"";if(e.api.tabs.sendMessage(n.id,{action:"toggleSidebar",reinitialized:t.reinitialized}).catch((()=>{})),!o.includes(e.api.runtime.getURL("html/newtab.html"))){const e=s(o);a=setTimeout((()=>{r(i[0])}),e?0:700)}}};const s=(e="")=>{let a=null,i=!1;const n={new_tab:[t.helper.utility.getParsedUrl("chrome://newtab/")],system:["chrome://","edge://","about:blank"],extension_page:["chrome-extension://","extension://"],webstore:["https?://chrome.google.com/webstore/"]};return Object.keys(n).some((t=>{if(n[t].some((n=>{if(e&&0===e.search(new RegExp(n,"gi")))return a=t,i=!0,!0})),i)return!0})),a},r=a=>{let i="fallback";if(n)i=n,n=null;else if(a&&a.url){const e=s(a.url);e&&(i=e)}t.helper.utility.openLink({href:e.api.runtime.getURL("html/newtab.html"),newTab:!0,params:{type:i}})}},e.CacheHelper=function(t){this.set=async t=>{try{await e.api.storage.local.set({["cache_"+t.name]:t.val})}catch(e){}},this.get=async t=>({val:(await e.api.storage.local.get(["cache_"+t.name]))["cache_"+t.name]}),this.remove=async a=>{t.importRunning||await e.api.storage.local.remove(["cache_"+a.name])}},e.IconHelper=function(t){const a=128,i={bookmark:{strokeWidth:10,path:"M 98.641 13.516 C 98.641 3.258 87.913 3.258 87.913 3.258 H 45.033 S 34.31 3.258 34.31 13.516 V 121.228 L 66.484 90.449 L 98.659 121.228 Z"},star:{strokeWidth:10,path:"M 126.579 49.962 L 95.277 80.476 l 7.388 43.128 L 63.916 103.252 l -38.661 20.352 L 32.672 80.476 L 1.282 49.991 l 43.274 -6.249 L 63.916 4.498 l 19.389 39.245 z"},"new-1":{path:"M 120.32 58.058 a 5.12 5.12 0 0 0 -5.12 5.12 c 0 28.224 -22.976 51.2 -51.2 51.2 S 12.8 91.402 12.8 63.178 A 51.264 51.264 0 0 1 100.32 27.114 a 5.12 5.12 0 1 0 7.264 -7.232 A 61.504 61.504 0 0 0 2.56 63.178 c 0 33.888 27.552 61.44 61.44 61.44 s 61.44 -27.552 61.44 -61.44 a 5.12 5.12 0 0 0 -5.12 -5.12 z M 84.48 58.058 h -15.36 v -15.36 a 5.12 5.12 0 0 0 -10.24 0 v 15.36 h -15.36 a 5.12 5.12 0 0 0 0 10.24 h 15.36 v 15.36 a 5.12 5.12 0 0 0 10.24 0 v -15.36 h 15.36 a 5.12 5.12 0 0 0 0 -10.24 z"},"new-2":{path:"M 94.868 126.671 l -0.064 -11.33 v -10.114 h -10.05 l -11.266 -0.064 v -10.37 l 11.266 -0.064 h 9.986 l 0.064 -10.242 v -11.266 h 10.562 V 94.729 h 21.636 v 10.37 l -11.266 0.064 l -10.306 0.064 v 10.242 l -0.128 11.266 h -10.434 z m -78.543 -4.481 a 13.507 13.507 0 0 1 -8.13 -4.609 c -1.024 -1.28 -2.176 -3.457 -2.56 -5.121 c -0.32 -1.088 -0.384 -3.777 -0.384 -48.457 c 0 -53.002 -0.128 -48.009 1.344 -51.018 c 1.6 -3.393 4.737 -5.889 8.578 -6.977 c 1.088 -0.256 3.713 -0.32 48.457 -0.32 c 44.616 0 47.305 0 48.393 0.32 c 3.841 1.088 7.041 3.649 8.642 7.041 c 1.344 2.945 1.28 0.832 1.28 27.333 l 0.064 23.812 h -13.058 V 18.683 H 18.246 v 90.705 h 46.281 v 13.058 H 40.97 c -12.93 0 -24.005 -0.128 -24.645 -0.192 z"}},n={forLight:"#555555",forDark:"#ffffff"};let s=null;this.init=async()=>{const[e,a]=await Promise.all([o(),t.helper.language.getLangVars()]);s=null,r(e,a)};const r=(t,a)=>{this.setExtensionIcon({name:t.name,color:t.color}),e.api.action.setTitle({title:a.vars.header_bookmarks.message}),e.isDev&&!e.opts.demoMode&&t.devModeIconBadge?(e.api.action.setBadgeBackgroundColor({color:[48,191,169,255]}),e.api.action.setBadgeText({text:" "})):e.api.action.setBadgeText({text:""})},o=async()=>{const t={name:"bookmark",color:"auto",devModeIconBadge:!0},a=await e.api.storage.sync.get(["appearance"]);return a&&a.appearance&&a.appearance.styles&&(void 0!==a.appearance.devModeIconBadge&&(t.devModeIconBadge=a.appearance.devModeIconBadge),a.appearance.styles&&(a.appearance.styles.iconShape&&(t.name=a.appearance.styles.iconShape),a.appearance.styles.iconColor&&(t.color=a.appearance.styles.iconColor))),t};this.getImageData=async e=>{const s=new OffscreenCanvas(a,a).getContext("2d");return e.background&&(s.beginPath(),s.fillStyle=e.background,s.arc(64,64,64,0,2*Math.PI,!1),s.fill(),s.closePath()),((e,s)=>{e.beginPath();let r=s.name,o=s.color,l=!1;(r.endsWith("-filled")||void 0===i[r].strokeWidth)&&(r=r.replace("-filled",""),l=!0),"auto"===s.color&&(o=n["dark"===t.helper.model.getSystemColor()?"forDark":"forLight"]),e.strokeStyle=o,e.fillStyle=o;const c=new Path2D(i[r].path),h=s.padding||0;if(h){const t=1-2*h/a;e.translate(h,h),e.scale(t,t)}l?e.fill(c):(e.lineWidth=i[r].strokeWidth,e.stroke(c)),e.closePath()})(s,e),s.getImageData(0,0,a,a)},this.setExtensionIcon=async t=>{const a=t.onlyCurrentTab||!1;if(s&&!a&&s===t.name+"_"+t.color);else{const i=await this.getImageData(t);e.api.action.setIcon({imageData:i,tabId:a&&t.tabId?t.tabId:null}),a||(s=t.name+"_"+t.color)}}},e.LanguageHelper=function(t){const a={ar:"Arabic",am:"Amharic",bg:"Bulgarian",bn:"Bengali",ca:"Catalan",cs:"Czech",da:"Danish",de:"German",el:"Greek",en:"English",en_US:"English (US)",es:"Spanish",et:"Estonian",fa:"Persian",fi:"Finnish",fil:"Filipino",fr:"French",gu:"Gujarati",he:"Hebrew",hi:"Hindi",hr:"Croatian",hu:"Hungarian",id:"Indonesian",it:"Italian",ja:"Japanese",kn:"Kannada",ko:"Korean",lt:"Lithuanian",lv:"Latvian",ml:"Malayalam",mr:"Marathi",ms:"Malay",nl:"Dutch",no:"Norwegian",pl:"Polish",pt_BR:"Portuguese (Brazil)",pt_PT:"Portuguese (Portugal)",ro:"Romanian",ru:"Russian",sk:"Slovak",sl:"Slovenian",sr:"Serbian",sv:"Swedish",sw:"Swahili",ta:"Tamil",te:"Telugu",th:"Thai",tr:"Turkish",uk:"Ukrainian",vi:"Vietnamese",zh_CN:"Chinese (Simplified)",zh_TW:"Chinese (Traditional)"},i=["ar","fa","he"],n={pt:"pt_PT"};let s=null,r={},o=!1;this.init=async()=>{const t=e.opts.manifest.default_locale;let a=null,c=(await e.api.storage.sync.get(["language"])).language||"default";"default"===c&&(c=this.getUILanguage()),c=c.replace("-","_"),n[c]&&(c=n[c]),c.indexOf("_")>-1&&(a=c.replace(/_.*$/,""));const h=await this.getAvailableLanguages();if(h&&h.infos)for(const e of[c,a,t])if(e&&h.infos[e]&&h.infos[e].available)return s=e,o=i.indexOf(s)>-1,void(r=await l(s,t))},this.getUILanguage=()=>{let t=e.api.i18n.getUILanguage();return t=t.replace("-","_"),t},this.getLanguage=()=>s,this.getRtlLanguages=async()=>i,this.getLangVars=async()=>({language:s,dir:o?"rtl":"ltr",vars:r}),this.getAvailableLanguages=async()=>{await e.api.storage.local.get(["languageInfos"]);const t={};for(const i in a){t[i]={name:i,label:a[i],available:!1};try{await fetch(e.api.runtime.getURL("_locales/"+i+"/messages.json"),{method:"HEAD"}),t[i].available=!0}catch(e){}}return e.api.storage.local.set({languageInfos:{infos:t,updated:+new Date}}),{infos:t}},this.getIncompleteLanguages=async()=>{const t=await fetch(e.opts.website.translation.info),a=await t.json(),i=[];if(a&&a.languages&&a.categories){let e=0;Object.values(a.categories).forEach((t=>{e+=t.total})),a.languages.forEach((t=>{t.varsAmount<e&&i.push(t.name)}))}return i};const l=async(t,a)=>{let i={};if(a){const t=await fetch(e.api.runtime.getURL(`_locales/${a}/messages.json`)),n=await t.json();i={...i,...n}}if(t){const a=await fetch(e.api.runtime.getURL(`_locales/${t}/messages.json`)),n=await a.json();i={...i,...n}}return i}},e.Linkchecker=function(e){const t={"youtube.com":["v"],"google.com":["q"],"google.de":["q"]};this.check=async e=>{try{const[t,n]=await Promise.all([a(e.url),i(e.url)]);return{httpInfo:t,duplicateInfo:n}}catch(e){return console.error(e),{error:!0}}};const a=async(e,t="HEAD")=>{const i=await fetch(e,{method:t,timeout:7e3}).catch((()=>{}));if(i&&i.url){if(i.url.startsWith("http:")){const e=await a(i.url.replace(/^http:/,"https:"),t);return e.url&&e.success&&e.status<400?e:{url:i.url,success:!0,status:i.status}}return{url:i.url,success:!0,status:i.status}}return"HEAD"===t?await a(e,"GET"):{url:e,success:!1,status:null}},i=async a=>{const i=e=>{let a=null;try{a=new URL(e)}catch(e){}const i=(e=(e=(e=(e=(e=e.split("?")[0]).split("#")[0]).replace(/^https?:\/\//,"")).replace(/^www\./,"")).replace(/\/$/,"")).split("/")[0];if(a&&t[i]){const n=[];t[i].forEach((e=>{const t=a.searchParams.get(e);t&&n.push(e+"="+t)})),e+="?"+n.join("&")}return e},n=i(a),s=await e.helper.bookmarks.getBySearchVal({searchVal:n});if(s&&s.bookmarks.length>1){const e=[];if(s.bookmarks.forEach((t=>{t.url&&i(t.url)===n&&e.push(t)})),e.length>1)return{label:n,duplicates:e}}return{label:n,duplicates:[]}}},e.Background=function(){this.importRunning=!1,this.preventReload=!1,this.reinitialized=null,this.reload=async t=>{await Promise.all([this.helper.newtab.updateConfig(),this.helper.cache.remove({name:"htmlList"}),this.helper.cache.remove({name:"htmlPinnedEntries"})]),this.helper.browserAction.reloadSidepanel();const a=await e.api.tabs.query({});for(const i of a)await e.delay(70),await e.api.tabs.sendMessage(i.id,{action:"reload",scrollTop:t.scrollTop||!1,reinitialized:this.reinitialized,type:t.type}).catch((()=>{}))},this.reinitialize=async(a={})=>{this.reinitialized=+new Date,await this.helper.newtab.updateConfig(),await this.helper.language.init(),await this.helper.cache.remove({name:"htmlList"}),await this.helper.cache.remove({name:"htmlPinnedEntries"});const i={css:"insertCSS",js:"executeScript"};let n=null;a&&a.type&&(n=a.type),this.helper.browserAction.reloadSidepanel();const s=await e.api.tabs.query({});for(const a of s)void 0===a.url||a.url.startsWith("http://")||a.url.startsWith("https://")||a.url.startsWith("file://")?(await e.delay(70),Object.entries(i).forEach((([i,s])=>{const r=e.opts.manifest.content_scripts[0][i];e.api.scripting[s]({target:{tabId:a.id},files:r}).catch((()=>{t(a.id,n)}))}))):t(a.id,n)};const t=(t,a)=>{this.helper.browserAction.reloadSidepanel(),e.api.tabs.sendMessage(t,{action:"reinitialize",type:a}).catch((()=>{}))},a=()=>{e.api.runtime.onInstalled.addListener((e=>{n(e)})),e.api.runtime.setUninstallURL(e.opts.website.info[e.isDev?"landing":"uninstall"]),e.api.tabs.onCreated.addListener(this.helper.newtab.onTabCreated),e.api.action.onClicked.addListener(this.helper.browserAction.toggleSidebar),e.api.bookmarks.onImportBegan&&e.api.bookmarks.onImportEnded&&(e.api.bookmarks.onImportBegan.addListener((()=>{this.importRunning=!0})),e.api.bookmarks.onImportEnded.addListener((()=>{this.importRunning=!1}))),["Changed","Created","Removed"].forEach((t=>{e.api.bookmarks["on"+t]&&e.api.bookmarks["on"+t].addListener((e=>{this.helper.viewAmount.increaseById(e,0),!1===this.importRunning&&!1===this.preventReload&&this.reload({type:t})}))})),["Moved","ChildrenReordered"].forEach((t=>{e.api.bookmarks["on"+t]&&e.api.bookmarks["on"+t].addListener((()=>{Promise.all([this.helper.cache.remove({name:"htmlList"}),this.helper.cache.remove({name:"htmlPinnedEntries"})])}))}))},i=()=>{this.helper={model:new e.ModelHelper(this),bookmarks:new e.Bookmarks(this),language:new e.LanguageHelper(this),upgrade:new e.UpgradeHelper(this),viewAmount:new e.ViewAmountHelper(this),newtab:new e.NewtabHelper(this),message:new e.MessageHelper(this),icon:new e.IconHelper(this),browserAction:new e.BrowserActionHelper(this),utility:new e.UtilityHelper(this),linkchecker:new e.Linkchecker(this),cache:new e.CacheHelper(this),analytics:new e.AnalyticsHelper(this)}},n=(e,t=0)=>{this.helper&&this.helper.upgrade&&this.helper.upgrade.loaded?"install"===e.reason?this.helper.upgrade.onInstalled(e):"update"===e.reason&&this.helper.upgrade.onUpdated(e):t<100&&setTimeout((()=>{n(e,t+1)}),500)};this.run=async()=>{const t=+new Date;i(),a(),(async()=>{const t=(e,t)=>{console.log("keepalive message: ",e,t.sender)},a=e=>{e._timer&&(clearTimeout(e._timer),delete e._timer)},i=e=>{a(e),e.disconnect()};e.api.runtime.onConnect.addListener((e=>{"keepalive"===e.name&&(e.onMessage.addListener(t),e.onDisconnect.addListener(a),e._timer=setTimeout(i,25e3,e))}))})(),await this.helper.model.init(),await this.helper.language.init(),await this.helper.analytics.init(),await this.helper.icon.init(),await this.helper.browserAction.init(),await this.helper.newtab.init(),await this.helper.message.init(),await this.helper.upgrade.init(),await this.helper.analytics.trackUserData();if(1===Math.floor(100*Math.random())+1){const e=await this.helper.model.getLicenseKey();if(e.licenseKey){!1===(await this.helper.utility.checkLicenseKey(e.licenseKey)).valid&&await this.helper.model.setLicenseKey(null)}}e.isDev&&console&&console.info&&console.info("Finished loading background script",+new Date-t)}},e.MessageHelper=function(t){this.init=async()=>{let a=0;const i={checkUrl:t.helper.linkchecker.check,bookmarks:t.helper.bookmarks.getById,searchBookmarks:t.helper.bookmarks.getBySearchVal,moveBookmark:t.helper.bookmarks.move,updateBookmark:t.helper.bookmarks.update,createBookmark:t.helper.bookmarks.create,deleteBookmark:t.helper.bookmarks.remove,openWebsite:t.openWebsite,reload:t.reload,reinitialize:t.reinitialize,systemColorChanged:t.helper.model.systemColorChanged,updateShareInfo:t.helper.model.setShareInfo,infoToDisplay:t.helper.model.getInfoToDisplay,languageInfos:t.helper.language.getAvailableLanguages,langvars:t.helper.language.getLangVars,rtlLangs:t.helper.language.getRtlLanguages,favicon:t.helper.bookmarks.getFavicon,openLink:t.helper.utility.openLink,userType:t.helper.model.getUserType,activatePremium:t.helper.utility.activatePremium,deactivatePremium:t.helper.utility.removePremiumState,licenseKey:t.helper.model.getLicenseKey,getCache:t.helper.cache.get,setCache:t.helper.cache.set,removeCache:t.helper.cache.remove,websiteStatus:t.helper.utility.checkWebsiteStatus,track:t.helper.analytics.track,iconImageData:t.helper.icon.getImageData,updateIcon:t.helper.icon.setExtensionIcon,reloadIcon:t.helper.icon.init,reloadBrowserAction:t.helper.browserAction.init,clearNotWorkingTimeout:t.helper.browserAction.clearTimeout,setNotWorkingReason:t.helper.browserAction.setReason,increaseViewCounter:t.helper.viewAmount.increaseByUrl,viewAmounts:t.helper.viewAmount.getAll,searchHistory:t.helper.utility.getHistoryBySearchVal,parsedUrl:async e=>t.helper.utility.getParsedUrl(e.href),lastUpdateDate:async()=>t.helper.model.getData("lastUpdateDate")};e.api.runtime.onMessage.addListener(((e,n,s)=>(i[e.type]?(a++,50===a&&(t.helper.analytics.trackUserData(),a=0),e.tabId=n.tab?n.tab.id:null,i[e.type](e).then((e=>{s(e)})).catch((e=>{console.error(e),s()}))):(console.error("Unknown message type:",e.type),s()),!0)))}},e.ModelHelper=function(t){let a={},i=null,n="light",s=[],r={config:null,activity:null};this.init=async()=>{const t=await e.api.storage.sync.get(["model","shareInfo","translationInfo","licenseKey","systemColor"]);a=t.model||{},"object"==typeof t.shareInfo&&(r=t.shareInfo),"string"==typeof t.licenseKey&&29===t.licenseKey.length&&(i=t.licenseKey),void 0!==t.systemColor&&(n=t.systemColor),"object"==typeof t.translationInfo&&(s=t.translationInfo),void 0===a.installationDate&&(a.installationDate=+new Date),void 0===a.lastUpdateDate&&(a.lastUpdateDate=+new Date),void 0===a.premiumInfo&&(a.premiumInfo=null),void 0===a.translationReminder&&(a.translationReminder=null),await o()},this.getShareInfo=()=>r,this.getLicenseKey=async()=>({licenseKey:i}),this.getInfoToDisplay=async()=>{if(a&&a.installationDate){const e=(+new Date-a.installationDate)/864e5,i=null===a.translationReminder?365:(+new Date-a.translationReminder)/864e5;if(null===r.config&&null===r.activity&&e>7)return{info:"shareInfo"};if(s.length>0&&i>3){const e=await t.helper.language.getIncompleteLanguages();await this.setData("translationReminder",+new Date);for(const t of s)if(-1!==e.indexOf(t))return{info:"translation"}}else{const t=await this.getUserType(),i=null===a.premiumInfo?365:(+new Date-a.premiumInfo)/864e5;if("premium"!==t.userType&&i>200&&e>14)return await this.setData("premiumInfo",+new Date),{info:"premium"}}}return{info:null}},this.getUserType=async()=>{let e="default";return"string"==typeof i&&29===i.length?e="premium":a&&a.installationDate&&a.installationDate<1538352e6&&(e="legacy"),{userType:e}},this.getSystemColor=()=>n,this.setShareInfo=async t=>{try{r={config:t.config||!1,activity:t.activity||!1},await e.api.storage.sync.set({shareInfo:r})}catch(e){console.error(e)}},this.setLicenseKey=async t=>{try{return await e.api.storage.sync.set({licenseKey:t}),i=t,{success:!0}}catch(t){return{success:!1,message:e.api.runtime.lastError.message}}},this.systemColorChanged=async a=>{if(n!==a.surface){n=a.surface,await t.helper.icon.init();try{await e.api.storage.sync.set({systemColor:n})}catch(e){console.error(e)}}},this.setData=async(e,t)=>{a[e]=t,await o()},this.getData=e=>a[e]||null;const o=async()=>{if(Object.getOwnPropertyNames(a).length>0)try{await e.api.storage.sync.set({model:a})}catch(e){console.error(e)}}},e.NewtabHelper=function(t){const a=e.api.runtime.getURL("html/newtab.html");let i=!1,n={};this.init=async()=>{await this.updateConfig(),i=!0},this.reload=async()=>{if(await e.api.permissions.contains({permissions:["tabs"]})){const t=await e.api.tabs.query({url:a});for(const a of t)e.api.tabs.reload(a.id)}},this.updateConfig=async()=>{const t=await e.api.storage.sync.get(["newtab"]);n=void 0===t.newtab?{}:t.newtab},this.onTabCreated=(l,c=0)=>{if(!i)return void(c<200?setTimeout((()=>{this.onTabCreated(l,c+1)}),5):console.error("Failed to handle tab creation"));if(void 0===n.override||!n.override)return;const h=l.url||l.pendingUrl;if(h&&(h===t.helper.utility.getParsedUrl("chrome://newtab/")||h===t.helper.utility.getParsedUrl("chrome://startpage/"))){let t=a;n.website&&n.website.length>0&&(t=o(n.website,"bs_nt",1)),n.focusOmnibox||0===l.index?r(l.id,t):(s(l.id),e.api.tabs.create({url:t,active:!0}))}};const s=(t,a=0)=>{e.api.tabs.remove(t,(()=>{e.api.runtime.lastError&&(a<200?setTimeout((()=>{s(t,a+1)}),20):console.error("Failed to remove tab"))}))},r=(t,a,i=0)=>{e.api.tabs.update(t,{url:a,active:!0},(async()=>{const n=await e.api.tabs.get(t),s=n.pendingUrl||n.url;s&&s.startsWith(a)||(i<200?setTimeout((()=>{r(t,a,i+1)}),20):console.error("Failed to override new tab"))}))},o=(e,t,a)=>{const i=new RegExp("([?&])"+t+"=.*?(&|#|$)","i");if(e.match(i))return e.replace(i,"$1"+t+"="+a+"$2");{let i="";-1!==e.indexOf("#")&&(i=e.replace(/.*#/,"#"),e=e.replace(/#.*/,""));const n=-1!==e.indexOf("?")?"&":"?";return e+n+t+"="+a+i}}},e.UpgradeHelper=function(t){this.loaded=!1,this.init=async()=>{e.api.runtime.onUpdateAvailable.addListener((()=>{e.api.runtime.reload()})),this.loaded=!0},this.onInstalled=async()=>{const i=t.helper.model.getData("installationDate");(null===i||+new Date-i<6e4)&&(t.helper.analytics.track({name:"action",value:{name:"install",value:"true"},always:!0}),a("install"),t.helper.utility.openLink({href:e.api.runtime.getURL("html/intro.html"),newTab:!0})),t.reinitialize()},this.onUpdated=async i=>{await e.api.storage.local.remove(["languageInfos"]),await t.helper.model.setData("lastUpdateDate",+new Date);const n=e.opts.manifest.version,s=i.previousVersion.split("."),r=n.split(".");s[0]===r[0]&&s[1]===r[1]||await a("upgrade"),await t.reinitialize()};const a=async t=>{const a=await e.api.storage.sync.get(null);void 0===a.behaviour&&(a.behaviour={}),void 0===a.appearance&&(a.appearance={}),void 0===a.appearance.styles&&(a.appearance.styles={}),void 0===a.newtab&&(a.newtab={}),"upgrade"===t?n(a):"install"===t&&i(a),await e.api.storage.sync.set({behaviour:a.behaviour}),await e.api.storage.sync.set({newtab:a.newtab}),await e.api.storage.sync.set({appearance:a.appearance})},i=e=>{"zh_CN"===t.helper.language.getUILanguage()?(e.newtab.searchEngine="baidu",e.newtab.topLinks=[{title:"百度",url:"https://www.baidu.com/"}]):e.newtab.topLinks=[{title:"Google",url:"https://google.com"}]},n=a=>{try{delete a.appearance.darkMode,delete a.behaviour.contextmenu,delete a.behaviour.dndOpen,delete a.behaviour.initialOpenOnNewTab,delete a.behaviour.rememberSearch,delete a.behaviour.rememberScroll,delete a.behaviour.autoOpen,delete a.behaviour.reopenSidebar,delete a.behaviour.pxTolerance,delete a.behaviour.scrollSensitivity,delete a.behaviour.hideEmptyDirs,delete a.behaviour.replaceNewTab,delete a.behaviour.language,delete a.behaviour.model,delete a.appearance.language,delete a.appearance.sidebarPosition,delete a.appearance.addVisual,delete a.appearance.indicatorWidth,delete a.appearance.indicatorIconSize,delete a.newtab.initialOpen,delete a.newtab.topPagesType,delete a.newtab.topPagesMaxCols,delete a.newtab.topPagesMaxRows,delete a.newtab.shortcutsPosition,delete a.newtab.shortcuts;const i=t.helper.model.getData("installationDate");if(i&&i<+new Date("2023-06-12")){let t=!1;try{t=navigator.userAgentData.brands.map((e=>e.brand)).includes("Brave")}catch(e){}a.behaviour.iconAction&&!t&&e.api.sidePanel||(a.behaviour.iconAction="overlay",e.api.sidePanel&&e.api.sidePanel.setPanelBehavior({openPanelOnActionClick:!1})),void 0===a.behaviour.refocusWebsite&&(a.behaviour.refocusWebsite=!0)}if(a.appearance.styles&&a.appearance.styles.fontFamily&&"DEFAULT"===a.appearance.styles.fontFamily.toUpperCase()){const e=a.appearance.styles.fontFamily.toUpperCase();"DEFAULT"!==e&&"ROBOTO"!==e&&"NOTO SANS SC"!==e&&"NOTO SANS TC"!==e&&"NOTO SANS JAPANESE"!==e||(a.appearance.styles.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif')}}catch(e){}}},e.UtilityHelper=function(t){this.getHistoryBySearchVal=async t=>{if(e.api.history){const a=await e.api.history.search({text:t.searchVal,maxResults:100}),i=t.searchVal.toLowerCase();return a.sort(((e,t)=>(e.title.toLowerCase().indexOf(i)>-1?100:0)+(e.url.toLowerCase().indexOf(i)>-1?50:0)+e.visitCount+e.typedCount-((t.title.toLowerCase().indexOf(i)>-1?100:0)+(t.url.toLowerCase().indexOf(i)>-1?50:0)+t.visitCount+t.typedCount))),{history:a}}return{history:[]}},this.removePremiumState=async e=>{await t.helper.model.setLicenseKey(null),await t.reinitialize({type:"premiumDeactivated"})},this.activatePremium=async e=>{if((await t.helper.model.getLicenseKey()).licenseKey===e.licenseKey)return{success:!0,skip:!0};if(!0==!!(await this.checkLicenseKey(e.licenseKey)).valid){const a=await t.helper.model.setLicenseKey(e.licenseKey);return await t.reinitialize({type:"premiumActivated"}),a}return{success:!1}},this.checkLicenseKey=async t=>{let a={};try{const i=new FormData;i.append("licenseKey",t);const n=await fetch(e.opts.website.premium.checkLicenseKey,{method:"POST",responseType:"json",body:i});a=await n.json()}catch(e){return console.error("License key check: Request failed",t,e),{valid:null}}return a&&void 0!==a.valid?(a.valid||console.error("License key check: Invalid key",t,a),{valid:a.valid}):(console.error("License key check: Invalid response",t,a),{valid:null})},this.checkWebsiteStatus=async()=>{let t={};try{const a=new FormData;a.append("version",e.isDev?"9.9.9":e.opts.manifest.version);const i=await fetch(e.opts.website.api.checkStatus,{method:"POST",responseType:"json",body:a});t=await i.json()}catch(e){return{status:"unavailable"}}return t&&t.available?{status:"available"}:{status:"unavailable"}},this.getParsedUrl=t=>t?(e.opts.urlAliases[e.browserName]&&e.opts.urlAliases[e.browserName][t]&&(t=e.opts.urlAliases[e.browserName][t]),t):t,this.openLink=async a=>{if(await t.helper.viewAmount.increaseById(a.id),a.hrefName){if(!e.opts.website.info[a.hrefName])return;a.href=e.opts.website.info[a.hrefName]}let i="";a.params&&(i=Object.entries(a.params).map((([e,t])=>encodeURIComponent(e)+"="+t)).join("&"),i&&(i="?"+i));const n=this.getParsedUrl(a.href)+i;if(a.newTab&&!0===a.newTab){const i=async(i=null)=>{const s=await e.api.tabs.query({active:!0,currentWindow:!0}),r=await e.api.tabs.create({url:n,active:void 0===a.active||!!a.active,index:null===i?s[0].index+1:i,openerTabId:s[0].id});await t.helper.model.setData("openedByExtension",r.id)};if("afterLast"===a.position){const t=await e.api.tabs.query({currentWindow:!0});let a=0;t.forEach((e=>{a=Math.max(a,e.index)})),await i(a+1)}else"beforeFirst"===a.position?await i(0):await i()}else if(a.newWindow&&!0===a.newWindow)await e.api.windows.create({url:n,state:"maximized"});else if(a.incognito&&!0===a.incognito)await e.api.windows.create({url:n,state:"maximized",incognito:!0});else{const a=await e.api.tabs.query({active:!0,currentWindow:!0}),i=await e.api.tabs.update(a[0].id,{url:n});await t.helper.model.setData("openedByExtension",i.id)}}},e.ViewAmountHelper=function(t){this.getAll=async()=>({viewAmounts:await a(),counterStartDate:t.helper.model.getData("installationDate")}),this.increaseByUrl=async e=>{if(null===t.helper.model.getData("openedByExtension")){const a=await t.helper.bookmarks.getBySearchVal({searchVal:{url:e.url}});if(a&&a.bookmarks)for(const t of a.bookmarks)if(t.url===e.url){await this.increaseById(t.id);break}}await t.helper.model.setData("openedByExtension",null)},this.increaseById=async(t,i=1)=>{if(t=""+t){const n=await a();void 0!==n[t]&&"object"==typeof n[t]||(n[t]={c:0}),n[t].c+=i,n[t].d=+new Date,await e.api.storage.local.set({clickCounter:n})}};const a=async()=>{const t=await e.api.storage.local.get(["clickCounter"]);let a={};return void 0!==t.clickCounter&&(a=t.clickCounter),a}}})(jsu);try{self.window||(self.window=self),self.document||(self.document={}),(new jsu.Background).run()}catch(e){console.error("Failed to load service worker"),console.error(e)}