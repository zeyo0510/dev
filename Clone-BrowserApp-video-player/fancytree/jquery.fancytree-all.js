/*!
 * jquery.fancytree.js
 * Dynamic tree view control, with support for lazy loading of branches.
 * https://github.com/mar10/fancytree/
 *
 * Copyright (c) 2006-2014, Martin Wendt (http://wwWendt.de)
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.1.0
 * @date 2014-05-29T16:44
 */
(function(n,t,i,r){"use strict";function nt(t){t=t||"";n.error("Not implemented: "+t)}function u(t,i){t||(i=i?": "+i:"",n.error("Assertion failed"+i))}function f(n,i){var r,f,u=t.console?t.console[n]:null;if(u)if(u.apply)u.apply(t.console,i);else{for(f="",r=0;r<i.length;r++)f+=i[r];u(f)}}function tt(n){return!!(n.tree&&n.statusNodeType!==r)}function it(t){for(var r,u,e=n.map(n.trim(t).split("."),function(n){return parseInt(n,10)}),f=n.map(Array.prototype.slice.call(arguments,1),function(n){return parseInt(n,10)}),i=0;i<f.length;i++)if(r=e[i]||0,u=f[i]||0,r!==u)return r>u;return!0}function w(n,t,i,r,u){return function(){var i=t[n],f=r[n],e=t.ext[u],o=function(){return i.apply(t,arguments)};return function(){var n=t._local,i=t._super;try{return t._local=e,t._super=o,f.apply(t,arguments)}finally{t._local=n;t._super=i}}}()}function rt(t,i,r,u){for(var f in r)typeof r[f]=="function"?typeof t[f]=="function"?t[f]=w(f,t,i,r,u):f.charAt(0)==="_"?t.ext[u][f]=w(f,t,i,r,u):n.error("Could not override tree."+f+". Use prefix '_' to create tree."+u+"._"+f):f!=="options"&&(t.ext[u][f]=r[f])}function h(t,i){return t===r?n.Deferred(function(){this.resolve()}).promise():n.Deferred(function(){this.resolveWith(t,i)}).promise()}function y(t,i){return t===r?n.Deferred(function(){this.reject()}).promise():n.Deferred(function(){this.rejectWith(t,i)}).promise()}function b(n,t){return function(){n.resolveWith(t)}}function p(t){var i=n.extend({},t.data()),r=i.json;return delete i.fancytree,r&&(delete i.json,i=n.extend(i,r)),i}function k(n){return n=n.toLowerCase(),function(t){return t.title.toLowerCase().indexOf(n)>=0}}function c(t,i){var f,h,r,e;for(this.parent=t,this.tree=t.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},f=0,h=s.length;f<h;f++)r=s[f],this[r]=i[r];i.data&&n.extend(this.data,i.data);for(r in i)a[r]||n.isFunction(i[r])||g[r]||(this.data[r]=i[r]);this.key==null?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),u(this.key,"defaultKey() must return a unique key")):this.key="_"+o._nextNodeKey++:this.key=""+this.key;i.active&&(u(this.tree.activeNode===null,"only one active node allowed"),this.tree.activeNode=this);i.selected&&(this.tree.lastSelectedNode=this);this.children=null;e=i.children;e&&e.length&&this._setChildren(e);this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function v(t){this.widget=t;this.$div=t.element;this.options=t.options;this.options&&n.isFunction(this.options.lazyload)&&(n.isFunction(this.options.lazyLoad)||(this.options.lazyLoad=function(){o.warn("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead.");t.options.lazyload.apply(this,arguments)}));this.ext={};this.data=p(this.$div);this._id=n.ui.fancytree._nextId++;this._ns=".fancytree-"+this._id;this.activeNode=null;this.focusNode=null;this._hasFocus=null;this.lastSelectedNode=null;this.systemFocusElement=null;this.statusClassPropName="span";this.ariaPropName="li";this.nodeContainerAttrName="li";this.$div.find(">ul.fancytree-container").remove();var r={tree:this},i;this.rootNode=new c(r,{title:"root",key:"root_"+this._id,children:null,expanded:!0});this.rootNode.parent=null;i=n("<ul>",{"class":"ui-fancytree fancytree-container"}).appendTo(this.$div);this.$container=i;this.rootNode.ul=i[0];this.options.debugLevel==null&&(this.options.debugLevel=o.debugLevel);this.$container.attr("tabindex",this.options.tabbable?"0":"-1");this.options.aria&&this.$container.attr("role","tree").attr("aria-multiselectable",!0)}if(n.ui.fancytree&&n.ui.fancytree.version){n.ui.fancytree.warn("Fancytree: ignored duplicate include");return}for(var o=null,ut={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},l="active expanded focus folder hideCheckbox lazy selected unselectable".split(" "),d={},s="expanded extraClasses folder hideCheckbox key lazy refKey selected title tooltip unselectable".split(" "),a={},g={active:!0,children:!0,data:!0,focus:!0},e=0;e<l.length;e++)d[l[e]]=!0;for(e=0;e<s.length;e++)a[s[e]]=!0;c.prototype={_findDirectChild:function(n){var t,r,i=this.children;if(i)if(typeof n=="string"){for(t=0,r=i.length;t<r;t++)if(i[t].key===n)return i[t]}else{if(typeof n=="number")return this.children[n];if(n.parent===this)return n}return null},_setChildren:function(n){u(n&&(!this.children||this.children.length===0),"only init supported");this.children=[];for(var t=0,i=n.length;t<i;t++)this.children.push(new c(this,n[t]))},addChildren:function(t,i){var r,o,e,s=null,f=[];for(n.isPlainObject(t)&&(t=[t]),this.children||(this.children=[]),r=0,o=t.length;r<o;r++)f.push(new c(this,t[r]));return s=f[0],i==null?this.children=this.children.concat(f):(i=this._findDirectChild(i),e=n.inArray(i,this.children),u(e>=0,"insertBefore must be an existing child"),this.children.splice.apply(this.children,[e,0].concat(f))),(!this.parent||this.parent.ul||this.tr)&&this.render(),this.tree.options.selectMode===3&&this.fixSelection3FromEndNodes(),s},addNode:function(n,t){(t===r||t==="over")&&(t="child");switch(t){case"after":return this.getParent().addChildren(n,this.getNextSibling());case"before":return this.getParent().addChildren(n,this);case"child":case"over":return this.addChildren(n)}u(!1,"Invalid mode: "+t)},appendSibling:function(n){return this.addNode(n,"after")},applyPatch:function(t){if(t===null)return this.remove(),h(this);var i,r,u={children:!0,expanded:!0,parent:!0};for(i in t)r=t[i],u[i]||n.isFunction(r)||(a[i]?this[i]=r:this.data[i]=r);return t.hasOwnProperty("children")&&(this.removeChildren(),t.children&&this._setChildren(t.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),t.hasOwnProperty("expanded")?this.setExpanded(t.expanded):h(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(n,t,i){return n.addNode(this.toDict(!0,i),t)},countChildren:function(n){var r=this.children,t,u,i;if(!r)return 0;if(i=r.length,n!==!1)for(t=0,u=i;t<u;t++)i+=r[t].countChildren();return i},debug:function(){this.tree.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),f("debug",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},findAll:function(t){t=n.isFunction(t)?t:k(t);var i=[];return this.visit(function(n){t(n)&&i.push(n)}),i},findFirst:function(t){t=n.isFunction(t)?t:k(t);var i=null;return this.visit(function(n){if(t(n))return i=n,!1}),i},_changeSelectStatusAttrs:function(n){var t=!1;switch(n){case!1:t=this.selected||this.partsel;this.selected=!1;this.partsel=!1;break;case!0:t=!this.selected||!this.partsel;this.selected=!0;this.partsel=!0;break;case r:t=this.selected||!this.partsel;this.selected=!1;this.partsel=!0;break;default:u(!1,"invalid state: "+n)}return t&&this.renderStatus(),t},fixSelection3AfterClick:function(){var n=this.isSelected();this.visit(function(t){t._changeSelectStatusAttrs(n)});this.fixSelection3FromEndNodes()},fixSelection3FromEndNodes:function(){function n(t){var i,h,c,f,u,e,o,s=t.children;if(s){for(e=!0,o=!1,i=0,h=s.length;i<h;i++)c=s[i],f=n(c),f!==!1&&(o=!0),f!==!0&&(e=!1);u=e?!0:o?r:!1}else u=!!t.selected;return t._changeSelectStatusAttrs(u),u}u(this.tree.options.selectMode===3,"expected selectMode 3");n(this);this.visitParents(function(n){for(var t,f,e=n.children,o=!0,s=!1,i=0,u=e.length;i<u;i++)t=e[i],(t.selected||t.partsel)&&(s=!0),t.unselectable||t.selected||(o=!1);f=o?!0:s?r:!1;n._changeSelectStatusAttrs(f)})},fromDict:function(t){for(var i in t)a[i]?this[i]=t[i]:i==="data"?n.extend(this.data,t.data):n.isFunction(t[i])||g[i]||(this.data[i]=t[i]);t.children&&(this.removeChildren(),this.addChildren(t.children));this.renderTitle()},getChildren:function(){return this.hasChildren()===r?r:this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return n.inArray(this,this.parent.children)},getIndexHier:function(t){t=t||".";var i=[];return n.each(this.getParentList(!1,!0),function(n,t){i.push(t.getIndex()+1)}),i.join(t)},getKeyPath:function(n){var t=[],i=this.tree.options.keyPathSeparator;return this.visitParents(function(n){n.parent&&t.unshift(n.key)},!n),i+t.join(i)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var t=0,n=this.parent;n;)t++,n=n.parent;return t},getNextSibling:function(){if(this.parent)for(var t=this.parent.children,n=0,i=t.length-1;n<i;n++)if(t[n]===this)return t[n+1];return null},getParent:function(){return this.parent},getParentList:function(n,t){for(var r=[],i=t?this:this.parent;i;)(n||i.parent)&&r.unshift(i),i=i.parent;return r},getPrevSibling:function(){if(this.parent)for(var t=this.parent.children,n=1,i=t.length;n<i;n++)if(t[n]===this)return t[n-1];return null},hasChildren:function(){return this.lazy?this.children==null?r:this.children.length===0?!1:this.children.length===1&&this.children[0].isStatusNode()?r:!0:!!this.children},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},isActive:function(){return this.tree.activeNode===this},isChildOf:function(n){return this.parent&&this.parent===n},isDescendantOf:function(n){if(!n||n.tree!==this.tree)return!1;for(var t=this.parent;t;){if(t===n)return!0;t=t.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var n=this.parent;return!n||n.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var n=this.parent;return!n||n.children[n.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||this.hasChildren()!==r},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isUndefined:function(){return this.hasChildren()===r},isVisible:function(){for(var i=this.getParentList(!1,!1),n=0,t=i.length;n<t;n++)if(!i[n].expanded)return!1;return!0},lazyLoad:function(n){return this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead."),this.load(n)},load:function(n){var i,t,r=this;return(u(this.isLazy(),"load() requires a lazy node"),u(n||this.isUndefined(),"Pass forceReload=true to re-load a lazy node"),this.isLoaded()&&this.resetLazy(),t=this.tree._triggerNodeEvent("lazyLoad",this),t===!1)?h(this):(u(typeof t!="boolean","lazyLoad event must return source in data.result"),i=this.tree._callHook("nodeLoadChildren",this,t),this.expanded&&i.always(function(){r.render()}),i)},makeVisible:function(t){for(var e=this,u=[],r=new n.Deferred,f=this.getParentList(!1,!1),o=f.length,s=!(t&&t.noAnimation===!0),h=!(t&&t.scrollIntoView===!1),i=o-1;i>=0;i--)u.push(f[i].setExpanded(!0,t));return n.when.apply(n,u).done(function(){h?e.scrollIntoView(s).done(function(){r.resolve()}):r.resolve()}),r.promise()},moveTo:function(t,i,f){(i===r||i==="over")&&(i="child");var o,s=this.parent,e=i==="child"?t:t.parent;if(this!==t){if(this.parent){if(e.isDescendantOf(this))throw"Cannot move a node to its own descendant";}else throw"Cannot move system root";if(this.parent.children.length===1?(this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1):(o=n.inArray(this,this.parent.children),u(o>=0),this.parent.children.splice(o,1)),this.parent=e,e.hasChildren())switch(i){case"child":e.children.push(this);break;case"before":o=n.inArray(t,e.children);u(o>=0);e.children.splice(o,0,this);break;case"after":o=n.inArray(t,e.children);u(o>=0);e.children.splice(o+1,0,this);break;default:throw"Invalid mode "+i;}else e.children=[this];f&&t.visit(f,!0);this.tree!==t.tree&&(this.warn("Cross-tree moveTo is experimantal!"),this.visit(function(n){n.tree=t.tree},!0));s.isDescendantOf(e)||s.render();e.isDescendantOf(s)||e===s||e.render()}},navigate:function(t,i){function u(r){if(r){if(r.makeVisible(),!n(r.span).is(":visible")){r.debug("Navigate: skipping hidden node");r.navigate(t,i);return}return i===!1?r.setFocus():r.setActive()}}var e,o,s=!0,f=n.ui.keyCode,r=null;switch(t){case f.BACKSPACE:this.parent&&this.parent.parent&&u(this.parent);break;case f.LEFT:this.expanded?(this.setExpanded(!1),u(this)):this.parent&&this.parent.parent&&u(this.parent);break;case f.RIGHT:!this.expanded&&(this.children||this.lazy)?(this.setExpanded(),u(this)):this.children&&this.children.length&&u(this.children[0]);break;case f.UP:for(r=this.getPrevSibling();r&&r.expanded&&r.children&&r.children.length;)r=r.children[r.children.length-1];!r&&this.parent&&this.parent.parent&&(r=this.parent);u(r);break;case f.DOWN:if(this.expanded&&this.children&&this.children.length)r=this.children[0];else for(o=this.getParentList(!1,!0),e=o.length-1;e>=0;e--)if(r=o[e].getNextSibling(),r)break;u(r);break;default:s=!1}},remove:function(){return this.parent.removeChild(this)},removeChild:function(n){return this.tree._callHook("nodeRemoveChild",this,n)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},render:function(n,t){return this.tree._callHook("nodeRender",this,n,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},resetLazy:function(){this.removeChildren();this.expanded=!1;this.lazy=!0;this.children=r;this.renderStatus()},scheduleAction:function(n,t){this.tree.timer&&clearTimeout(this.tree.timer);this.tree.timer=null;var i=this;switch(n){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){i.tree.debug("setTimeout: trigger expand");i.setExpanded(!0)},t);break;case"activate":this.tree.timer=setTimeout(function(){i.tree.debug("setTimeout: trigger activate");i.setActive(!0)},t);break;default:throw"Invalid mode "+n;}},scrollIntoView:function(f,e){e!==r&&tt(e)&&(this.warn("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead."),e={topNode:e});var a,c,d,p,s=n.extend({effects:f===!0?{duration:200,queue:!1}:f,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent||this.tree.$container,topNode:null},e),v=new n.Deferred,it=this,g=n(this.span).height(),o=n(s.scrollParent),w=s.scrollOfs.top||0,nt=s.scrollOfs.bottom||0,b=o.height(),y=o.scrollTop(),k=o,rt=o[0]===t,l=s.topNode||null,h=null;return u(n(this.span).is(":visible"),"scrollIntoView node is invisible"),rt?(c=n(this.span).offset().top,a=l?n(l.span).offset().top:0,k=n("html,body")):(u(o[0]!==i&&o[0]!==i.body,"scrollParent should be an simple element or `window`, not document or body."),p=o.offset().top,c=n(this.span).offset().top-p+y,a=l?n(l.span).offset().top-p+y:0,d=Math.max(0,o.innerHeight()-o[0].clientHeight),b-=d),c<y+w?h=c-w:c+g>y+b-nt&&(h=c+g-b+nt,l&&(u(n(l.span).is(":visible")),a<h&&(h=a-w))),h!==null?s.effects?(s.effects.complete=function(){v.resolveWith(it)},k.stop(!0).animate({scrollTop:h},s.effects)):(k[0].scrollTop=h,v.resolveWith(this)):v.resolveWith(this),v.promise()},setActive:function(n,t){return this.tree._callHook("nodeSetActive",this,n,t)},setExpanded:function(n,t){return this.tree._callHook("nodeSetExpanded",this,n,t)},setFocus:function(n){return this.tree._callHook("nodeSetFocus",this,n)},setSelected:function(n){return this.tree._callHook("nodeSetSelected",this,n)},setTitle:function(n){this.title=n;this.renderTitle()},sortChildren:function(n,t){var i,u,r=this.children;if(r){if(n=n||function(n,t){var i=n.title.toLowerCase(),r=t.title.toLowerCase();return i===r?0:i>r?1:-1},r.sort(n),t)for(i=0,u=r.length;i<u;i++)r[i].children&&r[i].sortChildren(n,"$norender$");t!=="$norender$"&&this.render()}},toDict:function(t,i){var u,o,f,r={},e=this;if(n.each(s,function(n,t){(e[t]||e[t]===!1)&&(r[t]=e[t])}),n.isEmptyObject(this.data)||(r.data=n.extend({},this.data),n.isEmptyObject(r.data)&&delete r.data),i&&i(r),t&&this.hasChildren())for(r.children=[],u=0,o=this.children.length;u<o;u++)f=this.children[u],f.isStatusNode()||r.children.push(f.toDict(!0,i));return r},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"<FancytreeNode(#"+this.key+", '"+this.title+"')>"},visit:function(n,t){var r,f,i=!0,u=this.children;if(t===!0&&(i=n(this),i===!1||i==="skip"))return i;if(u)for(r=0,f=u.length;r<f;r++)if(i=u[r].visit(n,!0),i===!1)break;return i},visitParents:function(n,t){if(t&&n(this)===!1)return!1;for(var i=this.parent;i;){if(n(i)===!1)return!1;i=i.parent}return!0},warn:function(){Array.prototype.unshift.call(arguments,this.toString());f("warn",arguments)}};v.prototype={_makeHookContext:function(t,i,u){var f,e;return t.node!==r?(i&&t.originalEvent!==i&&n.error("invalid args"),f=t):t.tree?(e=t.tree,f={node:t,tree:e,widget:e.widget,options:e.widget.options,originalEvent:i}):t.widget?f={node:null,tree:t,widget:t.widget,options:t.widget.options,originalEvent:i}:n.error("invalid args"),u&&n.extend(f,u),f},_callHook:function(t,i){var f=this._makeHookContext(i),r=this[t],u=Array.prototype.slice.call(arguments,2);return n.isFunction(r)||n.error("_callHook('"+t+"') is not a function"),u.unshift(f),r.apply(this,u)},_requireExtension:function(t,i,r,f){r=!!r;var e=this._local.name,s=this.options.extensions,c=n.inArray(t,s)<n.inArray(e,s),o=i&&this.ext[t]==null,h=!o&&r!=null&&r!==c;return(u(e&&e!==t),o||h)?(f||(o||i?(f="'"+e+"' extension requires '"+t+"'",h&&(f+=" to be registered "+(r?"before":"after")+" itself")):f="If used together, `"+t+"` must be registered "+(r?"before":"after")+" `"+e+"`"),n.error(f),!1):!0},activateKey:function(n){var t=this.getNodeByKey(n);return t?t.setActive():this.activeNode&&this.activeNode.setActive(!1),t},applyPatch:function(t){for(var o,r,f,s,e,c=t.length,h=[],i=0;i<c;i++)r=t[i],u(r.length===2,"patchList must be an array of length-2-arrays"),f=r[0],s=r[1],e=f===null?this.rootNode:this.getNodeByKey(f),e?(o=new n.Deferred,h.push(o),e.applyPatch(s).always(b(o,e))):this.warn("could not find node with key '"+f+"'");return n.when.apply(n,h).promise()},count:function(){return this.rootNode.countChildren()},debug:function(){this.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),f("debug",arguments))},generateFormElements:function(t,i){var u,f=t!==!1?"ft_"+this._id:t,e=i!==!1?"ft_"+this._id+"_active":i,o="fancytree_result_"+this._id,r=this.$container.find("div#"+o);r.length?r.empty():r=n("<div>",{id:o}).hide().appendTo(this.$container);f&&(u=this.getSelectedNodes(this.options.selectMode===3),n.each(u,function(t,i){r.append(n("<input>",{type:"checkbox",name:f,value:i.key,checked:!0}))}));e&&this.activeNode&&r.append(n("<input>",{type:"radio",name:e,value:this.activeNode.key,checked:!0}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getNodeByKey:function(n,t){var r,u;return!t&&(r=i.getElementById(this.options.idPrefix+n),r)?r.ftnode?r.ftnode:null:(t=t||this.rootNode,u=null,t.visit(function(t){if(t.key===n)return u=t,!1},!0),u)},getSelectedNodes:function(n){var t=[];return this.rootNode.visit(function(i){if(i.selected&&(t.push(i),n===!0))return"skip"}),t},hasFocus:function(){return!!this._hasFocus},info:function(){this.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),f("info",arguments))},loadKeyPath:function(t,i,u){function w(n,t,r){i.call(h,t,"loading");t.load().done(function(){h.loadKeyPath.call(h,o[n],i,t).always(b(r,h))}).fail(function(){h.warn("loadKeyPath: error loading: "+n+" (parent: "+l+")");i.call(h,t,"error");r.reject()})}var y,p,a,c,f,o,e,s,l=u||this.rootNode,v=this.options.keyPathSeparator,h=this;for(n.isArray(t)||(t=[t]),o={},a=0;a<t.length;a++)for(c=t[a],c.charAt(0)===v&&(c=c.substr(1)),s=c.split(v);s.length;)if(f=s.shift(),e=l._findDirectChild(f),e)if(s.length===0){i.call(this,e,"ok");break}else if(e.lazy&&e.hasChildren()===r){i.call(this,e,"loaded");o[f]?o[f].push(s.join(v)):o[f]=[s.join(v)];break}else i.call(this,e,"loaded"),l=e;else{this.warn("loadKeyPath: key not found: "+f+" (parent: "+l+")");i.call(this,f,"error");break}y=[];for(f in o)e=l._findDirectChild(f),p=new n.Deferred,y.push(p),w(f,e,p);return n.when.apply(n,y).promise()},reactivate:function(n){var t=this.activeNode;t&&(this.activeNode=null,t.setActive(),n&&t.setFocus())},reload:function(n){return this._callHook("treeClear",this),this._callHook("treeLoad",this,n)},render:function(n,t){return this.rootNode.render(n,t)},setFocus:function(n){return this._callHook("treeSetFocus",this,n)},toDict:function(n,t){var i=this.rootNode.toDict(!0,t);return n?i:i.children},toString:function(){return"<Fancytree(#"+this._id+")>"},_triggerNodeEvent:function(n,t,i,u){var f=this._makeHookContext(t,i,u),e=this.widget._trigger(n,i,f);return e!==!1&&f.result!==r?f.result:e},_triggerTreeEvent:function(n,t){var i=this._makeHookContext(this,t),u=this.widget._trigger(n,t,i);return u!==!1&&i.result!==r?i.result:u},visit:function(n){return this.rootNode.visit(n,!1)},warn:function(){Array.prototype.unshift.call(arguments,this.toString());f("warn",arguments)}};n.extend(v.prototype,{nodeClick:function(n){var t,i,r=n.originalEvent,u=n.targetType,f=n.node;if(u==="expander")this._callHook("nodeToggleExpanded",n);else if(u==="checkbox")this._callHook("nodeToggleSelected",n),this._callHook("nodeSetFocus",n,!0);else{if(i=!1,t=!0,f.folder)switch(n.options.clickFolderMode){case 2:i=!0;t=!1;break;case 3:t=!0;i=!0;
//!node.isExpanded();
}t&&(this.nodeSetFocus(n),this._callHook("nodeSetActive",n,!0));i&&(!t,this._callHook("nodeToggleExpanded",n))}r.target.localName==="a"&&r.target.className==="fancytree-title"&&r.preventDefault()},nodeCollapseSiblings:function(n,t){var r,i,f,u=n.node;if(u.parent)for(r=u.parent.children,i=0,f=r.length;i<f;i++)r[i]!==u&&r[i].expanded&&this._callHook("nodeSetExpanded",r[i],!1,t)},nodeDblclick:function(n){n.targetType==="title"&&n.options.clickFolderMode===4&&this._callHook("nodeToggleExpanded",n);n.targetType==="title"&&n.originalEvent.preventDefault()},nodeKeydown:function(t){var s,u=t.originalEvent,f=t.node,r=t.tree,e=t.options,o=!0,h=!(u.ctrlKey||!e.autoActivate),i=n.ui.keyCode;f||(this.rootNode.getFirstChild().setFocus(),f=t.node=this.focusNode,f.debug("Keydown force focus on first node"));switch(u.which){case i.NUMPAD_ADD:case 187:r.nodeSetExpanded(t,!0);break;case i.NUMPAD_SUBTRACT:case 189:r.nodeSetExpanded(t,!1);break;case i.SPACE:e.checkbox?r.nodeToggleSelected(t):r.nodeSetActive(t,!0);break;case i.ENTER:r.nodeSetActive(t,!0);break;case i.BACKSPACE:case i.LEFT:case i.RIGHT:case i.UP:case i.DOWN:s=f.navigate(u.which,h);break;default:o=!1}o&&u.preventDefault()},nodeLoadChildren:function(t,i){var o,f,r=t.tree,e=t.node;return n.isFunction(i)&&(i=i()),i.url&&(o=n.extend({},t.options.ajax,i),o.debugDelay?(f=o.debugDelay,n.isArray(f)&&(f=f[0]+Math.random()*(f[1]-f[0])),e.debug("nodeLoadChildren waiting debug delay "+Math.round(f)+"ms"),o.debugDelay=!1,i=n.Deferred(function(t){setTimeout(function(){n.ajax(o).done(function(){t.resolveWith(this,arguments)}).fail(function(){t.rejectWith(this,arguments)})},f)})):i=n.ajax(o),i=i.pipe(function(i){var u;return typeof i=="string"&&n.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),t.options.postProcess?(u=r._triggerNodeEvent("postProcess",t,t.originalEvent,{response:i,dataType:this.dataType}),i=n.isArray(u)?u:i):i&&i.hasOwnProperty("d")&&t.options.enableAspx&&(i=typeof i.d=="string"?n.parseJSON(i.d):i.d),i},function(n,t,i){return r._makeHookContext(e,null,{error:n,args:Array.prototype.slice.call(arguments),message:i,details:n.status+": "+i})})),n.isFunction(i.promise)&&(u(!e.isLoading()),r.nodeSetStatus(t,"loading"),i.done(function(){r.nodeSetStatus(t,"ok")}).fail(function(n){var i;i=n.node&&n.error&&n.message?n:r._makeHookContext(e,null,{error:n,args:Array.prototype.slice.call(arguments),message:n?n.message||n.toString():""});r._triggerNodeEvent("loaderror",i,null);r.nodeSetStatus(t,"error",i.message,i.details)})),n.when(i).done(function(t){var i;n.isPlainObject(t)&&(u(n.isArray(t.children),"source must contain (or be) an array of children"),u(e.isRoot(),"source may only be an object for root nodes"),i=t,t=t.children,delete i.children,n.extend(r.data,i));u(n.isArray(t),"expected array of children");e._setChildren(t);r._triggerNodeEvent("loadChildren",e)})},nodeLoadKeyPath:function(){},nodeRemoveChild:function(t,i){var f,s=t.node,o=t.options,e=n.extend({},t,{node:i}),r=s.children;if(r.length===1)return u(i===r[0]),this.nodeRemoveChildren(t);this.activeNode&&(i===this.activeNode||this.activeNode.isDescendantOf(i))&&this.activeNode.setActive(!1);this.focusNode&&(i===this.focusNode||this.focusNode.isDescendantOf(i))&&(this.focusNode=null);this.nodeRemoveMarkup(e);this.nodeRemoveChildren(e);f=n.inArray(i,r);u(f>=0);i.visit(function(n){n.parent=null},!0);this._callHook("treeRegisterNode",this,!1,i);o.removeNode&&o.removeNode.call(t.tree,{type:"removeNode"},e);r.splice(f,1)},nodeRemoveChildMarkup:function(t){var i=t.node;i.ul&&(i.isRoot()?n(i.ul).empty():(n(i.ul).remove(),i.ul=null),i.visit(function(n){n.li=n.ul=null}))},nodeRemoveChildren:function(t){var r,u=t.tree,i=t.node,e=i.children,f=t.options;e&&(this.activeNode&&this.activeNode.isDescendantOf(i)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(i)&&(this.focusNode=null),this.nodeRemoveChildMarkup(t),r=n.extend({},t),i.visit(function(n){n.parent=null;u._callHook("treeRegisterNode",u,!1,n);f.removeNode&&(r.node=n,f.removeNode.call(t.tree,{type:"removeNode"},r))}),i.children=i.lazy?[]:null,this.nodeRenderStatus(t))},nodeRemoveMarkup:function(t){var i=t.node;i.li&&(n(i.li).remove(),i.li=null);this.nodeRemoveChildMarkup(t)},nodeRender:function(t,r,f,e,o){var h,b,l,c,p,d,g,s=t.node,nt=t.tree,a=t.options,k=a.aria,tt=!1,w=s.parent,v=!w,y=s.children;if(v||w.ul){if(u(v||w.ul,"parent UL must exist"),v||(s.li&&(r||s.li.parentNode!==s.parent.ul)&&(s.li.parentNode!==s.parent.ul&&this.warn("unlink "+s+" (must be child of "+s.parent+")"),this.nodeRemoveMarkup(t)),s.li?this.nodeRenderStatus(t):(tt=!0,s.li=i.createElement("li"),s.li.ftnode=s,k,s.key&&a.generateIds&&(s.li.id=a.idPrefix+s.key),s.span=i.createElement("span"),s.span.className="fancytree-node",k&&n(s.span).attr("aria-labelledby","ftal_"+s.key),s.li.appendChild(s.span),this.nodeRenderTitle(t),a.createNode&&a.createNode.call(nt,{type:"createNode"},t)),a.renderNode&&a.renderNode.call(nt,{type:"renderNode"},t)),y){if(v||s.expanded||f===!0){for(s.ul||(s.ul=i.createElement("ul"),(e!==!0||o)&&s.expanded||(s.ul.style.display="none"),k&&n(s.ul).attr("role","group"),s.li?s.li.appendChild(s.ul):s.tree.$div.append(s.ul)),c=0,p=y.length;c<p;c++)g=n.extend({},t,{node:y[c]}),this.nodeRender(g,r,f,!1,!0);for(h=s.ul.firstChild;h;)l=h.ftnode,l&&l.parent!==s?(s.debug("_fixParent: remove missing "+l,h),d=h.nextSibling,h.parentNode.removeChild(h),h=d):h=h.nextSibling;for(h=s.ul.firstChild,c=0,p=y.length-1;c<p;c++)b=y[c],l=h.ftnode,b!==l?s.ul.insertBefore(b.li,l.li):h=h.nextSibling}}else s.ul&&(this.warn("remove child markup for "+s),this.nodeRemoveChildMarkup(t));v||tt&&w.ul.appendChild(s.li)}},nodeRenderTitle:function(n,t){var l,a,h,c,v,y,i=n.node,w=n.tree,f=n.options,s=f.aria,p=i.getLevel(),u=[],e=i.data.icon;(t!==r&&(i.title=t),i.span)&&(p<f.minExpandLevel?p>1&&(s?u.push("<span role='button' class='fancytree-expander'><\/span>"):u.push("<span class='fancytree-expander'><\/span>")):s?u.push("<span role='button' class='fancytree-expander'><\/span>"):u.push("<span class='fancytree-expander'><\/span>"),f.checkbox&&i.hideCheckbox!==!0&&!i.isStatusNode()&&(s?u.push("<span role='checkbox' class='fancytree-checkbox'><\/span>"):u.push("<span class='fancytree-checkbox'><\/span>")),c=s?" role='img'":"",e&&typeof e=="string"?(a=e.charAt(0)==="/"?e:(f.imagePath||"")+e,u.push("<img src='"+a+"' class='fancytree-icon' alt='' />")):i.data.iconclass?u.push("<span "+c+" class='fancytree-custom-icon "+i.data.iconclass+"'><\/span>"):(e===!0||e!==!1&&f.icons!==!1)&&u.push("<span "+c+" class='fancytree-icon'><\/span>"),h="",f.renderTitle&&(h=f.renderTitle.call(w,{type:"renderTitle"},n)||""),h||(y=i.tooltip?" title='"+o.escapeHtml(i.tooltip)+"'":"",l=s?" id='ftal_"+i.key+"'":"",c=s?" role='treeitem'":"",v=f.titlesTabbable?" tabindex='0'":"",h="<span "+c+" class='fancytree-title'"+l+y+v+">"+i.title+"<\/span>"),u.push(h),i.span.innerHTML=u.join(""),this.nodeRenderStatus(n))},nodeRenderStatus:function(t){var i=t.node,s=t.tree,h=t.options,c=i.hasChildren(),o=i.isLastSibling(),f=h.aria,e=n(i.span).find(".fancytree-title"),u=h._classNames,r=[],l=i[s.statusClassPropName];l&&(r.push(u.node),s.activeNode===i&&r.push(u.active),s.focusNode===i?(r.push(u.focused),f&&e.attr("aria-activedescendant",!0)):f&&e.removeAttr("aria-activedescendant"),i.expanded?(r.push(u.expanded),f&&e.attr("aria-expanded",!0)):f&&e.removeAttr("aria-expanded"),i.folder&&r.push(u.folder),c!==!1&&r.push(u.hasChildren),o&&r.push(u.lastsib),i.lazy&&i.children==null&&r.push(u.lazy),i.partsel&&r.push(u.partsel),i._isLoading&&r.push(u.loading),i._error&&r.push(u.error),i.selected?(r.push(u.selected),f&&e.attr("aria-selected",!0)):f&&e.attr("aria-selected",!1),i.extraClasses&&r.push(i.extraClasses),c===!1?r.push(u.combinedExpanderPrefix+"n"+(o?"l":"")):r.push(u.combinedExpanderPrefix+(i.expanded?"e":"c")+(i.lazy&&i.children==null?"d":"")+(o?"l":"")),r.push(u.combinedIconPrefix+(i.expanded?"e":"c")+(i.folder?"f":"")),l.className=r.join(" "),i.li&&(i.li.className=o?u.lastsib:""))},nodeSetActive:function(t,i,r){r=r||{};var s,e=t.node,f=t.tree,c=t.options,o=r.noEvents===!0,l=e===f.activeNode;if(i=i!==!1,l===i)return h(e);if(i&&!o&&this._triggerNodeEvent("beforeActivate",e,t.originalEvent)===!1)return y(e,["rejected"]);i?(f.activeNode&&(u(f.activeNode!==e,"node was active (inconsistency)"),s=n.extend({},t,{node:f.activeNode}),f.nodeSetActive(s,!1),u(f.activeNode===null,"deactivate was out of sync?")),c.activeVisible&&e.makeVisible({scrollIntoView:!1}),f.activeNode=e,f.nodeRenderStatus(t),f.nodeSetFocus(t),o||f._triggerNodeEvent("activate",e,t.originalEvent)):(u(f.activeNode===e,"node was not active (inconsistency)"),f.activeNode=null,this.nodeRenderStatus(t),o||t.tree._triggerNodeEvent("deactivate",e,t.originalEvent))},nodeSetExpanded:function(t,i,u){u=u||{};var s,o,c,p,a,w,f=t.node,b=t.tree,e=t.options,l=u.noAnimation===!0,v=u.noEvents===!0;if(i=i!==!1,f.expanded&&i||!f.expanded&&!i)return h(f);if(!i||f.lazy||f.hasChildren()){if(!i&&f.getLevel()<e.minExpandLevel)return y(f,["locked"]);if(!v&&this._triggerNodeEvent("beforeExpand",f,t.originalEvent)===!1)return y(f,["rejected"])}else return h(f);if(l||f.isVisible()||(l=u.noAnimation=!0),o=new n.Deferred,i&&!f.expanded&&e.autoCollapse){a=f.getParentList(!1,!0);w=e.autoCollapse;try{for(e.autoCollapse=!1,c=0,p=a.length;c<p;c++)this._callHook("nodeCollapseSiblings",a[c],u)}finally{e.autoCollapse=w}}return o.done(function(){i&&e.autoScroll&&!l?f.getLastChild().scrollIntoView(!0,{topNode:f}).always(function(){v||t.tree._triggerNodeEvent(i?"expand":"collapse",t)}):v||t.tree._triggerNodeEvent(i?"expand":"collapse",t)}),s=function(r){var u,o,s,h;if(f.expanded=i,b._callHook("nodeRender",t,!1,!1,!0),f.ul)if(s=f.ul.style.display!=="none",h=!!f.expanded,s===h)f.warn("nodeSetExpanded: UL.style.display already set");else if(!e.fx||l)f.ul.style.display=f.expanded||!parent?"":"none";else{u=e.fx.duration||200;o=e.fx.easing;n(f.ul).animate(e.fx,u,o,function(){r()});return}r()},i&&f.lazy&&f.hasChildren()===r?f.load().done(function(){o.notifyWith&&o.notifyWith(f,["loaded"]);s(function(){o.resolveWith(f)})}).fail(function(n){s(function(){o.rejectWith(f,["load failed ("+n+")"])})}):s(function(){o.resolveWith(f)}),o.promise()},nodeSetFocus:function(t,i){var f,r=t.tree,u=t.node;if(i=i!==!1,r.focusNode){if(r.focusNode===u&&i)return;f=n.extend({},t,{node:r.focusNode});r.focusNode=null;this._triggerNodeEvent("blur",f);this._callHook("nodeRenderStatus",f)}i&&(this.hasFocus()||(u.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",t,!0,!0)),u.makeVisible({scrollIntoView:!1}),r.focusNode=u,this._triggerNodeEvent("focus",t),t.options.autoScroll&&u.scrollIntoView(),this._callHook("nodeRenderStatus",t))},nodeSetSelected:function(n,t){var i=n.node,r=n.tree,u=n.options;if(t=t!==!1,i.debug("nodeSetSelected("+t+")",n),!i.unselectable){if(i.selected&&t||!i.selected&&!t||this._triggerNodeEvent("beforeSelect",i,n.originalEvent)===!1)return!!i.selected;t&&u.selectMode===1?r.lastSelectedNode&&r.lastSelectedNode.setSelected(!1):u.selectMode===3&&(i.selected=t,i.fixSelection3AfterClick());i.selected=t;this.nodeRenderStatus(n);r.lastSelectedNode=t?i:null;r._triggerNodeEvent("select",n)}},nodeSetStatus:function(t,i,r,u){function s(){var n=f.children?f.children[0]:null;if(n&&n.isStatusNode()){try{f.ul&&(f.ul.removeChild(n.li),n.li=null)}catch(t){}f.children.length===1?f.children=[]:f.children.shift()}}function o(t,i){var r=f.children?f.children[0]:null;return r&&r.isStatusNode()?(n.extend(r,t),e._callHook("nodeRender",r)):(t.key="_statusNode",f._setChildren([t]),f.children[0].statusNodeType=i,e.render()),f.children[0]}var f=t.node,e=t.tree;switch(i){case"ok":s();f._isLoading=!1;f._error=null;f.renderStatus();break;case"loading":f.parent||o({title:e.options.strings.loading+(r?" ("+r+") ":""),tooltip:u,extraClasses:"fancytree-statusnode-wait"},i);f._isLoading=!0;f._error=null;f.renderStatus();break;case"error":o({title:e.options.strings.loadError+(r?" ("+r+") ":""),tooltip:u,extraClasses:"fancytree-statusnode-error"},i);f._isLoading=!1;f._error={message:r,details:u};f.renderStatus();break;default:n.error("invalid node status "+i)}},nodeToggleExpanded:function(n){return this.nodeSetExpanded(n,!n.node.expanded)},nodeToggleSelected:function(n){return this.nodeSetSelected(n,!n.node.selected)},treeClear:function(n){var t=n.tree;t.activeNode=null;t.focusNode=null;t.$div.find(">ul.fancytree-container").empty();t.rootNode.children=null},treeCreate:function(){},treeDestroy:function(){},treeInit:function(n){this.treeLoad(n)},treeLoad:function(t,i){var f,u,r=t.tree,e=t.widget.element,o=n.extend({},t,{node:this.rootNode});if(r.rootNode.children&&this.treeClear(t),i=i||this.options.source,i)typeof i=="string"&&nt();else{f=e.data("type")||"html";switch(f){case"html":u=e.find(">ul:first");u.addClass("ui-fancytree-source ui-helper-hidden");i=n.ui.fancytree.parseHtml(u);this.data=n.extend(this.data,p(u));break;case"json":i=n.parseJSON(e.text());i.children&&(i.title&&(r.title=i.title),i=i.children);break;default:n.error("Invalid data-type: "+f)}}return this.nodeLoadChildren(o,i).done(function(){r.render();t.options.selectMode===3&&r.rootNode.fixSelection3FromEndNodes();r._triggerTreeEvent("init",!0)}).fail(function(){r.render();r._triggerTreeEvent("init",!1)})},treeRegisterNode:function(){},treeSetFocus:function(n,t){t=t!==!1;t!==this.hasFocus()&&(this._hasFocus=t,this.$container.toggleClass("fancytree-treefocus",t),this._triggerTreeEvent(t?"focusTree":"blurTree"))}});n.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!1,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,extensions:[],fx:{height:"toggle",duration:200},generateIds:!1,icons:!0,idPrefix:"ft_",keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading&#8230;",loadError:"Load error!"},tabbable:!0,titlesTabbable:!1,_classNames:{node:"fancytree-node",folder:"fancytree-folder",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partsel:"fancytree-partsel",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new v(this);this.$source=this.source||this.element.data("type")==="json"?this.element:this.element.find(">ul:first");for(var i,t,e=this.options.extensions,o=this.tree,f=0;f<e.length;f++)t=e[f],i=n.ui.fancytree._extensions[t],i||n.error("Could not apply extension '"+t+"' (it is not registered, did you forget to include it?)"),this.tree.options[t]=n.extend(!0,{},i.options,this.tree.options[t]),u(this.tree.ext[t]===r,"Extension name must not exist as Fancytree.ext attribute: '"+t+"'"),this.tree.ext[t]={},rt(this.tree,o,i,t),o=i;this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree);this._bind()},_setOption:function(t,i){var r=!0,u=!1;switch(t){case"aria":case"checkbox":case"icons":case"minExpandLevel":case"tabbable":this.tree._callHook("treeCreate",this.tree);u=!0;break;case"source":r=!1;this.tree._callHook("treeLoad",this.tree,i)}this.tree.debug("set option "+t+"="+i+" <"+typeof i+">");r&&n.Widget.prototype._setOption.apply(this,arguments);u&&this.tree.render(!0,!1)},destroy:function(){this._unbind();this.tree._callHook("treeDestroy",this.tree);this.tree.$div.find(">ul.fancytree-container").remove();this.$source&&this.$source.removeClass("ui-helper-hidden");n.Widget.prototype.destroy.call(this)},_unbind:function(){var t=this.tree._ns;this.element.unbind(t);this.tree.$container.unbind(t);n(i).unbind(t)},_bind:function(){var r=this,i=this.options,n=this.tree,t=n._ns;this._unbind();n.$container.on("focusin"+t+" focusout"+t,function(t){var i=o.getNode(t),r=t.type==="focusin";i?n._callHook("nodeSetFocus",i,r):n._callHook("treeSetFocus",n,r)}).on("selectstart"+t,"span.fancytree-title",function(n){n.preventDefault()}).on("keydown"+t,function(t){if(i.disabled||i.keyboard===!1)return!0;var r,u=n.focusNode,f=n._makeHookContext(u||n,t),e=n.phase;try{return n.phase="userEvent",r=u?n._triggerNodeEvent("keydown",u,t):n._triggerTreeEvent("keydown",t),r==="preventNav"?r=!0:r!==!1&&(r=n._callHook("nodeKeydown",f)),r}finally{n.phase=e}}).on("click"+t+" dblclick"+t,function(n){if(i.disabled)return!0;var u,f=o.getEventTarget(n),e=f.node,t=r.tree,s=t.phase;if(!e)return!0;u=t._makeHookContext(e,n);try{t.phase="userEvent";switch(n.type){case"click":return u.targetType=f.type,t._triggerNodeEvent("click",u,n)===!1?!1:t._callHook("nodeClick",u);case"dblclick":return u.targetType=f.type,t._triggerNodeEvent("dblclick",u,n)===!1?!1:t._callHook("nodeDblclick",u)}}finally{t.phase=s}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(n){return this.tree.getNodeByKey(n)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}});o=n.ui.fancytree;n.extend(n.ui.fancytree,{version:"2.1.0",buildType:"production",debugLevel:1,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:v,_FancytreeNodeClass:c,jquerySupports:{positionMyOfs:it(n.ui.version,1,9)},assert:function(n,t){return u(n,t)},debounce:function(n,t,i,r){var u;return arguments.length===3&&typeof i!="boolean"&&(r=i,i=!1),function(){var f=arguments;r=r||this;i&&!u&&t.apply(r,f);clearTimeout(u);u=setTimeout(function(){i||t.apply(r,f);u=null},n)}},debug:function(){n.ui.fancytree.debugLevel>=2&&f("log",arguments)},error:function(){f("error",arguments)},escapeHtml:function(n){return(""+n).replace(/[&<>"'\/]/g,function(n){return ut[n]})},unescapeHtml:function(n){var t=i.createElement("div");return t.innerHTML=n,t.childNodes.length===0?"":t.childNodes[0].nodeValue},getEventTargetType:function(n){return this.getEventTarget(n).type},getEventTarget:function(t){var u=t&&t.target?t.target.className:"",i={node:this.getNode(t.target),type:r};return/\bfancytree-title\b/.test(u)?i.type="title":/\bfancytree-expander\b/.test(u)?i.type=i.node.hasChildren()===!1?"prefix":"expander":/\bfancytree-checkbox\b/.test(u)||/\bfancytree-radio\b/.test(u)?i.type="checkbox":/\bfancytree-icon\b/.test(u)?i.type="icon":/\bfancytree-node\b/.test(u)?i.type="title":t&&t.target&&n(t.target).closest(".fancytree-title").length&&(i.type="title"),i},getNode:function(n){if(n instanceof c)return n;for(n.selector!==r?n=n[0]:n.originalEvent!==r&&(n=n.target);n;){if(n.ftnode)return n.ftnode;n=n.parentNode}return null},info:function(){n.ui.fancytree.debugLevel>=1&&f("info",arguments)},parseHtml:function(t){var o,i,f,h,u,c,a,e,y=t.find(">li"),v=[];return y.each(function(){var b,w=n(this),g=w.find(">span:first",this),k=g.length?null:w.find(">a:first"),y={tooltip:null,data:{}};for(g.length?y.title=g.html():k&&k.length?(y.title=k.html(),y.data.href=k.attr("href"),y.data.target=k.attr("target"),y.tooltip=k.attr("title")):(y.title=w.html(),h=y.title.search(/<ul/i),h>=0&&(y.title=y.title.substring(0,h))),y.title=n.trim(y.title),i=0,f=l.length;i<f;i++)y[l[i]]=r;for(a=this.className.split(" "),o=[],i=0,f=a.length;i<f;i++)e=a[i],d[e]?y[e]=!0:o.push(e);if(y.extraClasses=o.join(" "),u=w.attr("title"),u&&(y.tooltip=u),u=w.attr("id"),u&&(y.key=u),b=p(w),b&&!n.isEmptyObject(b)){for(i=0,f=s.length;i<f;i++)u=s[i],c=b[u],c!=null&&(delete b[u],y[u]=c);n.extend(y.data,b)}t=w.find(">ul:first");y.children=t.length?n.ui.fancytree.parseHtml(t):y.lazy?r:null;v.push(y)}),v},registerExtension:function(t){u(t.name!=null,"extensions must have a `name` property.");u(t.version!=null,"extensions must have a `version` property.");n.ui.fancytree._extensions[t.name]=t},warn:function(){f("warn",arguments)}})})(jQuery,window,document);
/*!
 * jquery.fancytree.childcounter.js
 *
 * Add a child counter bubble to tree nodes.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2014, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.1.0
 * @date 2014-05-29T16:44
 */
(function(n){"use strict";n.ui.fancytree._FancytreeClass.prototype.countSelected=function(n){var t=this,i=t.options;return t.getSelectedNodes(n).length};n.ui.fancytree._FancytreeNodeClass.prototype.toUpper=function(){var n=this;return n.setTitle(n.title.toUpperCase())};n.ui.fancytree.prototype.widgetMethod1=function(n){var t=this.tree;return n};n.ui.fancytree.registerExtension({name:"childcounter",version:"1.0.0",options:{deep:!0,hideZeros:!0,hideExpanded:!1},foo:42,_appendCounter:function(){var n=this},treeInit:function(n){var t=this,i=n.options,r=n.options.childcounter;this._super(n);this.$container.addClass("fancytree-ext-childcounter")},treeDestroy:function(n){this._super(n)},nodeRenderTitle:function(t,i){var r=t.node,u=t.options.childcounter,f=r.data.childCounter==null?r.countChildren(u.deep):+r.data.childCounter;this._super(t,i);!f&&u.hideZeros||r.isExpanded()&&u.hideExpanded||n("span.fancytree-icon",r.span).append(n("<span class='fancytree-childcounter'/>").text(f))},nodeSetExpanded:function(n,t,i){var r=n.tree,u=n.node;return this._super(n,t,i).always(function(){r.nodeRenderTitle(n)})}})})(jQuery);
/*!
 * jquery.fancytree.dnd.js
 *
 * Drag-and-drop support.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2014, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.1.0
 * @date 2014-05-29T16:44
 */
(function(n,t,i,r){"use strict";function e(n){return n===0?"":n>0?"+"+n:""+n}function o(t){var i=t.options.dnd||null;i&&s();i&&i.dragStart&&t.widget.element.draggable(n.extend({addClasses:!1,appendTo:"body",containment:!1,delay:0,distance:4,revert:!1,scroll:!0,scrollSpeed:7,scrollSensitivity:10,connectToFancytree:!0,helper:function(t){var i=n.ui.fancytree.getNode(t.target);return i?i.tree.ext.dnd._onDragEvent("helper",i,null,t,null,null):"<div>ERROR?: helper requested but sourceNode not found<\/div>"},start:function(n,t){var i=t.helper.data("ftSourceNode");return!!i}},t.options.dnd.draggable));i&&i.dragDrop&&t.widget.element.droppable(n.extend({addClasses:!1,tolerance:"intersect",greedy:!1},t.options.dnd.droppable))}function s(){f||(n.ui.plugin.add("draggable","connectToFancytree",{start:function(t,i){var r=n(this).data("ui-draggable")||n(this).data("draggable"),u=i.helper.data("ftSourceNode")||null;if(u)return r.offset.click.top=-2,r.offset.click.left=16,u.tree.ext.dnd._onDragEvent("start",u,null,t,i,r)},drag:function(t,i){var s,e=n(this).data("ui-draggable")||n(this).data("draggable"),o=i.helper.data("ftSourceNode")||null,f=i.helper.data("ftTargetNode")||null,r=n.ui.fancytree.getNode(t.target);if(t.target&&!r&&(s=n(t.target).closest("div.fancytree-drag-helper,#fancytree-drop-marker").length>0,s)){u("Drag event over helper: ignored.");return}i.helper.data("ftTargetNode",r);f&&f!==r&&f.tree.ext.dnd._onDragEvent("leave",f,o,t,i,e);r&&r.tree.options.dnd.dragDrop&&(r===f?r.tree.ext.dnd._onDragEvent("over",r,o,t,i,e):r.tree.ext.dnd._onDragEvent("enter",r,o,t,i,e))},stop:function(t,i){var e=n(this).data("ui-draggable")||n(this).data("draggable"),r=i.helper.data("ftSourceNode")||null,f=i.helper.data("ftTargetNode")||null,s=t.type,o=s==="mouseup"&&t.which===1;o||u("Drag was cancelled");f&&(o&&f.tree.ext.dnd._onDragEvent("drop",f,r,t,i,e),f.tree.ext.dnd._onDragEvent("leave",f,r,t,i,e));r&&r.tree.ext.dnd._onDragEvent("stop",r,null,t,i,e)}}),f=!0)}var u=n.ui.fancytree.debug,f=!1;n.ui.fancytree.registerExtension({name:"dnd",version:"0.1.0",options:{dragStart:null,dragStop:null,autoExpandMS:1e3,preventVoidMoves:!0,preventRecursiveMoves:!0,dragEnter:null,dragOver:null,dragDrop:null,dragLeave:null,draggable:null,droppable:null},treeInit:function(n){var t=n.tree;this._super(n);o(t)},nodeKeydown:function(t){var i=t.originalEvent;return i.which===n.ui.keyCode.ESCAPE&&this._local._cancelDrag(),this._super(t)},_setDndStatus:function(t,i,r,u,f){var a,l=0,c="center",h=this._local,s=t?n(t.span):null,o=n(i.span);if(h.$dropMarker||(h.$dropMarker=n("<div id='fancytree-drop-marker'><\/div>").hide().css({"z-index":1e3}).prependTo(n(this.$div).parent())),u==="after"||u==="before"||u==="over"){switch(u){case"before":h.$dropMarker.removeClass("fancytree-drop-after fancytree-drop-over").addClass("fancytree-drop-before");c="top";break;case"after":h.$dropMarker.removeClass("fancytree-drop-before fancytree-drop-over").addClass("fancytree-drop-after");c="bottom";break;default:h.$dropMarker.removeClass("fancytree-drop-after fancytree-drop-before").addClass("fancytree-drop-over");o.addClass("fancytree-drop-target");l=8}a=n.ui.fancytree.jquerySupports.positionMyOfs?{my:"left"+e(l)+" center",at:"left "+c,of:o}:{my:"left center",at:"left "+c,of:o,offset:""+l+" 0"};h.$dropMarker.show().position(a)}else o.removeClass("fancytree-drop-target"),h.$dropMarker.hide();u==="after"?o.addClass("fancytree-drop-after"):o.removeClass("fancytree-drop-after");u==="before"?o.addClass("fancytree-drop-before"):o.removeClass("fancytree-drop-before");f===!0?(s&&s.addClass("fancytree-drop-accept"),o.addClass("fancytree-drop-accept"),r.addClass("fancytree-drop-accept")):(s&&s.removeClass("fancytree-drop-accept"),o.removeClass("fancytree-drop-accept"),r.removeClass("fancytree-drop-accept"));f===!1?(s&&s.addClass("fancytree-drop-reject"),o.addClass("fancytree-drop-reject"),r.addClass("fancytree-drop-reject")):(s&&s.removeClass("fancytree-drop-reject"),o.removeClass("fancytree-drop-reject"),r.removeClass("fancytree-drop-reject"))},_onDragEvent:function(t,i,f,e,o,s){t!=="over"&&u("tree.ext.dnd._onDragEvent(%s, %o, %o) - %o",t,i,f,this);var b,k,d,w,a,h,l,g=this.options,c=g.dnd,y=this._makeHookContext(i,e,{otherNode:f,ui:o,draggable:s}),v=null,p=n(i.span);switch(t){case"helper":b=n("<div class='fancytree-drag-helper'><span class='fancytree-drag-helper-img' /><\/div>").css({zIndex:3,position:"relative"}).append(p.find("span.fancytree-title").clone());n("ul.fancytree-container",i.tree.$div).append(b);b.data("ftSourceNode",i);v=b;break;case"start":i.isStatusNode()?v=!1:c.dragStart&&(v=c.dragStart(i,y));v===!1?(this.debug("tree.dragStart() cancelled"),o.helper.trigger("mouseup").hide()):p.addClass("fancytree-drag-source");break;case"enter":l=c.preventRecursiveMoves&&i.isDescendantOf(f)?!1:c.dragEnter?c.dragEnter(i,y):null;v=l?n.isArray(l)?{over:n.inArray("over",l)>=0,before:n.inArray("before",l)>=0,after:n.inArray("after",l)>=0}:{over:l===!0||l==="over",before:l===!0||l==="before",after:l===!0||l==="after"}:!1;o.helper.data("enterResponse",v);u("helper.enterResponse: %o",v);break;case"over":a=o.helper.data("enterResponse");h=null;a===!1||(typeof a=="string"?h=a:(k=p.offset(),d={x:e.pageX-k.left,y:e.pageY-k.top},w={x:d.x/p.width(),y:d.y/p.height()},a.after&&w.y>.75?h="after":!a.over&&a.after&&w.y>.5?h="after":a.before&&w.y<=.25?h="before":!a.over&&a.before&&w.y<=.5?h="before":a.over&&(h="over"),c.preventVoidMoves&&(i===f?(u("    drop over source node prevented"),h=null):h==="before"&&f&&i===f.getNextSibling()?(u("    drop after source node prevented"),h=null):h==="after"&&f&&i===f.getPrevSibling()?(u("    drop before source node prevented"),h=null):h==="over"&&f&&f.parent===i&&f.isLastSibling()&&(u("    drop last child over own parent prevented"),h=null)),o.helper.data("hitMode",h)));h==="over"&&c.autoExpandMS&&i.hasChildren()!==!1&&!i.expanded&&i.scheduleAction("expand",c.autoExpandMS);h&&c.dragOver&&(y.hitMode=h,v=c.dragOver(i,y));this._local._setDndStatus(f,i,o.helper,h,v!==!1&&h!==null);break;case"drop":h=o.helper.data("hitMode");h&&c.dragDrop&&(y.hitMode=h,c.dragDrop(i,y));break;case"leave":i.scheduleAction("cancel");o.helper.data("enterResponse",null);o.helper.data("hitMode",null);this._local._setDndStatus(f,i,o.helper,"out",r);c.dragLeave&&c.dragLeave(i,y);break;case"stop":p.removeClass("fancytree-drag-source");c.dragStop&&c.dragStop(i,y);break;default:n.error("Unsupported drag event: "+t)}return v},_cancelDrag:function(){var t=n.ui.ddmanager.current;t&&t.cancel()}})})(jQuery,window,document);
/*!
 * jquery.fancytree.edit.js
 *
 * Make node titles editable.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2014, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.1.0
 * @date 2014-05-29T16:44
 */
(function(n,t,i){"use strict";var r=/Mac/.test(navigator.platform),u=n.ui.fancytree.escapeHtml,f=n.ui.fancytree.unescapeHtml;n.ui.fancytree._FancytreeNodeClass.prototype.editStart=function(){var r,t=this,e=this.tree,s=e.ext.edit,h=t.title,u=e.options.edit,c=n(".fancytree-title",t.span),o={node:t,tree:e,options:e.options};if(u.beforeEdit.call(t,{type:"beforeEdit"},o)===!1)return!1;h=t.title;t.debug("editStart");e.widget._unbind();n(i).on("mousedown.fancytree-edit",function(i){n(i.target).hasClass("fancytree-edit-input")||t.editEnd(!0,i)});r=n("<input />",{"class":"fancytree-edit-input",value:f(h)});u.adjustWidthOfs!=null&&r.width(c.width()+u.adjustWidthOfs);u.inputCss!=null&&r.css(u.inputCss);o.input=r;c.html(r);n.ui.fancytree.assert(!s.currentNode,"recursive edit");s.currentNode=this;r.focus().change(function(){r.addClass("fancytree-edit-dirty")}).keydown(function(i){switch(i.which){case n.ui.keyCode.ESCAPE:t.editEnd(!1,i);break;case n.ui.keyCode.ENTER:return t.editEnd(!0,i),!1}}).blur(function(n){return t.editEnd(!0,n)});u.edit.call(t,{type:"edit"},o)};n.ui.fancytree._FancytreeNodeClass.prototype.editEnd=function(t,r){var f=this,e=this.tree,v=e.ext.edit,h=e.options.edit,y=n(".fancytree-title",f.span),o=y.find("input.fancytree-edit-input"),c=o.val(),a=o.hasClass("fancytree-edit-dirty"),l=(t||a&&t!==!1)&&c!==f.title,s={node:f,tree:e,options:e.options,originalEvent:r,dirty:a,save:l,input:o,value:c};return h.beforeClose.call(f,{type:"beforeClose"},s)===!1?!1:l&&h.save.call(f,{type:"save"},s)===!1?!1:(o.removeClass("fancytree-edit-dirty").unbind(),n(i).off(".fancytree-edit"),l?f.setTitle(u(c)):f.renderTitle(),e.widget._bind(),v.currentNode=null,f.setFocus(),n(e.$container).focus(),s.input=null,h.close.call(f,{type:"close"},s),!0)};n.ui.fancytree._FancytreeNodeClass.prototype.startEdit=function(){return this.warn("FancytreeNode.startEdit() is deprecated since 2014-01-04. Use .editStart() instead."),this.editStart.apply(this,arguments)};n.ui.fancytree._FancytreeNodeClass.prototype.endEdit=function(){return this.warn("FancytreeNode.endEdit() is deprecated since 2014-01-04. Use .editEnd() instead."),this.editEnd.apply(this,arguments)};n.ui.fancytree._FancytreeClass.prototype.isEditing=function(){return this.ext.edit.currentNode};n.ui.fancytree._FancytreeNodeClass.prototype.isEditing=function(){return this.tree.ext.edit.currentNode===this};n.ui.fancytree.registerExtension({name:"edit",version:"0.1.0",options:{adjustWidthOfs:4,inputCss:{minWidth:"3em"},triggerCancel:["esc","tab","click"],triggerStart:["f2","shift+click","mac+enter"],beforeClose:n.noop,beforeEdit:n.noop,close:n.noop,edit:n.noop,save:n.noop},currentNode:null,treeInit:function(n){this._super(n);this.$container.addClass("fancytree-ext-edit")},nodeClick:function(t){return n.inArray("shift+click",t.options.edit.triggerStart)>=0&&t.originalEvent.shiftKey?(t.node.editStart(),!1):this._super(t)},nodeDblclick:function(t){return n.inArray("dblclick",t.options.edit.triggerStart)>=0?(t.node.editStart(),!1):this._super(t)},nodeKeydown:function(t){switch(t.originalEvent.which){case 113:if(n.inArray("f2",t.options.edit.triggerStart)>=0)return t.node.editStart(),!1;break;case n.ui.keyCode.ENTER:if(n.inArray("mac+enter",t.options.edit.triggerStart)>=0&&r)return t.node.editStart(),!1}return this._super(t)}})})(jQuery,window,document);
/*!
 * jquery.fancytree.filter.js
 *
 * Remove or highlight tree nodes, based on a filter.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2014, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.1.0
 * @date 2014-05-29T16:44
 */
(function(n){"use strict";function t(n){return(n+"").replace(/([.?*+\^\$\[\]\\(){}|-])/g,"\\$1")}n.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(n,i,r){var u,f,e=0,o=this.options.filter.mode==="hide";return r=!!r&&!i,typeof n=="string"&&(u=t(n),f=new RegExp(".*"+u+".*","i"),n=function(n){return!!f.exec(n.title)}),this.enableFilter=!0,this.$div.addClass("fancytree-ext-filter"),o?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm"),this.visit(function(n){delete n.match;delete n.subMatch}),this.visit(function(t){if((!r||t.children==null)&&n(t)&&(e++,t.match=!0,t.visitParents(function(n){n.subMatch=!0}),i))return t.visit(function(n){n.match=!0}),"skip"}),this.render(),e};n.ui.fancytree._FancytreeClass.prototype.filterNodes=function(n,t){return this._applyFilterImpl(n,!1,t)};n.ui.fancytree._FancytreeClass.prototype.applyFilter=function(){return this.warn("Fancytree.applyFilter() is deprecated since 2014-05-10. Use .filterNodes() instead."),this.filterNodes.apply(this,arguments)};n.ui.fancytree._FancytreeClass.prototype.filterBranches=function(n){return this._applyFilterImpl(n,!0,null)};n.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){this.visit(function(n){delete n.match;delete n.subMatch});this.enableFilter=!1;this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide");this.render()};n.ui.fancytree.registerExtension({name:"filter",version:"0.2.0",options:{mode:"dimm"},treeInit:function(n){this._super(n)},nodeRenderStatus:function(t){var r,i=t.node,u=t.tree,f=n(i[u.statusClassPropName]);return(r=this._super(t),!f.length||!u.enableFilter)?r:(f.toggleClass("fancytree-match",!!i.match).toggleClass("fancytree-submatch",!!i.subMatch).toggleClass("fancytree-hide",!(i.match||i.subMatch)),r)}})})(jQuery,window,document);
/*!
 * jquery.fancytree.glyph.js
 *
 * Use glyph fonts as instead of icon sprites.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2014, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.1.0
 * @date 2014-05-29T16:44
 */
(function(n){"use strict";function t(n,t){return n.map[t]}n.ui.fancytree.registerExtension({name:"glyph",version:"0.1.0",options:{prefix:"icon-",extra:null,map:{doc:"icon-file-alt",docOpen:"icon-file-alt",checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt",loading:"icon-refresh icon-spin",noExpander:""},icon:null},treeInit:function(n){var t=n.tree;this._super(n);t.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(i){var f,u,r=i.node,e=i.options.glyph,o=e.map;(this._super(i),r.isRoot())||(u=n("span.fancytree-expander",r.span).get(0),u&&(f=r.isLoading()?"loading":r.expanded?"expanderOpen":r.isUndefined()?"expanderLazy":r.hasChildren()?"expanderClosed":"noExpander",u.className="fancytree-expander "+o[f]),u=n("span.fancytree-checkbox",r.tr||r.span).get(0),u&&(f=r.selected?"checkboxSelected":r.partsel?"checkboxUnknown":"checkbox",u.className="fancytree-checkbox "+o[f]),u=n("span.fancytree-icon",r.span).get(0),u&&(f=r.folder?r.expanded?t(e,"folderOpen"):t(e,"folder"):r.expanded?t(e,"docOpen"):t(e,"doc"),u.className="fancytree-icon "+f))},nodeSetStatus:function(i,r,u,f){var e,s=i.options.glyph,o=i.node;this._super(i,r,u,f);e=o.parent?n("span.fancytree-expander",o.span).get(0):n(".fancytree-statusnode-wait, .fancytree-statusnode-error",o[this.nodeContainerAttrName]).find("span.fancytree-expander").get(0);r==="loading"?e.className="fancytree-expander "+t(s,"loading"):r==="error"&&(e.className="fancytree-expander "+t(s,"error"))}})})(jQuery,window,document);
/*!
 * jquery.fancytree.gridnav.js
 *
 * Support keyboard navigation for trees with embedded input controls.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2014, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.1.0
 * @date 2014-05-29T16:44
 */
(function(n){"use strict";function r(t,i){var r,f=i.get(0),u=0;return t.children().each(function(){if(this===f)return!1;r=n(this).prop("colspan");u+=r?r:1}),u}function u(t,i){var r,u=null,f=0;return t.children().each(function(){if(f>=i)return u=n(this),!1;r=n(this).prop("colspan");f+=r?r:1}),u}function f(n,i){var f,s,o=n.closest("td"),e=null;switch(i){case t.LEFT:e=o.prev();break;case t.RIGHT:e=o.next();break;case t.UP:case t.DOWN:for(f=o.parent(),s=r(f,o);;){if(f=i===t.UP?f.prev():f.next(),!f.length)break;if(!f.is(":hidden")&&(e=u(f,s),e&&e.find(":input").length))break}}return e}var t=n.ui.keyCode,i={text:[t.UP,t.DOWN],checkbox:[t.UP,t.DOWN,t.LEFT,t.RIGHT],radiobutton:[t.UP,t.DOWN,t.LEFT,t.RIGHT],"select-one":[t.LEFT,t.RIGHT],"select-multiple":[t.LEFT,t.RIGHT]};n.ui.fancytree.registerExtension({name:"gridnav",version:"0.0.1",options:{autofocusInput:!1,handleCursorKeys:!0},treeInit:function(t){this._requireExtension("table",!0,!0);this._super(t);this.$container.addClass("fancytree-ext-gridnav");this.$container.on("focusin",function(i){var u,r=n.ui.fancytree.getNode(i.target);r&&!r.isActive()&&(u=t.tree._makeHookContext(r,i),t.tree._callHook("nodeSetActive",u,!0))})},nodeSetActive:function(t,i){var u,e=t.options.gridnav,r=t.node,o=t.originalEvent||{},f=n(o.target).is(":input");i=i!==!1;this._super(t,i);i&&(t.options.titlesTabbable?(f||(n(r.span).find("span.fancytree-title").focus(),r.setFocus()),t.tree.$container.attr("tabindex","-1")):e.autofocusInput&&!f&&(u=n(r.tr||r.span),u.find(":input:enabled:first").focus()))},nodeKeydown:function(t){var r,o,u,h=t.options.gridnav,e=t.originalEvent,s=n(e.target);return(r=s.is(":input:enabled")?s.prop("type"):null,r&&h.handleCursorKeys)?(o=i[r],o&&n.inArray(e.which,o)>=0&&(u=f(s,e.which),u&&u.length))?(u.find(":input:enabled").focus(),!1):!0:(t.tree.debug("ext-gridnav NOT HANDLED",e,r),this._super(t))}})})(jQuery,window,document);
/*!
 * jquery.fancytree.persist.js
 *
 * Persist tree status in cookiesRemove or highlight tree nodes, based on a filter.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * @depends: jquery.cookie.js
 *
 * Copyright (c) 2014, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.1.0
 * @date 2014-05-29T16:44
 */
(function(n,t,i,r){"use strict";function h(t,i){i=i||"";t||n.error("Assertion failed "+i)}function s(t,i,r,f,e){var o,l,a,h,y=!1,v=[],c=[];for(r=r||[],e=e||n.Deferred(),o=0,a=r.length;o<a;o++)l=r[o],h=t.getNodeByKey(l),h?f&&h.isUndefined()?(y=!0,t.debug("_loadLazyNodes: "+h+" is lazy: loading..."),f==="expand"?v.push(h.setExpanded()):v.push(h.load())):(t.debug("_loadLazyNodes: "+h+" already loaded."),h.setExpanded()):(c.push(l),t.debug("_loadLazyNodes: "+h+" was not yet found."));return n.when.apply(n,v).always(function(){if(y&&c.length>0)s(t,i,c,f,e);else{if(c.length)for(t.warn("_loadLazyNodes: could not load those keys: ",c),o=0,a=c.length;o<a;o++)l=r[o],i._appendKey(u,r[o],!1);e.resolve()}}),e}var e="active",u="expanded",o="focus",f="selected";n.ui.fancytree._FancytreeClass.prototype.clearCookies=function(n){var t=this.ext.persist,i=t.cookiePrefix;n=n||"active expanded focus selected";n.indexOf(e)>=0&&t._data(i+e,null);n.indexOf(u)>=0&&t._data(i+u,null);n.indexOf(o)>=0&&t._data(i+o,null);n.indexOf(f)>=0&&t._data(i+f,null)};n.ui.fancytree._FancytreeClass.prototype.getPersistData=function(){var n=this.ext.persist,i=n.cookiePrefix,r=n.cookieDelimiter,t={};return t[e]=n._data(i+e),t[u]=(n._data(i+u)||"").split(r),t[f]=(n._data(i+f)||"").split(r),t[o]=n._data(i+o),t};n.ui.fancytree.registerExtension({name:"persist",version:"0.3.0",options:{cookieDelimiter:"~",cookiePrefix:r,cookie:{raw:!1,expires:"",path:"",domain:"",secure:!1},expandLazy:!1,overrideSource:!1,store:"auto",types:"active expanded focus selected"},_data:function(t,i){var u=this._local.localStorage;if(i===r)return u?u.getItem(t):n.cookie(t);i===null?u?u.removeItem(t):n.removeCookie(t):u?u.setItem(t,i):n.cookie(t,i,this.options.persist.cookie)},_appendKey:function(t,i,r){i=""+i;var f=this._local,c=this.options.persist,e=c.cookieDelimiter,o=f.cookiePrefix+t,s=f._data(o),u=s?s.split(e):[],h=n.inArray(i,u);h>=0&&u.splice(h,1);r&&u.push(i);f._data(o,u.join(e))},treeInit:function(c){var v=c.tree,y=c.options,l=this._local,a=this.options.persist;return h(a.store==="localStore"||n.cookie,"Missing required plugin for 'persist' extension: jquery.cookie.js"),l.cookiePrefix=a.cookiePrefix||"fancytree-"+v._id+"-",l.storeActive=a.types.indexOf(e)>=0,l.storeExpanded=a.types.indexOf(u)>=0,l.storeSelected=a.types.indexOf(f)>=0,l.storeFocus=a.types.indexOf(o)>=0,l.localStorage=a.store!=="cookie"&&t.localStorage?a.store==="local"?t.localStorage:t.sessionStorage:null,v.$div.bind("fancytreeinit",function(){var h,w,p,c,t,b=n.cookie(l.cookiePrefix+o);v.debug("COOKIE "+i.cookie);h=l._data(l.cookiePrefix+u);c=h&&h.split(a.cookieDelimiter);w=l.storeExpanded?s(v,l,c,a.expandLazy?"expand":!1,null):(new n.Deferred).resolve();w.done(function(){if(l.storeSelected&&(h=l._data(l.cookiePrefix+f),h))for(c=h.split(a.cookieDelimiter),p=0;p<c.length;p++)t=v.getNodeByKey(c[p]),t?(t.selected===r||a.overrideSource&&t.selected===!1)&&(t.selected=!0,t.renderStatus()):l._appendKey(f,c[p],!1);l.storeActive&&(h=l._data(l.cookiePrefix+e),h&&(y.persist.overrideSource||!v.activeNode)&&(t=v.getNodeByKey(h),t&&t.setActive()));l.storeFocus&&b&&(t=v.getNodeByKey(b),t&&t.setFocus())})}),this._super(c)},nodeSetActive:function(n,t,i){var u,r=this._local;return t=t!==!1,u=this._super(n,t,i),r.storeActive&&r._data(r.cookiePrefix+e,this.activeNode?this.activeNode.key:null),u},nodeSetExpanded:function(n,t,i){var r,e=n.node,f=this._local;return t=t!==!1,r=this._super(n,t,i),f.storeExpanded&&f._appendKey(u,e.key,t),r},nodeSetFocus:function(n,t){var r,i=this._local;return t=t!==!1,r=this._super(n,t),t&&i.storeFocus&&i._data(i.cookiePrefix+o,this.focusNode?this.focusNode.key:null),r},nodeSetSelected:function(n,t){var i,u=n.node,r=this._local;return t=t!==!1,i=this._super(n,t),r.storeSelected&&r._appendKey(f,u.key,t),i}})})(jQuery,window,document);
/*!
 * jquery.fancytree.table.js
 *
 * Render tree as table (aka 'treegrid', 'tabletree').
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2014, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.1.0
 * @date 2014-05-29T16:44
 */
(function(n,t,i){"use strict";function r(t,i){i=i||"";t||n.error("Assertion failed "+i)}function f(n,t){n.parentNode.insertBefore(t,n.nextSibling)}function u(n,t){n.visit(function(n){var i=n.tr;return i&&(i.style.display=n.hide||!t?"none":""),n.expanded?void 0:"skip"})}function e(t){var o,f,i,e=t.parent,u=e?e.children:null;if(u&&u.length>1&&u[0]!==t)for(o=n.inArray(t,u),i=u[o-1],r(i.tr);i.children;){if(f=i.children[i.children.length-1],!f.tr)break;i=f}else i=e;return i}n.ui.fancytree.registerExtension({name:"table",version:"0.2.0",options:{checkboxColumnIdx:null,customStatus:!1,indentation:16,nodeColumnIdx:0},treeInit:function(t){var f,u,e,r=t.tree,o=r.widget.element;for(o.addClass("fancytree-container fancytree-ext-table"),r.tbody=o.find("> tbody")[0],r.columnCount=n("thead >tr >th",o).length,n(r.tbody).empty(),r.rowFragment=i.createDocumentFragment(),u=n("<tr />"),e="",t.options.aria&&(u.attr("role","row"),e=" role='gridcell'"),f=0;f<r.columnCount;f++)t.options.table.nodeColumnIdx===f?u.append("<td"+e+"><span class='fancytree-node' /><\/td>"):u.append("<td"+e+" />");r.rowFragment.appendChild(u.get(0));r.statusClassPropName="tr";r.ariaPropName="tr";this.nodeContainerAttrName="tr";this._super(t);n(r.rootNode.ul).remove();r.rootNode.ul=null;r.$container=o;this.$container.attr("tabindex",this.options.tabbable?"0":"-1");this.options.aria&&r.$container.attr("role","treegrid").attr("aria-readonly",!0)},nodeRemoveChildMarkup:function(t){var i=t.node;i.visit(function(t){t.tr&&(n(t.tr).remove(),t.tr=null)})},nodeRemoveMarkup:function(t){var i=t.node;i.tr&&(n(i.tr).remove(),i.tr=null);this.nodeRemoveChildMarkup(t)},nodeRender:function(t,i,o,s,h){var y,d,b,g,a,p,w,k,v=t.tree,c=t.node,l=t.options,nt=!c.parent;if(h||(t.hasCollapsedParents=c.parent&&!c.parent.expanded),!nt)if(c.tr)i?this.nodeRenderTitle(t):this.nodeRenderStatus(t);else{if(t.hasCollapsedParents){c.debug("nodeRender ignored due to unrendered parent");return}a=v.rowFragment.firstChild.cloneNode(!0);p=e(c);r(p);s===!0&&h?a.style.display="none":o&&t.hasCollapsedParents&&(a.style.display="none");p.tr?f(p.tr,a):(r(!p.parent,"prev. row must have a tr, or is system root"),v.tbody.appendChild(a));c.tr=a;c.key&&l.generateIds&&(c.tr.id=l.idPrefix+c.key);c.tr.ftnode=c;l.aria&&n(c.tr).attr("aria-labelledby","ftal_"+c.key);c.span=n("span.fancytree-node",c.tr).get(0);this.nodeRenderTitle(t);l.createNode&&l.createNode.call(v,{type:"createNode"},t)}if(l.renderNode&&l.renderNode.call(v,{type:"renderNode"},t),y=c.children,y&&(nt||o||c.expanded))for(b=0,g=y.length;b<g;b++)k=n.extend({},t,{node:y[b]}),k.hasCollapsedParents=k.hasCollapsedParents||!c.expanded,this.nodeRender(k,i,o,s,!0);y&&!h&&(w=c.tr||null,d=v.tbody.firstChild,c.visit(function(n){if(n.tr){if(n.parent.expanded||n.tr.style.display==="none"||(n.tr.style.display="none",u(n,!1)),n.tr.previousSibling!==w){c.debug("_fixOrder: mismatch at node: "+n);var t=w?w.nextSibling:d;v.tbody.insertBefore(n.tr,t)}w=n.tr}}))},nodeRenderTitle:function(t){var u,r=t.node,i=t.options;this._super(t);i.checkbox&&i.table.checkboxColumnIdx!=null&&(u=n("span.fancytree-checkbox",r.span).detach(),n(r.tr).find("td:first").html(u));r.isRoot()||this.nodeRenderStatus(t);!i.table.customStatus&&r.isStatusNode()||i.renderColumns&&i.renderColumns.call(t.tree,{type:"renderColumns"},t)},nodeRenderStatus:function(t){var r,i=t.node,u=t.options;this._super(t);n(i.tr).removeClass("fancytree-node");r=(i.getLevel()-1)*u.table.indentation;n(i.span).css({marginLeft:r+"px"})},nodeSetExpanded:function(t,i,r){function e(n){i=i!==!1;u(t.node,i);n?i&&t.options.autoScroll&&!r.noAnimation&&t.node.hasChildren()?t.node.getLastChild().scrollIntoView(!0,{topNode:t.node}).always(function(){r.noEvents||t.tree._triggerNodeEvent(i?"expand":"collapse",t);f.resolveWith(t.node)}):(r.noEvents||t.tree._triggerNodeEvent(i?"expand":"collapse",t),f.resolveWith(t.node)):(r.noEvents||t.tree._triggerNodeEvent(i?"expand":"collapse",t),f.rejectWith(t.node))}var f=new n.Deferred,o=n.extend({},r,{noEvents:!0,noAnimation:!0});return r=r||{},this._super(t,i,o).done(function(){e(!0)}).fail(function(){e(!1)}),f.promise()},nodeSetStatus:function(t,i,r,u){if(i==="ok"){var e=t.node,f=e.children?e.children[0]:null;f&&f.isStatusNode()&&n(f.tr).remove()}this._super(t,i,r,u)},treeClear:function(n){return this.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode)),this._super(n)}})})(jQuery,window,document);
/*!
 * jquery.fancytree.themeroller.js
 *
 * Enable jQuery UI ThemeRoller styles.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * @see http://jqueryui.com/themeroller/
 *
 * Copyright (c) 2014, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.1.0
 * @date 2014-05-29T16:44
 */
(function(n){"use strict";n.ui.fancytree.registerExtension({name:"themeroller",version:"0.0.1",options:{activeClass:"ui-state-active",foccusClass:"ui-state-focus",hoverClass:"ui-state-hover",selectedClass:"ui-state-highlight"},treeInit:function(t){this._super(t);var i=t.widget.element;i[0].nodeName==="TABLE"?(i.addClass("ui-widget ui-corner-all"),i.find(">thead tr").addClass("ui-widget-header"),i.find(">tbody").addClass("ui-widget-conent")):i.addClass("ui-widget ui-widget-content ui-corner-all");i.delegate(".fancytree-node","mouseenter mouseleave",function(t){var i=n.ui.fancytree.getNode(t.target),r=t.type==="mouseenter";i.debug("hover: "+r);n(i.span).toggleClass("ui-state-hover ui-corner-all",r)})},treeDestroy:function(n){this._super(n);n.widget.element.removeClass("ui-widget ui-widget-content ui-corner-all")},nodeRenderStatus:function(t){var i=t.node,r=n(i.span);this._super(t);r.toggleClass("ui-state-active",i.isActive());r.toggleClass("ui-state-focus",i.hasFocus());r.toggleClass("ui-state-highlight",i.isSelected())}})})(jQuery,window,document)