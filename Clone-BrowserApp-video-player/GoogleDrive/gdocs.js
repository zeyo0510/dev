"use strict";function GDocs(){var n="https://www.googleapis.com/drive/v2/";this.lastResponse=null;this.__defineGetter__("SCOPE",function(){return n});this.__defineGetter__("DOCLIST_FEED",function(){return n+"files"});this.__defineGetter__("CREATE_SESSION_URI",function(){return"https://www.googleapis.com/upload/drive/v2/files?uploadType=resumable"});this.__defineGetter__("DEFAULT_CHUNK_SIZE",function(){return 5242880})}GDocs.prototype.auth=function(n,t){try{chrome.identity.getAuthToken({interactive:n},function(n){n&&(this.accessToken=n,t&&t())}.bind(this))}catch(i){console.log(i)}};GDocs.prototype.removeCachedAuthToken=function(n){if(this.accessToken){var t=this.accessToken;this.accessToken=null;try{chrome.identity.removeCachedAuthToken({token:t},function(){n&&n()})}catch(i){console.log(i)}}else n&&n()};GDocs.prototype.revokeAuthToken=function(n){if(this.accessToken){var t=new XMLHttpRequest;t.open("GET","https://accounts.google.com/o/oauth2/revoke?token="+this.accessToken);t.send();this.xhr=t;this.removeCachedAuthToken(n)}};GDocs.prototype.makeRequest=function(n,t,i,r,u,f){var h=u||null,s=f||{},e=new XMLHttpRequest,o;e.open(n,t,!0);e.setRequestHeader("Authorization","Bearer "+this.accessToken);for(o in s)e.setRequestHeader(o,s[o]);e.onload=function(n){this.response=n.target.response;this.lastResponse=this.response;this.lastStatus=n.target.status;i(this.lastResponse,this,this.lastStatus)}.bind(this);e.onerror=function(n){this.response=n.target.response;r(this.response)};e.send(h);this.xhr=e};GDocs.prototype.getCurrentXHR=function(){return this.uploader&&this.uploader.xhr?this.uploader.xhr:this.xhr};GDocs.prototype.getItemProperties=function(n,t,i){this.makeRequest("GET",this.DOCLIST_FEED+"/"+n,t,i,null)};GDocs.prototype.queryItems=function(n,t,i,r,u){var u=u?u:100,f=this.DOCLIST_FEED+"?maxResults="+u+"&q="+encodeURIComponent(n);t&&(f=f+"&pageToken="+t);this.makeRequest("GET",f,i,r,null)};GDocs.prototype.removeFile=function(n,t,i){var r=this.DOCLIST_FEED+"/"+n;this.makeRequest("DELETE",r,t,i,null)};GDocs.prototype.getItemComments=function(n,t,i,r,u,f){var f=f?f:20,e=this.DOCLIST_FEED+"/"+n+"/comments?maxResults="+f+"&fields=items%2CnextPageToken&includeDeleted=true";t&&(e=e+"&pageToken="+t);i&&(e=e+"&updatedMin="+encodeURIComponent(i));this.makeRequest("GET",e,r,u,null)};GDocs.prototype.addItemComment=function(n,t,i,r){var u=this.DOCLIST_FEED+"/"+t+"/comments";this.makeRequest("POST",u,i,r,JSON.stringify({content:n}),{"content-type":"application/json"})};GDocs.prototype.removeItemComment=function(n,t,i,r){var u=this.DOCLIST_FEED+"/"+t+"/comments/"+n;this.makeRequest("DELETE",u,i,r,null)};GDocs.prototype.removeItemCommentReply=function(n,t,i,r,u){var f=this.DOCLIST_FEED+"/"+i+"/comments/"+t+"/replies/"+n;this.makeRequest("DELETE",f,r,u,null)};GDocs.prototype.about=function(n,t){this.makeRequest("GET",this.SCOPE+"about?includeSubscribed=false",n,t,null)};GDocs.prototype.setPermissions=function(n,t,i,r,u,f,e){var o={value:"default",type:t,role:i,withLink:r};i=="reader"&&u&&(o.additionalRoles=["commenter"]);this.makeRequest("POST",this.DOCLIST_FEED+"/"+n+"/permissions",f,e,JSON.stringify(o),{fileId:n,"content-type":"application/json"})}