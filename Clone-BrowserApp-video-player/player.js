function initAnalyticsConfig(n){gAnalyticsConfig=n}function sendEventStatistic(n,t,i,r){gAnalyticsTracker&&gAnalyticsTracker.sendEvent(n,t,i,r)}function sendNameStatistic(){}function sendGalleryStatistic(){var n=document.getElementsByClassName("gallery_item"),i,r,t,u;if(sendEventStatistic("Video","Gallery","Scan"),n){for(i=0,r=0,t=0;t<n.length;++t)n[t].getAttribute("data-error")=="true"&&++i,u=n[t].getAttribute("id"),u&&u.indexOf("-gdrive")>=0&&++r;sendEventStatistic("Gallery","Items","Total",n.length);sendEventStatistic("Gallery","Items","Error",i);sendEventStatistic("Gallery","Items","Drive",r)}}function errorPrintFactory(n){return function(t){var i="";switch(t.code){case FileError.QUOTA_EXCEEDED_ERR:i="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:i="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:i="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:i="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:i="INVALID_STATE_ERR";break;default:i="Unknown Error"}console.log(n+": "+i)}}function GalleryData(n){this._id=n;this.path="";this.sizeBytes=0;this.numFiles=0;this.numDirs=0}function createElement(n){if(n){var t=null;return n.indexOf("image")>=0?t=document.createElement("img"):n.indexOf("audio")>=0?t=document.createElement("audio"):n.indexOf("video")>=0&&(t=document.createElement("video"),n!=="video"&&t.setAttribute("type",n)),t}}function getFileType(n){var t=n.substr(n.lastIndexOf(".")+1).toLowerCase();return imgFormats.indexOf(t)>=0?"image":audFormats.indexOf(t)>=0?"audio":vidFormats.indexOf(t)>=0?"video":null}function checkBetaProgram(n,t){if(n){var i=(new Date).getTime(),r=chrome.i18n.getUILanguage?chrome.i18n.getUILanguage()=="uk":!1;betaActivated=n;betaExtended=t;chromecastMode=!0;a=betaActivated&&(r||i<n)}}function loadLastState(n){try{chrome.storage.sync.get({betaProgramExpirationDate:0,betaProgramProlongationDate:0},function(t){t&&checkBetaProgram(t.betaProgramExpirationDate,t.betaProgramProlongationDate);console.log("beta activated until = ",betaActivated," ; beta extended on = ",betaExtended," ; chromecastMode = true; a= ",chromecastMode);chrome.storage.local.get("lastApplicationState",function(t){var i=t.lastApplicationState;i!==undefined&&(console.log("loaded last state",i),i.castMode&&!window.gCastMode&&window.gCastMode!=i.castMode&&(window.gCastMode=chromecastMode&&i.castMode=="none"?"tab":chromecastMode?i.castMode:"none",updateCastButton(i.castMode)),i.shuffleMode&&window.gShuffleMode!=i.shuffleMode&&(window.gShuffleMode=i.shuffleMode,updateShuffleButton(i.shuffleMode)),i.viewMode&&window.gViewMode!=i.viewMode&&(window.gViewMode=i.viewMode,updateViewButton(i.viewMode)),i.generateThumbnails!==undefined&&(window.gGenerateThumbnails=i.generateThumbnails),i.hideUnsupported!==undefined&&(window.gHideUnsupported=i.hideUnsupported),i.showTitles!==undefined&&(window.gShowTitles=i.showTitles),i.disablePasswordProtection!==undefined&&(window.gDisablePasswordProtection=i.disablePasswordProtection),i.passwordMD5!==undefined&&(window.gPasswordMD5=i.passwordMD5));n&&n(i)})})}catch(t){}}function saveLastState(n){try{var u=0,i=null,r=null,t=window.getVideoElement();t&&(t.currentTime!==undefined&&(u=t.currentTime),t.readyState&&(r=t.readyState),i=t.volume);chrome.storage.local.get("lastApplicationState",function(t){var f=t.lastApplicationState;f||(f={});f.castMode=chromecastMode?window.gCastMode:"none";f.shuffleMode=window.gShuffleMode;f.viewMode=window.gViewMode;f.generateThumbnails=window.gGenerateThumbnails;f.hideUnsupported=window.gHideUnsupported;f.showTitles=window.gShowTitles;f.disablePasswordProtection=window.gDisablePasswordProtection;f.passwordMD5=window.gPasswordMD5;f.modified=(new Date).getTime();i!==null&&(f.volume=i);r&&(f.lastVideoFsId=window.gCurFsId,f.lastVideoFsIdPath=window.gCurPath,f.lastVideoType=window.gCurType,f.lastVideoState=r,f.lastVideoPosition=u);chrome.storage.local.set({lastApplicationState:f},function(){console.log("settings saved",f);n&&n()})})}catch(f){}}function playLastStateVideo(n){n&&n.lastVideoFsId&&n.lastVideoFsIdPath&&n.lastVideoType&&n.lastVideoState&&play(n.lastVideoFsId,n.lastVideoFsIdPath,n.lastVideoType,!1,n.lastVideoPosition,n.volume)}function clearContentDiv(){var n=window.getVideoElement();n&&(removeVideoEventListeners(n),n.src&&webkitURL&&webkitURL.revokeObjectURL(n.src),n.src=null)}function clearList(){document.getElementById("GalleryList").innerHTML=""}function fsIdIsGDrive(n){return n.indexOf!==undefined&&n.indexOf("gdrive")>=0}function getItemSrc(n,t,i){fsIdIsGDrive(n)?getMediaFileSrc(t,function(n){i&&i(n)}):getItemFileEntry(n,t,function(n){n.file(function(n){i&&webkitURL&&i(webkitURL.createObjectURL(n))})})}function play(n,t,i,r,u,f){if(n&&t){highlightGalleryElement(!1,!1);window.gCurFsId=n;window.gCurPath=t;window.gCurType=i;highlightGalleryElement(!0,!0);var e=window.getVideoElement();e&&e.removeAttribute("controls");window.pause();getItemSrc(n,t,function(n){showMediaFile(n,t,i,r,u);f!==undefined&&e&&(e.volume=f);sendEventStatistic("Video","Play",isCastMode()?"tab":"desktop")})}}function getPlayingGalleryElement(){return!window.gCurFsId||!window.gCurPath?null:document.getElementById(window.gCurPath.hashCode().toString()+"-"+window.gCurFsId)}function highlightGalleryElement(n,t){var r=getPlayingGalleryElement(),u,i;if(r)for(u=0;u<r.childNodes.length;u++)i=r.childNodes[u].className,descriptionElement=r.childNodes[u],i.indexOf("gallery_list_description")>=0||i.indexOf("gallery_item_description")>=0?(descriptionElement.style.color=n?"#ff3333":"white",descriptionElement.style["font-weight"]=n?"bold":"normal",i=="gallery_item_description"&&(r.style["background-color"]=n?"#f33":"#f00")):(i.indexOf("gallery_item_play")>=0||i.indexOf("gallery_item_loading spinner")>=0)&&t!==undefined&&(descriptionElement.className=t?"gallery_item_loading spinner":"gallery_item_play")}function getItemFileEntry(n,t,i){var u,r,f;if(n=="local"){for(r=0;r<window.gLocalFilesArray.length;r++)if(t==window.gLocalFilesArray[r].fullPath){i(window.gLocalFilesArray[r]);break}}else{for(u=null,r=0;r<gGalleryArray.length;r++)if(f=chrome.mediaGalleries.getMediaFileSystemMetadata(gGalleryArray[r]),f.galleryId==n){u=gGalleryArray[r];break}u&&u.root.getFile(t,{create:!1},i)}}function showMediaFile(n,t,i,r,u){var i=i?i:getFileType(t),f=window.getVideoElement();clearContentDiv();addVideoEventListeners(f);document.body.style.background="#000";f.autoplay=r==undefined?!0:r;f.src=n;u&&(f.position=u);r||onVideoPaused()}function addGallery(n,t,i){var r=document.createElement("div"),u,e,f;return r.className="gallery_group_wrapper",r.setAttribute("label",n),i&&r.setAttribute("type",i),u=document.createElement("div"),u.setAttribute("label",n),u.setAttribute("id",t),u.className="gallery_group",window.gViewMode=="list"&&(u.style["-webkit-column-count"]=2),i=="gdrive"&&(e=document.createElement("div"),e.className="gallery_gdrive",e.id="gallery_gdrive",e.style.display="none",r.appendChild(e)),f=document.createElement("h2"),f.className="gallery_logo",f.textContent=n,f.style.display="none",f.id="gallery_logo",r.appendChild(f),r.appendChild(u),document.getElementById("GalleryList").appendChild(r),u}function findPos(n){var t=curtop=0;if(n&&n.offsetParent)do t+=n.offsetLeft,curtop+=n.offsetTop;while(n=n.offsetParent);return[t,curtop]}function addItem(n,t){var o=n.mimeType?n.mimeType:getFileType(n.fullPath),t=t?t:gCurgalleryGroupElement,i,u,r,s,e,h,f;if(o&&n.isFile&&o.indexOf("video")>=0){if(i=document.createElement("div"),u=createElement("image"),u.src="/assets/images/no_preview.png",i.appendChild(u),r=document.createElement("div"),i.appendChild(r),window.gViewMode=="list"){function l(n){var t=document.getElementById("tooltip"),f=document.getElementById("tip-image"),i,r;t&&f&&(i=document.getElementById("list"),r=findPos(i),t.style.display="block",t.style.left=(n.clientX<r[0]+i.offsetWidth/2-5?-156:i.offsetWidth)+"px",t.style.top=n.clientY-r[1]-54+"px",f.src=u.src)}function a(){var n=document.getElementById("tooltip"),t=document.getElementById("tip-image");n&&t&&(n.style.display="none",t.src="")}i.className="gallery_item gallery_item_list";u.style.display="none";r.className="gallery_list_description";r.textContent=n.name;r.onmousemove=l;r.onmouseout=a}else i.className=isCastMode()?"gallery_item gallery_item_grid gallery_item_grid_tab":"gallery_item gallery_item_grid",u.className="gallery_item_media",r.className="gallery_item_description",r.textContent=n.name,s=document.createElement("div"),s.className="gallery_item_play",i.appendChild(s);e=t.parentElement.querySelector("#gallery_logo");h=t.parentElement.querySelector("#gallery_gdrive");e&&window.gViewMode!=="grid"&&e.innerText!="local"&&(e.style.display="block",h&&(h.style.display="block"));i.addEventListener("click",onGalleryElementClick);i.setAttribute("data-name",n.name);i.setAttribute("data-fullpath",n.fullPath);i.setAttribute("data-type",o);isCastMode()&&(i.addEventListener("mousemove",function(){showVideoCaption(n.name,2e4,24,!0)}),i.addEventListener("mouseout",function(){videoCaptionIsShown()&&showVideoCaption(null)}));addElementToGallery(i,window.gShuffleMode,t);checkForEmptyGallery();function c(n){n===null&&(i.setAttribute("data-error",!0),window.gHideUnsupported===!0?i.style.display="none":(n="/assets/images/not_supported.png",window.gViewMode=="list"&&(r.style.color="#aaa")));n&&(u.src=n)}n.isGDrive?(i.setAttribute("data-fsid",n.gdriveFolder+"-gdrive"),i.setAttribute("id",n.fullPath.hashCode().toString()+"-"+n.gdriveFolder+"-gdrive"),getThumbnail(null,n.fullPath,"gdrive",n.mimeType,function(n){c(n)})):n.isLocal?(i.setAttribute("data-fsid","local"),i.setAttribute("id",n.fullPath.hashCode().toString()+"-local"),getThumbnail(n,n.fullPath,"local",n.mimeType,function(n){c(n)})):(f=chrome.mediaGalleries.getMediaFileSystemMetadata(n.filesystem),i.setAttribute("data-fsid",f.galleryId),i.setAttribute("id",n.fullPath.hashCode().toString()+"-"+f.galleryId),getItemFileEntry(f.galleryId,n.fullPath,function(t){getThumbnail(t,n.fullPath,f.galleryId,n.mimeType,function(n){c(n)})}))}}function scanProgress(n){var i=document.getElementById("thumbnails-generation"),t;i&&(i.style.display=n?"block":"none");t=document.getElementById("progress-indicator");t&&(t.innerText=chrome.i18n.getMessage("Loading")+" "+n)}function onProgressCancel(){gStopGalleryScan=!0;pauseThumbnais()}function scanNextGallery(){if(gGalleryIndex++,!gStopGalleryScan&&gGalleryIndex<gGalleryArray.length)scanProgress(gGalleryArray[gGalleryIndex].name),scanGalleries(gGalleryArray[gGalleryIndex]);else{checkForEmptyGallery();highlightGalleryElement(!0);sortGalleries(window.gShuffleMode);scanProgress();var n=window.getVideoElement();document.getElementById("app-loading").style.display="none";(!n||n.readyState<=2||n.paused)&&showGallery()}}function scanGallery(n){var i,t;if(n.length==0){!gStopGalleryScan&&gDirectories.length>0?(i=gDirectories.shift(),scanProgress(i.fullPath),gGalleryReader=i.createReader(),gGalleryReader.readEntries(scanGallery,errorPrintFactory("readEntries"))):scanNextGallery();return}for(t=0;t<n.length;t++)n[t].isFile?(addItem(n[t]),gGalleryData[gGalleryIndex].numFiles++,function(i){n[t].getMetadata(function(n){i.sizeBytes+=n.size})}(gGalleryData[gGalleryIndex])):n[t].isDirectory?gDirectories.push(n[t]):console.log("Got something other than a file or directory.");gGalleryReader.readEntries(scanGallery,errorPrintFactory("readMoreEntries"))}function scanGalleries(n){var t=chrome.mediaGalleries.getMediaFileSystemMetadata(n);!gStopGalleryScan&&galleryIsVisible(t.galleryId)?(scanProgress(t.name),window.gViewMode!=="grid"?gCurgalleryGroupElement=addGallery(t.name,t.galleryId,"local"):(addLocalGalleryGroup(),gCurgalleryGroupElement.style.display="block"),gGalleryData[gGalleryIndex]=new GalleryData(t.galleryId),gGalleryReader=n.root.createReader(),gGalleryReader.readEntries(scanGallery,errorPrintFactory("readEntries"))):scanNextGallery()}function addLocalGalleryGroup(){if(gCurgalleryGroupElement=document.getElementById("local"),!gCurgalleryGroupElement)return gCurgalleryGroupElement=addGallery("local","local","local")}function scanLocalFiles(){var t=addLocalGalleryGroup(),n;for(t.style.display=window.gLocalFilesArray.length?"block":"none",n=0;n<window.gLocalFilesArray.length;++n)window.gLocalFilesArray[n].isFile&&addItem(window.gLocalFilesArray[n],t)}function scanGDriveFiles(){getActiveFoldersCount("gdrive")!=0&&getGoogleDriveVideoItems(null,function(n){n&&updateGDriveFoldersTree(function(){var t,u,r,i;for(hideGallery(),t=0;t<mediaFolders.length&&!gStopGalleryScan;++t)if(mediaFolders[t].active!==!1&&mediaFolders[t].checked&&mediaFolders[t].type=="gdrive"){window.gViewMode!=="grid"?gCurgalleryGroupElement=addGallery(mediaFolders[t].name,mediaFolders[t].id+"-gdrive","gdrive"):(addLocalGalleryGroup(),gCurgalleryGroupElement.style.display="block");scanProgress("GDrive\\"+mediaFolders[t].name);function f(n){if(n.parents){for(var i=0;i<n.parents.length;++i)if(parentIsSelected(n.parents[i].id,mediaFolders[t].id))return!0}else return parentIsSelected("root",mediaFolders[t].id);return!1}if(u=gCurgalleryGroupElement,!n){u.style.display="none";return}for(u.style.display="block",r=0;r<n.length&&!gStopGalleryScan;++r)i={},i.mimeType=n[r].mimeType,i.isFile="true",i.name=n[r].title,i.fullPath=n[r].id,i.gdriveFolder=mediaFolders[t].id,i.isGDrive=!0,f(n[r])&&addItem(i,u);highlightGalleryElement(!0)}showGallery()})})}function galleryIsEmpty(){var n=document.getElementsByClassName("gallery_item");return n&&n.length>0?!1:!0}function checkForEmptyGallery(){var n=document.getElementById("no-videos-callout");n&&(galleryIsEmpty()?(getActiveFoldersCount("gdrive")==0,setTimeout(function(){n.style.display="block";n.style.opacity=1},200)):n.style.display="none")}function getGalleriesInfo(n){gGalleryArray=n;gGalleryIndex=0;gStopGalleryScan=!1;clearList();clearThumbnaisQueue();scanLocalFiles();scanGDriveFiles();hideGallery();gGalleryArray.length>0?scanGalleries(gGalleryArray[0]):checkForEmptyGallery()}function sortGalleries(){var n=document.getElementById("GalleryList"),t,i,r,u;if(n)for(t=0,i=0;t<n.childNodes.length;++t)r=n.childNodes[i],u=r.getAttribute("type"),u=="gdrive"?n.appendChild(r):++i}function sortGallery(n){var u,r,t,i,f,e;switch(n){case"none":for(u=document.getElementsByClassName("gallery_group"),r=0;r<u.length;++r)for(t=u[r],i=1;i<t.childNodes.length;++i)addElementToGallery(t.childNodes[i],n,t,i);break;case"shuffle all":case"shuffle":for(u=document.getElementsByClassName("gallery_group"),r=0;r<u.length;r++)if(t=u[r],t&&t.childNodes&&t.childNodes.length)for(i=t.childNodes.length;i>=0;--i)f=Math.random()*i|0,e=t.childNodes[f],t.appendChild(e)}}function addElementToGallery(n,t,i,r){var s,f,e,u,o;i||(i=gCurgalleryGroupElement);r||(r=i.childNodes.length);switch(t){case"shuffle all":case"shuffle":i.insertBefore(n,e);s=Math.random()*r|0;i.insertBefore(n,i.childNodes[s]);break;case"none":default:for(f=n.getAttribute("data-name"),e=i.childNodes[r],u=0;u<r;++u){if(o=i.childNodes[u].getAttribute("data-name"),f==o)return;if(f&&o&&f.toLowerCase()<o.toLowerCase()){e=i.childNodes[u];break}}i.insertBefore(n,e)}}function updateShuffleButton(){var n=document.getElementById("shuffle-button");if(n&&n.style)switch(window.gShuffleMode){case"shuffle":case"shuffle all":n.style.background="url(./assets/buttons/shuffle.png) no-repeat";n.title=chrome.i18n.getMessage("shuffleModeOn");break;case"none":default:n.style.background="url(./assets/buttons/repeat.png) no-repeat";n.title=chrome.i18n.getMessage("shuffleModeOff")}}function updateCastButton(){var n=document.getElementById("cast-button");if(n&&n.style)switch(window.gCastMode){case"desktop":n.style.background="url(./assets/buttons/cast-off.png) no-repeat";n.title=chrome.i18n.getMessage("castModeOff");break;case"tab":n.style.background="url(./assets/buttons/cast-on.png) no-repeat";n.title=chrome.i18n.getMessage("castModeOn");break;case"none":default:n.style.background="url(./assets/buttons/chromecast.png) no-repeat";n.title=chrome.i18n.getMessage("getChromecast")}}function updateViewButton(){var n=document.getElementById("view-button");if(n&&n.style)switch(window.gViewMode){case"list":n.style.background="url(./assets/buttons/list.png) no-repeat";n.title=chrome.i18n.getMessage("viewModeList");break;case"grid":n.style.background="url(./assets/buttons/grid.png) no-repeat";n.title=chrome.i18n.getMessage("viewModeGrid");break;case"grid-list":default:n.style.background="url(./assets/buttons/grid-list.png) no-repeat";n.title=chrome.i18n.getMessage("viewModeHybrid")}}function saveCurrentVideoState(){var i=getPlayingGalleryElement(),n=window.getVideoElement(),t,r;i&&n&&n.currentTime&&n.duration&&(t=n.getAttribute("data-position"),(!t||n.currentTime>t+5)&&(r=n.currentTime<Math.min(n.duration-10,n.duration*.9)?n.currentTime:0,i.setAttribute("data-position",r)));saveLastState()}function galleryIsShown(){var n=document.getElementById("gallery");return n&&n.style.display!=="none"}function scrollGallery(n){var i=isCastMode()?112:108,t;galleryIsShown()&&(t=document.getElementById("GalleryList"),t&&($(t).stop(!0,!0),$(t).animate({scrollTop:t.scrollTop+(i+9)*n},300)))}function videoCaptionIsShown(){var n=document.getElementById("caption-wrapper"),t=n&&n.clientTop>=0&&n.style.visibility!="hidden";return console.log("caption:",t),t}function showVideoCaption(n,t,i,r){if(window.gShowTitles!=!1){gCaptionTimeout!==null&&(clearTimeout(gCaptionTimeout),gCaptionTimeout=null);var u=document.getElementById("caption-wrapper"),f=document.getElementById("caption"),e=document.getElementById("content");u&&f&&e&&(n?(r?(u.style.left="0px",u.style.width="100%",u.style.paddingLeft="",f.style.textAlign="center"):(u.style.left="-15px",u.style.width="",u.style.paddingLeft="60px",f.style.textAlign="left",isCastMode()&&(u.style.left=e.offsetLeft-15+"px")),i!==undefined&&(f.style.fontSize=i.toString()+"px"),f.innerText=n,u.style.top="0px"):u.style.top="-"+u.clientHeight+"px");gCaptionTimeout=setTimeout(function(){var n=document.getElementById("caption-wrapper");n&&(n.style.top="-"+n.clientHeight+"px")},t)}}function onGalleryElementClick(n){var t;if(n.currentTarget)if(n.preventDefault(),n.stopPropagation(),t=window.getVideoElement(),n.currentTarget==getPlayingGalleryElement()&&t)try{t.play()}catch(n){onVideoError()}else{saveCurrentVideoState();document.getElementById("content").style.background="";var i=n.currentTarget.getAttribute("data-fsid"),r=n.currentTarget.getAttribute("data-fullpath"),u=n.currentTarget.getAttribute("data-name"),f=n.currentTarget.getAttribute("data-type"),e=n.currentTarget.getAttribute("data-position");play(i,r,f,!0,e);sendNameStatistic(u)}}function onVideoPlay(){video_content.src&&hideGallery();isCastMode()&&(document.getElementById("video_content").style.display="block");document.getElementById("app-loading").style.display="none"}function showGallery(){var n=window.getVideoElement(),t;n&&!n.paused&&n.ended&&n.error||(gShowGalleryTimeout&&(clearTimeout(gShowGalleryTimeout),gShowGalleryTimeout=null),scanProgress(null),document.getElementById("app-loading").style.display="none",t=window.__interactive||window.gLocalFilesArray.length>1,t&&(document.getElementById("gallery").style.display="block",document.getElementById("gallery").style.opacity=1,document.getElementById("video_content").style.opacity=.4,isCastMode()?(document.getElementById("video_content").style.display="none",$("video").hideVideoControls(),document.getElementById("content").style.background="#222",document.documentElement.style.background="#222"):document.getElementById("content").style.background="radial-gradient(#fff 0%, #ddd 50%, #000 95%, #000 100%)"),showMouse("show"),showVideoCaption(null),resumeThumbnais())}function onVideoPaused(){highlightGalleryElement(!0,!1);gShowGalleryTimeout||(gShowGalleryTimeout=setTimeout(function(){showGallery()},10));saveCurrentVideoState()}function hideGallery(){gShowGalleryTimeout&&(clearTimeout(gShowGalleryTimeout),gShowGalleryTimeout=null);document.getElementById("app-loading").style.display="block";document.getElementById("gallery").style.display="none";document.getElementById("gallery").style.opacity=0;document.getElementById("content").style.background="";document.getElementById("video_content").style.opacity=1;document.getElementById("video_content").style.display="block";document.documentElement.style.background="#000";showMouse("hide");pauseThumbnais()}function onVideoEnded(){hideGallery();galleryIsEmpty()||window.navigate("next");saveCurrentVideoState()}function onVideoClick(n){if(!isCastMode()&&(n.controlsArea||n.offsetY+45>n.target.clientHeight)||n.target.id!=="video_content"&&n.target.id!=="content"&&n.target.id!=="list"&&n.target.id!=="GalleryList"&&n.target.className!=="gallery_group"&&n.target.tagName!=="HTML"){n.controlsArea=!0;return}var t=window.getVideoElement();if(t)if(n.preventDefault(),n.stopPropagation(),n.button==1)isCastMode()||(document.webkitFullscreenElement?document.webkitExitFullscreen():t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT));else if(t.paused&&!t.error)try{t.play();onVideoPlay()}catch(n){onVideoError()}else t.pause(),onVideoPaused()}function onVideoLoaded(){var n=window.getVideoElement(),t;if(n){if(t=n.position,n.position=null,t&&t<n.duration){console.log("seek to position",t);function i(){onWindowResize();n.removeEventListener("seeking",i,!1);n.addEventListener("seeking",onVideoStartSeeking,!1)}n.removeEventListener("seeking",onVideoStartSeeking,!1);n.addEventListener("seeking",i,!1);n.currentTime=t}else onWindowResize();isCastMode()&&$("video").initVideoControls();setTimeout(function(){isCastMode()||n.setAttribute("controls","controls");highlightGalleryElement(!0,!1)},400)}}function onVideoError(n){if(console.log("Video playing error",n),n&&n.target&&n.target.src&&n.target.src.indexOf("https://")>=0){console.log("Retry");n.target.removeEventListener("error",onVideoError,!1);n.target.addEventListener("error",onVideoPaused,!1);var t=n.target.src;n.target.src="";setTimeout(function(){n.target.src=t},1e3)}else onVideoPaused(n)}function zeroPad(n,t){var i=String(t).length-String(n).length+1;return i>0?new Array(i).join("0")+n:n}function onVideoStartSeeking(){var n,t,i,r,u;hideGallery();onVideoPlay();n=window.getVideoElement();n&&(t=n.currentTime,(t!==null||t!==undefined)&&(i=Math.floor(t/3600)),r=Math.floor((t-i*3600)/60),u=Math.floor(t-i*3600-r*60),n.duration&&n.duration>0&&showVideoCaption(chrome.i18n.getMessage("time")+": "+i+":"+zeroPad(r,10)+":"+zeroPad(u,10)+"  ("+Math.round(n.currentTime/n.duration*100)+"%)",3e3,38))}function onVideoVolumeChange(){var n=window.getVideoElement();n&&showVideoCaption(chrome.i18n.getMessage("volume")+": "+Math.round(n.volume*100).toString()+"%",3e3,38)}function onVideoSpeedChange(){var n=window.getVideoElement();n&&showVideoCaption(chrome.i18n.getMessage("speed")+": "+Math.round(n.playbackRate*100).toString()+"%",3e3,38)}function onKeyDown(n){console.log("key down",n.keyCode);n.preventDefault();n.stopPropagation();var t=window.getVideoElement();switch(n.keyCode){case 13:case 70:isCastMode()||(document.webkitFullscreenElement?document.webkitExitFullscreen():t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT));break;case 32:case 27:if(t)if(t.paused&&!t.error)try{t.play();onVideoPlay()}catch(n){onVideoError()}else t.pause(),onVideoPaused();break;case 33:case 166:galleryIsShown()?scrollGallery(-4):window.navigate("previous");break;case 34:case 167:galleryIsShown()?scrollGallery(4):window.navigate("next");break;case 37:galleryIsShown()?scrollGallery(-4):t&&(t.currentTime=Math.max(0,t.currentTime-(n.shiftKey?30:5)));break;case 39:galleryIsShown()?scrollGallery(4):t&&(t.currentTime=Math.min(t.duration,t.currentTime+(n.shiftKey?30:5)));break;case 38:galleryIsShown()?scrollGallery(-2):t.volume=Math.min(t.volume+.1,1);break;case 40:galleryIsShown()?scrollGallery(2):t.volume=Math.max(t.volume-.1,0);break;case 106:n.shiftKey||n.altKey||n.ctrlKey||!t||(t.playbackRate=1);break;case 107:case 187:n.shiftKey||n.altKey||n.ctrlKey||!t||(t.playbackRate+=.2);break;case 221:n.shiftKey||n.altKey||n.ctrlKey||!t||(t.playbackRate+=.05);break;case 109:case 189:!n.shiftKey&&!n.altKey&&!n.ctrlKey&&t&&t.playbackRate>.2&&(t.playbackRate-=.2);break;case 219:!n.shiftKey&&!n.altKey&&!n.ctrlKey&&t&&t.playbackRate>.05&&(t.playbackRate-=.05)}}function onDrop(n){var i,u,r,t;for(n.stopPropagation(),n.preventDefault(),clearContentDiv(),i=0,u=n.dataTransfer,r=0;r<u.items.length;r++)t=u.items[r],t.kind=="file"&&t.webkitGetAsEntry()&&(fileEntry=t.webkitGetAsEntry(),window.addLocalFileEntry(fileEntry,t.type),++i);i>0&&window.playLocalFile(!1,i)}function onShuffleClick(){var n=document.getElementById("shuffle-button");if(n&&n.style){switch(window.gShuffleMode){case"shuffle":case"shuffle all":window.gShuffleMode="none";break;case"none":default:window.gShuffleMode="shuffle"}updateShuffleButton();sortGallery(window.gShuffleMode)}}function onViewClick(){var n=document.getElementById("view-button");if(n&&n.style){switch(window.gViewMode){case"list":window.gViewMode="grid";break;case"grid":window.gViewMode="grid-list";break;case"grid-list":default:window.gViewMode="list"}updateViewButton();getGalleriesInfo(gGalleryArray)}}function showMouse(n){var t,i;if(n=="temp"){if(gMouseShown=="show"&&gMouseMoveTimeout)return}else gMouseShown=n;gMouseMoveTimeout!==null&&(clearTimeout(gMouseMoveTimeout),gMouseMoveTimeout=null);t=window.getVideoElement();isCastMode()&&t.style.cursor!="none"&&(t.style.cursor="none");(n=="temp"||n=="hide")&&(gMouseMoveTimeout=setTimeout(function(){var n,t;gMouseMoveTimeout=null;n=window.getVideoElement();n&&!n.paused&&(isCastMode()?($("video").hideVideoControls(),t=document.getElementById("mouse-cursor"),t&&(t.style.display="none")):n.style.cursor="none")},3e3));(n=="temp"||n=="show")&&(isCastMode()?(galleryIsShown()||$("video").showVideoControls(),i=document.getElementById("mouse-cursor"),i&&(i.style.display="block")):t&&t.style.cursor!=="default"&&(t.style.cursor="default"))}function onMouseMove(n){n.target&&n.target.id=="video_content"?showMouse("temp"):showMouse("show")}function onArtificialMouseMove(n){var t=document.getElementById("mouse-cursor");t&&(t.style.visibility="visible",t.style.left=n.clientX+"px",t.style.top=n.clientY-2+"px")}function onArtificialMouseOut(){var n=document.getElementById("mouse-cursor");n&&(n.style.visibility="hidden")}function onMouseWheel(n){if(galleryIsShown()){n.preventDefault();n.stopPropagation();var t=document.getElementById("GalleryList");t&&($(t).stop(!0,!0),$(t).animate({scrollTop:t.scrollTop+-n.wheelDeltaY},100))}else video_content.volume=Math.max(Math.min(video_content.volume+n.wheelDeltaY/560,1),0)}function addVideoEventListeners(n){n.addEventListener("play",onVideoPlay,!1);n.addEventListener("pause",onVideoPaused,!1);n.addEventListener("ended",onVideoEnded,!1);n.addEventListener("error",onVideoError,!1);n.addEventListener("click",onVideoClick,!1);n.addEventListener("touchstart",onVideoClick,!1);document.getElementById("content").addEventListener("mousemove",onMouseMove,!1);n.addEventListener("keydown",onKeyDown,!1);n.addEventListener("canplay",onVideoLoaded,!1);n.addEventListener("seeking",onVideoStartSeeking,!1);n.addEventListener("volumechange",onVideoVolumeChange,!1);n.addEventListener("ratechange",onVideoSpeedChange,!1)}function removeVideoEventListeners(n){n.removeEventListener("play",onVideoPlay,!1);n.removeEventListener("pause",onVideoPaused,!1);n.removeEventListener("ended",onVideoEnded,!1);n.removeEventListener("error",onVideoError,!1);n.removeEventListener("click",onVideoClick,!1);n.removeEventListener("touchstart",onVideoClick,!1);document.getElementById("content").removeEventListener("mousemove",onMouseMove,!1);n.removeEventListener("keydown",onKeyDown,!1);n.removeEventListener("canplay",onVideoLoaded,!1);n.removeEventListener("volumechange",onVideoVolumeChange,!1);n.removeEventListener("ratechange",onVideoSpeedChange,!1)}function isCastMode(){return window.gCastMode=="tab"||window.gCastMode==undefined}function configureMainButtons(){!window.gPasswordMD5||window.gDisablePasswordProtection?(document.getElementById("shuffle-button").style.visibility="visible",document.getElementById("view-button").style.visibility="visible",document.getElementById("cast-button").style.visibility="visible"):(document.getElementById("shuffle-button").style.visibility="hidden",document.getElementById("view-button").style.visibility="hidden",document.getElementById("cast-button").style.visibility="hidden")}var gAliveTiming,gStatisticsInterval,gCaptionTimeout,onWindowClose,gShowGalleryTimeout,onFullScreen,onWindowResize,gMouseMoveTimeout,gMouseShown;self.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}};var gGalleryIndex=0,gGalleryReader=null,gStopGalleryScan=!1,gDirectories=[],gGalleryArray=[],gGalleryData=[],gCurOptGrp=null,imgFormats=["png","bmp","jpeg","jpg","gif","png","svg","xbm","webp"],audFormats=["wav","mp3"],vidFormats=["3gp","3gpp","avi","flv","mov","mpeg","mpeg4","mp4","ogg","webm","wmv","m4v","mkv","ogv"];window.gShuffleMode="none";window.gViewMode="grid-list";window.gCurFsId=null;window.gCurPath=null;window.gCurType=null;window.gGenerateThumbnails=!0;window.gHideUnsupported=!1;window.gShowTitles=!0;window.gDisablePasswordProtection=!1;window.gPasswordMD5="";chromecastMode=!0;a=!1;betaActivated=!1;betaExtended=!1;var gAnalyticsService=analytics.getService("VideoPlayer"),gAnalyticsTracker=gAnalyticsService.getTracker("UA-52966819-3"),gAnalyticsConfig=null;gAnalyticsService.getConfig().addCallback(initAnalyticsConfig);gAnalyticsTracker.sendAppView("VideoPlayer");gAliveTiming=gAnalyticsTracker.startTiming("VideoPlayer","Alive");gStatisticsInterval=setInterval(function(){for(var t=0,n=0;n<thumbnailQueue.length;++n)(window.gGenerateThumbnails||n!=1)&&(t+=thumbnailQueue[n].length);t==0&&(clearInterval(gStatisticsInterval),sendGalleryStatistic())},5e3);window.addLocalFileEntry=function(n,t){if(n&&n.isFile){for(var i=0;i<window.gLocalFilesArray.length;++i)if(window.gLocalFilesArray[i].fullPath==n.fullPath)return;n.isLocal=!0;n.mimeType=t;window.gLocalFilesArray.push(n);addLocalGalleryGroup();gCurgalleryGroupElement.style.display="block";addItem(n);checkForEmptyGallery()}};window.playLocalFile=function(n,t){if(window.gLocalFilesArray.length!=0){var i=t&&t<window.gLocalFilesArray.length?window.gLocalFilesArray.length-t:0;play("local",window.gLocalFilesArray[i].fullPath,window.gLocalFilesArray[i].mimeType,n)}};window.refreshLocalFiles=function(){if(gLocalFilesArray.length>0){addLocalGalleryGroup();for(var n=0;n<gLocalFilesArray.length;++n)addItem(gLocalFilesArray[n]);gCurgalleryGroupElement.style.display="block";checkForEmptyGallery()}};window.getVideoElement=function(){return document.getElementById("video_content")};gCaptionTimeout=null;window.navigate=function(n){var f=getPlayingGalleryElement(),e,o,s,u,i,t,r;if(!f)return onVideoPaused(),!1;for(u=window.getVideoElement(),i=document.getElementsByClassName("gallery_item"),t=0;t<i.length;t++)if(i[t]==f)if(r=n=="next"?i[t<i.length-1?t+1:0]:i[t>0?t-1:i.length-1],e=r.getAttribute("data-fsid"),o=r.getAttribute("data-fullpath"),name=r.getAttribute("data-name"),s=r.getAttribute("data-type"),error=r.getAttribute("data-error"),error)f=r;else{showVideoCaption(name,7e3,24);u&&(saveCurrentVideoState(),u.removeEventListener("pause",onVideoPaused,!1),u.removeEventListener("ended",onVideoEnded,!1));play(e,o,s,!0);sendNameStatistic(name);break}};window.pause=function(){var n=window.getVideoElement();n&&n.pause()};onWindowClose=function(){gAliveTiming&&gAliveTiming.send()};window.onload=function(){window.onclosed=onWindowClose};gShowGalleryTimeout=null;onFullScreen=function(){console.log("going into fullscreen",document.webkitFullscreenElement,document.webkitFullscreenEnabled);document.webkitFullscreenElement?onWindowResize():window.show()};onWindowResize=function(){var t=window.innerWidth,i=window.innerHeight,s=t/i,n=document.getElementById("content"),u=window.getVideoElement(),e;if(n&&u){var h=u.videoWidth,c=u.videoHeight,r=h/c;s>r?(n.style.width=Math.min(t,Math.floor(i*r))+"px",n.style.height=i+"px",n.style.top="0px",n.style.left=Math.floor((t-i*r)/2)+"px"):(n.style.width=t+"px",n.style.height=Math.min(i,Math.floor(t/r))+"px",n.style.top=Math.floor((i-t/r)/2)+"px",n.style.left="0px")}var o=isCastMode()?166:162,f=document.getElementById("gallery"),l=isCastMode()?.8:.7;f&&(e=Math.max(1,Math.floor(t*l/o))*o+35,f.style.width=e+"px",f.style.left=Math.floor((t-e)/2)+"px")};onCastClick=function(){var n=document.getElementById("shuffle-button");if(n&&n.style){switch(window.gCastMode){case"tab":window.gCastMode="desktop";saveLastState(function(){chrome.runtime.sendMessage({message:"switch_desktop"},function(n){n.farewell=="close"&&window.close()})});break;case"desktop":window.gCastMode="tab";saveLastState(function(){chrome.runtime.sendMessage({message:"switch_tab"},function(n){n.farewell=="close"&&window.close()})});break;case"none":default:activateChromecastBeta()}updateCastButton()}};gMouseMoveTimeout=null;gMouseShown="show";window.initCastMode=function(){var n,t;updateCastButton();console.log("cast mode",window.gCastMode);isCastMode()&&(n=document.createElement("link"),n.href="controls/controls.css",n.rel="stylesheet",document.documentElement.appendChild(n),$("video").initVideoPlayer(),t=document.getElementById("mouse-cursor"),t&&(t.style.display="block",document.documentElement.addEventListener("mousemove",onArtificialMouseMove,!1),document.documentElement.addEventListener("mouseout",onArtificialMouseOut,!1),document.documentElement.style.cursor="none",document.body.style.cursor="none"),document.getElementById("gallery").style.height="80%",openCastWindow(function(){window.gCastMode="desktop";saveLastState(function(){chrome.runtime.sendMessage({message:"switch_desktop"},function(n){n.farewell=="close"&&window.close()})})}))};window.addEventListener("load",function(){var n,i,t;window.gLocalFilesArray===undefined&&(window.gLocalFilesArray=[]);document.addEventListener("click",onVideoClick,!1);window.addEventListener("resize",onWindowResize,!1);window.addEventListener("keydown",onKeyDown,!1);document.addEventListener("drop",onDrop,!1);document.addEventListener("dragover",function(n){n.preventDefault()},!1);document.addEventListener("mousewheel",onMouseWheel,!1);window.onresize=onWindowResize;window.onFullScreen=onFullScreen;window.onMaximized=onWindowResize;window.onMinimized=pause;window.wizardDialog=new modalWizard(document.getElementById("modal-dialog"));n=createElement("video");n.id="video_content";i=document.getElementById("content");i.appendChild(n);document.getElementById("configure-button").title=chrome.i18n.getMessage("selectMediaFolders");document.getElementById("help-button").title=chrome.i18n.getMessage("help");document.getElementById("shuffle-button").title=chrome.i18n.getMessage("shuffleModeOff");document.getElementById("view-button").title=chrome.i18n.getMessage("viewModeHybrid");document.getElementById("progress-cancel").addEventListener("click",onProgressCancel,!1);window.lastState=null;window.initCastMode();setTimeout(function(){window.refreshLocalFiles();loadLastState(function(n){window.lastState=n;configureMainButtons();var t=window.__interactive||window.gLocalFilesArray.length>1;t?loadMediaFolders(function(){updateMediaFolders(function(n){n&&getActiveFoldersCount()!=0?(getGalleriesInfo(n),setTimeout(function(){playLastStateVideo(window.lastState);document.getElementById("app-loading").style.display="none";document.getElementById("gallery").style.display="block"},200)):(document.getElementById("app-loading").style.display="none",showSelectFoldersDialog(),document.getElementById("gallery").style.display="block")})}):playLocalFile(!0)})},10);document.getElementById("configure-button").addEventListener("click",function(){showSelectFoldersDialog()});document.getElementById("help-button").addEventListener("click",function(){showHelpDialog()});document.getElementById("scan-button").addEventListener("click",function(){chrome.mediaGalleries.getMediaFileSystems({interactive:"if_needed"},getGalleriesInfo)});t=document.getElementById("cast-button");t&&t.addEventListener("click",onCastClick);document.getElementById("shuffle-button").addEventListener("click",onShuffleClick);document.getElementById("view-button").addEventListener("click",onViewClick);onWindowResize()});window.addEventListener("message",function(n){console.info("player received message: "+n.data.message);switch(n.data.message){case"new_window":window.focus()}})