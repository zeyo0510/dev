T.GroupOperation=function(){T.OperationBase.call(this,editor,notifications);this.customGroup=null};T.GroupOperation.prototype=Object.create(T.OperationBase.prototype);T.GroupOperation.prototype.filterObject=function(b){return b&&!b.dummy&&!(b instanceof T.Light)};
T.GroupOperation.prototype.preOperateAll=function(b,a){this.groupMatrixWorldInverse=new T.Matrix4;this.customGroup?(this.group=this.customGroup,this.parent=this.customGroup.parent):(this.group=new T.Object3D,this.group.name="Group",this.parent=T.GeometryUtils.findCommonParent(a));this.parent||(this.parent=b.scene);globalBB=new T.Box3;for(var c=0;c<a.length;++c)void 0!==a[c].parent&&globalBB.union(T.GeometryUtils.computeGlobalBoundingBox(a[c]));this.parent.updateMatrixWorld();globalBB.empty()||(this.group.position=
this.parent.worldToLocal(globalBB.center()),this.group.updateMatrix());this.group.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.group.matrix);this.groupMatrixWorldInverse.getInverse(this.group.matrixWorld)};
T.GroupOperation.prototype.preOperate=function(b,a){void 0!==a.parent&&(a.updateMatrixWorld(),a.matrix.multiplyMatrices(this.groupMatrixWorldInverse,a.matrixWorld),a.position.setFromMatrixPosition(a.matrix),a.rotation.setFromRotationMatrix(a.matrix),a.scale.setFromMatrixScale(a.matrix),this.group.add(a))};T.GroupOperation.prototype.postOperateObject=function(b,a){return a};
T.GroupOperation.prototype.postOperateAll=function(b,a){if(0<this.group.children.length){b.unmark(a);var c=b.history.isRecording;b.history.isRecording=!1;b.addObject(this.group,this.parent);b.history.isRecording=c;b.select(this.group);T.SceneUtils.updateBadEdges(this.group,!0,!0)}return[this.group]};T.UngroupOperation=function(){T.OperationBase.call(this,editor,notifications)};T.UngroupOperation.prototype=Object.create(T.OperationBase.prototype);
T.UngroupOperation.prototype.filterObject=function(b){return b&&!b.dummy&&!(b instanceof T.Light)};T.UngroupOperation.prototype.postOperateObject=function(b,a){return a};T.UngroupOperation.prototype.postOperateAll=function(b,a){for(var c=[],f=0;f<a.length;++f){var d=a[f];if(d&&d.parent){for(;0<d.children.length;){var e=d.children[0];e.applyMatrix(d.matrix);d.parent.add(e);c.push(e)}d.geometry?c.push(d):(e=b.history.isRecording,b.history.isRecording=!1,b.removeObject(d),b.history.isRecording=e)}}return c};
