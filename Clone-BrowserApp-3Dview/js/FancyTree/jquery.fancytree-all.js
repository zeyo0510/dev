(function(d,B,t,v){function m(a){d.error("Not implemented: "+(a||""))}function p(a,e){a||d.error("Assertion failed"+(e?": "+e:""))}function f(a,e){var h,w,d=B.console?B.console[a]:null;if(d)if(d.apply)d.apply(B.console,e);else{w="";for(h=0;h<e.length;h++)w+=e[h];d(w)}}function g(a,e,h,w){var b,c,z,l=d.map(d.trim(a).split("."),function(a){return parseInt(a,10)}),f=d.map(Array.prototype.slice.call(arguments,1),function(a){return parseInt(a,10)});for(b=0;b<f.length;b++)if(c=l[b]||0,z=f[b]||0,c!==z)return c>
z;return!0}function b(a,e,h,w,d){return function(){var h=e[a],b=w[a],c=e.ext[d],l=function(){return h.apply(e,arguments)};return function(){var a=e._local,h=e._super;try{return e._local=c,e._super=l,b.apply(e,arguments)}finally{e._local=a,e._super=h}}}()}function c(a,e){return a===v?d.Deferred(function(){this.resolve()}).promise():d.Deferred(function(){this.resolveWith(a,e)}).promise()}function l(a,e){return a===v?d.Deferred(function(){this.reject()}).promise():d.Deferred(function(){this.rejectWith(a,
e)}).promise()}function y(a,e){return function(){a.resolveWith(e)}}function k(a){a=d.extend({},a.data());var e=a.json;delete a.fancytree;e&&(delete a.json,a=d.extend(a,e));return a}function n(a){a=a.toLowerCase();return function(e){return 0<=e.title.toLowerCase().indexOf(a)}}function u(a,e){var h,w,b;this.parent=a;this.tree=a.tree;this.statusNodeType=this.li=this.ul=null;this._isLoading=!1;this._error=null;this.data={};h=0;for(w=E.length;h<w;h++)b=E[h],this[b]=e[b];e.data&&d.extend(this.data,e.data);
for(b in e)G[b]||d.isFunction(e[b])||H[b]||(this.data[b]=e[b]);null==this.key?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),p(this.key,"defaultKey() must return a unique key")):this.key="_"+F._nextNodeKey++:this.key=""+this.key;e.active&&(p(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this);e.selected&&(this.tree.lastSelectedNode=this);this.children=null;(h=e.children)&&h.length&&this._setChildren(h);this.tree._callHook("treeRegisterNode",
this.tree,!0,this)}function r(a){this.widget=a;this.$div=a.element;(this.options=a.options)&&d.isFunction(this.options.lazyload)&&!d.isFunction(this.options.lazyLoad)&&(this.options.lazyLoad=function(){F.warn("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead.");a.options.lazyload.apply(this,arguments)});this.ext={};this.data=k(this.$div);this._id=d.ui.fancytree._nextId++;this._ns=".fancytree-"+this._id;this.systemFocusElement=this.lastSelectedNode=this._hasFocus=
this.focusNode=this.activeNode=null;this.statusClassPropName="span";this.nodeContainerAttrName=this.ariaPropName="li";this.$div.find(">ul.fancytree-container").remove();var e;this.rootNode=new u({tree:this},{title:"root",key:"root_"+this._id,children:null,expanded:!0});this.rootNode.parent=null;this.$container=e=d("<ul>",{"class":"ui-fancytree fancytree-container"}).appendTo(this.$div);this.rootNode.ul=e[0];null==this.options.debugLevel&&(this.options.debugLevel=F.debugLevel);this.$container.attr("tabindex",
this.options.tabbable?"0":"-1");this.options.aria&&this.$container.attr("role","tree").attr("aria-multiselectable",!0)}if(d.ui.fancytree&&d.ui.fancytree.version)d.ui.fancytree.warn("Fancytree: ignored duplicate include");else{var x,F=null,C={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},D="active expanded focus folder hideCheckbox lazy selected unselectable".split(" "),A={},E="expanded extraClasses folder hideCheckbox key lazy refKey selected title tooltip unselectable".split(" "),
G={},H={active:!0,children:!0,data:!0,focus:!0};for(x=0;x<D.length;x++)A[D[x]]=!0;for(x=0;x<E.length;x++)G[E[x]]=!0;u.prototype={_findDirectChild:function(a){var e,h,w=this.children;if(w)if("string"===typeof a)for(e=0,h=w.length;e<h;e++){if(w[e].key===a)return w[e]}else{if("number"===typeof a)return this.children[a];if(a.parent===this)return a}return null},_setChildren:function(a){p(a&&(!this.children||0===this.children.length),"only init supported");this.children=[];for(var e=0,h=a.length;e<h;e++)this.children.push(new u(this,
a[e]))},addChildren:function(a,e){var h,w;w=null;var b=[];d.isPlainObject(a)&&(a=[a]);this.children||(this.children=[]);h=0;for(w=a.length;h<w;h++)b.push(new u(this,a[h]));w=b[0];null==e?this.children=this.children.concat(b):(e=this._findDirectChild(e),h=d.inArray(e,this.children),p(0<=h,"insertBefore must be an existing child"),this.children.splice.apply(this.children,[h,0].concat(b)));(!this.parent||this.parent.ul||this.tr)&&this.render();3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes();
return w},addNode:function(a,e){if(e===v||"over"===e)e="child";switch(e){case "after":return this.getParent().addChildren(a,this.getNextSibling());case "before":return this.getParent().addChildren(a,this);case "child":case "over":return this.addChildren(a)}p(!1,"Invalid mode: "+e)},appendSibling:function(a){return this.addNode(a,"after")},applyPatch:function(a){if(null===a)return this.remove(),c(this);var e,h,w={children:!0,expanded:!0,parent:!0};for(e in a)h=a[e],w[e]||d.isFunction(h)||(G[e]?this[e]=
h:this.data[e]=h);a.hasOwnProperty("children")&&(this.removeChildren(),a.children&&this._setChildren(a.children));this.isVisible()&&(this.renderTitle(),this.renderStatus());return a.hasOwnProperty("expanded")?this.setExpanded(a.expanded):c(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(a,e,h){return a.addNode(this.toDict(!0,h),e)},countChildren:function(a){var e=this.children,h,w;if(!e)return 0;w=e.length;if(!1!==a)for(a=0,h=w;a<h;a++)w+=
e[a].countChildren();return w},debug:function(a){2<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),f("debug",arguments))},discard:function(){this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead.");return this.resetLazy()},findAll:function(a){a=d.isFunction(a)?a:n(a);var e=[];this.visit(function(h){a(h)&&e.push(h)});return e},findFirst:function(a){a=d.isFunction(a)?a:n(a);var e=null;this.visit(function(h){if(a(h))return e=
h,!1});return e},_changeSelectStatusAttrs:function(a){var e=!1;switch(a){case !1:e=this.selected||this.partsel;this.partsel=this.selected=!1;break;case !0:e=!this.selected||!this.partsel;this.partsel=this.selected=!0;break;case v:e=this.selected||!this.partsel;this.selected=!1;this.partsel=!0;break;default:p(!1,"invalid state: "+a)}e&&this.renderStatus();return e},fixSelection3AfterClick:function(){var a=this.isSelected();this.visit(function(e){e._changeSelectStatusAttrs(a)});this.fixSelection3FromEndNodes()},
fixSelection3FromEndNodes:function(){function a(e){var h,w,d,b,c,l=e.children;if(l){b=!0;c=!1;h=0;for(w=l.length;h<w;h++)d=l[h],d=a(d),!1!==d&&(c=!0),!0!==d&&(b=!1);h=b?!0:c?v:!1}else h=!!e.selected;e._changeSelectStatusAttrs(h);return h}p(3===this.tree.options.selectMode,"expected selectMode 3");a(this);this.visitParents(function(a){var h,d,b,c=a.children,z=!0,l=!1;h=0;for(d=c.length;h<d;h++){b=c[h];if(b.selected||b.partsel)l=!0;b.unselectable||b.selected||(z=!1)}a._changeSelectStatusAttrs(z?!0:
l?v:!1)})},fromDict:function(a){for(var e in a)G[e]?this[e]=a[e]:"data"===e?d.extend(this.data,a.data):d.isFunction(a[e])||H[e]||(this.data[e]=a[e]);a.children&&(this.removeChildren(),this.addChildren(a.children));this.renderTitle()},getChildren:function(){return this.hasChildren()===v?v:this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return d.inArray(this,this.parent.children)},getIndexHier:function(a){a=a||".";var e=[];d.each(this.getParentList(!1,
!0),function(a,d){e.push(d.getIndex()+1)});return e.join(a)},getKeyPath:function(a){var e=[],h=this.tree.options.keyPathSeparator;this.visitParents(function(a){a.parent&&e.unshift(a.key)},!a);return h+e.join(h)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var a=0,e=this.parent;e;)a++,e=e.parent;return a},getNextSibling:function(){if(this.parent){var a,e,h=this.parent.children;a=0;for(e=h.length-1;a<e;a++)if(h[a]===this)return h[a+
1]}return null},getParent:function(){return this.parent},getParentList:function(a,e){for(var h=[],d=e?this:this.parent;d;)(a||d.parent)&&h.unshift(d),d=d.parent;return h},getPrevSibling:function(){if(this.parent){var a,e,h=this.parent.children;a=1;for(e=h.length;a<e;a++)if(h[a]===this)return h[a-1]}return null},hasChildren:function(){return this.lazy?null==this.children?v:0===this.children.length?!1:1===this.children.length&&this.children[0].isStatusNode()?v:!0:!!this.children},hasFocus:function(){return this.tree.hasFocus()&&
this.tree.focusNode===this},isActive:function(){return this.tree.activeNode===this},isChildOf:function(a){return this.parent&&this.parent===a},isDescendantOf:function(a){if(!a||a.tree!==this.tree)return!1;for(var e=this.parent;e;){if(e===a)return!0;e=e.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var a=this.parent;return!a||a.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var a=this.parent;return!a||a.children[a.children.length-
1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||this.hasChildren()!==v},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isUndefined:function(){return this.hasChildren()===v},isVisible:function(){var a,e,h=this.getParentList(!1,!1);a=0;for(e=h.length;a<e;a++)if(!h[a].expanded)return!1;return!0},lazyLoad:function(a){this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead.");
return this.load(a)},load:function(a){var e=this;p(this.isLazy(),"load() requires a lazy node");p(a||this.isUndefined(),"Pass forceReload=true to re-load a lazy node");this.isLoaded()&&this.resetLazy();a=this.tree._triggerNodeEvent("lazyLoad",this);if(!1===a)return c(this);p("boolean"!==typeof a,"lazyLoad event must return source in data.result");a=this.tree._callHook("nodeLoadChildren",this,a);this.expanded&&a.always(function(){e.render()});return a},makeVisible:function(a){var e,h=this,w=[],b=new d.Deferred,
c=this.getParentList(!1,!1),z=!(a&&!0===a.noAnimation),l=!(a&&!1===a.scrollIntoView);for(e=c.length-1;0<=e;e--)w.push(c[e].setExpanded(!0,a));d.when.apply(d,w).done(function(){l?h.scrollIntoView(z).done(function(){b.resolve()}):b.resolve()});return b.promise()},moveTo:function(a,e,h){if(e===v||"over"===e)e="child";var w,b=this.parent,c="child"===e?a:a.parent;if(this!==a){if(!this.parent)throw"Cannot move system root";if(c.isDescendantOf(this))throw"Cannot move a node to its own descendant";1===this.parent.children.length?
(this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1):(w=d.inArray(this,this.parent.children),p(0<=w),this.parent.children.splice(w,1));this.parent=c;if(c.hasChildren())switch(e){case "child":c.children.push(this);break;case "before":w=d.inArray(a,c.children);p(0<=w);c.children.splice(w,0,this);break;case "after":w=d.inArray(a,c.children);p(0<=w);c.children.splice(w+1,0,this);break;default:throw"Invalid mode "+e;}else c.children=[this];h&&a.visit(h,!0);this.tree!==a.tree&&(this.warn("Cross-tree moveTo is experimantal!"),
this.visit(function(e){e.tree=a.tree},!0));b.isDescendantOf(c)||b.render();c.isDescendantOf(b)||c===b||c.render()}},navigate:function(a,e){function h(h){if(h){h.makeVisible();if(d(h.span).is(":visible"))return!1===e?h.setFocus():h.setActive();h.debug("Navigate: skipping hidden node");h.navigate(a,e)}}var b,c;b=d.ui.keyCode;var q=null;switch(a){case b.BACKSPACE:this.parent&&this.parent.parent&&h(this.parent);break;case b.LEFT:this.expanded?(this.setExpanded(!1),h(this)):this.parent&&this.parent.parent&&
h(this.parent);break;case b.RIGHT:this.expanded||!this.children&&!this.lazy?this.children&&this.children.length&&h(this.children[0]):(this.setExpanded(),h(this));break;case b.UP:for(q=this.getPrevSibling();q&&q.expanded&&q.children&&q.children.length;)q=q.children[q.children.length-1];!q&&this.parent&&this.parent.parent&&(q=this.parent);h(q);break;case b.DOWN:if(this.expanded&&this.children&&this.children.length)q=this.children[0];else for(c=this.getParentList(!1,!0),b=c.length-1;0<=b&&!(q=c[b].getNextSibling());b--);
h(q)}},remove:function(){return this.parent.removeChild(this)},removeChild:function(a){return this.tree._callHook("nodeRemoveChild",this,a)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},render:function(a,e){return this.tree._callHook("nodeRender",this,a,e)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},resetLazy:function(){this.removeChildren();this.expanded=
!1;this.lazy=!0;this.children=v;this.renderStatus()},scheduleAction:function(a,e){this.tree.timer&&clearTimeout(this.tree.timer);this.tree.timer=null;var h=this;switch(a){case "cancel":break;case "expand":this.tree.timer=setTimeout(function(){h.tree.debug("setTimeout: trigger expand");h.setExpanded(!0)},e);break;case "activate":this.tree.timer=setTimeout(function(){h.tree.debug("setTimeout: trigger activate");h.setActive(!0)},e);break;default:throw"Invalid mode "+a;}},scrollIntoView:function(a,e){e!==
v&&e.tree&&e.statusNodeType!==v&&(this.warn("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead."),e={topNode:e});var h,b,c,q=d.extend({effects:!0===a?{duration:200,queue:!1}:a,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent||this.tree.$container,topNode:null},e),z=new d.Deferred,l=this,f=d(this.span).height();c=d(q.scrollParent);var k=q.scrollOfs.top||0,y=q.scrollOfs.bottom||0,g=c.height(),m=c.scrollTop(),r=c;b=c[0]===
B;var n=q.topNode||null,u=null;p(d(this.span).is(":visible"),"scrollIntoView node is invisible");b?(b=d(this.span).offset().top,h=n?d(n.span).offset().top:0,r=d("html,body")):(p(c[0]!==t&&c[0]!==t.body,"scrollParent should be an simple element or `window`, not document or body."),h=c.offset().top,b=d(this.span).offset().top-h+m,h=n?d(n.span).offset().top-h+m:0,c=Math.max(0,c.innerHeight()-c[0].clientHeight),g-=c);b<m+k?u=b-k:b+f>m+g-y&&(u=b+f-g+y,n&&(p(d(n.span).is(":visible")),h<u&&(u=h-k)));null!==
u?q.effects?(q.effects.complete=function(){z.resolveWith(l)},r.stop(!0).animate({scrollTop:u},q.effects)):(r[0].scrollTop=u,z.resolveWith(this)):z.resolveWith(this);return z.promise()},setActive:function(a,e){return this.tree._callHook("nodeSetActive",this,a,e)},setExpanded:function(a,e){return this.tree._callHook("nodeSetExpanded",this,a,e)},setFocus:function(a){return this.tree._callHook("nodeSetFocus",this,a)},setSelected:function(a){return this.tree._callHook("nodeSetSelected",this,a)},setTitle:function(a){this.title=
a;this.renderTitle()},sortChildren:function(a,e){var h,d,b=this.children;if(b){a=a||function(a,e){var h=a.title.toLowerCase(),b=e.title.toLowerCase();return h===b?0:h>b?1:-1};b.sort(a);if(e)for(h=0,d=b.length;h<d;h++)b[h].children&&b[h].sortChildren(a,"$norender$");"$norender$"!==e&&this.render()}},toDict:function(a,e){var h,b,c,q={},z=this;d.each(E,function(a,e){if(z[e]||!1===z[e])q[e]=z[e]});d.isEmptyObject(this.data)||(q.data=d.extend({},this.data),d.isEmptyObject(q.data)&&delete q.data);e&&e(q);
if(a&&this.hasChildren())for(q.children=[],h=0,b=this.children.length;h<b;h++)c=this.children[h],c.isStatusNode()||q.children.push(c.toDict(!0,e));return q},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"<FancytreeNode(#"+this.key+", '"+this.title+"')>"},visit:function(a,e){var h,b,d=!0,c=this.children;if(!0===e&&(d=a(this),!1===d||"skip"===d))return d;if(c)for(h=
0,b=c.length;h<b&&(d=c[h].visit(a,!0),!1!==d);h++);return d},visitParents:function(a,e){if(e&&!1===a(this))return!1;for(var h=this.parent;h;){if(!1===a(h))return!1;h=h.parent}return!0},warn:function(a){Array.prototype.unshift.call(arguments,this.toString());f("warn",arguments)}};r.prototype={_makeHookContext:function(a,e,h){var b;a.node!==v?(e&&a.originalEvent!==e&&d.error("invalid args"),b=a):a.tree?(b=a.tree,b={node:a,tree:b,widget:b.widget,options:b.widget.options,originalEvent:e}):a.widget?b=
{node:null,tree:a,widget:a.widget,options:a.widget.options,originalEvent:e}:d.error("invalid args");h&&d.extend(b,h);return b},_callHook:function(a,e,h){var b=this._makeHookContext(e),c=this[a],q=Array.prototype.slice.call(arguments,2);d.isFunction(c)||d.error("_callHook('"+a+"') is not a function");q.unshift(b);return c.apply(this,q)},_requireExtension:function(a,e,h,b){h=!!h;var c=this._local.name,q=this.options.extensions,z=d.inArray(a,q)<d.inArray(c,q),q=e&&null==this.ext[a],z=!q&&null!=h&&h!==
z;p(c&&c!==a);return q||z?(b||(q||e?(b="'"+c+"' extension requires '"+a+"'",z&&(b+=" to be registered "+(h?"before":"after")+" itself")):b="If used together, `"+a+"` must be registered "+(h?"before":"after")+" `"+c+"`"),d.error(b),!1):!0},activateKey:function(a){(a=this.getNodeByKey(a))?a.setActive():this.activeNode&&this.activeNode.setActive(!1);return a},applyPatch:function(a){var e,h,b,c,q=a.length,z=[];for(h=0;h<q;h++)b=a[h],p(2===b.length,"patchList must be an array of length-2-arrays"),e=b[0],
b=b[1],(c=null===e?this.rootNode:this.getNodeByKey(e))?(e=new d.Deferred,z.push(e),c.applyPatch(b).always(y(e,c))):this.warn("could not find node with key '"+e+"'");return d.when.apply(d,z).promise()},count:function(){return this.rootNode.countChildren()},debug:function(a){2<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),f("debug",arguments))},generateFormElements:function(a,e){var h,b=!1!==a?"ft_"+this._id:a,c=!1!==e?"ft_"+this._id+"_active":e;h="fancytree_result_"+
this._id;var q=this.$container.find("div#"+h);q.length?q.empty():q=d("<div>",{id:h}).hide().appendTo(this.$container);b&&(h=this.getSelectedNodes(3===this.options.selectMode),d.each(h,function(a,e){q.append(d("<input>",{type:"checkbox",name:b,value:e.key,checked:!0}))}));c&&this.activeNode&&q.append(d("<input>",{type:"radio",name:c,value:this.activeNode.key,checked:!0}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(a){return this.focusNode},
getNodeByKey:function(a,e){var h,b;if(!e&&(h=t.getElementById(this.options.idPrefix+a)))return h.ftnode?h.ftnode:null;e=e||this.rootNode;b=null;e.visit(function(e){if(e.key===a)return b=e,!1},!0);return b},getSelectedNodes:function(a){var e=[];this.rootNode.visit(function(h){if(h.selected&&(e.push(h),!0===a))return"skip"});return e},hasFocus:function(){return!!this._hasFocus},info:function(a){1<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),f("info",arguments))},
loadKeyPath:function(a,e,h){function b(a,h,d){e.call(g,h,"loading");h.load().done(function(){g.loadKeyPath.call(g,z[a],e,h).always(y(d,g))}).fail(function(b){g.warn("loadKeyPath: error loading: "+a+" (parent: "+f+")");e.call(g,h,"error");d.reject()})}var c,q,z,l,f=h||this.rootNode,k=this.options.keyPathSeparator,g=this;d.isArray(a)||(a=[a]);z={};for(c=0;c<a.length;c++)for(h=a[c],h.charAt(0)===k&&(h=h.substr(1)),l=h.split(k);l.length;)if(q=l.shift(),h=f._findDirectChild(q))if(0===l.length){e.call(this,
h,"ok");break}else if(h.lazy&&h.hasChildren()===v){e.call(this,h,"loaded");z[q]?z[q].push(l.join(k)):z[q]=[l.join(k)];break}else e.call(this,h,"loaded"),f=h;else{this.warn("loadKeyPath: key not found: "+q+" (parent: "+f+")");e.call(this,q,"error");break}a=[];for(q in z)h=f._findDirectChild(q),c=new d.Deferred,a.push(c),b(q,h,c);return d.when.apply(d,a).promise()},reactivate:function(a){var e=this.activeNode;e&&(this.activeNode=null,e.setActive(),a&&e.setFocus())},reload:function(a){this._callHook("treeClear",
this);return this._callHook("treeLoad",this,a)},render:function(a,e){return this.rootNode.render(a,e)},setFocus:function(a){return this._callHook("treeSetFocus",this,a)},toDict:function(a,e){var h=this.rootNode.toDict(!0,e);return a?h:h.children},toString:function(){return"<Fancytree(#"+this._id+")>"},_triggerNodeEvent:function(a,e,h,b){e=this._makeHookContext(e,h,b);a=this.widget._trigger(a,h,e);return!1!==a&&e.result!==v?e.result:a},_triggerTreeEvent:function(a,e){var h=this._makeHookContext(this,
e),b=this.widget._trigger(a,e,h);return!1!==b&&h.result!==v?h.result:b},visit:function(a){return this.rootNode.visit(a,!1)},warn:function(a){Array.prototype.unshift.call(arguments,this.toString());f("warn",arguments)}};d.extend(r.prototype,{nodeClick:function(a){var e,b,d=a.originalEvent;e=a.targetType;var c=a.node;if("expander"===e)this._callHook("nodeToggleExpanded",a);else if("checkbox"===e)this._callHook("nodeToggleSelected",a),this._callHook("nodeSetFocus",a,!0);else{b=!1;e=!0;if(c.folder)switch(a.options.clickFolderMode){case 2:b=
!0;e=!1;break;case 3:b=e=!0}e&&(this.nodeSetFocus(a),this._callHook("nodeSetActive",a,!0));b&&this._callHook("nodeToggleExpanded",a)}"a"===d.target.localName&&"fancytree-title"===d.target.className&&d.preventDefault()},nodeCollapseSiblings:function(a,e){var b,d,c,q=a.node;if(q.parent)for(b=q.parent.children,d=0,c=b.length;d<c;d++)b[d]!==q&&b[d].expanded&&this._callHook("nodeSetExpanded",b[d],!1,e)},nodeDblclick:function(a){"title"===a.targetType&&4===a.options.clickFolderMode&&this._callHook("nodeToggleExpanded",
a);"title"===a.targetType&&a.originalEvent.preventDefault()},nodeKeydown:function(a){var e=a.originalEvent,b=a.node,c=a.tree,l=a.options,q=!0,z=!(e.ctrlKey||!l.autoActivate),f=d.ui.keyCode;b||(this.rootNode.getFirstChild().setFocus(),b=a.node=this.focusNode,b.debug("Keydown force focus on first node"));switch(e.which){case f.NUMPAD_ADD:case 187:c.nodeSetExpanded(a,!0);break;case f.NUMPAD_SUBTRACT:case 189:c.nodeSetExpanded(a,!1);break;case f.SPACE:l.checkbox?c.nodeToggleSelected(a):c.nodeSetActive(a,
!0);break;case f.ENTER:c.nodeSetActive(a,!0);break;case f.BACKSPACE:case f.LEFT:case f.RIGHT:case f.UP:case f.DOWN:b.navigate(e.which,z);break;default:q=!1}q&&e.preventDefault()},nodeLoadChildren:function(a,e){var b,c,l=a.tree,q=a.node;d.isFunction(e)&&(e=e());e.url&&(b=d.extend({},a.options.ajax,e),b.debugDelay?(c=b.debugDelay,d.isArray(c)&&(c=c[0]+Math.random()*(c[1]-c[0])),q.debug("nodeLoadChildren waiting debug delay "+Math.round(c)+"ms"),b.debugDelay=!1,e=d.Deferred(function(a){setTimeout(function(){d.ajax(b).done(function(){a.resolveWith(this,
arguments)}).fail(function(){a.rejectWith(this,arguments)})},c)})):e=d.ajax(b),e=e.pipe(function(e,b,h){"string"===typeof e&&d.error("Ajax request returned a string (did you get the JSON dataType wrong?).");a.options.postProcess?(b=l._triggerNodeEvent("postProcess",a,a.originalEvent,{response:e,dataType:this.dataType}),e=d.isArray(b)?b:e):e&&e.hasOwnProperty("d")&&a.options.enableAspx&&(e="string"===typeof e.d?d.parseJSON(e.d):e.d);return e},function(a,e,b){return l._makeHookContext(q,null,{error:a,
args:Array.prototype.slice.call(arguments),message:b,details:a.status+": "+b})}));d.isFunction(e.promise)&&(p(!q.isLoading()),l.nodeSetStatus(a,"loading"),e.done(function(){l.nodeSetStatus(a,"ok")}).fail(function(e){var b;b=e.node&&e.error&&e.message?e:l._makeHookContext(q,null,{error:e,args:Array.prototype.slice.call(arguments),message:e?e.message||e.toString():""});l._triggerNodeEvent("loaderror",b,null);l.nodeSetStatus(a,"error",b.message,b.details)}));return d.when(e).done(function(a){var e;d.isPlainObject(a)&&
(p(d.isArray(a.children),"source must contain (or be) an array of children"),p(q.isRoot(),"source may only be an object for root nodes"),e=a,a=a.children,delete e.children,d.extend(l.data,e));p(d.isArray(a),"expected array of children");q._setChildren(a);l._triggerNodeEvent("loadChildren",q)})},nodeLoadKeyPath:function(a,e){},nodeRemoveChild:function(a,e){var b;b=a.node;var c=a.options,l=d.extend({},a,{node:e}),q=b.children;if(1===q.length)return p(e===q[0]),this.nodeRemoveChildren(a);this.activeNode&&
(e===this.activeNode||this.activeNode.isDescendantOf(e))&&this.activeNode.setActive(!1);this.focusNode&&(e===this.focusNode||this.focusNode.isDescendantOf(e))&&(this.focusNode=null);this.nodeRemoveMarkup(l);this.nodeRemoveChildren(l);b=d.inArray(e,q);p(0<=b);e.visit(function(a){a.parent=null},!0);this._callHook("treeRegisterNode",this,!1,e);c.removeNode&&c.removeNode.call(a.tree,{type:"removeNode"},l);q.splice(b,1)},nodeRemoveChildMarkup:function(a){a=a.node;a.ul&&(a.isRoot()?d(a.ul).empty():(d(a.ul).remove(),
a.ul=null),a.visit(function(a){a.li=a.ul=null}))},nodeRemoveChildren:function(a){var e,b=a.tree,c=a.node,l=a.options;c.children&&(this.activeNode&&this.activeNode.isDescendantOf(c)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(c)&&(this.focusNode=null),this.nodeRemoveChildMarkup(a),e=d.extend({},a),c.visit(function(c){c.parent=null;b._callHook("treeRegisterNode",b,!1,c);l.removeNode&&(e.node=c,l.removeNode.call(a.tree,{type:"removeNode"},e))}),c.children=c.lazy?[]:null,
this.nodeRenderStatus(a))},nodeRemoveMarkup:function(a){var e=a.node;e.li&&(d(e.li).remove(),e.li=null);this.nodeRemoveChildMarkup(a)},nodeRender:function(a,e,b,c,l){var q,f=a.node;q=a.tree;var k=a.options,g=k.aria,y=!1,m=f.parent,n=!m,r=f.children;if(n||m.ul){p(n||m.ul,"parent UL must exist");n||(f.li&&(e||f.li.parentNode!==f.parent.ul)&&(f.li.parentNode!==f.parent.ul&&this.warn("unlink "+f+" (must be child of "+f.parent+")"),this.nodeRemoveMarkup(a)),f.li?this.nodeRenderStatus(a):(y=!0,f.li=t.createElement("li"),
f.li.ftnode=f,f.key&&k.generateIds&&(f.li.id=k.idPrefix+f.key),f.span=t.createElement("span"),f.span.className="fancytree-node",g&&d(f.span).attr("aria-labelledby","ftal_"+f.key),f.li.appendChild(f.span),this.nodeRenderTitle(a),k.createNode&&k.createNode.call(q,{type:"createNode"},a)),k.renderNode&&k.renderNode.call(q,{type:"renderNode"},a));if(r){if(n||f.expanded||!0===b){if(!f.ul){f.ul=t.createElement("ul");if(!0===c&&!l||!f.expanded)f.ul.style.display="none";g&&d(f.ul).attr("role","group");f.li?
f.li.appendChild(f.ul):f.tree.$div.append(f.ul)}c=0;for(l=r.length;c<l;c++)q=d.extend({},a,{node:r[c]}),this.nodeRender(q,e,b,!1,!0);for(a=f.ul.firstChild;a;)(b=a.ftnode)&&b.parent!==f?(f.debug("_fixParent: remove missing "+b,a),e=a.nextSibling,a.parentNode.removeChild(a),a=e):a=a.nextSibling;a=f.ul.firstChild;c=0;for(l=r.length-1;c<l;c++)e=r[c],b=a.ftnode,e!==b?f.ul.insertBefore(e.li,b.li):a=a.nextSibling}}else f.ul&&(this.warn("remove child markup for "+f),this.nodeRemoveChildMarkup(a));n||y&&m.ul.appendChild(f.li)}},
nodeRenderTitle:function(a,e){var b,c,d,f,l=a.node;b=a.tree;f=a.options;var k=f.aria;d=l.getLevel();var g=[];c=l.data.icon;e!==v&&(l.title=e);l.span&&(d<f.minExpandLevel?1<d&&(k?g.push("<span role='button' class='fancytree-expander'></span>"):g.push("<span class='fancytree-expander'></span>")):k?g.push("<span role='button' class='fancytree-expander'></span>"):g.push("<span class='fancytree-expander'></span>"),f.checkbox&&!0!==l.hideCheckbox&&!l.isStatusNode()&&(k?g.push("<span role='checkbox' class='fancytree-checkbox'></span>"):
g.push("<span class='fancytree-checkbox'></span>")),d=k?" role='img'":"",c&&"string"===typeof c?(c="/"===c.charAt(0)?c:(f.imagePath||"")+c,g.push("<img src='"+c+"' class='fancytree-icon'"+(l.data.iconStyle?" style='"+l.data.iconStyle+"'":"")+"  alt='' />")):l.data.iconclass?g.push("<span "+d+" class='fancytree-custom-icon "+l.data.iconclass+"'></span>"):(!0===c||!1!==c&&!1!==f.icons)&&g.push("<span "+d+" class='fancytree-icon'></span>"),c="",f.renderTitle&&(c=f.renderTitle.call(b,{type:"renderTitle"},
a)||""),c||(c=l.tooltip?" title='"+F.escapeHtml(l.tooltip)+"'":"",b=k?" id='ftal_"+l.key+"'":"",f=f.titlesTabbable?" tabindex='0'":"",c="<span "+(k?" role='treeitem'":"")+" class='fancytree-title'"+b+c+f+">"+l.title+"</span>"),g.push(c),l.span.innerHTML=g.join(""),this.nodeRenderStatus(a))},nodeRenderStatus:function(a){var e=a.node,b=a.tree,c=a.options;a=e.hasChildren();var f=e.isLastSibling(),l=c.aria,k=d(e.span).find(".fancytree-title"),c=c._classNames,g=[],y=e[b.statusClassPropName];y&&(g.push(c.node),
b.activeNode===e&&g.push(c.active),b.focusNode===e?(g.push(c.focused),l&&k.attr("aria-activedescendant",!0)):l&&k.removeAttr("aria-activedescendant"),e.expanded?(g.push(c.expanded),l&&k.attr("aria-expanded",!0)):l&&k.removeAttr("aria-expanded"),e.folder&&g.push(c.folder),!1!==a&&g.push(c.hasChildren),f&&g.push(c.lastsib),e.lazy&&null==e.children&&g.push(c.lazy),e.partsel&&g.push(c.partsel),e._isLoading&&g.push(c.loading),e._error&&g.push(c.error),e.selected?(g.push(c.selected),l&&k.attr("aria-selected",
!0)):l&&k.attr("aria-selected",!1),e.extraClasses&&g.push(e.extraClasses),!1===a?g.push(c.combinedExpanderPrefix+"n"+(f?"l":"")):g.push(c.combinedExpanderPrefix+(e.expanded?"e":"c")+(e.lazy&&null==e.children?"d":"")+(f?"l":"")),g.push(c.combinedIconPrefix+(e.expanded?"e":"c")+(e.folder?"f":"")),y.className=g.join(" "),e.li&&(e.li.className=f?c.lastsib:""))},nodeSetActive:function(a,e,b){b=b||{};var f=a.node,g=a.tree,k=a.options;b=!0===b.noEvents;var y=f===g.activeNode;e=!1!==e;if(y===e)return c(f);
if(e&&!b&&!1===this._triggerNodeEvent("beforeActivate",f,a.originalEvent))return l(f,["rejected"]);e?(g.activeNode&&(p(g.activeNode!==f,"node was active (inconsistency)"),e=d.extend({},a,{node:g.activeNode}),g.nodeSetActive(e,!1),p(null===g.activeNode,"deactivate was out of sync?")),k.activeVisible&&f.makeVisible({scrollIntoView:!1}),g.activeNode=f,g.nodeRenderStatus(a),g.nodeSetFocus(a),b||g._triggerNodeEvent("activate",f,a.originalEvent)):(p(g.activeNode===f,"node was not active (inconsistency)"),
g.activeNode=null,this.nodeRenderStatus(a),b||a.tree._triggerNodeEvent("deactivate",f,a.originalEvent))},nodeSetExpanded:function(a,e,b){b=b||{};var f,g,k,y,m,p,n=a.node,r=a.tree,u=a.options,x=!0===b.noAnimation,t=!0===b.noEvents;e=!1!==e;if(n.expanded&&e||!n.expanded&&!e||e&&!n.lazy&&!n.hasChildren())return c(n);if(!e&&n.getLevel()<u.minExpandLevel)return l(n,["locked"]);if(!t&&!1===this._triggerNodeEvent("beforeExpand",n,a.originalEvent))return l(n,["rejected"]);x||n.isVisible()||(x=b.noAnimation=
!0);g=new d.Deferred;if(e&&!n.expanded&&u.autoCollapse){m=n.getParentList(!1,!0);p=u.autoCollapse;try{for(u.autoCollapse=!1,k=0,y=m.length;k<y;k++)this._callHook("nodeCollapseSiblings",m[k],b)}finally{u.autoCollapse=p}}g.done(function(){e&&u.autoScroll&&!x?n.getLastChild().scrollIntoView(!0,{topNode:n}).always(function(){t||a.tree._triggerNodeEvent(e?"expand":"collapse",a)}):t||a.tree._triggerNodeEvent(e?"expand":"collapse",a)});f=function(b){var c,h;n.expanded=e;r._callHook("nodeRender",a,!1,!1,
!0);if(n.ul)if(c="none"!==n.ul.style.display,h=!!n.expanded,c===h)n.warn("nodeSetExpanded: UL.style.display already set");else if(!u.fx||x)n.ul.style.display=n.expanded||!parent?"":"none";else{c=u.fx.duration||200;h=u.fx.easing;d(n.ul).animate(u.fx,c,h,function(){b()});return}b()};e&&n.lazy&&n.hasChildren()===v?n.load().done(function(){g.notifyWith&&g.notifyWith(n,["loaded"]);f(function(){g.resolveWith(n)})}).fail(function(a){f(function(){g.rejectWith(n,["load failed ("+a+")"])})}):f(function(){g.resolveWith(n)});
return g.promise()},nodeSetFocus:function(a,e){var b,c=a.tree,f=a.node;e=!1!==e;if(c.focusNode){if(c.focusNode===f&&e)return;b=d.extend({},a,{node:c.focusNode});c.focusNode=null;this._triggerNodeEvent("blur",b);this._callHook("nodeRenderStatus",b)}e&&(this.hasFocus()||(f.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",a,!0,!0)),f.makeVisible({scrollIntoView:!1}),c.focusNode=f,this._triggerNodeEvent("focus",a),a.options.autoScroll&&f.scrollIntoView(),this._callHook("nodeRenderStatus",
a))},nodeSetSelected:function(a,e){var b=a.node,c=a.tree,d=a.options;e=!1!==e;b.debug("nodeSetSelected("+e+")",a);if(!b.unselectable){if(b.selected&&e||!b.selected&&!e||!1===this._triggerNodeEvent("beforeSelect",b,a.originalEvent))return!!b.selected;e&&1===d.selectMode?c.lastSelectedNode&&c.lastSelectedNode.setSelected(!1):3===d.selectMode&&(b.selected=e,b.fixSelection3AfterClick());b.selected=e;this.nodeRenderStatus(a);c.lastSelectedNode=e?b:null;c._triggerNodeEvent("select",a)}},nodeSetStatus:function(a,
e,b,c){function f(){var a=g.children?g.children[0]:null;if(a&&a.isStatusNode()){try{g.ul&&(g.ul.removeChild(a.li),a.li=null)}catch(e){}1===g.children.length?g.children=[]:g.children.shift()}}function l(a,e){var b=g.children?g.children[0]:null;b&&b.isStatusNode()?(d.extend(b,a),k._callHook("nodeRender",b)):(a.key="_statusNode",g._setChildren([a]),g.children[0].statusNodeType=e,k.render());return g.children[0]}var g=a.node,k=a.tree;switch(e){case "ok":f();g._isLoading=!1;g._error=null;g.renderStatus();
break;case "loading":g.parent||l({title:k.options.strings.loading+(b?" ("+b+") ":""),tooltip:c,extraClasses:"fancytree-statusnode-wait"},e);g._isLoading=!0;g._error=null;g.renderStatus();break;case "error":l({title:k.options.strings.loadError+(b?" ("+b+") ":""),tooltip:c,extraClasses:"fancytree-statusnode-error"},e);g._isLoading=!1;g._error={message:b,details:c};g.renderStatus();break;default:d.error("invalid node status "+e)}},nodeToggleExpanded:function(a){return this.nodeSetExpanded(a,!a.node.expanded)},
nodeToggleSelected:function(a){return this.nodeSetSelected(a,!a.node.selected)},treeClear:function(a){a=a.tree;a.activeNode=null;a.focusNode=null;a.$div.find(">ul.fancytree-container").empty();a.rootNode.children=null},treeCreate:function(a){},treeDestroy:function(a){},treeInit:function(a){this.treeLoad(a)},treeLoad:function(a,e){var b,c=a.tree,f=a.widget.element,l=d.extend({},a,{node:this.rootNode});c.rootNode.children&&this.treeClear(a);if(e=e||this.options.source)"string"===typeof e&&m();else switch(b=
f.data("type")||"html",b){case "html":b=f.find(">ul:first");b.addClass("ui-fancytree-source ui-helper-hidden");e=d.ui.fancytree.parseHtml(b);this.data=d.extend(this.data,k(b));break;case "json":e=d.parseJSON(f.text());e.children&&(e.title&&(c.title=e.title),e=e.children);break;default:d.error("Invalid data-type: "+b)}return this.nodeLoadChildren(l,e).done(function(){c.render();3===a.options.selectMode&&c.rootNode.fixSelection3FromEndNodes();c._triggerTreeEvent("init",!0)}).fail(function(){c.render();
c._triggerTreeEvent("init",!1)})},treeRegisterNode:function(a,b,c){},treeSetFocus:function(a,b,c){b=!1!==b;b!==this.hasFocus()&&(this._hasFocus=b,this.$container.toggleClass("fancytree-treefocus",b),this._triggerTreeEvent(b?"focusTree":"blurTree"))}});d.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!1,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,extensions:[],fx:{height:"toggle",
duration:200},generateIds:!1,icons:!0,idPrefix:"ft_",keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading&#8230;",loadError:"Load error!"},tabbable:!0,titlesTabbable:!1,_classNames:{node:"fancytree-node",folder:"fancytree-folder",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",
lazy:"fancytree-lazy",focused:"fancytree-focused",partsel:"fancytree-partsel",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new r(this);this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul:first");var a,e,c,f=this.options.extensions,l=this.tree;for(c=0;c<f.length;c++){e=f[c];(a=d.ui.fancytree._extensions[e])||d.error("Could not apply extension '"+e+"' (it is not registered, did you forget to include it?)");
this.tree.options[e]=d.extend(!0,{},a.options,this.tree.options[e]);p(this.tree.ext[e]===v,"Extension name must not exist as Fancytree.ext attribute: '"+e+"'");this.tree.ext[e]={};var g=this.tree,k=a,y=void 0;for(y in k)"function"===typeof k[y]?"function"===typeof g[y]?g[y]=b(y,g,l,k,e):"_"===y.charAt(0)?g.ext[e][y]=b(y,g,l,k,e):d.error("Could not override tree."+y+". Use prefix '_' to create tree."+e+"._"+y):"options"!==y&&(g.ext[e][y]=k[y]);l=a}this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",
this.tree);this._bind()},_setOption:function(a,b){var c=!0,f=!1;switch(a){case "aria":case "checkbox":case "icons":case "minExpandLevel":case "tabbable":this.tree._callHook("treeCreate",this.tree);f=!0;break;case "source":c=!1,this.tree._callHook("treeLoad",this.tree,b)}this.tree.debug("set option "+a+"="+b+" <"+typeof b+">");c&&d.Widget.prototype._setOption.apply(this,arguments);f&&this.tree.render(!0,!1)},destroy:function(){this._unbind();this.tree._callHook("treeDestroy",this.tree);this.tree.$div.find(">ul.fancytree-container").remove();
this.$source&&this.$source.removeClass("ui-helper-hidden");d.Widget.prototype.destroy.call(this)},_unbind:function(){var a=this.tree._ns;this.element.unbind(a);this.tree.$container.unbind(a);d(t).unbind(a)},_bind:function(){var a=this,b=this.options,c=this.tree,d=c._ns;this._unbind();c.$container.on("focusin"+d+" focusout"+d,function(a){var b=F.getNode(a);a="focusin"===a.type;b?c._callHook("nodeSetFocus",b,a):c._callHook("treeSetFocus",c,a)}).on("selectstart"+d,"span.fancytree-title",function(a){a.preventDefault()}).on("keydown"+
d,function(a){if(b.disabled||!1===b.keyboard)return!0;var d,f=c.focusNode,l=c._makeHookContext(f||c,a),g=c.phase;try{return c.phase="userEvent",d=f?c._triggerNodeEvent("keydown",f,a):c._triggerTreeEvent("keydown",a),"preventNav"===d?d=!0:!1!==d&&(d=c._callHook("nodeKeydown",l)),d}finally{c.phase=g}}).on("click"+d+" dblclick"+d,function(c){if(b.disabled)return!0;var d,f=F.getEventTarget(c);d=f.node;var h=a.tree,l=h.phase;if(!d)return!0;d=h._makeHookContext(d,c);try{switch(h.phase="userEvent",c.type){case "click":return d.targetType=
f.type,!1===h._triggerNodeEvent("click",d,c)?!1:h._callHook("nodeClick",d);case "dblclick":return d.targetType=f.type,!1===h._triggerNodeEvent("dblclick",d,c)?!1:h._callHook("nodeDblclick",d)}}finally{h.phase=l}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(a){return this.tree.getNodeByKey(a)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}});F=d.ui.fancytree;d.extend(d.ui.fancytree,{version:"2.1.0",buildType:"production",debugLevel:1,
_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:r,_FancytreeNodeClass:u,jquerySupports:{positionMyOfs:g(d.ui.version,1,9)},assert:function(a,b){return p(a,b)},debounce:function(a,b,c,d){var f;3===arguments.length&&"boolean"!==typeof c&&(d=c,c=!1);return function(){var l=arguments;d=d||this;c&&!f&&b.apply(d,l);clearTimeout(f);f=setTimeout(function(){c||b.apply(d,l);f=null},a)}},debug:function(a){2<=d.ui.fancytree.debugLevel&&f("log",arguments)},error:function(a){f("error",arguments)},escapeHtml:function(a){return(""+
a).replace(/[&<>"'\/]/g,function(a){return C[a]})},unescapeHtml:function(a){var b=t.createElement("div");b.innerHTML=a;return 0===b.childNodes.length?"":b.childNodes[0].nodeValue},getEventTargetType:function(a){return this.getEventTarget(a).type},getEventTarget:function(a){var b=a&&a.target?a.target.className:"",c={node:this.getNode(a.target),type:v};/\bfancytree-title\b/.test(b)?c.type="title":/\bfancytree-expander\b/.test(b)?c.type=!1===c.node.hasChildren()?"prefix":"expander":/\bfancytree-checkbox\b/.test(b)||
/\bfancytree-radio\b/.test(b)?c.type="checkbox":/\bfancytree-icon\b/.test(b)?c.type="icon":/\bfancytree-node\b/.test(b)?c.type="title":a&&a.target&&d(a.target).closest(".fancytree-title").length&&(c.type="title");return c},getNode:function(a){if(a instanceof u)return a;a.selector!==v?a=a[0]:a.originalEvent!==v&&(a=a.target);for(;a;){if(a.ftnode)return a.ftnode;a=a.parentNode}return null},info:function(a){1<=d.ui.fancytree.debugLevel&&f("info",arguments)},parseHtml:function(a){var b,c,f,l,g,y,n,m,
p=[];a.find(">li").each(function(){var r,u=d(this);r=u.find(">span:first",this);var x=r.length?null:u.find(">a:first"),t={tooltip:null,data:{}};r.length?t.title=r.html():x&&x.length?(t.title=x.html(),t.data.href=x.attr("href"),t.data.target=x.attr("target"),t.tooltip=x.attr("title")):(t.title=u.html(),l=t.title.search(/<ul/i),0<=l&&(t.title=t.title.substring(0,l)));t.title=d.trim(t.title);c=0;for(f=D.length;c<f;c++)t[D[c]]=v;n=this.className.split(" ");b=[];c=0;for(f=n.length;c<f;c++)m=n[c],A[m]?
t[m]=!0:b.push(m);t.extraClasses=b.join(" ");if(g=u.attr("title"))t.tooltip=g;if(g=u.attr("id"))t.key=g;if((r=k(u))&&!d.isEmptyObject(r)){c=0;for(f=E.length;c<f;c++)g=E[c],y=r[g],null!=y&&(delete r[g],t[g]=y);d.extend(t.data,r)}a=u.find(">ul:first");t.children=a.length?d.ui.fancytree.parseHtml(a):t.lazy?v:null;p.push(t)});return p},registerExtension:function(a){p(null!=a.name,"extensions must have a `name` property.");p(null!=a.version,"extensions must have a `version` property.");d.ui.fancytree._extensions[a.name]=
a},warn:function(a){f("warn",arguments)}})}})(jQuery,window,document);
(function(d,B){d.ui.fancytree._FancytreeClass.prototype.countSelected=function(d){return this.getSelectedNodes(d).length};d.ui.fancytree._FancytreeNodeClass.prototype.toUpper=function(){return this.setTitle(this.title.toUpperCase())};d.ui.fancytree.prototype.widgetMethod1=function(d){return d};d.ui.fancytree.registerExtension({name:"childcounter",version:"1.0.0",options:{deep:!0,hideZeros:!0,hideExpanded:!1},foo:42,_appendCounter:function(d){},treeInit:function(d){this._super(d);this.$container.addClass("fancytree-ext-childcounter")},
treeDestroy:function(d){this._super(d)},nodeRenderTitle:function(t,v){var m=t.node,p=t.options.childcounter,f=null==m.data.childCounter?m.countChildren(p.deep):+m.data.childCounter;this._super(t,v);!f&&p.hideZeros||m.isExpanded()&&p.hideExpanded||d("span.fancytree-icon",m.span).append(d("<span class='fancytree-childcounter'/>").text(f))},nodeSetExpanded:function(d,v,m){var p=d.tree;return this._super(d,v,m).always(function(){p.nodeRenderTitle(d)})}})})(jQuery);
(function(d,B,t,v){function m(b){var c=b.options.dnd||null;c&&p();c&&c.dragStart&&b.widget.element.draggable(d.extend({addClasses:!1,appendTo:"body",containment:!1,delay:0,distance:4,revert:!1,scroll:!0,scrollSpeed:7,scrollSensitivity:10,connectToFancytree:!0,helper:function(b){var c=d.ui.fancytree.getNode(b.target);return c?c.tree.ext.dnd._onDragEvent("helper",c,null,b,null,null):"<div>ERROR?: helper requested but sourceNode not found</div>"},start:function(b,c){return!!c.helper.data("ftSourceNode")}},
b.options.dnd.draggable));c&&c.dragDrop&&b.widget.element.droppable(d.extend({addClasses:!1,tolerance:"intersect",greedy:!1},b.options.dnd.droppable))}function p(){g||(d.ui.plugin.add("draggable","connectToFancytree",{start:function(b,c){var f=d(this).data("ui-draggable")||d(this).data("draggable"),g=c.helper.data("ftSourceNode")||null;if(g)return f.offset.click.top=-2,f.offset.click.left=16,g.tree.ext.dnd._onDragEvent("start",g,null,b,c,f)},drag:function(b,c){var l,g=d(this).data("ui-draggable")||
d(this).data("draggable"),k=c.helper.data("ftSourceNode")||null,n=c.helper.data("ftTargetNode")||null,m=d.ui.fancytree.getNode(b.target);if(b.target&&!m&&(l=0<d(b.target).closest("div.fancytree-drag-helper,#fancytree-drop-marker").length)){f("Drag event over helper: ignored.");return}c.helper.data("ftTargetNode",m);n&&n!==m&&n.tree.ext.dnd._onDragEvent("leave",n,k,b,c,g);m&&m.tree.options.dnd.dragDrop&&(m===n?m.tree.ext.dnd._onDragEvent("over",m,k,b,c,g):m.tree.ext.dnd._onDragEvent("enter",m,k,b,
c,g))},stop:function(b,c){var l=d(this).data("ui-draggable")||d(this).data("draggable"),g=c.helper.data("ftSourceNode")||null,k=c.helper.data("ftTargetNode")||null,n="mouseup"===b.type&&1===b.which;n||f("Drag was cancelled");k&&(n&&k.tree.ext.dnd._onDragEvent("drop",k,g,b,c,l),k.tree.ext.dnd._onDragEvent("leave",k,g,b,c,l));g&&g.tree.ext.dnd._onDragEvent("stop",g,null,b,c,l)}}),g=!0)}var f=d.ui.fancytree.debug,g=!1;d.ui.fancytree.registerExtension({name:"dnd",version:"0.1.0",options:{dragStart:null,
dragStop:null,autoExpandMS:1E3,preventVoidMoves:!0,preventRecursiveMoves:!0,dragEnter:null,dragOver:null,dragDrop:null,dragLeave:null,draggable:null,droppable:null},treeInit:function(b){var c=b.tree;this._super(b);m(c)},nodeKeydown:function(b){b.originalEvent.which===d.ui.keyCode.ESCAPE&&this._local._cancelDrag();return this._super(b)},_setDndStatus:function(b,c,f,g,k){var n;n=0;var m="center",r=this._local;b=b?d(b.span):null;c=d(c.span);r.$dropMarker||(r.$dropMarker=d("<div id='fancytree-drop-marker'></div>").hide().css({"z-index":1E3}).prependTo(d(this.$div).parent()));
if("after"===g||"before"===g||"over"===g){switch(g){case "before":r.$dropMarker.removeClass("fancytree-drop-after fancytree-drop-over").addClass("fancytree-drop-before");m="top";break;case "after":r.$dropMarker.removeClass("fancytree-drop-before fancytree-drop-over").addClass("fancytree-drop-after");m="bottom";break;default:r.$dropMarker.removeClass("fancytree-drop-after fancytree-drop-before").addClass("fancytree-drop-over"),c.addClass("fancytree-drop-target"),n=8}n=d.ui.fancytree.jquerySupports.positionMyOfs?
{my:"left"+(0===n?"":0<n?"+"+n:""+n)+" center",at:"left "+m,of:c}:{my:"left center",at:"left "+m,of:c,offset:""+n+" 0"};r.$dropMarker.show().position(n)}else c.removeClass("fancytree-drop-target"),r.$dropMarker.hide();"after"===g?c.addClass("fancytree-drop-after"):c.removeClass("fancytree-drop-after");"before"===g?c.addClass("fancytree-drop-before"):c.removeClass("fancytree-drop-before");!0===k?(b&&b.addClass("fancytree-drop-accept"),c.addClass("fancytree-drop-accept"),f.addClass("fancytree-drop-accept")):
(b&&b.removeClass("fancytree-drop-accept"),c.removeClass("fancytree-drop-accept"),f.removeClass("fancytree-drop-accept"));!1===k?(b&&b.addClass("fancytree-drop-reject"),c.addClass("fancytree-drop-reject"),f.addClass("fancytree-drop-reject")):(b&&b.removeClass("fancytree-drop-reject"),c.removeClass("fancytree-drop-reject"),f.removeClass("fancytree-drop-reject"))},_onDragEvent:function(b,c,g,m,k,n){"over"!==b&&f("tree.ext.dnd._onDragEvent(%s, %o, %o) - %o",b,c,g,this);var p,r,x=this.options.dnd;n=this._makeHookContext(c,
m,{otherNode:g,ui:k,draggable:n});var t=null,C=d(c.span);switch(b){case "helper":k=d("<div class='fancytree-drag-helper'><span class='fancytree-drag-helper-img' /></div>").css({zIndex:3,position:"relative"}).append(C.find("span.fancytree-title").clone());d("ul.fancytree-container",c.tree.$div).append(k);k.data("ftSourceNode",c);t=k;break;case "start":c.isStatusNode()?t=!1:x.dragStart&&(t=x.dragStart(c,n));!1===t?(this.debug("tree.dragStart() cancelled"),k.helper.trigger("mouseup").hide()):C.addClass("fancytree-drag-source");
break;case "enter":t=(c=x.preventRecursiveMoves&&c.isDescendantOf(g)?!1:x.dragEnter?x.dragEnter(c,n):null)?d.isArray(c)?{over:0<=d.inArray("over",c),before:0<=d.inArray("before",c),after:0<=d.inArray("after",c)}:{over:!0===c||"over"===c,before:!0===c||"before"===c,after:!0===c||"after"===c}:!1;k.helper.data("enterResponse",t);f("helper.enterResponse: %o",t);break;case "over":b=k.helper.data("enterResponse");r=null;!1!==b&&("string"===typeof b?r=b:(p=C.offset(),m=m.pageY-p.top,C.width(),m/=C.height(),
b.after&&.75<m?r="after":!b.over&&b.after&&.5<m?r="after":b.before&&.25>=m?r="before":!b.over&&b.before&&.5>=m?r="before":b.over&&(r="over"),x.preventVoidMoves&&(c===g?(f("    drop over source node prevented"),r=null):"before"===r&&g&&c===g.getNextSibling()?(f("    drop after source node prevented"),r=null):"after"===r&&g&&c===g.getPrevSibling()?(f("    drop before source node prevented"),r=null):"over"===r&&g&&g.parent===c&&g.isLastSibling()&&(f("    drop last child over own parent prevented"),r=
null)),k.helper.data("hitMode",r)));"over"===r&&x.autoExpandMS&&!1!==c.hasChildren()&&!c.expanded&&c.scheduleAction("expand",x.autoExpandMS);r&&x.dragOver&&(n.hitMode=r,t=x.dragOver(c,n));this._local._setDndStatus(g,c,k.helper,r,!1!==t&&null!==r);break;case "drop":(r=k.helper.data("hitMode"))&&x.dragDrop&&(n.hitMode=r,x.dragDrop(c,n));break;case "leave":c.scheduleAction("cancel");k.helper.data("enterResponse",null);k.helper.data("hitMode",null);this._local._setDndStatus(g,c,k.helper,"out",v);x.dragLeave&&
x.dragLeave(c,n);break;case "stop":C.removeClass("fancytree-drag-source");x.dragStop&&x.dragStop(c,n);break;default:d.error("Unsupported drag event: "+b)}return t},_cancelDrag:function(){var b=d.ui.ddmanager.current;b&&b.cancel()}})})(jQuery,window,document);
(function(d,B,t,v){var m=/Mac/.test(navigator.platform),p=d.ui.fancytree.escapeHtml,f=d.ui.fancytree.unescapeHtml;d.ui.fancytree._FancytreeNodeClass.prototype.editStart=function(){var g,b=this,c=this.tree,l=c.ext.edit,m=b.title,k=c.options.edit,n=d(".fancytree-title",b.span),p={node:b,tree:c,options:c.options};if(!1===k.beforeEdit.call(b,{type:"beforeEdit"},p))return!1;m=b.title;b.debug("editStart");c.widget._unbind();d(t).on("mousedown.fancytree-edit",function(c){d(c.target).hasClass("fancytree-edit-input")||
b.editEnd(!0,c)});g=d("<input />",{"class":"fancytree-edit-input",value:f(m)});null!=k.adjustWidthOfs&&g.width(n.width()+k.adjustWidthOfs);null!=k.inputCss&&g.css(k.inputCss);p.input=g;n.html(g);d.ui.fancytree.assert(!l.currentNode,"recursive edit");l.currentNode=this;g.focus().change(function(b){g.addClass("fancytree-edit-dirty")}).keydown(function(c){switch(c.which){case d.ui.keyCode.ESCAPE:b.editEnd(!1,c);break;case d.ui.keyCode.ENTER:return b.editEnd(!0,c),!1}}).blur(function(c){return b.editEnd(!0,
c)});k.edit.call(b,{type:"edit"},p)};d.ui.fancytree._FancytreeNodeClass.prototype.editEnd=function(f,b){var c=this.tree,l=c.ext.edit,m=c.options.edit,k=d(".fancytree-title",this.span).find("input.fancytree-edit-input"),n=k.val(),u=k.hasClass("fancytree-edit-dirty"),r=(f||u&&!1!==f)&&n!==this.title,u={node:this,tree:c,options:c.options,originalEvent:b,dirty:u,save:r,input:k,value:n};if(!1===m.beforeClose.call(this,{type:"beforeClose"},u)||r&&!1===m.save.call(this,{type:"save"},u))return!1;k.removeClass("fancytree-edit-dirty").unbind();
d(t).off(".fancytree-edit");r?this.setTitle(p(n)):this.renderTitle();c.widget._bind();l.currentNode=null;this.setFocus();d(c.$container).focus();u.input=null;m.close.call(this,{type:"close"},u);return!0};d.ui.fancytree._FancytreeNodeClass.prototype.startEdit=function(){this.warn("FancytreeNode.startEdit() is deprecated since 2014-01-04. Use .editStart() instead.");return this.editStart.apply(this,arguments)};d.ui.fancytree._FancytreeNodeClass.prototype.endEdit=function(){this.warn("FancytreeNode.endEdit() is deprecated since 2014-01-04. Use .editEnd() instead.");
return this.editEnd.apply(this,arguments)};d.ui.fancytree._FancytreeClass.prototype.isEditing=function(){return this.ext.edit.currentNode};d.ui.fancytree._FancytreeNodeClass.prototype.isEditing=function(){return this.tree.ext.edit.currentNode===this};d.ui.fancytree.registerExtension({name:"edit",version:"0.1.0",options:{adjustWidthOfs:4,inputCss:{minWidth:"3em"},triggerCancel:["esc","tab","click"],triggerStart:["f2","shift+click","mac+enter"],beforeClose:d.noop,beforeEdit:d.noop,close:d.noop,edit:d.noop,
save:d.noop},currentNode:null,treeInit:function(d){this._super(d);this.$container.addClass("fancytree-ext-edit")},nodeClick:function(f){return 0<=d.inArray("shift+click",f.options.edit.triggerStart)&&f.originalEvent.shiftKey?(f.node.editStart(),!1):this._super(f)},nodeDblclick:function(f){return 0<=d.inArray("dblclick",f.options.edit.triggerStart)?(f.node.editStart(),!1):this._super(f)},nodeKeydown:function(f){switch(f.originalEvent.which){case 113:if(0<=d.inArray("f2",f.options.edit.triggerStart))return f.node.editStart(),
!1;break;case d.ui.keyCode.ENTER:if(0<=d.inArray("mac+enter",f.options.edit.triggerStart)&&m)return f.node.editStart(),!1}return this._super(f)}})})(jQuery,window,document);
(function(d,B,t,v){d.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(d,p,f){var g,b,c=0,l="hide"===this.options.filter.mode;f=!!f&&!p;"string"===typeof d&&(g=(d+"").replace(/([.?*+\^\$\[\]\\(){}|-])/g,"\\$1"),b=new RegExp(".*"+g+".*","i"),d=function(c){return!!b.exec(c.title)});this.enableFilter=!0;this.$div.addClass("fancytree-ext-filter");l?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm");this.visit(function(b){delete b.match;delete b.subMatch});
this.visit(function(b){if((!f||null==b.children)&&d(b)&&(c++,b.match=!0,b.visitParents(function(b){b.subMatch=!0}),p))return b.visit(function(b){b.match=!0}),"skip"});this.render();return c};d.ui.fancytree._FancytreeClass.prototype.filterNodes=function(d,p){return this._applyFilterImpl(d,!1,p)};d.ui.fancytree._FancytreeClass.prototype.applyFilter=function(d){this.warn("Fancytree.applyFilter() is deprecated since 2014-05-10. Use .filterNodes() instead.");return this.filterNodes.apply(this,arguments)};
d.ui.fancytree._FancytreeClass.prototype.filterBranches=function(d){return this._applyFilterImpl(d,!0,null)};d.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){this.visit(function(d){delete d.match;delete d.subMatch});this.enableFilter=!1;this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide");this.render()};d.ui.fancytree.registerExtension({name:"filter",version:"0.2.0",options:{mode:"dimm"},treeInit:function(d){this._super(d)},nodeRenderStatus:function(m){var p=
m.node,f=m.tree,g=d(p[f.statusClassPropName]);m=this._super(m);if(!g.length||!f.enableFilter)return m;g.toggleClass("fancytree-match",!!p.match).toggleClass("fancytree-submatch",!!p.subMatch).toggleClass("fancytree-hide",!(p.match||p.subMatch));return m}})})(jQuery,window,document);
(function(d,B,t,v){d.ui.fancytree.registerExtension({name:"glyph",version:"0.1.0",options:{prefix:"icon-",extra:null,map:{doc:"icon-file-alt",docOpen:"icon-file-alt",checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt",loading:"icon-refresh icon-spin",noExpander:""},
icon:null},treeInit:function(d){var p=d.tree;this._super(d);p.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(m){var p,f=m.node,g=m.options.glyph,b=g.map;this._super(m);if(!f.isRoot()){if(p=d("span.fancytree-expander",f.span).get(0))m=f.isLoading()?"loading":f.expanded?"expanderOpen":f.isUndefined()?"expanderLazy":f.hasChildren()?"expanderClosed":"noExpander",p.className="fancytree-expander "+b[m];if(p=d("span.fancytree-checkbox",f.tr||f.span).get(0))m=f.selected?"checkboxSelected":
f.partsel?"checkboxUnknown":"checkbox",p.className="fancytree-checkbox "+b[m];if(p=d("span.fancytree-icon",f.span).get(0))m=f.folder?f.expanded?g.map.folderOpen:g.map.folder:f.expanded?g.map.docOpen:g.map.doc,p.className="fancytree-icon "+m}},nodeSetStatus:function(m,p,f,g){var b=m.options.glyph,c=m.node;this._super(m,p,f,g);m=c.parent?d("span.fancytree-expander",c.span).get(0):d(".fancytree-statusnode-wait, .fancytree-statusnode-error",c[this.nodeContainerAttrName]).find("span.fancytree-expander").get(0);
"loading"===p?m.className="fancytree-expander "+b.map.loading:"error"===p&&(m.className="fancytree-expander "+b.map.error)}})})(jQuery,window,document);
(function(d,B,t,v){function m(b,c){var f,g=c.get(0),k=0;b.children().each(function(){if(this===g)return!1;f=d(this).prop("colspan");k+=f?f:1});return k}function p(b,c){var f,g=null,k=0;b.children().each(function(){if(k>=c)return g=d(this),!1;f=d(this).prop("colspan");k+=f?f:1});return g}var f=d.ui.keyCode,g={text:[f.UP,f.DOWN],checkbox:[f.UP,f.DOWN,f.LEFT,f.RIGHT],radiobutton:[f.UP,f.DOWN,f.LEFT,f.RIGHT],"select-one":[f.LEFT,f.RIGHT],"select-multiple":[f.LEFT,f.RIGHT]};d.ui.fancytree.registerExtension({name:"gridnav",
version:"0.0.1",options:{autofocusInput:!1,handleCursorKeys:!0},treeInit:function(b){this._requireExtension("table",!0,!0);this._super(b);this.$container.addClass("fancytree-ext-gridnav");this.$container.on("focusin",function(c){var f=d.ui.fancytree.getNode(c.target);f&&!f.isActive()&&(c=b.tree._makeHookContext(f,c),b.tree._callHook("nodeSetActive",c,!0))})},nodeSetActive:function(b,c){var f;f=b.options.gridnav;var g=b.node,k=d((b.originalEvent||{}).target).is(":input");c=!1!==c;this._super(b,c);
c&&(b.options.titlesTabbable?(k||(d(g.span).find("span.fancytree-title").focus(),g.setFocus()),b.tree.$container.attr("tabindex","-1")):f.autofocusInput&&!k&&(f=d(g.tr||g.span),f.find(":input:enabled:first").focus()))},nodeKeydown:function(b){var c,l,y=b.options.gridnav,k=b.originalEvent;l=d(k.target);if((c=l.is(":input:enabled")?l.prop("type"):null)&&y.handleCursorKeys){if((b=g[c])&&0<=d.inArray(k.which,b)){k=k.which;c=l.closest("td");b=null;switch(k){case f.LEFT:b=c.prev();break;case f.RIGHT:b=
c.next();break;case f.UP:case f.DOWN:for(l=c.parent(),c=m(l,c);;){l=k===f.UP?l.prev():l.next();if(!l.length)break;if(!l.is(":hidden")&&(b=p(l,c))&&b.find(":input").length)break}}if((l=b)&&l.length)return l.find(":input:enabled").focus(),!1}return!0}b.tree.debug("ext-gridnav NOT HANDLED",k,c);return this._super(b)}})})(jQuery,window,document);
(function(d,B,t,v){function m(f,g){f||d.error("Assertion failed "+(g||""))}function p(f,g,b,c,l){var m,k,n,u,r=!1,t=[],v=[];b=b||[];l=l||d.Deferred();m=0;for(n=b.length;m<n;m++)k=b[m],(u=f.getNodeByKey(k))?c&&u.isUndefined()?(r=!0,f.debug("_loadLazyNodes: "+u+" is lazy: loading..."),"expand"===c?t.push(u.setExpanded()):t.push(u.load())):(f.debug("_loadLazyNodes: "+u+" already loaded."),u.setExpanded()):(v.push(k),f.debug("_loadLazyNodes: "+u+" was not yet found."));d.when.apply(d,t).always(function(){if(r&&
0<v.length)p(f,g,v,c,l);else{if(v.length)for(f.warn("_loadLazyNodes: could not load those keys: ",v),m=0,n=v.length;m<n;m++)k=b[m],g._appendKey("expanded",b[m],!1);l.resolve()}});return l}d.ui.fancytree._FancytreeClass.prototype.clearCookies=function(d){var g=this.ext.persist,b=g.cookiePrefix;d=d||"active expanded focus selected";0<=d.indexOf("active")&&g._data(b+"active",null);0<=d.indexOf("expanded")&&g._data(b+"expanded",null);0<=d.indexOf("focus")&&g._data(b+"focus",null);0<=d.indexOf("selected")&&
g._data(b+"selected",null)};d.ui.fancytree._FancytreeClass.prototype.getPersistData=function(){var d=this.ext.persist,g=d.cookiePrefix,b=d.cookieDelimiter,c={};c.active=d._data(g+"active");c.expanded=(d._data(g+"expanded")||"").split(b);c.selected=(d._data(g+"selected")||"").split(b);c.focus=d._data(g+"focus");return c};d.ui.fancytree.registerExtension({name:"persist",version:"0.3.0",options:{cookieDelimiter:"~",cookiePrefix:v,cookie:{raw:!1,expires:"",path:"",domain:"",secure:!1},expandLazy:!1,overrideSource:!1,
store:"auto",types:"active expanded focus selected"},_data:function(f,g){var b=this._local.localStorage;if(g===v)return b?b.getItem(f):d.cookie(f);null===g?b?b.removeItem(f):d.removeCookie(f):b?b.setItem(f,g):d.cookie(f,g,this.options.persist.cookie)},_appendKey:function(f,g,b){g=""+g;var c=this._local,l=this.options.persist.cookieDelimiter;f=c.cookiePrefix+f;var m=c._data(f),m=m?m.split(l):[],k=d.inArray(g,m);0<=k&&m.splice(k,1);b&&m.push(g);c._data(f,m.join(l))},treeInit:function(f){var g=f.tree,
b=f.options,c=this._local,l=this.options.persist;m("localStore"===l.store||d.cookie,"Missing required plugin for 'persist' extension: jquery.cookie.js");c.cookiePrefix=l.cookiePrefix||"fancytree-"+g._id+"-";c.storeActive=0<=l.types.indexOf("active");c.storeExpanded=0<=l.types.indexOf("expanded");c.storeSelected=0<=l.types.indexOf("selected");c.storeFocus=0<=l.types.indexOf("focus");c.localStorage="cookie"!==l.store&&B.localStorage?"local"===l.store?B.localStorage:B.sessionStorage:null;g.$div.bind("fancytreeinit",
function(f){var k,m,u,r,x=d.cookie(c.cookiePrefix+"focus");g.debug("COOKIE "+t.cookie);u=(k=c._data(c.cookiePrefix+"expanded"))&&k.split(l.cookieDelimiter);(c.storeExpanded?p(g,c,u,l.expandLazy?"expand":!1,null):(new d.Deferred).resolve()).done(function(){if(c.storeSelected&&(k=c._data(c.cookiePrefix+"selected")))for(u=k.split(l.cookieDelimiter),m=0;m<u.length;m++)if(r=g.getNodeByKey(u[m])){if(r.selected===v||l.overrideSource&&!1===r.selected)r.selected=!0,r.renderStatus()}else c._appendKey("selected",
u[m],!1);c.storeActive&&(!(k=c._data(c.cookiePrefix+"active"))||!b.persist.overrideSource&&g.activeNode||(r=g.getNodeByKey(k))&&r.setActive());c.storeFocus&&x&&(r=g.getNodeByKey(x))&&r.setFocus()})});return this._super(f)},nodeSetActive:function(d,g,b){var c=this._local;d=this._super(d,!1!==g,b);c.storeActive&&c._data(c.cookiePrefix+"active",this.activeNode?this.activeNode.key:null);return d},nodeSetExpanded:function(d,g,b){var c=d.node,l=this._local;g=!1!==g;d=this._super(d,g,b);l.storeExpanded&&
l._appendKey("expanded",c.key,g);return d},nodeSetFocus:function(d,g){var b,c=this._local;g=!1!==g;b=this._super(d,g);g&&c.storeFocus&&c._data(c.cookiePrefix+"focus",this.focusNode?this.focusNode.key:null);return b},nodeSetSelected:function(d,g){var b,c=d.node,l=this._local;g=!1!==g;b=this._super(d,g);l.storeSelected&&l._appendKey("selected",c.key,g);return b}})})(jQuery,window,document);
(function(d,B,t,v){function m(b,c){b||d.error("Assertion failed "+(c||""))}function p(b,c){b.parentNode.insertBefore(c,b.nextSibling)}function f(b,c){b.visit(function(b){var d=b.tr;d&&(d.style.display=b.hide||!c?"none":"");if(!b.expanded)return"skip"})}function g(b){var c,f=b.parent;if((c=f?f.children:null)&&1<c.length&&c[0]!==b)for(b=d.inArray(b,c),b=c[b-1],m(b.tr);b.children;){c=b.children[b.children.length-1];if(!c.tr)break;b=c}else b=f;return b}d.ui.fancytree.registerExtension({name:"table",version:"0.2.0",
options:{checkboxColumnIdx:null,customStatus:!1,indentation:16,nodeColumnIdx:0},treeInit:function(b){var c,f,g,k=b.tree,m=k.widget.element;m.addClass("fancytree-container fancytree-ext-table");k.tbody=m.find("> tbody")[0];k.columnCount=d("thead >tr >th",m).length;d(k.tbody).empty();k.rowFragment=t.createDocumentFragment();f=d("<tr />");g="";b.options.aria&&(f.attr("role","row"),g=" role='gridcell'");for(c=0;c<k.columnCount;c++)b.options.table.nodeColumnIdx===c?f.append("<td"+g+"><span class='fancytree-node' /></td>"):
f.append("<td"+g+" />");k.rowFragment.appendChild(f.get(0));k.statusClassPropName="tr";this.nodeContainerAttrName=k.ariaPropName="tr";this._super(b);d(k.rootNode.ul).remove();k.rootNode.ul=null;k.$container=m;this.$container.attr("tabindex",this.options.tabbable?"0":"-1");this.options.aria&&k.$container.attr("role","treegrid").attr("aria-readonly",!0)},nodeRemoveChildMarkup:function(b){b.node.visit(function(b){b.tr&&(d(b.tr).remove(),b.tr=null)})},nodeRemoveMarkup:function(b){var c=b.node;c.tr&&(d(c.tr).remove(),
c.tr=null);this.nodeRemoveChildMarkup(b)},nodeRender:function(b,c,l,t,k){var n,u,r,v,B,C,D=b.tree,A=b.node;C=b.options;r=!A.parent;k||(b.hasCollapsedParents=A.parent&&!A.parent.expanded);if(!r)if(A.tr)c?this.nodeRenderTitle(b):this.nodeRenderStatus(b);else{if(b.hasCollapsedParents){A.debug("nodeRender ignored due to unrendered parent");return}n=D.rowFragment.firstChild.cloneNode(!0);v=g(A);m(v);!0===t&&k?n.style.display="none":l&&b.hasCollapsedParents&&(n.style.display="none");v.tr?p(v.tr,n):(m(!v.parent,
"prev. row must have a tr, or is system root"),D.tbody.appendChild(n));A.tr=n;A.key&&C.generateIds&&(A.tr.id=C.idPrefix+A.key);A.tr.ftnode=A;C.aria&&d(A.tr).attr("aria-labelledby","ftal_"+A.key);A.span=d("span.fancytree-node",A.tr).get(0);this.nodeRenderTitle(b);C.createNode&&C.createNode.call(D,{type:"createNode"},b)}C.renderNode&&C.renderNode.call(D,{type:"renderNode"},b);if((n=A.children)&&(r||l||A.expanded))for(r=0,v=n.length;r<v;r++)C=d.extend({},b,{node:n[r]}),C.hasCollapsedParents=C.hasCollapsedParents||
!A.expanded,this.nodeRender(C,c,l,t,!0);n&&!k&&(B=A.tr||null,u=D.tbody.firstChild,A.visit(function(b){b.tr&&(b.parent.expanded||"none"===b.tr.style.display||(b.tr.style.display="none",f(b,!1)),b.tr.previousSibling!==B&&(A.debug("_fixOrder: mismatch at node: "+b),D.tbody.insertBefore(b.tr,B?B.nextSibling:u)),B=b.tr)}))},nodeRenderTitle:function(b,c){var f,g=b.node,k=b.options;this._super(b);k.checkbox&&null!=k.table.checkboxColumnIdx&&(f=d("span.fancytree-checkbox",g.span).detach(),d(g.tr).find("td:first").html(f));
g.isRoot()||this.nodeRenderStatus(b);(k.table.customStatus||!g.isStatusNode())&&k.renderColumns&&k.renderColumns.call(b.tree,{type:"renderColumns"},b)},nodeRenderStatus:function(b){var c=b.node,f=b.options;this._super(b);d(c.tr).removeClass("fancytree-node");b=(c.getLevel()-1)*f.table.indentation;d(c.span).css({marginLeft:b+"px"})},nodeSetExpanded:function(b,c,g){function m(d){c=!1!==c;f(b.node,c);d?c&&b.options.autoScroll&&!g.noAnimation&&b.node.hasChildren()?b.node.getLastChild().scrollIntoView(!0,
{topNode:b.node}).always(function(){g.noEvents||b.tree._triggerNodeEvent(c?"expand":"collapse",b);k.resolveWith(b.node)}):(g.noEvents||b.tree._triggerNodeEvent(c?"expand":"collapse",b),k.resolveWith(b.node)):(g.noEvents||b.tree._triggerNodeEvent(c?"expand":"collapse",b),k.rejectWith(b.node))}var k=new d.Deferred,n=d.extend({},g,{noEvents:!0,noAnimation:!0});g=g||{};this._super(b,c,n).done(function(){m(!0)}).fail(function(){m(!1)});return k.promise()},nodeSetStatus:function(b,c,f,g){if("ok"===c){var k=
b.node;(k=k.children?k.children[0]:null)&&k.isStatusNode()&&d(k.tr).remove()}this._super(b,c,f,g)},treeClear:function(b){this.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode));return this._super(b)}})})(jQuery,window,document);
(function(d,B,t,v){d.ui.fancytree.registerExtension({name:"themeroller",version:"0.0.1",options:{activeClass:"ui-state-active",foccusClass:"ui-state-focus",hoverClass:"ui-state-hover",selectedClass:"ui-state-highlight"},treeInit:function(m){this._super(m);m=m.widget.element;"TABLE"===m[0].nodeName?(m.addClass("ui-widget ui-corner-all"),m.find(">thead tr").addClass("ui-widget-header"),m.find(">tbody").addClass("ui-widget-conent")):m.addClass("ui-widget ui-widget-content ui-corner-all");m.delegate(".fancytree-node",
"mouseenter mouseleave",function(m){var f=d.ui.fancytree.getNode(m.target);m="mouseenter"===m.type;f.debug("hover: "+m);d(f.span).toggleClass("ui-state-hover ui-corner-all",m)})},treeDestroy:function(d){this._super(d);d.widget.element.removeClass("ui-widget ui-widget-content ui-corner-all")},nodeRenderStatus:function(m){var p=m.node,f=d(p.span);this._super(m);f.toggleClass("ui-state-active",p.isActive());f.toggleClass("ui-state-focus",p.hasFocus());f.toggleClass("ui-state-highlight",p.isSelected())}})})(jQuery,
window,document);
