T.ColladaLoader=function(){function ha(a,b,c){Q=a;b=b||ia;void 0!==c&&(a=c.split("/"),a.pop(),Aa=(1>a.length?".":a.join("/"))+"/");if((a=Q.querySelectorAll("asset")[0])&&a.childNodes)for(c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];switch(d.nodeName){case "unit":(d=d.getAttribute("meter"))&&(Ba=parseFloat(d));break;case "up_axis":Y=d.textContent.charAt(0)}}if(x.convertUpAxis&&Y!==x.upAxis)switch(Y){case "X":E="Y"===x.upAxis?"XtoY":"XtoZ";break;case "Y":E="X"===x.upAxis?"YtoX":"YtoZ";break;
case "Z":E="X"===x.upAxis?"ZtoX":"ZtoY"}else E=null;Z=A("library_images image",ja,"image");ka=A("library_materials material",Ca,"material");la=A("library_effects effect",F,"effect");G=A("library_geometries geometry",Da,"geometry");ma=A("library_cameras camera",na,"camera");oa=A("library_lights light",aa,"light");I=A("library_controllers controller",Ea,"controller");M=A("library_animations animation",pa,"animation");qa=A("library_visual_scenes visual_scene",ba,"visual_scene");ca=[];da=[];(a=Q.querySelectorAll("scene instance_visual_scene")[0])?
(a=a.getAttribute("url").replace(/^#/,""),H=qa[0<a.length?a:"visual_scene0"]):H=null;R=new T.Object3D;for(a=0;a<H.nodes.length;a++)R.add(Fa(H.nodes[a]));R.scale.multiplyScalar(Ba);ra=[];Ga(R);a={scene:R,morphs:ca,skins:da,animations:ra,dae:{images:Z,materials:ka,cameras:ma,lights:oa,effects:la,geometries:G,controllers:I,animations:M,visualScenes:qa,scene:H}};b&&b(a);return a}function A(a,b,c){a=Q.querySelectorAll(a);for(var d={},g=0,e=a.length,h=0;h<e;h++){var f=a[h],f=(new b).parse(f);f.id&&0!=f.id.length||
(f.id=c+g++);d[f.id]=f}return d}function Ga(a){var b=H.getChildById(a.name,!0),c=null;if(b&&b.keys){c={fps:60,hierarchy:[{node:b,keys:b.keys,sids:b.sids}],node:a,name:"animation_"+a.name,length:0};ra.push(c);for(var d=0,g=b.keys.length;d<g;d++)c.length=Math.max(c.length,b.keys[d].time)}else c={hierarchy:[{keys:[],sids:[]}]};d=0;for(g=a.children.length;d<g;d++)for(var b=0,e=Ga(a.children[d]).hierarchy.length;b<e;b++)c.hierarchy.push({keys:[],sids:[]});return c}function sa(a,b,c,d){a.world=a.world||
new T.Matrix4;a.localworld=a.localworld||new T.Matrix4;a.world.copy(a.matrix);a.localworld.copy(a.matrix);if(a.channels&&a.channels.length){var g=a.channels[0].sampler.output[c];g instanceof T.Matrix4&&(a.world.copy(g),a.localworld.copy(g),0==c&&a.matrix.copy(g))}d&&a.world.multiplyMatrices(d,a.world);b.push(a);for(d=0;d<a.nodes.length;d++)sa(a.nodes[d],b,c,a.world)}function Ha(a,b){for(var c=0;c<a.length;c++){var d=a[c],g=-1;if("JOINT"==d.type){for(var e=0;e<b.joints.length;e++)if(d.sid==b.joints[e]){g=
e;break}if(0<=g)for(e=b.invBindMatrices[g],d.invBindMatrix=e,d.skinningMatrix=new T.Matrix4,d.skinningMatrix.multiplyMatrices(d.world,e),d.animatrix=new T.Matrix4,d.animatrix.copy(d.localworld),d.weights=[],e=0;e<b.weights.length;e++)for(var h=0;h<b.weights[e].length;h++){var f=b.weights[e][h];f.joint==g&&d.weights.push(f)}else console.warn("ColladaLoader: Could not find joint '"+d.sid+"'."),d.skinningMatrix=new T.Matrix4,d.weights=[]}}}function Wa(a){var b=[],c=function(a,b,e){var h={};h.name=b.sid;
h.parent=a;h.matrix=b.matrix;a=[new T.V3,new T.Quaternion,new T.V3];h.matrix.decompose(a[0],a[1],a[2]);h.pos=[a[0].x,a[0].y,a[0].z];h.scl=[a[2].x,a[2].y,a[2].z];h.rotq=[a[1].x,a[1].y,a[1].z,a[1].w];e.push(h);for(var f in b.nodes)c(b.sid,b.nodes[f],e)};c(-1,a,b);return b}function Ia(a,b,c){var d,g=I[b.url];if(g&&g.skin)if(b.skeleton&&b.skeleton.length){var e=0,h;for(d in M){var f=M[d];h=h||f.id;for(c=0;c<f.sampler.length;c++){var k=f.sampler[c];k.create();e=Math.max(e,k.input.length)}}d=e;c=h;b=H.getChildById(b.skeleton[0],
!0)||H.getChildBySid(b.skeleton[0],!0);var e=Wa(b),l=g.skin.joints;h=[];for(f=0;f<l.length;f++)for(k=0;k<e.length;k++)e[k].name==l[f]&&(h[f]=e[k]);for(f=0;f<h.length;f++)for(k=0;k<h.length;k++)h[f].parent==h[k].name&&(h[f].parent=k);for(var n,q,e=new T.V3,p,f=0;f<a.vertices.length;f++)a.vertices[f].applyMatrix4(g.skin.bindShapeMatrix);for(var k=[],l=[],m=g.skin.weights,f=0;f<m.length;f++){var r=new T.Vector4(m[f][0]?m[f][0].joint:0,m[f][1]?m[f][1].joint:0,m[f][2]?m[f][2].joint:0,m[f][3]?m[f][3].joint:
0);n=new T.Vector4(m[f][0]?m[f][0].weight:0,m[f][1]?m[f][1].weight:0,m[f][2]?m[f][2].weight:0,m[f][3]?m[f][3].weight:0);k.push(r);l.push(n)}a.skinIndices=k;a.skinWeights=l;a.bones=h;l={name:c,fps:30,length:d/30,hierarchy:[]};for(k=0;k<h.length;k++)l.hierarchy.push({parent:h[k].parent,name:h[k].name,keys:[]});if(30>h.length){f=[];sa(b,f,-1);Ha(f,g.skin);v=new T.V3;c=[];for(k=0;k<a.vertices.length;k++)c.push(new T.V3);for(k=0;k<f.length;k++)if("JOINT"==f[k].type)for(j=0;j<f[k].weights.length;j++)w=
f[k].weights[j],vidx=w.index,weight=w.weight,o=a.vertices[vidx],s=c[vidx],v.x=o.x,v.y=o.y,v.z=o.z,v.applyMatrix4(f[k].skinningMatrix),s.x+=v.x*weight,s.y+=v.y*weight,s.z+=v.z*weight;for(k=0;k<a.vertices.length;k++)a.vertices[k]=c[k]}for(c=0;c<d;c++)if(m=[],r=[],sa(b,m,c),Ha(m,g.skin),30>h.length){for(f=0;f<m.length;f++)for(k=0;k<l.hierarchy.length;k++)l.hierarchy[k].name==m[f].sid&&(n={},n.time=c/30,n.matrix=m[f].animatrix,0==c&&(m[f].matrix=n.matrix),r=[new T.V3,new T.Quaternion,new T.V3],n.matrix.decompose(r[0],
r[1],r[2]),n.pos=[r[0].x,r[0].y,r[0].z],n.scl=[r[2].x,r[2].y,r[2].z],n.rot=r[1],l.hierarchy[k].keys.push(n));a.animation=l}else{for(f=0;f<a.vertices.length;f++)r.push(new T.V3);for(f=0;f<m.length;f++)if("JOINT"==m[f].type)for(k=0;k<m[f].weights.length;k++)n=m[f].weights[k],q=n.index,n=n.weight,p=a.vertices[q],q=r[q],e.x=p.x,e.y=p.y,e.z=p.z,e.applyMatrix4(m[f].skinningMatrix),q.x+=e.x*n,q.y+=e.y*n,q.z+=e.z*n;a.morphTargets.push({name:"target_"+c,vertices:r})}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");
else console.log("ColladaLoader: Could not find skin controller.")}function Fa(a,b){var c=new T.Object3D,d,g,e,h;for(e=0;e<a.controllers.length;e++){var f=I[a.controllers[e].url];switch(f.type){case "skin":if(G[f.skin.source]){var k=new S;k.url=f.skin.source;k.instance_material=a.controllers[e].instance_material;a.geometries.push(k);d=a.controllers[e]}else I[f.skin.source]&&(g=f=I[f.skin.source],f.morph&&G[f.morph.source]&&(k=new S,k.url=f.morph.source,k.instance_material=a.controllers[e].instance_material,
a.geometries.push(k)));break;case "morph":G[f.morph.source]&&(k=new S,k.url=f.morph.source,k.instance_material=a.controllers[e].instance_material,a.geometries.push(k),g=a.controllers[e]),console.log("ColladaLoader: Morph-controller partially supported.")}}k={};for(e=0;e<a.geometries.length;e++){h=a.geometries[e];var f=h.instance_material,l=G[h.url],n={},q=[],p=0,m;if(l&&l.mesh&&l.mesh.primitives){0==c.name.length&&(c.name=l.id);if(f)for(h=0;h<f.length;h++){m=f[h];var r=ka[m.target],u=la[r.instance_effect.url].shader.material;
l.doubleSided&&(m.symbol in k||(u=u.clone(),u.side=T.DoubleSide,k[m.symbol]=u),u=k[m.symbol]);u.opacity=u.opacity?u.opacity:1;n[m.symbol]=p;q.push(u);m=u;m.name=null==r.name||""===r.name?r.id:r.name;p++}f=m||T.SceneUtils.createDefaultMaterials(l.useColor)[0];l=l.mesh.geometry3js;if(1<p)for(f=new T.MeshFaceMaterial(q),h=0;h<l.faces.length;h++)q=l.faces[h],q.materialIndex=n[q.daeMaterial];if(void 0!==d)Ia(l,d),0<l.morphTargets.length?(f.morphTargets=!0,f.skinning=!1):(f.morphTargets=!1,f.skinning=!0),
f=new T.SkinnedMesh(l,f,!1),f.name="skin_"+da.length,da.push(f);else if(void 0!==g){h=l;if((n=g instanceof ta?I[g.url]:g)&&n.morph){n=n.morph;for(q=0;q<n.targets.length;q++)p=G[n.targets[q]],p.mesh&&p.mesh.primitives&&p.mesh.primitives.length&&(p=p.mesh.primitives[0].geometry,p.vertices.length===h.vertices.length&&h.morphTargets.push({name:"target_1",vertices:p.vertices}));h.morphTargets.push({name:"target_Z",vertices:h.vertices})}else console.log("could not find morph controller!");f.morphTargets=
!0;f=T.SceneUtils.createMesh(l,f);f.name="morph_"+ca.length;ca.push(f)}else f=T.SceneUtils.createMesh(l,f);1<a.geometries.length?c.add(f):c=f}}for(e=0;e<a.cameras.length;e++)d=ma[a.cameras[e].url],d=new T.PerspectiveCamera(d.yfov,parseFloat(d.aspect_ratio),parseFloat(d.znear),parseFloat(d.zfar)),c.add(d);for(e=0;e<a.lights.length;e++){d=null;if((g=oa[a.lights[e].url])&&g.technique)switch(k=g.color.getHex(),m=g.intensity,f=g.falloff_angle,g.technique){case "directional":d=new T.DirectionalLight(k,
m,0);d.position.set(0,0,1);break;case "point":d=new T.PointLight(k,m,0);break;case "spot":d=new T.SpotLight(k,m,0,f,void 0);d.position.set(0,0,1);break;case "ambient":d=new T.AmbientLight(k)}d&&c.add(d)}c.name=a.name||a.id||"";c.layer=a.layer||"";c.matrix=a.matrix;c.matrix.decompose(c.position,c.quaternion,c.scale);x.centerGeometry&&c.geometry&&(e=T.GeometryUtils.center(c.geometry),e.multiply(c.scale),e.applyQuaternion(c.quaternion),c.position.sub(e));for(e=0;e<a.nodes.length;e++)c.add(Fa(a.nodes[e],
a));return c}function ja(){this.init_from=this.id=""}function Ea(){this.type=this.name=this.id="";this.morph=this.skin=null}function ua(){this.weights=this.targets=this.source=this.method=null}function ea(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}function ba(){this.name=this.id="";this.nodes=[];this.scene=new T.Object3D}function D(){this.sid=this.name=this.id="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=
[];this.matrix=new T.Matrix4}function U(){this.type=this.sid="";this.data=[];this.obj=null}function ta(){this.url="";this.skeleton=[];this.instance_material=[]}function va(){this.target=this.symbol=""}function S(){this.url="";this.instance_material=[]}function Da(){this.id="";this.mesh=null}function wa(a){this.geometry=a.id;this.primitives=[];this.geometry3js=this.vertices=null}function J(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new T.Geometry}function Ja(){J.call(this);
this.vcount=[]}function Ka(){J.call(this);this.vcount=3}function La(){this.source="";this.stride=this.count=0;this.params=[]}function Ma(){this.input={}}function K(){this.semantic="";this.offset=0;this.source="";this.set=0}function N(a){this.id=a;this.type=null}function Ca(){this.name=this.id="";this.instance_effect=null}function O(){this.color=new T.Color;this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texOpts=this.texcoord=this.texture=null}function xa(a,b){this.type=
a;this.effect=b;this.material=null}function Na(a){this.effect=a;this.format=this.init_from=null}function Oa(a){this.effect=a;this.mipfilter=this.magfilter=this.minfilter=this.wrap_t=this.wrap_s=this.source=null}function F(){this.name=this.id="";this.shader=null;this.surface={};this.sampler={}}function Pa(){this.url=""}function pa(){this.name=this.id="";this.source={};this.sampler=[];this.channel=[]}function Qa(a){this.animation=a;this.target=this.source="";this.member=this.arrIndices=this.arrSyntax=
this.dotSyntax=this.sid=this.fullSid=null}function fa(a){this.id="";this.animation=a;this.inputs=[];this.endTime=this.startTime=this.interpolation=this.strideOut=this.output=this.input=null;this.duration=0}function P(a){this.targets=[];this.time=a}function na(){this.technique=this.name=this.id=""}function Ra(){this.url=""}function aa(){this.technique=this.name=this.id=""}function Sa(){this.url=""}function V(a){a=ga(a);for(var b=[],c=0,d=a.length;c<d;c++)b.push(parseFloat(a[c]));return b}function W(a){a=
ga(a);for(var b=[],c=0,d=a.length;c<d;c++)b.push(parseInt(a[c],10));return b}function ga(a){return 0<a.length?a.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/):[]}function X(a,b,c){return a.hasAttribute(b)?parseInt(a.getAttribute(b),10):c}function Ta(a,b){a.doubleSided=!1;var c=b.querySelectorAll("extra double_sided")[0];c&&c&&1===parseInt(c.textContent,10)&&(a.doubleSided=!0)}function z(a,b){if(x.convertUpAxis&&Y!==x.upAxis)switch(E){case "XtoY":var c=a[0];a[0]=b*a[1];a[1]=c;break;case "XtoZ":c=
a[2];a[2]=a[1];a[1]=a[0];a[0]=c;break;case "YtoX":c=a[0];a[0]=a[1];a[1]=b*c;break;case "YtoZ":c=a[1];a[1]=b*a[2];a[2]=c;break;case "ZtoX":c=a[0];a[0]=a[1];a[1]=a[2];a[2]=c;break;case "ZtoY":c=a[1],a[1]=a[2],a[2]=b*c}}function ya(a,b){var c=[a[b],a[b+1],a[b+2]];z(c,-1);return new T.V3(c[0],c[1],c[2])}function za(a){if(x.convertUpAxis){var b=[a[0],a[4],a[8]];z(b,-1);a[0]=b[0];a[4]=b[1];a[8]=b[2];b=[a[1],a[5],a[9]];z(b,-1);a[1]=b[0];a[5]=b[1];a[9]=b[2];b=[a[2],a[6],a[10]];z(b,-1);a[2]=b[0];a[6]=b[1];
a[10]=b[2];b=[a[0],a[1],a[2]];z(b,-1);a[0]=b[0];a[1]=b[1];a[2]=b[2];b=[a[4],a[5],a[6]];z(b,-1);a[4]=b[0];a[5]=b[1];a[6]=b[2];b=[a[8],a[9],a[10]];z(b,-1);a[8]=b[0];a[9]=b[1];a[10]=b[2];b=[a[3],a[7],a[11]];z(b,-1);a[3]=b[0];a[7]=b[1];a[11]=b[2]}return new T.Matrix4(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])}function Ua(a){if(x.convertUpAxis)switch(a){case "X":switch(E){case "XtoY":case "XtoZ":case "YtoX":a="Y";break;case "ZtoX":a="Z"}break;case "Y":switch(E){case "XtoY":case "YtoX":case "ZtoX":a=
"X";break;case "XtoZ":case "YtoZ":case "ZtoY":a="Z"}break;case "Z":switch(E){case "XtoZ":a="X";break;case "YtoZ":case "ZtoX":case "ZtoY":a="Y"}}return a}var Q=null,R=null,H,ia=null,L={},Z={},M={},I={},G={},ka={},la={},ma={},oa={},ra,qa,Aa,ca,da,Va=T.SmoothShading,x={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},Ba=1,Y="Y",E=null;ja.prototype.parse=function(a){this.id=a.getAttribute("id");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];"init_from"==
c.nodeName&&(this.init_from=c.textContent)}return this};Ea.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");this.type="none";for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case "skin":this.skin=(new ea).parse(c);this.type=c.nodeName;break;case "morph":this.morph=(new ua).parse(c),this.type=c.nodeName}}return this};ua.prototype.parse=function(a){var b={},c=[],d;this.method=a.getAttribute("method");this.source=a.getAttribute("source").replace(/^#/,
"");for(d=0;d<a.childNodes.length;d++){var g=a.childNodes[d];if(1==g.nodeType)switch(g.nodeName){case "source":g=(new N).parse(g);b[g.id]=g;break;case "targets":c=this.parseInputs(g);break;default:console.log(g.nodeName)}}for(d=0;d<c.length;d++)switch(a=c[d],g=b[a.source],a.semantic){case "MORPH_TARGET":this.targets=g.read();break;case "MORPH_WEIGHT":this.weights=g.read()}return this};ua.prototype.parseInputs=function(a){for(var b=[],c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case "input":b.push((new K).parse(d))}}return b};
ea.prototype.parse=function(a){var b={},c,d;this.source=a.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var g=0;g<a.childNodes.length;g++){var e=a.childNodes[g];if(1==e.nodeType)switch(e.nodeName){case "bind_shape_matrix":e=V(e.textContent);this.bindShapeMatrix=za(e);break;case "source":e=(new N).parse(e);b[e.id]=e;break;case "joints":c=e;break;case "vertex_weights":d=e;break;default:console.log(e.nodeName)}}this.parseJoints(c,b);this.parseWeights(d,
b);return this};ea.prototype.parseJoints=function(a,b){for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case "input":var d=(new K).parse(d),g=b[d.source];"JOINT"==d.semantic?this.joints=g.read():"INV_BIND_MATRIX"==d.semantic&&(this.invBindMatrices=g.read())}}};ea.prototype.parseWeights=function(a,b){for(var c,d,g=[],e=0;e<a.childNodes.length;e++){var h=a.childNodes[e];if(1==h.nodeType)switch(h.nodeName){case "input":g.push((new K).parse(h));break;case "v":c=
W(h.textContent);break;case "vcount":d=W(h.textContent)}}for(e=h=0;e<d.length;e++){for(var f=d[e],k=[],l=0;l<f;l++){for(var n={},q=0;q<g.length;q++){var p=g[q],m=c[h+p.offset];switch(p.semantic){case "JOINT":n.joint=m;break;case "WEIGHT":n.weight=b[p.source].data[m]}}k.push(n);h+=g.length}for(l=0;l<k.length;l++)k[l].index=e;this.weights.push(k)}};ba.prototype.getChildById=function(a,b){for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildById(a,b);if(d)return d}return null};ba.prototype.getChildBySid=
function(a,b){for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildBySid(a,b);if(d)return d}return null};ba.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");this.nodes=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "node":this.nodes.push((new D).parse(c))}}return this};D.prototype.getChannelForTransform=function(a){for(var b=0;b<this.channels.length;b++){var c=this.channels[b],d=c.target.split("/");
d.shift();var g=d.shift(),e=0<=g.indexOf("."),h=0<=g.indexOf("("),f;if(e)d=g.split("."),g=d.shift(),d.shift();else if(h)for(f=g.split("("),g=f.shift(),d=0;d<f.length;d++)f[d]=parseInt(f[d].replace(/\)/,""));if(g==a)return c.info={sid:g,dotSyntax:e,arrSyntax:h,arrIndices:f},c}return null};D.prototype.getChildById=function(a,b){if(this.id==a)return this;if(b)for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildById(a,b);if(d)return d}return null};D.prototype.getChildBySid=function(a,b){if(this.sid==
a)return this;if(b)for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildBySid(a,b);if(d)return d}return null};D.prototype.getTransformBySid=function(a){for(var b=0;b<this.transforms.length;b++)if(this.transforms[b].sid==a)return this.transforms[b];return null};D.prototype.parse=function(a){var b;this.id=a.getAttribute("id");this.sid=a.getAttribute("sid");this.name=a.getAttribute("name");this.type=a.getAttribute("type");this.layer=a.getAttribute("layer");this.type="JOINT"==this.type?this.type:
"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.cameras=[];this.lights=[];this.controllers=[];this.matrix=new T.Matrix4;for(var c=0;c<a.childNodes.length;c++)if(b=a.childNodes[c],1==b.nodeType)switch(b.nodeName){case "node":this.nodes.push((new D).parse(b));break;case "instance_camera":this.cameras.push((new Ra).parse(b));break;case "instance_controller":this.controllers.push((new ta).parse(b));break;case "instance_geometry":this.geometries.push((new S).parse(b));break;case "instance_light":this.lights.push((new Sa).parse(b));
break;case "instance_node":b=b.getAttribute("url").replace(/^#/,"");a:{for(var d=Q.querySelectorAll("library_nodes node"),g=0;g<d.length;g++){var e=d[g].attributes.getNamedItem("id");if(e&&e.value===b){b=d[g];break a}}b=void 0}b&&this.nodes.push((new D).parse(b));break;case "rotate":case "translate":case "scale":case "matrix":case "lookat":case "skew":this.transforms.push((new U).parse(b));break;case "extra":break;default:console.log(b.nodeName)}a=[];c=1E6;b=-1E6;for(var h in M)for(d=M[h],g=0;g<d.channel.length;g++){var e=
d.channel[g],f=d.sampler[g];h=e.target.split("/")[0];h==this.id&&(f.create(),e.sampler=f,c=Math.min(c,f.startTime),b=Math.max(b,f.endTime),a.push(e))}a.length&&(this.startTime=c,this.endTime=b);if((this.channels=a)&&this.channels.length){h=[];a=[];c=0;for(d=this.channels.length;c<d;c++){var k=this.channels[c],g=k.fullSid,e=k.sampler,f=e.input,l=this.getTransformBySid(k.sid),n;if(k.arrIndices){n=[];b=0;for(var q=k.arrIndices.length;b<q;b++){var p=n,m=b,r=k.arrIndices[b];-1<r&&3>r&&(r=Ua(["X","Y","Z"][r]),
r={X:0,Y:1,Z:2}[r]);p[m]=r}}else n=Ua(k.member);if(l)for(-1===a.indexOf(g)&&a.push(g),b=0,q=f.length;b<q;b++){for(var p=f[b],k=e.getData(l.type,b),m=null,r=0,u=h.length;r<u&&null==m;r++){var x=h[r];if(x.time===p)m=x;else if(x.time>p)break}if(!m){m=new P(p);r=-1;u=0;for(x=h.length;u<x&&-1==r;u++)h[u].time>=p&&(r=u);p=r;h.splice(-1==p?h.length:p,0,m)}m.addTarget(g,l,n,k)}else console.log('Could not find transform "'+k.sid+'" in node '+this.id)}for(c=0;c<a.length;c++)for(d=a[c],b=0;b<h.length;b++)if(m=
h[b],!m.hasTarget(d)){f=h;g=m;n=b;e=d;l=void 0;a:{l=n?n-1:0;for(l=0<=l?l:l+f.length;0<=l;l--)if(q=f[l],q.hasTarget(e)){l=q;break a}l=null}q=void 0;a:{for(n+=1;n<f.length;n++)if(q=f[n],q.hasTarget(e))break a;q=null}if(l&&q){f=(g.time-l.time)/(q.time-l.time);l=l.getTarget(e);n=q.getTarget(e).data;q=l.data;k=void 0;if("matrix"===l.type)k=q;else if(q.length)for(k=[],p=0;p<q.length;++p)k[p]=q[p]+(n[p]-q[p])*f;else k=q+(n-q)*f;g.addTarget(e,l.transform,l.member,k)}}this.keys=h;this.sids=a}this.updateMatrix();
return this};D.prototype.updateMatrix=function(){this.matrix.identity();for(var a=0;a<this.transforms.length;a++)this.transforms[a].apply(this.matrix)};U.prototype.parse=function(a){this.sid=a.getAttribute("sid");this.type=a.nodeName;this.data=V(a.textContent);this.convert();return this};U.prototype.convert=function(){switch(this.type){case "matrix":this.obj=za(this.data);break;case "rotate":this.angle=T.Math.degToRad(this.data[3]);case "translate":z(this.data,-1);this.obj=new T.V3(this.data[0],this.data[1],
this.data[2]);break;case "scale":z(this.data,1);this.obj=new T.V3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}};U.prototype.apply=function(){var a=new T.Matrix4;return function(b){switch(this.type){case "matrix":b.multiply(this.obj);break;case "translate":b.multiply(a.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case "rotate":b.multiply(a.makeRotationAxis(this.obj,this.angle));break;case "scale":b.scale(this.obj)}}}();
U.prototype.update=function(a,b){var c=["X","Y","Z","ANGLE"];switch(this.type){case "matrix":if(b)if(1===b.length)switch(b[0]){case 0:this.obj.n11=a[0];this.obj.n21=a[1];this.obj.n31=a[2];this.obj.n41=a[3];break;case 1:this.obj.n12=a[0];this.obj.n22=a[1];this.obj.n32=a[2];this.obj.n42=a[3];break;case 2:this.obj.n13=a[0];this.obj.n23=a[1];this.obj.n33=a[2];this.obj.n43=a[3];break;case 3:this.obj.n14=a[0],this.obj.n24=a[1],this.obj.n34=a[2],this.obj.n44=a[3]}else 2===b.length?this.obj["n"+(b[0]+1)+
(b[1]+1)]=a:console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(a);break;case "translate":case "scale":"[object Array]"===Object.prototype.toString.call(b)&&(b=c[b[0]]);switch(b){case "X":this.obj.x=a;break;case "Y":this.obj.y=a;break;case "Z":this.obj.z=a;break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2]}break;case "rotate":switch("[object Array]"===Object.prototype.toString.call(b)&&(b=c[b[0]]),b){case "X":this.obj.x=a;break;case "Y":this.obj.y=a;break;case "Z":this.obj.z=
a;break;case "ANGLE":this.angle=T.Math.degToRad(a);break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2],this.angle=T.Math.degToRad(a[3])}}};ta.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1===c.nodeType)switch(c.nodeName){case "skeleton":this.skeleton.push(c.textContent.replace(/^#/,""));break;case "bind_material":for(var c=c.querySelectorAll("instance_material"),
d=0;d<c.length;d++){var g=c[d];this.instance_material.push((new va).parse(g))}}}return this};va.prototype.parse=function(a){this.symbol=a.getAttribute("symbol");this.target=a.getAttribute("target").replace(/^#/,"");return this};S.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType&&"bind_material"==c.nodeName){a=c.querySelectorAll("instance_material");for(b=0;b<a.length;b++)c=
a[b],this.instance_material.push((new va).parse(c));break}}return this};Da.prototype.parse=function(a){this.id=a.getAttribute("id");Ta(this,a);for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case "mesh":this.mesh=(new wa(this)).parse(c)}}return this};wa.prototype.parse=function(a){this.primitives=[];var b;for(b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case "source":var d=c.getAttribute("id");void 0==L[d]&&(L[d]=(new N(d)).parse(c));break;
case "vertices":this.vertices=(new Ma).parse(c);break;case "triangles":this.primitives.push((new Ka).parse(c));break;case "polygons":this.primitives.push((new J).parse(c));break;case "polylist":this.primitives.push((new Ja).parse(c))}}this.geometry3js=new T.Geometry;a=L[this.vertices.input.POSITION.source].data;for(b=0;b<a.length;b+=3)this.geometry3js.vertices.push(ya(a,b).clone());for(b=0;b<this.primitives.length;b++)a=this.primitives[b],a.setVertices(this.vertices),this.handlePrimitive(a,this.geometry3js);
this.geometry3js.computeCentroids();this.geometry3js.computeFaceNormals();this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals);return this};wa.prototype.handlePrimitive=function(a,b){var c,d,g=a.p,e=a.inputs,h,f,k,l,n,q=0,p=3,m=0,r=[];for(c=0;c<e.length;c++)switch(h=e[c],p=h.offset+1,m=m<p?p:m,h.semantic){case "TEXCOORD":r.push(h.set)}for(var u=0;u<g.length;++u)for(var z=g[u],A=0;A<z.length;){var t=[],B=[],C=null,y=[],p=a.vcount?a.vcount.length?
a.vcount[q++]:a.vcount:z.length/m;for(c=0;c<p;c++)for(d=0;d<e.length;d++)switch(h=e[d],l=L[h.source],f=z[A+c*m+h.offset],n=l.accessor.params.length,k=f*n,h.semantic){case "VERTEX":t.push(f);break;case "NORMAL":B.push(ya(l.data,k));break;case "TEXCOORD":C=C||{};void 0===C[h.set]&&(C[h.set]=[]);C[h.set].push(new T.Vector2(l.data[k],l.data[k+1]));break;case "COLOR":y.push((new T.Color).setRGB(l.data[k],l.data[k+1],l.data[k+2]))}if(0==B.length)if(h=this.vertices.input.NORMAL)for(l=L[h.source],n=l.accessor.params.length,
c=0,f=t.length;c<f;c++)B.push(ya(l.data,t[c]*n));else b.calcNormals=!0;if(!C&&(C={},h=this.vertices.input.TEXCOORD))for(r.push(h.set),l=L[h.source],n=l.accessor.params.length,c=0,f=t.length;c<f;c++)k=t[c]*n,void 0===C[h.set]&&(C[h.set]=[]),C[h.set].push(new T.Vector2(l.data[k],1-l.data[k+1]));if(0==y.length&&(h=this.vertices.input.COLOR))for(l=L[h.source],n=l.accessor.params.length,c=0,f=t.length;c<f;c++)k=t[c]*n,y.push((new T.Color).setRGB(l.data[k],l.data[k+1],l.data[k+2]));0<y.length&&(b.useColor=
!0);d=null;h=[];if(3===p)h.push(new T.F3(t[0],t[1],t[2],B,y.length?y:new T.Color));else if(4===p)h.push(new T.F3(t[0],t[1],t[3],[B[0],B[1],B[3]],y.length?[y[0],y[1],y[3]]:new T.Color)),h.push(new T.F3(t[1],t[2],t[3],[B[1],B[2],B[3]],y.length?[y[1],y[2],y[3]]:new T.Color));else if(4<p&&x.subdivideFaces)for(y=y.length?y:new T.Color,d=1;d<p-1;)h.push(new T.F3(t[0],t[d],t[d+1],[B[0],B[d++],B[d]],y));if(h.length)for(c=0,f=h.length;c<f;c++)for(d=h[c],d.daeMaterial=a.material,b.faces.push(d),d=0;d<r.length;d++)t=
C[r[d]],t=4<p?[t[0],t[c+1],t[c+2]]:4===p?0===c?[t[0],t[1],t[3]]:[t[1].clone(),t[2],t[3].clone()]:[t[0],t[1],t[2]],void 0===b.faceVertexUvs[d]&&(b.faceVertexUvs[d]=[]),b.faceVertexUvs[d].push(t);else console.log("dropped face with vcount "+p+" for geometry with id: "+b.id);A+=m*p}};J.prototype.setVertices=function(a){for(var b=0;b<this.inputs.length;b++)this.inputs[b].source==a.id&&(this.inputs[b].source=a.input.POSITION.source)};J.prototype.parse=function(a){this.material=a.getAttribute("material");
this.count=X(a,"count",0);for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case "input":this.inputs.push((new K).parse(a.childNodes[b]));break;case "vcount":this.vcount=W(c.textContent);break;case "p":this.p.push(W(c.textContent));break;case "ph":console.warn("polygon holes not yet supported!")}}return this};Ja.prototype=Object.create(J.prototype);Ka.prototype=Object.create(J.prototype);La.prototype.parse=function(a){this.params=[];this.source=a.getAttribute("source");
this.count=X(a,"count",0);this.stride=X(a,"stride",0);for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if("param"==c.nodeName){var d={};d.name=c.getAttribute("name");d.type=c.getAttribute("type");this.params.push(d)}}return this};Ma.prototype.parse=function(a){this.id=a.getAttribute("id");for(var b=0;b<a.childNodes.length;b++)if("input"==a.childNodes[b].nodeName){var c=(new K).parse(a.childNodes[b]);this.input[c.semantic]=c}return this};K.prototype.parse=function(a){this.semantic=a.getAttribute("semantic");
this.source=a.getAttribute("source").replace(/^#/,"");this.set=X(a,"set",-1);this.offset=X(a,"offset",0);"TEXCOORD"==this.semantic&&0>this.set&&(this.set=0);return this};N.prototype.parse=function(a){this.id=a.getAttribute("id");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case "bool_array":for(var d=ga(c.textContent),g=[],e=0,h=d.length;e<h;e++)g.push("true"==d[e]||"1"==d[e]?!0:!1);this.data=g;this.type=c.nodeName;break;case "float_array":this.data=V(c.textContent);
this.type=c.nodeName;break;case "int_array":this.data=W(c.textContent);this.type=c.nodeName;break;case "IDREF_array":case "Name_array":this.data=ga(c.textContent);this.type=c.nodeName;break;case "technique_common":for(d=0;d<c.childNodes.length;d++)if("accessor"==c.childNodes[d].nodeName){this.accessor=(new La).parse(c.childNodes[d]);break}}}return this};N.prototype.read=function(){var a=[],b=this.accessor.params[0];switch(b.type){case "IDREF":case "Name":case "name":case "float":return this.data;
case "float4x4":for(b=0;b<this.data.length;b+=16){var c=this.data.slice(b,b+16),c=za(c);a.push(c)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+b.type+".")}return a};Ca.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++)if("instance_effect"==a.childNodes[b].nodeName){this.instance_effect=(new Pa).parse(a.childNodes[b]);break}return this};O.prototype.isColor=function(){return null==this.texture};
O.prototype.isTexture=function(){return null!=this.texture};O.prototype.parse=function(a){"transparent"==a.nodeName&&(this.opaque=a.getAttribute("opaque"));for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "color":c=V(c.textContent);this.color=new T.Color;this.color.setRGB(c[0],c[1],c[2]);this.color.a=c[3];break;case "texture":this.texture=c.getAttribute("texture"),this.texcoord=c.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,
repeatV:1,wrapU:1,wrapV:1},this.parseTexture(c)}}return this};O.prototype.parseTexture=function(a){if(!a.childNodes)return this;a.childNodes[1]&&"extra"===a.childNodes[1].nodeName&&(a=a.childNodes[1],a.childNodes[1]&&"technique"===a.childNodes[1].nodeName&&(a=a.childNodes[1]));for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case "offsetU":case "offsetV":case "repeatU":case "repeatV":this.texOpts[c.nodeName]=parseFloat(c.textContent);break;case "wrapU":case "wrapV":"TRUE"===
c.textContent.toUpperCase()?this.texOpts[c.nodeName]=1:this.texOpts[c.nodeName]=parseInt(c.textContent);break;default:this.texOpts[c.nodeName]=c.textContent}}return this};xa.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "ambient":case "emission":case "diffuse":case "specular":case "transparent":case "bump":this[c.nodeName]=(new O).parse(c);break;case "shininess":case "reflectivity":case "index_of_refraction":case "transparency":var d=
c.querySelectorAll("float");0<d.length&&(this[c.nodeName]=parseFloat(d[0].textContent))}}this.create();return this};xa.prototype.create=function(){var a={},b=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var c=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;0<c&&(b=!0,a.transparent=!0,a.opacity=1-c)}var c={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"normalMap"},d;for(d in this)switch(d){case "ambient":case "emission":case "diffuse":case "specular":case "bump":var g=
this[d];if(g instanceof O)if(g.isTexture()){var e=this.effect.sampler[g.texture];if(void 0!==e&&void 0!==e.source&&(e=Z[this.effect.surface[e.source].init_from])){if(e=T.FileOperations.getLocalURL(Aa+e.init_from))e=T.ImageUtils.loadTexture(e),e.wrapS=g.texOpts.wrapU?T.RepeatWrapping:T.ClampToEdgeWrapping,e.wrapT=g.texOpts.wrapV?T.RepeatWrapping:T.ClampToEdgeWrapping,e.offset.x=g.texOpts.offsetU,e.offset.y=g.texOpts.offsetV,e.repeat.x=g.texOpts.repeatU,e.repeat.y=g.texOpts.repeatV,a[c[d]]=e;"emission"===
d&&(a.emissive=16777215)}}else"diffuse"!==d&&b||("emission"===d?a.emissive=g.color.getHex():a[d]=g.color.getHex());break;case "shininess":a[d]=this[d];break;case "reflectivity":a[d]=this[d];0<a[d]&&(a.envMap=x.defaultEnvMap);a.combine=T.MixOperation;break;case "index_of_refraction":a.refractionRatio=this[d],1!==this[d]&&(a.envMap=x.defaultEnvMap)}a.shading=Va;a.side=T.DoubleSide;switch(this.type){case "constant":void 0!=a.emissive&&(a.color=a.emissive);this.material=new T.MeshBasicMaterial(a);break;
case "phong":case "blinn":void 0!=a.diffuse&&(a.color=a.diffuse);this.material=new T.ObjectMaterial(a);break;default:void 0!=a.diffuse&&(a.color=a.diffuse),this.material=new T.ObjectMaterial(a)}return this.material};Na.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "init_from":this.init_from=c.textContent;break;case "format":this.format=c.textContent;break;default:console.log("unhandled Surface prop: "+c.nodeName)}}return this};
Oa.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "source":this.source=c.textContent;break;case "minfilter":this.minfilter=c.textContent;break;case "magfilter":this.magfilter=c.textContent;break;case "mipfilter":this.mipfilter=c.textContent;break;case "wrap_s":this.wrap_s=c.textContent;break;case "wrap_t":this.wrap_t=c.textContent;break;default:console.log("unhandled Sampler2D prop: "+c.nodeName)}}return this};F.prototype.create=
function(){if(null==this.shader)return null};F.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");Ta(this,a);this.shader=null;for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(c))}}return this};F.prototype.parseNewparam=function(a){for(var b=a.getAttribute("sid"),c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case "surface":this.surface[b]=
(new Na(this)).parse(d);break;case "sampler2D":this.sampler[b]=(new Oa(this)).parse(d);break;case "extra":break;default:console.log(d.nodeName)}}};F.prototype.parseProfileCOMMON=function(a){for(var b,c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case "profile_COMMON":this.parseProfileCOMMON(d);break;case "technique":b=d;break;case "newparam":this.parseNewparam(d);break;case "image":d=(new ja).parse(d);Z[d.id]=d;break;case "extra":break;default:console.log(d.nodeName)}}return b};
F.prototype.parseTechnique=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "constant":case "lambert":case "blinn":case "phong":this.shader=(new xa(c.nodeName,this)).parse(c);break;case "extra":this.parseExtra(c)}}};F.prototype.parseExtra=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "technique":this.parseExtraTechnique(c)}}};F.prototype.parseExtraTechnique=function(a){for(var b=
0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "bump":this.shader.parse(a)}}};Pa.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");return this};pa.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");this.source={};for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "animation":var c=(new pa).parse(c),d;for(d in c.source)this.source[d]=c.source[d];
for(var g=0;g<c.channel.length;g++)this.channel.push(c.channel[g]),this.sampler.push(c.sampler[g]);break;case "source":d=(new N).parse(c);this.source[d.id]=d;break;case "sampler":this.sampler.push((new fa(this)).parse(c));break;case "channel":this.channel.push((new Qa(this)).parse(c))}}return this};Qa.prototype.parse=function(a){this.source=a.getAttribute("source").replace(/^#/,"");this.target=a.getAttribute("target");var b=this.target.split("/");b.shift();a=b.shift();var c=0<=a.indexOf("."),d=0<=
a.indexOf("(");if(c)b=a.split("."),this.sid=b.shift(),this.member=b.shift();else if(d){b=a.split("(");this.sid=b.shift();for(var g=0;g<b.length;g++)b[g]=parseInt(b[g].replace(/\)/,""));this.arrIndices=b}else this.sid=a;this.fullSid=a;this.dotSyntax=c;this.arrSyntax=d;return this};fa.prototype.parse=function(a){this.id=a.getAttribute("id");this.inputs=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "input":this.inputs.push((new K).parse(c))}}return this};
fa.prototype.create=function(){for(var a=0;a<this.inputs.length;a++){var b=this.inputs[a],c=this.animation.source[b.source];switch(b.semantic){case "INPUT":this.input=c.read();break;case "OUTPUT":this.output=c.read();this.strideOut=c.accessor.stride;break;case "INTERPOLATION":this.interpolation=c.read();break;case "IN_TANGENT":break;case "OUT_TANGENT":break;default:console.log(b.semantic)}}this.duration=this.endTime=this.startTime=0;if(this.input.length){this.startTime=1E8;this.endTime=-1E8;for(a=
0;a<this.input.length;a++)this.startTime=Math.min(this.startTime,this.input[a]),this.endTime=Math.max(this.endTime,this.input[a]);this.duration=this.endTime-this.startTime}};fa.prototype.getData=function(a,b){var c;if("matrix"===a&&16===this.strideOut)c=this.output[b];else if(1<this.strideOut){c=[];b*=this.strideOut;for(var d=0;d<this.strideOut;++d)c[d]=this.output[b+d];if(3===this.strideOut)switch(a){case "rotate":case "translate":z(c,-1);break;case "scale":z(c,1)}else 4===this.strideOut&&"matrix"===
a&&z(c,-1)}else c=this.output[b];return c};P.prototype.addTarget=function(a,b,c,d){this.targets.push({sid:a,member:c,transform:b,data:d})};P.prototype.apply=function(a){for(var b=0;b<this.targets.length;++b){var c=this.targets[b];a&&c.sid!==a||c.transform.update(c.data,c.member)}};P.prototype.getTarget=function(a){for(var b=0;b<this.targets.length;++b)if(this.targets[b].sid===a)return this.targets[b];return null};P.prototype.hasTarget=function(a){for(var b=0;b<this.targets.length;++b)if(this.targets[b].sid===
a)return!0;return!1};P.prototype.interpolate=function(a,b){for(var c=0,d=this.targets.length;c<d;c++){var g=this.targets[c],e=a.getTarget(g.sid);if("matrix"!==g.transform.type&&e){var h=(b-this.time)/(a.time-this.time),f=e.data,k=g.data;0>h&&(h=0);1<h&&(h=1);if(k.length)for(var e=[],l=0;l<k.length;++l)e[l]=k[l]+(f[l]-k[l])*h;else e=k+(f-k)*h}else e=g.data;g.transform.update(e,g.member)}};na.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++){var c=
a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "optics":this.parseOptics(c)}}return this};na.prototype.parseOptics=function(a){for(var b=0;b<a.childNodes.length;b++)if("technique_common"==a.childNodes[b].nodeName)for(var c=a.childNodes[b],d=0;d<c.childNodes.length;d++)if(this.technique=c.childNodes[d].nodeName,"perspective"==this.technique)for(var g=c.childNodes[d],e=0;e<g.childNodes.length;e++){var h=g.childNodes[e];switch(h.nodeName){case "yfov":this.yfov=h.textContent;break;case "xfov":this.xfov=
h.textContent;break;case "znear":this.znear=h.textContent;break;case "zfar":this.zfar=h.textContent;break;case "aspect_ratio":this.aspect_ratio=h.textContent}}else if("orthographic"==this.technique)for(g=c.childNodes[d],e=0;e<g.childNodes.length;e++)switch(h=g.childNodes[e],h.nodeName){case "xmag":this.xmag=h.textContent;break;case "ymag":this.ymag=h.textContent;break;case "znear":this.znear=h.textContent;break;case "zfar":this.zfar=h.textContent;break;case "aspect_ratio":this.aspect_ratio=h.textContent}return this};
Ra.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");return this};aa.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "technique_common":this.parseCommon(c);break;case "technique":this.parseTechnique(c)}}return this};aa.prototype.parseCommon=function(a){for(var b=0;b<a.childNodes.length;b++)switch(a.childNodes[b].nodeName){case "directional":case "point":case "spot":case "ambient":this.technique=
a.childNodes[b].nodeName;for(var c=a.childNodes[b],d=0;d<c.childNodes.length;d++){var g=c.childNodes[d];switch(g.nodeName){case "color":g=V(g.textContent);this.color=new T.Color(0);this.color.setRGB(g[0],g[1],g[2]);this.color.a=g[3];break;case "falloff_angle":this.falloff_angle=parseFloat(g.textContent)}}}return this};aa.prototype.parseTechnique=function(a){this.profile=a.getAttribute("profile");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case "intensity":this.intensity=
parseFloat(c.textContent)}}return this};Sa.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");return this};return{load:function(a,b,c,d){var g=0;if(document.implementation&&document.implementation.createDocument){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState)if(0==e.status||200==e.status)if(e.responseXML)ia=b,ha(e.responseXML,void 0,a);else if(e.responseText){ia=b;var h=(new DOMParser).parseFromString(e.responseText,"application/xml");ha(h,void 0,
a)}else d&&d({type:"error",message:"Couldn't load URL ["+a+"]",responseStatus:event.target.status}),console.error("ColladaLoader: Empty or non-existing file ("+a+")");else d&&d({type:"error",message:"Couldn't load URL ["+a+"]",responseStatus:event.target.status});else 3==e.readyState&&c&&(0==g&&(g=e.getResponseHeader("Content-Length")),c({total:g,loaded:e.responseText.length}))};e.open("GET",a,!0);T.FileOperations.setXHRHeader&&T.FileOperations.setXHRHeader(e,a);e.send(null);return e}alert("Don't know how to parse XML!")},
parse:ha,setPreferredShading:function(a){Va=a},applySkin:Ia,geometries:G,options:x}};
