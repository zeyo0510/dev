T.HoleSelectionControls=function(m,r,e,n){function f(a){a&&a.cancel||!b.enabled||(d.style.cursor="copy",b.enableHover&&(this.computingIntersection||setTimeout(function(){if(a){var c=a.touches?a.touches[0]:a;this.computingIntersection=!0;c=g(c);this.computingIntersection=!1;c&&c.length&&c[0]&&(c={type:"hover",object:c[0].object.badEdgesFor,points:[c[0].object.geometry.vertices[c[0].index].badVertexOf,c[0].object.geometry.vertices[c[0].index+1].badVertexOf],selectionNr:b.selections.length,mode:b.mode},
b.lastHoverEvent=c,b.dispatchEvent(c))}},10)))}function h(a){a&&a.cancel||!b.enabled||(a.preventDefault(),a.stopPropagation(),a=a.touches?a.touches[0]:a,0!==a.button&&void 0!=a.button)||((a=g(a))&&a.length&&a[0]?(a={type:"select",object:a[0].object.badEdgesFor,points:[a[0].object.geometry.vertices[a[0].index].badVertexOf,a[0].object.geometry.vertices[a[0].index+1].badVertexOf],selectionNr:b.selections.length+1,mode:b.mode},b.selections.push(a),b.dispatchEvent(a),b.selections.length>=b.selectionsCount&&
b.dispatchEvent({type:"selected",selections:b.selections,mode:b.mode}),b.lastHoverEvent=null):b.lastHoverEvent&&b.selections.length==b.selectionsCount-1?(a={type:"select",object:b.lastHoverEvent.object,points:b.lastHoverEvent.points,selectionNr:b.selections.length+1,mode:b.mode},b.selections.push(a),b.dispatchEvent(a),b.enabled&&b.dispatchEvent({type:"selected",selections:b.selections,mode:b.mode}),b.lastHoverEvent=null):b.dispatchEvent({type:"select",selectionNr:b.selections.length+1,mode:b.mode}))}
function p(a){var b=d.getBoundingClientRect();a=new T.V3((a.clientX-b.left)/b.width*2-1,2*-((a.clientY-b.top)/b.height)+1,.5);q.unprojectVector(a,e);return a.sub(e.position).normalize()}function g(a){e.updateMatrixWorld();(new T.V3).setFromMatrixPosition(e.matrixWorld);var b=k._createPickingList(m.objects,k.isPickingBadEdge,!0,!0,!1);l.set(e.position,p(a));a=[];for(var d=0,f=b.length;d<f;d++)b[d].raycast(l,a);a=a.filter(function(a){return a.index+1<a.object.geometry.vertices.length&&a.distance>200*
a.precision});a.sort(function(a,b){return a.distance-b.distance});return a}var d=n.dom;this.enabled=!0;this.controlKeyDown=!1;this.mode=null;this.selectionsCount=1;this.enableHover=!1;this.selections=[];var b=this;new T.V3;var l=new T.Raycaster,q=new T.Projector;new T.V3;var k=new T.Picking;this.enable=function(a,c,e){b.enabled&&this.selections.length<c&&b.dispatchEvent({type:"cancel",mode:b.mode});this.selections=[];this.enableHover=e;this.selectionsCount=c?c:1;this.mode=a;this.lastHoverEvent=null;
b.enabled=!0;d.style.cursor="copy"};this.disable=function(){this.selections=[];b.enabled=!1;d.style.cursor="default"};d.addEventListener("mousedown",h,!1);d.addEventListener("touchstart",h,!1);d.addEventListener("mousemove",f,!1);d.addEventListener("touchmove",f,!1);window.addEventListener("keydown",function(a){if(!1!==b.enabled)switch(a.keyCode){case 27:b.dispatchEvent({type:"cancel",mode:b.mode})}},!1)};T.HoleSelectionControls.prototype=Object.create(T.EventDispatcher.prototype);
