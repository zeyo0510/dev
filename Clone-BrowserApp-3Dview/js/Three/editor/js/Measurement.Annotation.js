T.MeasurementAnnotation=function(){T.Measurement.call(this);this.createGizmo=function(d){return this.measurementGizmo=new T.MeasurementGizmoAnnotation(this,d)};this.getValue=function(){return null};this.getInfo=function(){for(var d=this.measurementGizmo.getControlPointsWorld(),f=[],b=0;b<Math.min(1,d.length);++b)f.push({name:"Point",values:[d[b].x,d[b].y,d[b].z]});return f};this.getType=function(){return"Annotation"};this.getDescription=function(){return this.comments&&0!=this.comments.length||this.name&&
0!=this.name.length?this.name&&0!=this.name.length?this.comments&&0!=this.comments.length?"("+this.comments+")":"":this.comments:"untitled"};this.exportMeasurement=function(){var d=T.Measurement.prototype.exportMeasurement.call(this);this.measurementGizmo&&(d.textWidth=this.measurementGizmo.text.getWidth(),d.textHeight=this.measurementGizmo.text.getHeight());return d}};T.MeasurementAnnotation.prototype=Object.create(T.Measurement.prototype);
T.MeasurementGizmoAnnotation=function(d,f){this.initText=function(){this.text=new UI.TextArea;this.text.setDisplay("none");this.text.setPosition("absolute");this.text.setColor("#000000");this.text.setPadding("3px");this.text.setPaddingRight("8px");this.text.setPaddingLeft("8px");this.text.setBackgroundColor("#FFFFFF");this.text.setBorder("1px solid #FF0000");this.text.setOpacity("0.9");this.text.setStyle("font",["normal normal normal 13px/normal 'Helvetica Neue', arial, sans-serif"]);this.text.setStyle("overflow",
["auto"]);this.text.setDisplay("none");this.text.setCursor("default");this.text.setValue("Note");this.container.add(this.text)};T.MeasurementGizmo.call(this,d,f);var b=this;this.handleGizmos={ARROW:[new T.Mesh(new T.CylinderGeometry(3,0,6,8,1,!1),new T.MeasurementGizmoMaterial({color:16711680,opacity:.4})),new T.V3(0,1,0),new T.V3(Math.PI/2,0,0)],LINE:[new T.Mesh(new T.CylinderGeometry(1,1,1,4,1,!1),new T.MeasurementGizmoMaterial({color:16711680,opacity:.4})),new T.V3(0,.5,0),new T.V3(Math.PI/2,0,
0)]};this.pickerGizmos={ARROW:[new T.Mesh(new T.SphereGeometry(4),T.MeasurementPickerMaterial)],LINE:[new T.Mesh(new T.CylinderGeometry(3,3,1,4,1,!1),T.MeasurementPickerMaterial),new T.V3(0,.5,0),new T.V3(Math.PI/2,0,0)],TEXT:[new T.Mesh(new T.SphereGeometry(4),T.MeasurementPickerMaterial)]};this.addControlPoint=function(d,a,e,c,f){T.MeasurementGizmo.prototype.addControlPoint.call(this,d,a,e,c,f);1==b.controlPoints.length&&a&&(a.add(this.measurement),f&&f(this.measurement));this.show()};this.acceptPoints=
function(){return 1>this.controlPoints.length};this.mustDragGizmo=function(){return 1==this.controlPoints.length?this.pickerGizmos.TEXT[0]:!1};this.mustSnapToPart=function(){return 1>this.controlPoints.length};this.update=function(d){if(this.isVisible()){this.show();var a=b.getWidth(b.getCenterPointWorld(),d),e=b.getControlPointsWorld();switch(b.controlPoints.length){case 2:horisontal=(new T.V3).copy(e[1]).sub(e[0]);horisontalCorrection=(new T.V3).copy(horisontal).setLength(6*a);arrowCorrection=(new T.V3).copy(horisontal).setLength(2*
a);if(0<horisontal.length()-12*a){var c=b.handleGizmos.LINE[0];c.position.copy(e[0]).add(horisontalCorrection);c.lookAt(e[1]);c.scale.set(a,a,horisontal.length()-12*a);c.visible=!0;c=b.handleGizmos.ARROW[0];c.position.copy(e[0]).add(arrowCorrection);c.lookAt(e[1]);c.scale.set(a,a,a);c.visible=!0;c=b.pickerGizmos.ARROW[0];c.position.copy(e[0]).add(arrowCorrection);c.scale.set(a,a,a);c=b.pickerGizmos.LINE[0];c.position.copy(e[0]).add(horisontalCorrection);c.lookAt(e[1]);c.scale.set(a,a,horisontal.length()-
12*a)}else b.handleGizmos.LINE[0].visible=!1,b.handleGizmos.ARROW[0].visible=!1;c=b.pickerGizmos.TEXT[0];c.position.copy(e[1]);c.scale.set(a,a,a);a=b.measurement.getComments();0==a.length&&(a=b.measurement.name);b.setText(0==a.length?null:a,e[1],d)}}else this.hide()};this.onGizmoMoved=function(b,a){switch(b){case "ARROW":case "LINE":case "TEXT":2==this.controlPoints.length&&this.offsetControlPoint(1,a)}};this.getValue=function(){return null};this.select=function(d){T.MeasurementGizmo.prototype.select.call(this,
d);var a=this.measurement.getComments();0==a.length&&(a=b.measurement.name);0==a.length&&(a=!1!==d?'"Put some notes on a sidebar"':'"Click here"');this.text.setValue(a)};this.init()};T.MeasurementGizmoAnnotation.prototype=Object.create(T.MeasurementGizmo.prototype);
