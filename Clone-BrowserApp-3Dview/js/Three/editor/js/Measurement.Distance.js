T.MeasurementDistance=function(){T.Measurement.call(this);this.createGizmo=function(h){return this.measurementGizmo=new T.MeasurementGizmoDistance(this,h)};this.getValue=function(){return this.measurementGizmo.getValue()};this.getInfo=function(){for(var h=this.measurementGizmo.getControlPointsWorld(),k=[],d=0;d<Math.min(2,h.length);++d)k.push({name:"Point "+(d+1).toString(),values:[h[d].x,h[d].y,h[d].z]});return k};this.getType=function(){return"Distance"};this.getDescription=function(){return null==
this.getValue()?"distance":"distance = "+this.getValue().toFixed(2)}};T.MeasurementDistance.prototype=Object.create(T.Measurement.prototype);
T.MeasurementGizmoDistance=function(h,k){T.MeasurementGizmo.call(this,h,k);var d=this;this.handleGizmos={TOPLINE:[new T.Mesh(new T.CylinderGeometry(1,1,1,4,1,!1),new T.MeasurementGizmoMaterial({color:16711680,opacity:.4})),new T.V3(0,.5,0),new T.V3(Math.PI/2,0,0)],STARTLINE:[new T.Mesh(new T.CylinderGeometry(.5,.5,1,4,1,!1),new T.MeasurementGizmoMaterial({color:0,opacity:.1})),new T.V3(0,.5,0),new T.V3(Math.PI/2,0,0)],ENDLINE:[new T.Mesh(new T.CylinderGeometry(.5,.5,1,4,1,!1),new T.MeasurementGizmoMaterial({color:0,
opacity:.1})),new T.V3(0,.5,0),new T.V3(Math.PI/2,0,0)],START:[new T.Mesh(new T.SphereGeometry(2),new T.MeasurementGizmoMaterial({color:16711680,opacity:.4}))],END:[new T.Mesh(new T.SphereGeometry(2),new T.MeasurementGizmoMaterial({color:16711680,opacity:.4}))],STARTARROW:[new T.Mesh(new T.CylinderGeometry(3,0,6,8,1,!1),new T.MeasurementGizmoMaterial({color:16711680,opacity:.4})),new T.V3(0,1,0),new T.V3(Math.PI/2,0,0)],ENDARROW:[new T.Mesh(new T.CylinderGeometry(3,0,6,8,1,!1),new T.MeasurementGizmoMaterial({color:16711680,
opacity:.4})),new T.V3(0,1,0),new T.V3(Math.PI/2,0,0)]};this.pickerGizmos={TOPLINE:[new T.Mesh(new T.CylinderGeometry(3,3,1,4,1,!1),T.MeasurementPickerMaterial),new T.V3(0,.5,0),new T.V3(Math.PI/2,0,0)],STARTARROW:[new T.Mesh(new T.SphereGeometry(4),T.MeasurementPickerMaterial)],ENDARROW:[new T.Mesh(new T.SphereGeometry(4),T.MeasurementPickerMaterial)],TEXT:[new T.Mesh(new T.SphereGeometry(4),T.MeasurementPickerMaterial)]};T.MeasurementGizmoDistance.prototype.addControlPoint=function(f,a,c,l,h){a=
2>d.controlPoints.length?a:d.controlPoints[1].object;T.MeasurementGizmo.prototype.addControlPoint.call(this,f,a,c,l,h);1==d.controlPoints.length?a&&(a.add(this.measurement),h&&h(this.measurement)):3==d.controlPoints.length&&(f=d.getControlPointsWorld(),!0!==c&&(f=(new T.V3).copy(f[0]).add(f[2]).sub(f[1]),T.MeasurementGizmo.prototype.addControlPoint.call(this,f,d.controlPoints[0].object,!1,l,h)));this.show()};this.acceptPoints=function(){return 3>this.controlPoints.length};this.mustDragGizmo=function(){return 2==
this.controlPoints.length?this.pickerGizmos.TOPLINE[0]:!1};this.mustSnapToPart=function(){return 2>this.controlPoints.length};this.update=function(f){this.isVisible()?(this.show(),this.updateGizmosFromControlPoints(f)):this.hide()};this.onGizmoMoved=function(f,a){switch(f){case "TOPLINE":case "TEXT":4==this.controlPoints.length?(this.offsetControlPoint(2,a),this.offsetControlPoint(3,a)):2==this.controlPoints.length&&(this.offsetControlPoint(0,a),this.offsetControlPoint(1,a));break;case "STARTARROW":4==
this.controlPoints.length&&this.offsetControlPoint(3,a);break;case "ENDARROW":4==this.controlPoints.length&&this.offsetControlPoint(2,a)}};this.getValue=function(){if(2>this.controlPoints.length)return null;var f=d.getControlPointsWorld();return f[1].distanceTo(f[0])};this.init();T.MeasurementGizmoDistance.prototype.updateGizmosFromControlPoints=function(f){var a=this.getWidth(this.getCenterPointWorld(),f),c,d,h,e,g=this.getControlPointsWorld();4==this.controlPoints.length?e=[g[3],g[2]]:2==this.controlPoints.length&&
(e=[g[0],g[1]]);switch(this.controlPoints.length){case 4:c=g[0].distanceTo(g[3]);if(c>2*a){var b=this.handleGizmos.STARTLINE[0];d=(new T.V3).copy(g[3]).sub(g[0]).setLength(2*a);b.position.copy(g[0]).add(d);b.lookAt(e[0]);b.scale.set(a,a,c-2*a);b.visible=!0}else this.handleGizmos.STARTLINE[0].visible=!1;c=g[1].distanceTo(g[2]);c>2*a?(b=this.handleGizmos.ENDLINE[0],d=(new T.V3).copy(g[2]).sub(g[1]).setLength(2*a),b.position.copy(g[1]).add(d),b.lookAt(e[1]),b.scale.set(a,a,c-2*a),b.visible=!0):this.handleGizmos.ENDLINE[0].visible=
!1;case 2:c=this.getWidth(g[1],f),b=this.handleGizmos.END[0],b.position.copy(g[1]),b.scale.set(c,c,c),b.visible=!0,b=this.pickerGizmos.STARTARROW[0],b.position.copy(e[0]),b.scale.set(a,a,a),b=this.pickerGizmos.ENDARROW[0],b.position.copy(e[1]),b.scale.set(a,a,a),c=(new T.V3).copy(e[1]).sub(e[0]),d=(new T.V3).copy(c).setLength(6*a),h=(new T.V3).copy(c).setLength(2*a),0<c.length()-12*a?(b=this.handleGizmos.TOPLINE[0],b.position.copy(e[0]).add(d),b.lookAt(e[1]),b.scale.set(a,a,c.length()-12*a),b.visible=
!0,b=this.handleGizmos.STARTARROW[0],b.position.copy(e[0]).add(h),b.lookAt(e[1]),b.scale.set(a,a,a),b.visible=!0,b=this.handleGizmos.ENDARROW[0],b.position.copy(e[1]).sub(h),b.lookAt(e[0]),b.scale.set(a,a,a),b.visible=!0,b=this.pickerGizmos.TOPLINE[0],b.position.copy(e[0]).add(d),b.lookAt(e[1]),b.scale.set(a,a,c.length()-12*a)):(this.handleGizmos.TOPLINE[0].visible=!1,this.handleGizmos.STARTARROW[0].visible=!1,this.handleGizmos.ENDARROW[0].visible=!1),e=(new T.V3).copy(e[0]).add(e[1]).divideScalar(2),
b=this.pickerGizmos.TEXT[0],b.position.copy(e),b.scale.set(a,a,a),c=this.getValue(),this.setText(c.toFixed(2),e,f);case 1:c=this.getWidth(g[0],f),b=this.handleGizmos.START[0],b.position.copy(g[0]),b.scale.set(c,c,c),b.visible=!0}}};T.MeasurementGizmoDistance.prototype=Object.create(T.MeasurementGizmo.prototype);
