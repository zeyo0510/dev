/*
 */
var aa=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};function ca(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var ea=ca(this);
function fa(a,b){if(b)a:{var c=ea;a=a.split(".");for(var e=0;e<a.length-1;e++){var d=a[e];if(!(d in c))break a;c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&b!=null&&aa(c,a,{configurable:!0,writable:!0,value:b})}}
fa("Symbol",function(a){function b(g){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(e+(g||"")+"_"+d++,g)}function c(g,m){this.Cb=g;aa(this,"description",{configurable:!0,writable:!0,value:m})}if(a)return a;c.prototype.toString=function(){return this.Cb};var e="jscomp_symbol_"+(Math.random()*1E9>>>0)+"_",d=0;return b});const ha=globalThis,t=chrome.i18n?.getMessage||(()=>""),ia=chrome.runtime?.sendMessage||(()=>{});
function ja(a){return atob(a).split("").map(b=>String.fromCharCode(b.charCodeAt(0)+1)).join("")}const ka=(chrome.runtime?.getURL?.("")||"")+ja("a2hhci4");function la(a){chrome.tabs.create({url:a,active:!0}).then(b=>chrome.windows.update(b.windowId,{focused:!0}))}function ma(){return navigator.platform.indexOf("Mac")>-1}const na=RegExp("^(C:/Windows/|C:/ProgramData/|C:/Program Files/|C:/Program Files \\(x86\\)/|C:/Users/[^/]+/AppData/)","i"),oa=RegExp("^/(Users|home|tmp)/","i");
function pa(a){return navigator.platform.indexOf("Win")==0?a&&!na.test(a):a&&oa.test(a)}function qa(a){return a?a.trim():""}function ra(a,b){return a&&b&&a.startsWith(b)?a.slice(b.length):a}
var sa=RegExp("^data:([^;]+)((?:;[^=]+=[^;]+)*)(?:;(base64))?,(.+)$"),ta=RegExp("^(?:(?:https?|ftp)://)?(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i"),
ua=RegExp("^(blob:|data:|(https?|ftp)://)");
const va={"3gpp":"3gp","3gpp2":"3g2",aiff:"aif","ms-asf":"asf",basic:"au",msvideo:"avi",binary:"bin",macbinary:"bin","octet-stream":"bin","windows-bmp":"bmp",bzip:"bz",bzip2:"bz2",java:"class","java-class":"class",msword:"doc","openxmlformats-officedocument.wordprocessingml.document":"docx",fortran:"f",icon:"ico","java-source":"java",jpeg:"jpg",pjpeg:"jpg",mpegurl:"m3u",rfc822:"mhtml",matroska:"mkv",quicktime:"mov",mpeg3:"mp3",mpeg:"mp4","sgi-movie":"mv",pascal:"p","portable-bitmap":"pbm","portable-floatmap":"pfm",
"portable-graymap":"pgm","portable-pixmap":"ppm",mspowerpoint:"ppt","ms-powerpoint":"ppt",powerpoint:"ppt","openxmlformats-officedocument.presentationml.presentation":"pptx","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx",postscript:"ps","adobe.photoshop":"psd","script.phyton":"py","pn-realaudio":"ra","rn-realmedia":"rm",bsh:"sh","svg+xml":"svg",gnutar:"tgz",plain:"txt","ms-wma":"wma","ms-wmv":"wmv",excel:"xls",msexcel:"xls","ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx",
compressed:"zip","zip-compressed":"zip"};
function wa(a){a=(a||"").trim();var b={},c=14;if(a.startsWith("blob:")){for(;c--;)b[xa[c]]="";return b}if(a.indexOf("data:")==0){for(;c--;)b[xa[c]]="";b.protocol="data";(a=sa.exec(a))&&a[1]&&(a=a[1].match(/(?:[^\/]+)\/(?:x-)?(?:vnd\.)?(.+)/i))&&a[1]&&(b.file="download."+(va[a[1]]||a[1]))}else try{const h=new URL(a);{var e=h.pathname;const k=e.lastIndexOf(".");if(k==-1||k==e.length-1)var d="";else{var g=e.lastIndexOf("/");d=g>k?"":e.slice(g+1)}}{var m=h.pathname;const k=m.lastIndexOf(".");if(k==-1||
k==m.length-1)var f=m;else{var l=m.lastIndexOf("/");f=l>k?m:m.substring(0,l+1)}}return{anchor:ra(h.hash,"#"),authority:h.host,directory:f,file:d,host:h.host,password:h.password,path:h.pathname,port:h.port,protocol:h.protocol,query:ra(h.search,"?"),relative:h.pathname,source:h.href,user:h.username,userInfo:h.username&&h.password?h.username+":"+h.password:h.username}}catch(h){for(console.error(h);c--;)b[xa[c]]=""}return b}var xa="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");
function ya(a){a=(a||"").trim();var b=a.lastIndexOf("."),c=b!=-1;c||(b=a.length);return{ua:a.substr(0,b),O:a.substr(b+1),Vc:c}}function za(a){return ua.test(a)?a:"http://"+a}function Aa(a){return(a||"").trim().replace(/(^(\\|\/|\.)+)|((\\|\/|\.)+$)/g,"").replace(/\s*(\\|\/)+\s*/g,"/").trim()}function Ba(a,b=!0){return a.replace(/[\/\\]+$/g,"").replace(/[\/\\]+/g,"/").trim()+(b==0?"":"/")}function Ca(a,b){return a?b?a.replace(/[\/\\]+$/,"")+"/"+b.replace(/[\/\\]+$/,""):a:b}
function Da(a){let b=0;a[a.length-1]=="/"&&(b=1);let c=a.lastIndexOf("/",a.length-1-b)+1;return[a.substring(0,c),a.substring(c,Math.max(c,a.length-b))]}function Ea(a){return a?a.substr(Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"))+1):""}function Fa(a){return a?a.substr(0,Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"))+1):""}function Ga(a){return a&&!/^ *(\.|\\|\/)/.test(a)&&a.replace(/[\.\*\\\/_]/g,"").trim()!=""}var v=0;v=0;var Ha=v++,Ia=v++,Ja=v++;v=0;var z=v++,Ka=v++,La=v++,Ma=v++,Na=v++;v++;
v=0;var Oa=v++,Pa=v++;v=0;var Qa=v++;v++;var Ra=v++,Sa=v++;v=0;var Ta=v++,Ua=v++,Va=v++,Wa=v++,Xa=v++;v=0;var Ya=v++;v++;v++;var Za=v++,ab=v++;v=0;var bb=v++,cb=v++;v=0;v++;v++;var db=v++;v=0;v++;v++;v++;v++;v++;v++;v++;v++;v++;v++;v++;v++;v++;v++;v++;v=0;v++;v++;v++;v=0;v++;v=256;v++;v++;v++;v++;v++;v++;v=512;v++;v++;const eb=t("chromesysFailedGenericNetworkError"),fb=t("chromesysFailedGenericDownloadError");
var gb={none:t("errorNone"),fnConflict:t("errorFNameConflict"),noID:t("errorNoID"),NETWORK_FAILED:eb,NETWORK_DISCONNECTED:eb,NETWORK_SERVER_DOWN:eb,NETWORK_INVALID_REQUEST:eb,FILE_FAILED:fb,FILE_HASH_MISMATCH:fb,SERVER_NO_RANGE:fb};function hb(a){return a?gb[a]||t("chromesysFailed_"+a)||a:""}
function ib(a){let b,c,e,d;return async function(...g){for(;d;)await d;b&&clearTimeout(b);c||(c=new Promise(f=>{e=f}));const m=()=>{b=void 0;d=a.apply(void 0,g.slice(1)).then(f=>{e(f);d=e=c=void 0})};g[0]?m():b=setTimeout(m,100);return c}}function jb(){let a,b;return{promise:new Promise((c,e)=>{a=c;b=e}),resolve:a,reject:b}}function kb(a){a=/^(https?|ftp|data|blob):/i.test(a)?a:"http://"+a;return a[a.length-1]=="/"?a:a+"/"}
function lb(a,b){if(!a.length||!b.length)return[[],a];const c=new Set(a),e=b.filter(d=>c.has(d));a=e.length<a.length?a.filter(d=>!e.includes(d)):[];return[e,a]}function mb(a,b,c){let e,d=0;return(...g)=>{const m=Date.now();m-d>=b?(clearTimeout(e),e=void 0,d=m,a.apply(void 0,g)):e||(e=setTimeout(()=>{e=void 0;d=Date.now();a.apply(void 0,c||g)},b))}}const nb=[3,4,5,6,7,9,10,11,129,12,13,14,15,96,100,101,157],ob=ja("bV4"),pb=ja("YF4");
function E(a){if(a===0)var b="a";else for(b="";a>0;)b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[a%62]+b,a=Math.floor(a/62);return pb+b}function qb(){switch(F.get("autoclear_type")){case "finished":return 53;case "miss":return 54;case "interrupted":return 55;case "both":return 56;default:return 40}}function rb(a){return typeof a==="string"?a:a.stack?a.stack:a.toString?a.toString():JSON.stringify(a)}let sb;
function tb(a){if(a&&(a=rb(a))&&typeof a==="string"&&(sb||(sb=/extensions gallery cannot be scripted|cannot access contents of the page|extension manifest must request permission to access the respective host|could not establish connection|receiving end does not exist|frame with ID \d+|Filename not yet determined|no (tab|window) with id:|Tabs cannot be edited right now|The page keeping the extension port is moved into back\/forward cache/i),!sb.test(a)))return a.slice(0,400)}const ub=new Map;
function vb(a,b){let c=ub.get(a);c===void 0&&b!==void 0&&(c=b,ub.set(a,c));return c}function wb(){const [a]=I.get("ud",[{},[]]);return Object.entries(a).flatMap(([b,c])=>[b.length,JSON.stringify(c).length])}
async function xb(a,b,c){const [e,d]=await Promise.all([a.get(null),a.getBytesInUse()]),g=Object.entries(e).map(([m,f])=>[m,JSON.stringify(f).length]);b=rb(b);/Session storage quota bytes exceeded/i.test(b)&&(b=`S[${wb()}]`);a=`${b};[${a.QUOTA_BYTES},${d}] [${c.flatMap(([m,f])=>[m,JSON.stringify(f).length])}] ${g}`.slice(0,300);(0,ha.__cdmg__?.r)?.(138,"page_referrer",a)}
class yb{constructor(a){this.m=a}async get(a,b){let c=!1;Array.isArray(a)||(c=!0,a=[a],b=[b]);b=b??[];const e=[],d=await this.m.get(a);for(let g=0;g<a.length;++g){const m=a[g],f=d[m];f!==void 0?e.push(f):e.push(vb(m,b[g]))}return c?e[0]:e}set(a,b){return this.m.set({[a]:b})}da(a){return this.m.set(a)}erase(a){return this.m.remove(a)}}function zb(){var a=I;a.ja||(a.ja=a.m.get(a.Kb).then(b=>{Object.assign(a.I,b)}));return a.ja}
class Ab{constructor(){var a=chrome.storage.session;this.I={};this.m=a;this.Kb=null}get(a,b){let c=!1;Array.isArray(a)||(c=!0,a=[a],b=[b]);b=b??[];const e=[];for(let d=0;d<a.length;++d){const g=a[d],m=this.I[g];m!==void 0?e.push(m):e.push(vb(g,b[d]))}return c?e[0]:e}set(a,b){this.I[a]=b;return this.m.set({[a]:b}).catch(c=>{xb(this.m,c,[[a,b]])})}da(a){Object.assign(this.I,a);return this.m.set(a).catch(b=>{xb(this.m,b,Object.entries(a))})}erase(a){delete this.I[a];return this.m.remove(a)}Z(a,b,c=!1){let e=
this.get(a,[]);e=e.filter(d=>!b.includes(d));c?e.unshift(...b):e.push(...b);return this.set(a,e)}ta(a,b){const c=this.I[a];if(c){var e=new Set(b);b=c.filter(d=>!e.has(d));if(b.length!==c.length)return this.set(a,b)}}Ja(a,b,c){const e=this.I[a];e&&b&&this.set(a,c?e.slice(0,e.length-b):e.slice(b))}ca(a,b,c){const e=this.get(a,{});e[b]=c;this.set(a,e)}Oa(a,b){return this.get(a,{})[b]}ma(a,b){const c=this.I[a];if(c){var e=c[b];delete c[b];this.set(a,c);return e}}}
function Bb(a,b){b=a.ia.indexOf(b);b!==-1&&a.ia.splice(b,1)}function Cb(a,b){const c=a.ha.get(b);c&&console.warn(`consecutive writes of the same key [${b}]`);const e=jb();a.ha.set(b,e);const d=e.resolve;e.resolve=()=>{c?.resolve();a.ha.get(b)===e&&a.ha.delete(b);d();e.rd=!0};return[e.resolve,c?.promise||null,e]}function Db(a,b){Bb(a,b);return Cb(a,b)}function Eb(a,b,c){a.V[b]=c;a.ra.add(b);a.ab()}
async function Fb(a,b,c,e){const [d,g,m]=Db(a,b);c=await a.get(b,c,g);if(!m.rd){e=e(c);e===void 0&&(e=[]);var [f,l]=e;f!==void 0&&Eb(a,b,f);d();return l}}
class Gb{constructor(){var a=chrome.storage.local;this.V={};this.ra=new Set;this.ia=[];this.ha=new Map;this.m=a;this.ab=ib(()=>{const b=[];if(this.ra.size){const c=Array.from(this.ra.keys());this.ra.clear();const e={};for(const d of c)e[d]=this.V[d];b.push(this.m.set(e))}this.ia.length&&(b.push(this.m.remove(this.ia)),this.ia=[]);return b.length?Promise.all(b):Promise.resolve()})}va(){return this.ab(!0)}async get(a,b,c){var e=c||c===null;let d=!1;Array.isArray(a)||(d=!0,a=[a],b=[b]);b=b??[];if(c)await c;
else if(!e){const m=[];c=a.map(f=>{const l=this.ha.get(f);l&&m.push(f);return l?.promise}).filter(f=>!!f);c.length>0&&await Promise.all(c)}c=[];e=new Map;for(var g=0;g<a.length;++g){const m=a[g],f=this.V[m];f===null||f===void 0?(f===void 0&&e.set(m,c.length),c.push(vb(m,b[g]))):c.push(f)}if(!e.size)return d?c[0]:c;b=Array.from(e.keys());a=await this.m.get(b);for(const m of b)g=this.V[m],g!==null&&(b=e.get(m),g!==void 0?c[b]=g:(g=a[m],g!==void 0?(c[b]=g,this.V[m]=g):this.V[m]=null));return d?c[0]:
c}set(a,b){Bb(this,a);Eb(this,a,b)}Z(a,b,c){return Fb(this,a,[],e=>{e=e.filter(d=>!b.includes(d));c?e.unshift(...b):e.push(...b);return[e]})}ta(a,b){return Fb(this,a,void 0,c=>{if(c&&c.length){var e=new Set(b),d=c.filter(g=>!e.has(g));if(d.length!==c.length)return[d]}})}Ja(a,b,c){Fb(this,a,void 0,e=>{if(e&&e.length)return c?[e.slice(0,e.length-b)]:[e.slice(b)]})}async ca(a,b,c){Fb(this,a,{},e=>{e[b]=c;return[e]})}async Oa(a,b){return(await this.get(a,{}))[b]}async ma(a,b){return Fb(this,a,{},c=>{if(b in
c){var e=c[b];delete c[b];return[c,e]}})}}const I=new Ab,K=new Gb,Hb=new yb(chrome.storage.session),L=new yb(chrome.storage.local),Ib=new yb(chrome.storage.sync),Jb=ja("YV4"),Kb=["",[String.fromCharCode(103),String.fromCharCode(108),String.fromCharCode(99)].join(""),"2_"].join("_");async function Lb(a){a=Kb+a;return(await chrome.storage.local.get(a))[a]}async function Mb(a){a=await Lb(a);const b=Date.now();return!a||!a._t||isNaN(a._t)||!isFinite(a._t)||b-a._t>6048E5?{_t:b}:a}
function Nb(a){return Jb+btoa(a.split("").map(b=>{var c=b.charCodeAt(0),e=0;b!="_"&&(e=c>60?-55:53);return String.fromCharCode(c+e)}).join("")).replace(/=+$/,"")}async function Ob(a,b,c,e){e=e||1;const d=await Mb(a);b=[b,...(c||[])].map(g=>typeof g==="string"?g:E(g)).join(";");d[b]=(d[b]||0)+e;chrome.storage.local.set({[Kb+a]:d})}async function Pb(a){const b=Kb+33,c=(await chrome.storage.local.get(b))[b]||0;a=Math.max(a,c);chrome.storage.local.set({[b]:a})}
async function Qb(){const a=Kb+33;return(await chrome.storage.local.get(a))[a]||0}const Rb=[0,.1,.5,1,5,10,20,50,100,200,500,1E3,2E3,5E3,1E4,2E4,5E4,1E5,2E5,5E5,1E6],Sb=[0,1,5,10,20,50,100,200,500,1E3,2E3,5E3,1E4,2E4,5E4,1E5,2E5,5E5,1E6];function Tb(a,b){b=b||Sb;let c=0;for(;c<b.length&&a>=b[c];++c);c=Math.max(0,c-1);return b[c]}function Ub(a,b){b<=0||isNaN(b)||Vb(a,b/1048576,Rb)}function Vb(a,b,c){b<=0?Promise.resolve():(b=Tb(b,c),Ob(a,(ob+b).replace(/\./g,"_")))}
async function Wb(a){const b=await Mb(11);for(const [c,e]of Object.entries(a))a=c.replace(/[<>:"/\\|?*\x00-\x1F]/g,"").replace(/[^\x00-\x7F]/g,"_"),a=Nb(a),b[a]=(b[a]||0)+e;chrome.storage.local.set({[Kb+11]:b})}function Xb(a){const b=btoa(a).replace(/=+$/,"");return a[a.length-1]+b[0]+a[0]+b.substr(1)}
const Yb={L:"//downloads",Fc:"//extensions",C:"//settings/downloads",Ca:"//settings/languages",Jb:"//settings/content/pdfDocuments",Ib:(a="chrome:")=>`${a}//extensions/?id=${chrome.runtime.id}#allow-on-file-urls`},Zb={L:"chrome://downloads",C:"chrome://settings/downloads",Jc:"https://chromewebstore.google.com/detail/mciiogijehkdemklbdcbfkefimifhecn",Za:"https://chromewebstore.google.com/detail/mciiogijehkdemklbdcbfkefimifhecn/reviews"};let ac="Chrome";var bc,cc;
a:{const a=["Chrome","chrome",Zb,"google"],b=[a,["Edge","edge",{},"microsoftedge"],["Firefox","",{Ca:"about:preferences#general",Ib:()=>"about:addons"},"mozilla"],["Opera","opera",{},"opera"],["360","se",{C:"se://settings/browser#downloadsSection",Ca:"se://settings",Jb:"se://settings"},"360"],["QQ","qqbrowser",{C:"qqbrowser://settings/normal?qbDownload"},"qq"]],c=chrome.runtime.getManifest().homepage_url;for(const e of b){const [d,,,g]=e;if(""===d||c.includes(g)){cc=e;break a}}cc=a}
const [dc,ec,fc]=cc,gc={};if(ec)for(const a in Yb){const b=Yb[a];gc[a]=typeof b==="function"?b.bind(void 0,ec+":"):ec+":"+b}ac=dc;bc={Gc:"about:newtab",Za:chrome.runtime.getManifest().homepage_url||Zb.Za,...gc,...(fc||{})};var hc;if(ac==="Edge")hc=t("optItemOverrideChromeNoShortcut");else{var ic=ac!=="Opera";hc=t("optItemOverrideChrome",[(ma()?((ic||"")&&"\u21e7")+"\u2318":"Ctrl+")+"J"])}var jc=t("uilang");
const kc={_uilanguage:{label:"",type:"button",value:void 0,Pc:t("chromesysChange"),onclick:function(){la(bc.Ca)}},fnconflict:{label:"When file name conflicts",type:"select",options:[t("optOptionUniquify"),t("optOptionOverwrite"),t("optOptionPrompt"),t("optOptionSkipPause"),t("optOptionSkipCancel")],value:Ya,j:"NameConflict"},def_threads:{label:t("fieldThreads"),type:"int",mc:!0,value:5,min:1,max:15},def_addtop:{label:t("optionAddTop"),type:"bool",value:!1},def_addpause:{label:"Add paused",type:"bool",
value:!1,j:"DefAddPaused"},down_clipboard:{label:"Download URL from Clipboard",type:"bool",value:!0,j:"DownloadClipboard"},start_interrupted:{label:"Start Button also starts interrupted tasks",type:"bool",value:!1,j:"StartInterrupted"},override_cr:{label:hc,type:"bool",value:!0},hide_cr_bar:{label:"Hide Chrome's Downloads Shelf(Bar)",type:"bool",value:!0,j:"HideShelf"},win_mode:{label:"Open downloads manager as standalone window",type:"bool",value:!0,j:"WinMode"},slide_details_panel:{label:"Slide details panel when click on task",
type:"bool",value:!0,j:"SlideDetailsPanel",ya:t("tipOptItemSlideDetailsPanel")},recycle_cancel:{label:"Cancel the task when it's recycled",type:"bool",value:!1,j:"RecycleCancel"},clear_search:{label:"Clear search box when filter changes",type:"bool",value:!1,j:"ClearSearch"},menu_d_dialog:{label:t("menuDLink"),type:"bool",value:!0},menu_d_oneclick:{label:t("menuDLinkOneClick"),type:"bool",value:!0},menu_d_sniffer:{label:t("tipBrowserAction"),type:"bool",value:!0},notify_error:{label:"When error occurs",
type:"bool",value:!0,j:"NotifyError"},notify_finish:{label:"When download completes",type:"bool",value:!0,j:"NotifyFinish"},sound_finish:{label:"Play sound when download completes",type:"bool",value:!0,j:"SoundFinish"},sound_error:{label:"Play sound when error occurs",type:"bool",value:!0,j:"SoundError"},notify_oneclick:{label:"When adding One-Click download",type:"bool",value:!1,j:"NotifyOneClick"},notify_progress:{label:"Show download progress",type:"bool",value:!1,j:"NotifyProgress"},notify_large_preview:{label:"Show large preview for images",
type:"bool",value:!0,j:"NotifyLargePreview"},click_notify:{label:"Clicking on a notification",type:"select",options:[[t("optOptionOpenFile"),Wa],[t("optOptionOpenFolder"),Xa],[t("menuOpenManager"),Ta],[t("optOptionClearNotify"),Ua],[t("optOptionClearAllNotify"),Va]],value:Wa,j:"ClickNotify"},dbclick_action:{label:"Double-click on task",type:"select",options:[[t("optOptionDoNothing"),Qa],[t("optOptionOpenFile"),Ra],[t("optOptionOpenFolder"),Sa]],value:Sa,j:"DblClickAction"},doneclick_rule:{label:t("phraseEnable"),
type:"bool",value:!0,ya:t("tipOptSectionOneClick"),bd:"https://faq.chronodownloader.net/?action=faq&cat=7&id=3"},badge_downnum:{label:"Show Downloading Number",type:"bool",value:!0,j:"BadgeDownloadNum"},font_size:{label:t("chromesysFontSize"),type:"int",value:14,min:12,max:16},poplist_max_items:{label:"Max Items",type:"int",value:15,min:1,max:50,j:"PopMaxItems"},poplist_showd_first:{label:"Show downloading tasks first",type:"bool",value:!0,j:"PopShowDLFirst"},poplist_clear_close:{label:"Close after clear",
type:"bool",value:!1,j:"PopClearClose"},dy_max_con_tasks:{label:"Concurrent downloads",type:"int",value:10,min:1,max:20,j:"ConcurrentDownloads"},dy_max_per_server:{label:"Downloads per server",type:"int",value:5,min:1,max:5,j:"DownloadsPerServer"},always_use_last_location:{label:jc.startsWith("en")||jc.startsWith("zh")?t("labelUseLastLocation"):t("labelFolderColon")+" "+t("labelUseLastLocation"),type:"bool",value:!0},chrono_folder_selection:{label:t("labelEnableFolderSelection"),type:"bool",value:!0},
folder_inaccessible:{label:t("labelUnableSaveToFolder"),type:"select",options:[t("labelDownloadToDefaultFolder"),t("labelChooseDownloadLocation")],value:bb},def_folder:{label:"Default folder",type:"string",value:"",mc:!0,ya:t("tipOptNoRuleMatch"),j:"DefFolder"},def_naming:{label:"Default Naming Mask",type:"string",value:"*name*.*ext*",kb:"*name*.*ext*",ya:t("tipOptNoRuleMatch"),j:"DefNaming"},match_mode:{label:"Match Mode",type:"select",options:[t("optOptionFirstMatch"),t("optOptionReplace")],value:Oa,
ya:t("tipOptItemRuleMatchMode"),j:"RuleMatchMode"},tb_fit_cols:{type:"bool",value:!1},tb_sync_resize:{type:"bool",value:!1},tb_def_cols:{type:"list",value:"state name progress size speed active_threads time_remained url time_add".split(" ")},tb_sort_cols:{type:"list",value:[{field:"time_add",sortAsc:!1}]},pop_preview:{type:"bool",value:!0},pop_showsize:{type:"bool",value:!0},pop_content:{type:"int",value:0,min:void 0,max:void 0},pop_sniffer_hint:{type:"int",value:0,min:void 0,max:void 0},pop_clear_file:{type:"bool",
value:!1},poplist_remove_confirm:{type:"select",value:db,j:"PopDeleteAction",label:"Click 'Delete' button",options:[t("optOptionRemList"),t("optOptionRemFile"),t("optOptionRemAsk")]},preview_autoplay:{type:"bool",value:!1,label:`${t("optSectionPreview")} - ${t("optItemPreviewAutoplay")}`},bg_image_enable:{type:"bool",value:!1},bg_image_everset:{type:"bool",value:!1},bg_image_url:{type:"string",value:"/icons/bg/1.jpg"},bg_image_opacity:{type:"float",value:.35,min:0,max:1},bg_image_blur:{type:"int",
value:0,min:0,max:10},ui_grid_list:{type:"bool",value:!0},autoclear_type:{type:"string",value:"both"},autoclear_timer:{type:"int",value:-1,min:void 0,max:void 0},search_mode:{type:"string",value:"normal"},search_case_sensitive:{type:"bool",value:!1}};
class lc{constructor(){this.Fa=kc}load(){this.ja||(this.ja=chrome.storage.sync.get(Object.keys(kc)).then(a=>{for(const b in a){const c=a[b];c!==void 0&&c!==null&&(this.Fa[b].value=c)}}));return this.ja}get(a){return(a=this.Fa[a])?a.value===""&&a.kb!==void 0?a.kb:a.value:null}set(a,b){const c=this.Fa[a];if(!c||c.min!==void 0&&b<c.min||c.max!==void 0&&b>c.max)return!1;c.value=b;this.eb(a,b);return!0}eb(){throw Error("not implemented");}}const F=new class extends lc{eb(a,b){Ib.set(a,b)}},mc=F.load();
function M(a){const b=[mc,zb()],c=Promise.all(b);return function(...e){c.then(()=>a(...e))}}const oc=(a,b)=>b.some(c=>a instanceof c);let pc,qc;const rc=new WeakMap,sc=new WeakMap,tc=new WeakMap;function uc(a){const b=new Promise((c,e)=>{const d=()=>{a.removeEventListener("success",g);a.removeEventListener("error",m)},g=()=>{c(vc(a.result));d()},m=()=>{e(a.error);d()};a.addEventListener("success",g);a.addEventListener("error",m)});tc.set(b,a);return b}
function wc(a){if(!rc.has(a)){var b=new Promise((c,e)=>{const d=()=>{a.removeEventListener("complete",g);a.removeEventListener("error",m);a.removeEventListener("abort",m)},g=()=>{c();d()},m=()=>{e(a.error||new DOMException("AbortError","AbortError"));d()};a.addEventListener("complete",g);a.addEventListener("error",m);a.addEventListener("abort",m)});rc.set(a,b)}}
let xc={get(a,b,c){if(a instanceof IDBTransaction){if(b==="done")return rc.get(a);if(b==="store")return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return vc(a[b])},set(a,b,c){a[b]=c;return!0},has(a,b){return a instanceof IDBTransaction&&(b==="done"||b==="store")?!0:b in a}};
function yc(a){return(qc||(qc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){a.apply(tc.get(this),b);return vc(this.request)}:function(...b){return vc(a.apply(tc.get(this),b))}}
function vc(a){if(a instanceof IDBRequest)return uc(a);if(sc.has(a))return sc.get(a);if(typeof a==="function")var b=yc(a);else a instanceof IDBTransaction&&wc(a),b=oc(a,pc||(pc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(a,xc):a;b!==a&&(sc.set(a,b),tc.set(b,a));return b}
function zc({Nc:a,upgrade:b,Oc:c,ad:e}={}){const d=indexedDB.open("downloady",2),g=vc(d);b&&d.addEventListener("upgradeneeded",m=>{b(vc(d.result),m.oldVersion,m.newVersion,vc(d.transaction),m)});a&&d.addEventListener("blocked",m=>a(m.oldVersion,m.newVersion,m));g.then(m=>{e&&m.addEventListener("close",()=>e());c&&m.addEventListener("versionchange",f=>c(f.oldVersion,f.newVersion,f))}).catch(()=>{});return g}
const Ac=["get","getKey","getAll","getAllKeys","count"],Bc=["put","add","delete","clear"],Cc=new Map;
function Dc(a,b){if(a instanceof IDBDatabase&&!(b in a)&&typeof b==="string"){if(Cc.get(b))return Cc.get(b);var c=b.replace(/FromIndex$/,""),e=b!==c,d=Bc.includes(c);if(c in(e?IDBIndex:IDBObjectStore).prototype&&(d||Ac.includes(c)))return a=async function(g,...m){g=this.transaction(g,d?"readwrite":"readonly");let f=g.store;e&&(f=f.index(m.shift()));return(await Promise.all([f[c](...m),d&&g.done]))[0]},Cc.set(b,a),a}}xc=(a=>({...a,get:(b,c,e)=>Dc(b,c)||a.get(b,c,e),has:(b,c)=>!!Dc(b,c)||a.has(b,c)}))(xc);
const Ec=["continue","continuePrimaryKey","advance"],Fc={},Gc=new WeakMap,Hc=new WeakMap,Ic={get(a,b){if(!Ec.includes(b))return a[b];(a=Fc[b])||(a=Fc[b]=function(...c){Gc.set(this,Hc.get(this)[b](...c))});return a}};async function*Jc(...a){let b=this;b instanceof IDBCursor||(b=await b.openCursor(...a));if(b)for(a=new Proxy(b,Ic),Hc.set(a,b),tc.set(a,tc.get(b));b;)yield a,b=await (Gc.get(a)||b.continue()),Gc.delete(a)}
function Kc(a,b){return b===Symbol.asyncIterator&&oc(a,[IDBIndex,IDBObjectStore,IDBCursor])||b==="iterate"&&oc(a,[IDBIndex,IDBObjectStore])}xc=(a=>({...a,get(b,c,e){return Kc(b,c)?Jc:a.get(b,c,e)},has(b,c){return Kc(b,c)||a.has(b,c)}}))(xc);
function Lc(a){a?(this.id=a.id,this.cr_id=a.cr_id,this.url=a.url,this.referer=a.referer,this.page_title=a.page_title,this.text=a.text,this.title=a.title,this.size=a.size,this.size==void 0&&(this.size=-1),this.iconURL16=a.iconURL16,this.iconURL32=a.iconURL32,this.folder=a.folder,this.naming=a.naming,this.naming_auto=a.naming_auto,this.folder_auto=a.folder_auto,this.name_conflict=a.name_conflict,this.state=a.state,this.time_add=new Date(a.time_add),this.time_finish=a.time_finish?new Date(a.time_finish):
null,this.time_elapsed=a.time_elapsed,this.max_threads_config=a.max_threads_config,this.checksum=a.checksum,this.desc=a.desc,this.batch_num=a.batch_num,this.exists=!!a.exists,this.hash=a.hash,this.temp_file=a.temp_file,this.recycled=a.recycled,this.finished_bytes=a.finished_bytes,this.etag=a.etag,this.last_modified=a.last_modified,this.mime_type=a.mime_type,this.file_ext=a.file_ext,this.full_path=a.full_path,this.eurl=a.eurl,this.single_thread=a.single_thread,this.error_str=a.error_str,this._suppress_noty=
a._suppress_noty):(this.id="<invalid>",this.cr_id=-2,this.title=this.text=this.page_title=this.referer=this.url="",this.size=-1,this.naming=this.folder=this.iconURL32=this.iconURL16="",this.naming_auto=!0,this.folder_auto=!1,this.name_conflict="",this.state=2,this.time_add=new Date,this.time_finish=null,this.time_elapsed=0,this.max_threads_config=5,this.desc=this.checksum="",this.batch_num=0,this.exists=!1,this.temp_file=this.hash="",this.finished_bytes=this.recycled=0,this.eurl=this.full_path=this.file_ext=
this.mime_type=this.last_modified=this.etag="",this.single_thread=!0);this.progress=this.size>0?this.finished_bytes/this.size*100:this.state==3?100:0;this.time_remained=this.active_threads=this.max_threads=this.speed=0}
function Mc(a){return{id:a.id,cr_id:a.cr_id,url:a.url,referer:a.referer,page_title:a.page_title,text:a.text,title:a.title,size:a.size,iconURL16:a.iconURL16,iconURL32:a.iconURL32,folder:a.folder,naming:a.naming,naming_auto:a.naming_auto,folder_auto:a.folder_auto,name_conflict:a.name_conflict,state:a.state,time_add:a.time_add,time_finish:a.time_finish,time_elapsed:a.time_elapsed,max_threads_config:a.max_threads_config,checksum:a.checksum,desc:a.desc,batch_num:a.batch_num,hash:a.hash,exists:a.exists?
1:0,temp_file:a.temp_file,recycled:a.recycled,finished_bytes:a.finished_bytes,etag:a.etag,last_modified:a.last_modified,mime_type:a.mime_type,file_ext:a.file_ext,full_path:a.full_path,eurl:a.eurl,single_thread:a.single_thread,error_str:a.error_str,_suppress_noty:a._suppress_noty}}
function Nc(a,b,c){a.naming_auto&&(a.naming="");a.name_conflict="";a.eurl=a.url;a.cr_id=-2;a.size=-1;a.iconURL16="";a.iconURL32="";b!=void 0&&(a.state=b);a.time_finish=null;a.time_elapsed=0;a.batch_num=0;a.exists=!1;a.hash="";a.temp_file="";a.finished_bytes=0;a.etag="";a.last_modified="";a.mime_type="";a.full_path="";a.single_thread=!0;a.error_str=void 0;a.progress=0;a.speed=0;a.max_threads=0;a.active_threads=0;a.time_remained=0;c!==!1&&(a.time_add=c?new Date(c):new Date);Oc(a);delete a._suppress_noty;
delete a.cb;delete a.Ga;delete a.sa;delete a.la;delete a.X}function Oc(a){a.bb=void 0;a.W=void 0}
function Pc(a,b,c,e,d){if(b=="mime")b="mime_type";else if(b=="addtime")b="time_add";else if(b=="refer")b="referer";else if(b=="remark"||b=="remarks")b="desc";let g=null;switch(b){case "host":g=c.host;break;case "query":case "anchor":g=c[b];break;case "subdirs":g=c.directory;break;case "name":if(e){a=e.ua;try{var m=decodeURIComponent(a)}catch(f){console.warn(f,a),m=a}}else m="";g=m;break;case "ext":g=e?e.O:"";break;case "url":g=a.url;break;case "eurl":g=a.eurl;break;case "num":g=a.batch_num||0;break;
case "date":case "datetime":g=new Date;break;case "state":case "size":case "referer":case "page_title":case "text":case "title":case "time_add":case "time_elapsed":case "desc":case "progress":case "finished_bytes":case "mime_type":g=a[b];break;default:d==1&&(g="_"+b+"_")}return g}
function Qc(a,b,c){function e(f){return f<10?"0"+f:f.toString()}function d(f,l){var h={"M+":f.getMonth()+1,"d+":f.getDate(),"h+":f.getHours(),"m+":f.getMinutes(),"s+":f.getSeconds(),S:f.getMilliseconds()};l||(l="yyyy-MM-dd hh:mm:ss");/(y+)/.test(l)&&(l=l.replace(RegExp.$1,(f.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in h)(new RegExp("("+k+")")).test(l)&&(l=l.replace(RegExp.$1,RegExp.$1.length==1?h[k]:("00"+h[k]).substr((""+h[k]).length)));return l}b=(b||"").trim();if(!b)return"";var g=
wa(a.url),m=ya(a.file_ext||(a.eurl&&a.eurl!==a.url?wa(a.eurl).file:"")||g.file);b=b.replace(/\*(flat)?([^\*]+)?\*/gi,function(f,l,h){if(h){h=qa(h.replace(/\s+,\s+/,",")).split(",");f=h[0];h=h[1];var k=new Date;switch(f){case "hh":f=e(k.getHours());break;case "mm":f=e(k.getMinutes());break;case "ss":f=e(k.getSeconds());break;case "y":f=k.getFullYear().toString();break;case "m":f=e(k.getMonth()+1);break;case "d":f=e(k.getDate());break;case "wd":f=""+k.getDay();break;case "datetime":f=d(k,h);break;case "date":f=
d(k,h||"yyyy-MM-dd");break;case "time":f=d(k,h||"hh:mm:ss");break;case "time_add":case "addtime":f=d(a.time_add,h);break;case "size_s":f=a.size;f=f<1E3?+f.toFixed(2)+" B":f<1024E3?+(f/1024).toFixed(2)+" KB":f<1048576E3?+(f/1048576).toFixed(2)+" MB":+(f/1073741824).toFixed(2)+" GB";break;case "name":case "ext":case "url":case "host":case "query":case "anchor":case "subdirs":case "text":case "title":case "page_title":case "num":case "size":case "refer":case "referer":case "mime":case "mime_type":case "remark":case "remarks":case "desc":f=
String(Pc(a,f,g,m,!0));break;default:f="_"+f+"_"}(f=f||"")&&(l||c)&&(f=(f||"").replace(/\/|\\/g,"_"));return f}return""});return Aa(b.replace(/~|\*|\?|:|\||<|>|"/g,"_"))}function Rc(a,b){var c;if(!(c=Ea(a.full_path)||a.bb)){a:if(a.W)c=a.W;else{c={};b=[a.naming,b,"*name*.*ext*","*subdirs*","*anchor*","*query*","*host*"];for(var e=0,d=b.length;e<d;++e){var g=b[e];if(g&&!c[g]&&(c[g]=!0,a.W=Qc(a,g,e>=2),Ga(a.W))){c=a.W;break a}}c=a.W="_file"}c=a.bb=Ea(c)}return c}
const Sc=function(){async function a(d,g,m,f){let l;l=d.objectStoreNames.contains("tasks-v2")?f.objectStore("tasks-v2"):d.createObjectStore("tasks-v2",{keyPath:"id"});if(g===1&&m===2){g=f.objectStore("tasks");for await(const h of g)if(g=h.value)g.id=String(g.id),g.recycled=g.recycled?1:0,g.exists=g.exists?1:0,l.put(g);d.deleteObjectStore("tasks")}l.indexNames.contains("icd")||l.createIndex("icd","cr_id",{unique:!1});l.indexNames.contains("inrta")||l.createIndex("inrta",["recycled","time_add"],{unique:!1});
l.indexNames.contains("iclr")||l.createIndex("iclr",["recycled","state","exists","time_add"],{unique:!1});console.log("dbupdated")}async function b(){if(e)return e;try{e=await zc({upgrade:async function(d,g,m,f){console.log("dbupgradeneeded");return a(d,g,m,f)}})}catch(d){console.error("store error: "+d)}return e}function c(d,g,m,f){f=f??Date.now();return IDBKeyRange.bound([0,d,0,new Date(0)],[0,g??d,m?0:1,new Date(f)])}let e=null;return{Mb:function(){return e},J:b,Lb:function(d,g){let m,f=!1;switch(d){case "miss":f=
!0;case "finished":m=d=Ma;break;case "interrupted":m=d=Na;break;case "both":d=Ma;m=Na;break;default:return}return c(d,m,f,g)},Pb:c,Lc:function(){e&&(e.close(),e=null)},Ob:async function(){return e||(e=await b())?e.count("tasks-v2"):0}}}(),Tc={eeyW91dHViZQ:121,odvmltZW8:102,nZdGFpbHltb3Rpb24:103,kdtGlrdG9r:104,maiW5zdGFncmFt:105,kZfmFjZWJib29r:106,xexA:107,iYbmlsaWJpbGk:108,ueyW91a3U:109,iaiXFpeWk:110,qaiXE:111,nZdG91eWlu:112,odw2VpYm8:113,aaiXhpZ3Vh:114,uak3VhaXNob3U:115,obmWlndXZpZGVv:116,nbmWlndWZ1bg:117,
vbmWd0dg:118,qdvi5xcQ:119,hdtHdpdGNo:120,uexGlhb2hvbmdzaHU:125,tcs25hcGNoYXQ:126,tcrmVkZGl0:127,tcpGludGVyZXN0:128},Uc=chrome.runtime.getURL("/ui/index.html"),Vc=chrome.runtime.getURL("/pop/sniffer.html");async function Wc(a,b){return"getContexts"in chrome.runtime?(await chrome.runtime.getContexts({contextTypes:[a]})).map(c=>c.documentUrl):(await self.clients.matchAll()).filter(c=>c.url.startsWith(b)).map(c=>c.url)}async function Xc(){return!!(await Wc("POPUP",Vc))[0]?.startsWith(Vc)}
async function Yc(){const a=await chrome.tabs.query({url:Uc+"*"});return[a[0]?.id,a[0]?.windowId]}async function Zc(){return(await Wc("OFFSCREEN_DOCUMENT",chrome.runtime.getURL("bg/offscreen.html"))).length>0}let ad;async function bd(){await Zc()||(ad||(ad=chrome.offscreen.createDocument({url:"bg/offscreen.html",reasons:["AUDIO_PLAYBACK"],justification:"playing notification sound"})),await ad,ad=null)}
var cd=1,dd=[{id:String(cd++),int_name:"r_recent",condition:"*time_add*>=[3_days_ago]",as_filter:!0,caption:t("ruleRecent"),active:!1,folder:"",naming:"",post_action:"",init_indent:0},{id:String(cd++),int_name:"r_downloading",condition:"*state*!=[finished]&&*state*!=[interrupted]",as_filter:!0,caption:t("ruleDownloading"),active:!1,folder:"",naming:"",post_action:"",init_indent:0},{id:String(cd++),int_name:"r_done",condition:"*state*==[finished]",as_filter:!0,caption:t("ruleFinished"),active:!1,folder:"",
naming:"",post_action:"",init_indent:0},{id:String(cd++),int_name:"r_done_image",condition:"{r_done}&&*ext*.is([ext_image])",as_filter:!0,caption:t("ruleImage"),active:!1,folder:"./images",naming:"",post_action:"<file>",init_indent:1},{id:String(cd++),int_name:"r_done_video",condition:"{r_done}&&*ext*.is([ext_video])",as_filter:!0,caption:t("ruleVideo"),active:!1,folder:"./videos",naming:"",post_action:"",init_indent:1},{id:String(cd++),int_name:"r_done_audio",condition:"{r_done}&&*ext*.is([ext_audio])",
as_filter:!0,caption:t("ruleAudio"),active:!1,folder:"./music",naming:"",post_action:"",init_indent:1},{id:String(cd++),int_name:"r_done_doc",condition:"{r_done}&&*ext*.is([ext_doc])",as_filter:!0,caption:t("ruleDocument"),active:!1,folder:"./docs",naming:"",post_action:"<file>",init_indent:1},{id:String(cd++),int_name:"r_done_other",condition:"{r_done}&&!(*ext*.is([ext_audio])||*ext*.is([ext_video])||*ext*.is([ext_image])||*ext*.is([ext_doc]))",as_filter:!0,caption:t("ruleOther"),active:!1,folder:"",
naming:"",post_action:"",init_indent:1},{id:String(cd++),int_name:"r_interrupted",condition:"*state*==[interrupted]",as_filter:!0,caption:t("ruleInterrupted"),active:!1,folder:"",naming:"",post_action:"",init_indent:0},{id:String(cd++),active:!1,caption:t("ruleSmallFiles"),int_name:"r_smallf",condition:"*size*>0&&*size*<kb(1024)",folder:"./small_files",naming:"",as_filter:!1,post_action:"<folder>",init_indent:0}];const ed=cd-1;
async function fd(){await gd.load();const a=dd.filter(d=>{d=Number(d.id);return isNaN(d)||d>ed});let b=0,c=0,e=0;for(const d of a)d.active&&++b,d.as_filter&&++c,d.naming&&++e;return{qc:a.length,oc:b,pc:c,rc:e}}
function hd(a){var b=F;const c=b.get("match_mode"),e={};for(var d=0;d<dd.length;++d)if(dd[d].active&&a(dd[d].condition))if(c==Oa){a=dd[d];e.naming=a.naming;e.folder=a.folder;e.post_action=a.post_action;break}else if(c==Pa){var g=qa(dd[d].naming);g&&(e.naming=g)}e.naming||(e.naming=b.get("def_naming"));return e}const gd=new class{constructor(){this.ka=!1}async load(a){if(!a&&this.ka)return dd;(a=await Ib.get("rules"))&&(dd=a);this.ka=!0;return dd}};
async function id(){async function a(c){const e=await Lb(c);if(e){var d=e._t;if(d){delete e._t;var g=Math.round(Math.max(0,(Date.now()-d)/864E5-.1999));if(!(g<1)){d=0;for(var m in e)if(m!=="_t"){var f=Math.ceil(e[m]/g);if(isNaN(f)||!isFinite(f))f=0;e[m]=f;d+=f}g=Object.keys(e);m={};if(g.length<25)m=e;else{if(24>=g.length)g=[...g];else{f=[];for(var l=new Set;f.length<24;){const h=Math.floor(Math.random()*g.length);l.has(h)||(f.push(g[h]),l.add(h))}g=f}f=0;for(const h of g)m[h]=e[h],f+=m[h];m[E(87)]=
d-f}b.push([E(c),m]);chrome.storage.local.remove(Kb+c)}}}}const b=[];await async function(){const [c,e,d,g,m,f]=await Promise.all([chrome.storage.local.get(["sdt","ghf","ver1","ver1_t"]),chrome.extension.isAllowedFileSchemeAccess(),navigator.storage.estimate(),fd(),Sc.Ob(),Qb()]);var l=[16,E(F.get("ui_grid_list")==1?44:45)];var h=F.get("bg_image_enable")?(h=F.get("bg_image_url"))?h[0]=="#"?41:h.startsWith("../")||h.startsWith("chrome-extension://")?42:43:40:39;l=[l,[17,E(h)],[20,F.get("fnconflict")],
[21,F.get("override_cr")],[22,F.get("dbclick_action")],[23,F.get("doneclick_rule")],[124,F.get("click_notify")],[24,F.get("slide_details_panel")],[25,F.get("poplist_showd_first")],[140,F.get("pop_content")],[26,F.get("def_naming")!="*name*.*ext*"],[27,F.get("match_mode")],[28,E(F.get("autoclear_timer")>0?qb():39)],[29,F.get("always_use_last_location")],[30,F.get("chrono_folder_selection")],[31,F.get("folder_inaccessible")],[35,F.get("poplist_max_items")],[36,F.get("dy_max_con_tasks")],[37,F.get("dy_max_per_server")],
[160,F.get("win_mode")]];for(var k of l)k[0]=E(k[0]);k={};c.ver1&&c.ver1_t&&(h=Tb((Math.max(0,Date.now()-c.ver1_t)||0)/864E5),k[E(154)]=c.ver1,k[E(155)]=h);f>0&&(k[E(33)]=Tb(f));!isNaN(m)&&isFinite(m)&&(k[E(32)]=Tb(m));d.quota!==void 0&&(k[E(38)]=Tb(d.quota/1048576,Rb));e!==void 0&&(k[E(34)]=e);c.sdt!==void 0&&(k[E(18)]=c.sdt);h=c.ghf;k[E(122)]=h?h[0].toLowerCase()+(h.split("/").length-1):"_";b.push([E(1),Object.fromEntries(l)]);Object.keys(k).length>0&&b.push([E(2),k]);b.push([E(82),{[E(84)]:g.qc,
[E(85)]:g.oc,[E(86)]:g.pc,[E(83)]:g.rc}])}();for(const c of nb)await a(c);return b}async function jd(a,b,c=!0){if(c){c="_grt_"+a;const e=(await chrome.storage.local.get(c))[c]||0,d=Date.now();if(d-e<864E5)return;chrome.storage.local.set({[c]:d})}await bd();b.page_location=location.href;b.v=chrome.runtime.getManifest().version;chrome.runtime.sendMessage({target:"off",cmd:"e",data:[[[E(a),b]]]})}const kd=(a,b,c)=>jd(a,{[typeof b==="string"?b:E(b)]:typeof c==="string"?c:E(c)},!1);
(ha.__cdmg__=ha.__cdmg__||{}).r=kd;async function ld(a){if(a.startsWith("http:")||a.startsWith("https:")){var b=!0;try{const e=await fetch(a,{method:"HEAD",headers:{Range:"bytes=0-"},mode:"cors"});if(e.status===206)b=!1;else if(e.status===200){const d=Number(e.headers.get("content-length"));Ub(157,d);b=!d||d>=10485760}var c=(ob+e.status).replace(/\./g,"_")}catch(e){c=95}Ob(100,c);if(b)try{jd(97,{[E(98)]:c,page_referrer:Nb(Xb(a))})}catch(e){}}}let md;
function nd(a){if(a){if(!md){const b=`://(?:[^/]+\\.)?(${Object.keys(Tc).map(c=>atob(c[1]+c.slice(3)).replace(/\./g,"\\.")).join("|")})\\.(?:com|tv)`;md=new RegExp(b)}if(a=md.exec(a)?.[1])a=Tc[Xb(a)],a!==void 0&&Ob(101,a)}}
async function od(){var a=(await chrome.storage.local.get("_glr2"))._glr2||0;const b=Date.now();a?Math.round(Math.max(0,(b-a)/864E5-.1999))<1||(chrome.storage.local.set({_glr2:b}),a=await id(),a.length>0&&(await bd(),chrome.runtime.sendMessage({target:"off",cmd:"e",data:[a,!0]}))):chrome.storage.local.set({_glr2:b})}const pd={Va:"Content-Type",Ua:"Cache-Control",Wa:"YmNsLGR3b2hxZHI",hb:"application/javascript",nc:"no-store, no-cache",Gb:"ejZRbTBiLmpz"};let N;
const qd=typeof TextDecoder!=="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available");}};typeof TextDecoder!=="undefined"&&qd.decode();let rd=null;function sd(){if(rd===null||rd.byteLength===0)rd=new Uint8Array(N.memory.buffer);return rd}function td(a,b){a>>>=0;return qd.decode(sd().subarray(a,a+b))}let ud=0;
const vd=typeof TextEncoder!=="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available");}},wd=typeof vd.encodeInto==="function"?function(a,b){return vd.encodeInto(a,b)}:function(a,b){const c=vd.encode(a);b.set(c);return{read:a.length,written:c.length}};let xd=null;function yd(){if(xd===null||xd.buffer.Wb===!0||xd.buffer.Wb===void 0&&xd.buffer!==N.memory.buffer)xd=new DataView(N.memory.buffer);return xd}
const zd=typeof FinalizationRegistry==="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(a=>{N.__wbindgen_export_3.get(a.jb)(a.a,a.b)});function Ad(a,b){var c=Bd;const e={a,b,cnt:1,jb:22};a=(...d)=>{e.cnt++;const g=e.a;e.a=0;try{return c(g,e.b,...d)}finally{--e.cnt===0?(N.__wbindgen_export_3.get(e.jb)(g,e.b),zd.unregister(e)):e.a=g}};a.sc=e;zd.register(a,e,e);return a}function Bd(a,b,c){N.closure21_externref_shim(a,b,c)}
function Cd(a){const b=N.__externref_table_alloc();N.__wbindgen_export_2.set(b,a);return b}function Dd(a,b){try{return a.apply(this,b)}catch(c){a=Cd(c),N.__wbindgen_exn_store(a)}}function Ed(){return()=>{throw Error("queueMicrotask is not defined");}}const Fd=typeof FinalizationRegistry==="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(a=>N.__wbg_qmfzzvb_free(a>>>0,1));
class Gd{constructor(){this.Ea=N.qmfzzvb_cc()>>>0;Fd.register(this,this.Ea,this);return this}a(a){var b=N.__wbindgen_malloc;b=b(a.length*4,4)>>>0;const c=yd();for(let e=0;e<a.length;e++)c.setUint32(b+4*e,Cd(a[e]),!0);ud=a.length;return N.qmfzzvb_a(this.Ea,b,ud)}}
async function Hd(a,b){if(typeof Response==="function"&&a instanceof Response){if(typeof WebAssembly.instantiateStreaming==="function")try{return await WebAssembly.instantiateStreaming(a,b)}catch(c){if(a.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",c);else throw c;}a=await a.arrayBuffer();
return await WebAssembly.instantiate(a,b)}b=await WebAssembly.instantiate(a,b);return b instanceof WebAssembly.Instance?{instance:b,module:a}:b}
function Id(){const a={wbg:{}};a.wbg.__wbindgen_number_new=function(b){return b};a.wbg.__wbindgen_string_new=function(b,c){return td(b,c)};a.wbg.__wbindgen_is_function=function(b){return typeof b==="function"};a.wbg.__wbindgen_string_get=function(b,c){c=typeof c==="string"?c:void 0;if(c===void 0||c===null)c=0;else{var e=c,d=N.__wbindgen_malloc;c=N.__wbindgen_realloc;if(c===void 0){c=vd.encode(e);var g=d(c.length,1)>>>0;sd().subarray(g,g+c.length).set(c);ud=c.length;c=g}else{g=e.length;d=d(g,1)>>>
0;for(var m=sd(),f=0;f<g;f++){const l=e.charCodeAt(f);if(l>127)break;m[d+f]=l}f!==g&&(f!==0&&(e=e.slice(f)),d=c(d,g,g=f+e.length*3,1)>>>0,m=sd().subarray(d+f,d+g),e=wd(e,m),f+=e.written,d=c(d,g,f,1)>>>0);ud=f;c=d}}g=ud;yd().setInt32(b+4,g,!0);yd().setInt32(b+0,c,!0)};a.wbg.__wbindgen_cb_drop=function(b){b=b.sc;return b.cnt--==1?(b.a=0,!0):!1};a.wbg.__wbg_instanceof_Crypto_e60e52ac6fd32379=function(b){let c;try{c=b instanceof Crypto}catch(e){c=!1}return c};a.wbg.__wbg_subtle_216b5e2ad7384e6e=function(b){return b.subtle};
a.wbg.__wbg_instanceof_Response_3c0e210a57ff751d=function(b){let c;try{c=b instanceof Response}catch(e){c=!1}return c};a.wbg.__wbg_ok_abdcc292e508a59f=function(b){return b.ok};a.wbg.__wbg_arrayBuffer_144729e09879650e=function(){return Dd(function(b){return b.arrayBuffer()},arguments)};a.wbg.__wbg_digest_c5bc8be24233ba41=function(){return Dd(function(b,c,e,d){return b.digest(td(c,e),d)},arguments)};a.wbg.__wbg_digest_76776632069939cb=function(){return Dd(function(b,c,e,d,g){var m=b.digest;c=td(c,e);
d>>>=0;g=sd().subarray(d/1,d/1+g);return m.call(b,c,g)},arguments)};a.wbg.__wbg_queueMicrotask_848aa4969108a57e=function(b){return b.queueMicrotask};a.wbg.__wbg_queueMicrotask_c5419c06eab41e73=typeof queueMicrotask=="function"?queueMicrotask:Ed();a.wbg.__wbg_newnoargs_1ede4bf2ebbaaf43=function(b,c){return new Function(td(b,c))};a.wbg.__wbg_get_ef828680c64da212=function(){return Dd(function(b,c){return Reflect.get(b,c)},arguments)};a.wbg.__wbg_call_a9ef466721e824f2=function(){return Dd(function(b,
c){return b.call(c)},arguments)};a.wbg.__wbg_self_bf91bf94d9e04084=function(){return Dd(function(){return self.self},arguments)};a.wbg.__wbg_window_52dd9f07d03fd5f8=function(){return Dd(function(){return window.window},arguments)};a.wbg.__wbg_globalThis_05c129bf37fcf1be=function(){return Dd(function(){return globalThis.globalThis},arguments)};a.wbg.__wbg_global_3eca19bb09e9c484=function(){return Dd(function(){return global.global},arguments)};a.wbg.__wbindgen_is_undefined=function(b){return b===void 0};
a.wbg.__wbg_instanceof_ArrayBuffer_74945570b4a62ec7=function(b){let c;try{c=b instanceof ArrayBuffer}catch(e){c=!1}return c};a.wbg.__wbg_call_3bfa248576352471=function(){return Dd(function(b,c,e){return b.call(c,e)},arguments)};a.wbg.__wbg_now_70af4fe37a792251=function(){return Date.now()};a.wbg.__wbg_instanceof_Promise_f3fd1bcac3157f0c=function(b){let c;try{c=b instanceof Promise}catch(e){c=!1}return c};a.wbg.__wbg_new_1073970097e5a420=function(b,c){try{var e=b;var d=c;return new Promise((g,m)=>
{const f=e;e=0;try{N.closure42_externref_shim(f,d,g,m)}finally{e=f}})}finally{e=d=0}};a.wbg.__wbg_resolve_0aad7c1484731c99=function(b){return Promise.resolve(b)};a.wbg.__wbg_then_748f75edfb032440=function(b,c){return b.then(c)};a.wbg.__wbg_then_4866a7d9f55d8f3e=function(b,c,e){return b.then(c,e)};a.wbg.__wbg_buffer_ccaed51a635d8a2d=function(b){return b.buffer};a.wbg.__wbg_new_fec2611eb9180f95=function(b){return new Uint8Array(b)};a.wbg.__wbg_set_ec2fcf81bc573fd9=function(b,c,e){b.set(c,e>>>0)};a.wbg.__wbg_length_9254c4bd3b9f23c4=
function(b){return b.length};a.wbg.__wbindgen_array_new=function(){return[]};a.wbg.__wbindgen_array_push=function(b,c){b.push(c)};a.wbg.__wbindgen_throw=function(b,c){throw Error(td(b,c));};a.wbg.__wbindgen_memory=function(){return N.memory};a.wbg.__wbindgen_closure_wrapper159=function(b,c){return Ad(b,c)};a.wbg.__wbindgen_init_externref_table=function(){const b=N.__wbindgen_export_2,c=b.grow(4);b.set(0,void 0);b.set(c+0,void 0);b.set(c+1,null);b.set(c+2,!0);b.set(c+3,!1)};return a}
async function Jd(){var a;if(N!==void 0)return N;typeof a!=="undefined"&&(Object.getPrototypeOf(a)===Object.prototype?{Xc:a}=a:console.warn("using deprecated parameters for the initialization function; pass a single object instead"));typeof a==="undefined"&&(a=new URL("/libs/BFtU8g5Z.wasm",location.href));const b=Id();if(typeof a==="string"||typeof Request==="function"&&a instanceof Request||typeof URL==="function"&&a instanceof URL)a=fetch(a);({instance:a}=await Hd(await a,b));N=a.exports;rd=xd=
null;N.__wbindgen_start();return N}let Kd=null,Ld;async function Md(){if(Kd)return Kd;if(Ld)return Ld;const a=jb();Ld=a.promise;await Jd();Kd=new Gd;a.resolve(Kd);Ld=void 0;return Kd}
self.addEventListener("fetch",async a=>{if(a.request.url.startsWith(ka)){var b=a.request.url.slice(ka.length);if(b[0]==="z"&&btoa(b)===pd.Gb){var c="https://app.chronodownloader.net/js/"+b;a.respondWith(caches.match(c,{cacheName:"chp"}).then(e=>{const d=Date.now();if(e){const g=Number(e.headers.get(pd.Wa));if(g&&d<g)return e;caches.open("chp").then(m=>m.delete(c))}return Md().then(g=>N.qmfzzvb_s(g.Ea)).then(g=>{g=new Response(g,{headers:{[pd.Va]:pd.hb,[pd.Ua]:"private, max-age=72000, must-revalidate",
[pd.Wa]:(d+72E6).toString()}});const m=g.clone();caches.open("chp").then(f=>f.put(c,m));return g}).catch(g=>{kd(141,98,[142,143,144,145,146,147,148,149,150][parseInt(g)]||40);return new Response("",{headers:{[pd.Va]:pd.hb,[pd.Ua]:pd.nc}})})}))}}});
let Nd=[{caption:t("extsImage"),int_name:"ext_image",exts:"bmp|cur|dds|exr|gif|ico|jpg|jpeg|pcx|pbm|pfm|pgm|ppm|png|psd|svg|tga|tif|tiff|webp",filter_links:!0},{caption:t("extsVideo"),int_name:"ext_video",exts:"3gp|3g2|asf|avi|f4f|f4i|f4m|f4v|flv|h264|m4v|mkv|mov|mp4|mpg|ogg|ogv|qt|rm|rmvb|ts|vob|webm|wmv",filter_links:!0},{caption:t("extsAudio"),int_name:"ext_audio",exts:"aac|aif|ape|flac|oga|opus|m3u|m4a|mid|midi|mp3|ra|wav|wma|weba",filter_links:!0},{caption:t("extsDocument"),int_name:"ext_doc",
exts:"c|cfg|cpp|cs|css|csv|dat|doc|docx|h|hpp|ini|js|log|m|pdf|ppt|pptx|ps|py|rtf|sh|tex|torrent|txt|xls|xlsx",filter_links:!0},{caption:t("extsArchive"),int_name:"ext_arch",exts:"7z|bin|cbr|cue|deb|dmg|gz|iso|mdf|pkg|rar|rpm|sitx|tar.gz|vcd|zip",filter_links:!0},{caption:t("extsApp"),int_name:"ext_app",exts:"apk|app|bat|cgi|com|dll|exe|gadget|jar|msi|pif|sys",filter_links:!0},{caption:t("extsAll"),int_name:"ext_all",exts:"[ext_audio]|[ext_video]|[ext_image]|[ext_doc]|[ext_arch]|[ext_app]",filter_links:!1}];
function Od(a,b,c){for(var e=0;e<Nd.length;++e)if(Nd[e].int_name==b)try{return Pd(a,Nd[e].exts,c)}catch(d){console.log(d);break}return null}function Pd(a,b,c){return b.replace(/\[([^\]]+)\]/gi,(e,d)=>{e=d?d.trim().toLowerCase():"";if(c[e]==1)throw"loop of link filter ["+e+"] detected";c[e]=!0;d=Od(a,e,c);delete c[e];if(!d)throw"ref link filter ["+e+"] not found";return"("+d+")"})}
const Qd=new class{constructor(){this.ka=!1}async load(a){if(a||!this.ka)(a=await Ib.get("lfilters"))&&(Nd=a),this.ka=!0}},Rd=function(){function a(c,e){return I.da({rt:[c,e],nrt:Object.keys(c).length})}const b=[{},{}];return{get:function(c){const [e]=I.get("rt",b);return e[c]},ac:function(c){const [,e]=I.get("rt",b);return e[c]||[]},Rc:function(c){const [e]=I.get("rt",b);return Object.values(e).find(d=>{d=kb(d.url);const g=kb(c);return d===g})},add:function(c){if(c&&c.url){var [e,d]=I.get("rt",b),
g=e[c.id];g||(g=e[c.id]={id:c.id});g.url=c.url;g.Y=Date.now()/1E3;g=wa(c.url).authority;var m=d[g];m===void 0&&(d[g]=m=[]);m.includes(c.id)||m.push(c.id);return a(e,d)}},remove:function(c){const [e,d]=I.get("rt",b),g=e[c];if(g){delete e[c];c=wa(g.url).authority;var m=d[c];if(m&&m.length>0){const f=m.indexOf(g.id);f!==-1&&m.splice(f,1);m.length===0&&delete d[c]}a(e,d);return g}},update:function(c){const [e,d]=I.get("rt",b);e[c.id]=c;return a(e,d)},has:function(c){const [e]=I.get("rt",b);return c in
e},length:function(){return I.get("nrt",0)}}}(),Td=(()=>{async function a(){c=c||(new OffscreenCanvas(48,48)).getContext("2d",{willReadFrequently:!0});if(!e){const m=await (await fetch("/icons/logo/48.png")).blob();e=await createImageBitmap(m)}d=0;g&&(clearTimeout(g),g=void 0)}function b(){d+=1/36;c.save();c.clearRect(0,0,48,48);c.translate(24,24);c.rotate(2*Math.PI*((1-Math.sin(Math.PI/2+d*Math.PI))/2));c.drawImage(e,-24,-24);c.restore();chrome.action.setIcon({imageData:c.getImageData(0,0,48,48)});
d<=1?g=setTimeout(b,10):(d=0,chrome.action.setIcon({path:{16:"/icons/logo/16.png",19:"/icons/logo/19.png",24:"/icons/logo/24.png",32:"/icons/logo/32.png",38:"/icons/logo/38.png",48:"/icons/logo/48.png",128:"/icons/logo/128.png"}}))}let c,e,d=0,g;return async()=>{try{await a()}catch(m){console.error(m);return}b()}})(),O=Object.assign(Sc,function(){async function a(h,k,p,q){const r=[],w=[];for(var C of h)(h=k[C])||h===null?h&&r.push(h):w.push(C);if(!w.length||!f()&&!await Sc.J())return r;C=f().transaction("tasks-v2",
"readonly");const A=p(C);p=w.map(da=>q(A,da));p.push(C.done);p=await Promise.all(p);p.pop();for(C=0;C<p.length;++C){h=w[C];var H=k[h];H||H===null?H&&r.push(H):(H=p[C])?(h=new Lc(H),g[h.id]=h,m[h.cr_id]=h,r.push(h)):console.warn("missing task in db",h)}return r}async function b(h,k){if(f()||await Sc.J()){var p=await f().getAllFromIndex("tasks-v2","icd",h);for(const q of p)q.id!==k&&((p=g[q.id])||(p=new Lc(q)),p.cr_id=-2,e(p),console.warn("found stale id mapping",h,p.id,k))}}function c(h){m[h.cr_id]=
null;h.cr_id=-2;e(h)}function e(h){g[h.id]!==null&&(m[h.cr_id]=h,g[h.id]=h,h.Da||(h.Da=!0,l()))}async function d(h){if(!h||!f()&&!await Sc.J())return[];var k=await f().getAllFromIndex("tasks-v2","iclr",h);h=[];for(const p of k)p?(k=g[p.id],k!==null&&(k?h.push(k):(k=new Lc(p),m[k.cr_id]=k,g[k.id]=k,h.push(k)))):console.warn("missing task in db from query");return h}const g={},m={},f=Sc.Mb,l=ib(async function(){if(f()||await Sc.J()){var h=Object.values(g).filter(p=>p?p.Da?(delete p.Da,!0):!1:!1);if(h.length){var k=
f().transaction("tasks-v2","readwrite");h=h.map(p=>k.store.put(Mc(p)));h.push(k.done);await Promise.all(h)}}});return{clear:async function(){for(const h in g)delete g[h];for(const h in m)delete m[h];if(f()||await Sc.J())return f().clear("tasks-v2")},La:async function(h){if(!(h<0)){var k=m[h];if(k||k===null)return k;if(f()||await Sc.J()){var p=await f().getFromIndex("tasks-v2","icd",h);p&&(k=new Lc(p),m[h]=k,g[k.id]=k);return k}}},Tc:function(h){return h<0?void 0:m[h]},Uc:function(h){return g[h]},
yc:async function(h){if(h&&h.length){for(const p of h)g[p.id]=null,m[p.cr_id]=null;h=h.map(p=>p.id);if(f()||await Sc.J()){var k=f().transaction("tasks-v2","readwrite");h=h.map(p=>k.store.delete(p));h.push(k.done);return Promise.all(h)}}},F:async function(h){return a(h,g,k=>k.store,(k,p)=>k.get(p))},qb:async function(h){return a(h.filter(k=>k>=0),m,k=>k.store.index("icd"),(k,p)=>k.iterate(p).next().then(q=>q?.value?.value))},vc:function(h){h=Sc.Pb(h);return d(h)},wc:function(h,k){h=Sc.Lb(h,k);return d(h)},
B:e,sb:c,Ma:function(h,k){if(!(h<0)){var p=m[h];p!==null&&(p?p.id!==k&&c(p):b(h,k))}},va:()=>l(!0),Mc:async function(h){if(f()||await Sc.J())return f().put("tasks-v2",Mc(new Lc(h)))}}}()),Ud={};let Vd=!1;function Wd(a,b=2,c=0){if(a===void 0)return 0;if(c>=b||typeof a!=="object"||a===null)return(a=JSON.stringify(a))?a.length:4;if(Array.isArray(a))return JSON.stringify(a).length;const e={};for(const [d,g]of Object.entries(a))e[d]=Wd(g,b,c+1);return e}
function Xd(...a){try{chrome.runtime.sendMessage(...a)}catch(b){b?.message?.includes("Message length exceeded maximum allowed length")?(a=Wd(a[0],2),kd(138,"page_referrer",`sendMessage limit${JSON.stringify(a)}`.slice(0,300))):setTimeout(()=>{throw b;},0)}}function P(...a){if(!Vd){switch(a[0].cmd){case "u_tasks":var b=O.va();break;case "u_fields":b=Ud[a[0].id]}b?b.then(()=>{Xd(...a)}):Xd(...a)}}function Yd(a,b){chrome.runtime.sendMessage({...a,target:"ui"},b)}
const Zd={Zb(){const a=I.get("gbn",0)+1;I.set("gbn",a);return a}};function ae(a,b){a==void 0||a<0?b&&b():chrome.downloads.search({id:a},function(c){c&&c.length&&c[0].state=="complete"&&c[0].exists&&chrome.downloads.removeFile(a,function(){});b&&b()})}
const be=(()=>{function a(q,r,w){const C=new Promise(A=>{p=setTimeout(w,r,A)});return Promise.race([q,C])}function b(q=!1){return h?h:h=a(new Promise(r=>{k=r;chrome.downloads.download({url:"data:text/plain;charset=utf-8,CHRONO%20TEST",filename:f,method:"GET",saveAs:!1,conflictAction:"overwrite"},function(w){h||k?l=w:(console.error(`got did: ${w} but no pending, cleanup again`),g(w))})}),800,r=>{(h||k)&&console.error("timeout");g();r("");Ob(96,159);kd(138,"page_referrer",159);q&&chrome.windows.create({url:`https://faq.chronodownloader.net/?action=faq&cat=1&id=84&artlang=${chrome.i18n.getUILanguage().startsWith("zh")?
"zh":"en"}#wrapper`,type:"popup",focused:!0,width:800,height:600})}).then(r=>{I.set("cdf",r);chrome.storage.local.set({ghf:r});g();I.set("cdft",Date.now());return r})}function c(q){e(q,"onCreated")}function e(q,r){!l&&d(q.url)&&(h||k?l=q.id:(console.error(`${r} got did: ${q.id} but no pending, cleanup again`),g(q.id)))}function d(q){return q.startsWith("data:text/plain;charset=utf-8,CHRONO%20TEST")}function g(q){const r=q||l;l=void 0;p&&clearTimeout(p);k=h=p=void 0;r||console.error("cleanup missing did");
r&&chrome.downloads.cancel(r,function(){ae(r,()=>{chrome.downloads.erase({id:r},()=>{})})})}function m(q){l&&l==q.id&&(q.error&&q.error.current=="USER_CANCELED"||q.state&&q.state.current=="interrupted"?k&&k(""):q.filename&&q.filename.current&&(q=Ba(Fa(q.filename.current)),k&&k(q)))}let f=t("filenameTestDownloadConfigFail"),l,h,k,p;return{Ya:"data:text/plain;charset=utf-8,CHRONO%20TEST",A:function(){chrome.downloads.onCreated.addListener(c);chrome.downloads.onChanged.addListener(m)},Sc:b,ob:(q=!1)=>
{var r=Date.now();const w=I.get("cdft",0);if(r-w<=216E5)return r=I.get("cdf",""),q?Promise.resolve(r):r;r=b(q);return q?r.then(()=>I.get("cdf","")):I.get("cdf","")},onDeterminingFilename:function(q,r){if(!d(q.url))return!1;e(q,"onDeterminingFilename");r({filename:f,conflictAction:"overwrite"});return!0}}})();function ce(){return globalThis.__cdmg__.e}
const de=mb(function(){Vd||(F.get("badge_downnum")?(async()=>{const a=Rd.length()+await Q.xc();let b="";a>99?b="99+":a>0&&(b=String(a));chrome.action.setBadgeText({text:b})})():chrome.action.setBadgeText({text:""}))},500,[-1]),ee=mb(async function(){const [a,,b]=await ce().tc();Hb.set("os",a);if(b.length){var c=Date.now()/1E3,e=[];for(const g of b){var d=Rd.get(g.id);d?(d.Y||(d.Y=c),g.time_elapsed+=c-d.Y,d.Y=c,Rd.update(d),d={id:g.id,speed:g.speed,finished_bytes:g.finished_bytes,time_remained:g.time_remained,
time_elapsed:g.time_elapsed},g.size>0&&(g.progress=g.finished_bytes/g.size*100,g.progress=Math.min(100,g.progress),d.progress=g.progress,isFinite(g.progress)||console.log("f: "+g.finished_bytes+" sz: "+g.size)),e.push(d)):console.error("missing running in progress")}P({cmd:"u_prog",data:e});for(c=0;c<b.length;++c)O.B(b[c])}},250),Q=function(){function a(g){return K.ta("qt",g)}async function b(g,m){if(g&&g.length){var [f,l]=Db(K,"qt"),h=await K.get("qt",[],l);m&&(h=h.filter(q=>!m.includes(q)),h.push(...m));
var [k,p]=lb(h,g);h=k.concat(p);g=Eb(K,"qt",h);f();return g}}async function c(){const [g,m,f]=await K.get(["ft","bt","qt"],[[],[],[],[]]),l=I.get("slt",[]);var h=f;[p,h]=lb(h,g);[k,h]=lb(h,m);var k=p.concat(h,k);Pb(f.length);h=[];var p=null;for(const q of k)if(!l.includes(q))if([k]=await O.F([q]),k&&!k.recycled){p=k;break}else!k&&console.error("queued task not found in db",q),h.push(q);h.length>0&&a(h);return p}async function e(){if(!d){d=!0;de(!1);var g=await c();if(g){var m=await ce().hc(g);de(m!==
Ha);if(m===Ia)d=!1;else{if(m===Ha){a([g.id]);if(!ce().download(g)){d=!1;return}I.ta("slt",[g.id])}else m==Ja&&I.Z("slt",[g.id]);d=!1;setTimeout(e,0)}}else d=!1}}let d=!1;return{xc:async function(){return(await K.get("qt",[])).length},enqueue:function(g,m){if(g&&g.length)return m?b(m,g):K.Z("qt",g,!1)},Ka:a,K:function(){I.erase("slt");e()},pa:e,xb:b}}();
function fe(a,b,c){function e(l,h){return Math.sign(h.cnt-l.cnt)*1+Math.sign(h.time-l.time)*3}function d(){return Array.from(new Set(c().filter(l=>!!l))).map(l=>({value:l,cnt:0,time:0}))}async function g(){const l=await a.get(b,d());f||(f=l)}const m=[];let f;return{Ra:async function(l,h){if(l){m.push([l,h]);if(!f&&(await g(),!m.length))return;for(const k of m)a:{l=k[0];h=k[1];let p=0,q=f.length,r=!1;h?h=h.getTime():(h=Date.now(),r=!0);let w=1;for(;p<q;++p)if(f[p].value===l){if(h-f[p].time<4E3)break a;
w=f[p].cnt+1;f[p].cnt=r?1E6:w;f[p].time=h;break}p>=q&&(q>=12&&f.splice(11,1),f.push({value:l,cnt:r?1E6:w,time:h}));f.sort(e);r&&(f[0].cnt=w)}m.length=0;return a.set(b,f)}},rb:async function(){f||await g();return(f.length>6?f.slice(0,6):f).map(l=>l.value)},cc:async function(){f||await g();return f[0]?.value}}}const ge=fe(L,"path_rt_",()=>[F.get("def_folder")]),he=fe(Ib,"naming_rt_",()=>[F.get("def_naming"),"*name*.*ext*","*text*.*ext*","*title*.*ext*","*page_title*.*ext*"]),ie=[];
function je(){const a=jb();ie.push(a);return a.promise}function ke(){for(const a of ie)a.resolve();ie.length=0}
const S=function(){function a(k,p){return k&&p&&(k[k.length-1]==="/"?k:k+"/")===(p[p.length-1]==="/"?p:p+"/")}async function b(k){const p=await chrome.tabs.get(k.tabId);p&&F.get("override_cr")&&(a(bc.L,p.url)||a(Zb.L,p.url))?m({D:p.id}):g(k.windowId,p)}function c(k,p){p.url&&(F.get("override_cr")&&(a(bc.L,p.url)||a(Zb.L,p.url))?m({D:k}):p.url.startsWith(bc.C)||p.url.startsWith(Zb.C)?I.set("cdft",0):nd(p.url))}function e(k){k.url&&(F.get("override_cr")&&(a(bc.L,k.url)||a(Zb.L,k.url))?m({D:k.id}):k.url.startsWith(bc.C)||
k.url.startsWith(Zb.C)?I.set("cdft",0):nd(k.url))}async function d(k){if(k.type==="popup"){var [,p]=await Yc();p===k.id&&L.set("uwb",[k.width,k.height,k.left,k.top])}}async function g(k,p){if(!p){if(k<0)return;k=await chrome.windows.get(k,{populate:!0});if(!k||!k.tabs)return;p=k.tabs.find(q=>q.active)}p&&p.url&&(p.url.startsWith(bc.C)||p.url.startsWith(Zb.C))&&I.set("cdft",0)}function m(k){function p(C){chrome.windows.getCurrent(function(A){chrome.runtime.lastError&&!A?(console.log(chrome.runtime.lastError),
console.log("checking in one second"),setTimeout(function(){p(C)},1100)):C&&C()})}if(h)return console.log("still opening"),h;const q=k?.lb?f+"?"+(new URLSearchParams(k.lb)).toString():f,{promise:r,resolve:w}=jb();h=r;Promise.all([Yc(),mc]).then(([[C]])=>{const A=F.get("win_mode");if(C&&C!==-1)if(k?.Yb)chrome.tabs.remove(C);else{k?.D&&(A||k.D!==C)&&chrome.tabs.remove(k.D);chrome.tabs.get(C,function(H){chrome.windows.update(H.windowId,{focused:!0})});chrome.tabs.update(C,{active:!0});h=void 0;w();return}if(A){k?.D&&
chrome.tabs.remove(k.D);const H={url:q,type:"popup",focused:!0};L.get("uwb").then(da=>{if(da){const [n,u,x,y]=da;H.width=n;H.height=u;H.left=x;H.top=y}chrome.windows.create(H)})}else k?.D?(chrome.tabs.get(k.D,function(H){chrome.windows.update(H.windowId,{focused:!0})}),chrome.tabs.update(k.D,{active:!0,url:q})):p(function(){chrome.tabs.create({active:!0,url:q})});je().then(()=>{h=void 0;w()})});return h}const f=chrome.runtime.getURL("/ui/index.html"),l=chrome.runtime.getURL("/ui/options.html");let h;
return{Wc:f,Yc:l,pb:function(k){chrome.windows.getLastFocused({populate:!1},function(p){chrome.tabs.query({active:!0,windowId:p.id},function(q){k(q&&q.length?q[0]:null)})})},A:function(){chrome.tabs.onUpdated.addListener(M(c));chrome.tabs.onCreated.addListener(M(e));chrome.tabs.onActivated.addListener(M(b));chrome.windows.onBoundsChanged.addListener(d);chrome.windows.onFocusChanged.addListener(M(g))},o:m,wa:async function(k){k||(k={});const [[p],q]=await Promise.all([Yc(),chrome.tabs.query({url:l+
"*"})]);var r=l+(k.xa?"#"+k.xa:"");if(p&&!k.nb)chrome.runtime.sendMessage({cmd:"u_options",data:r}),chrome.tabs.get(p,function(H){chrome.windows.update(H.windowId,{focused:!0})}),chrome.tabs.update(p,{active:!0});else if(q&&q.length){var w=q[0];let H=w.windowId;if(k&&k.ea&&k.na){var C=w.index,A=k.na;w.windowId==k.ea&&C<A&&--A;chrome.tabs.move(w.id,{windowId:k.ea,index:A}).then(da=>{H=da.windowId}).catch(()=>{}).finally(()=>{chrome.windows.update(H,{focused:!0})})}else chrome.windows.update(H,{focused:!0});
r!=w.url?chrome.tabs.update(w.id,{url:r,active:!0}):chrome.tabs.update(w.id,{active:!0})}else r={url:r,active:!0},k&&k.ea&&k.na&&(r.windowId=k.ea,r.index=k.na),chrome.tabs.create(r).then(H=>{chrome.windows.update(H.windowId,{focused:!0})})}}}();var le=t("tipmsgNotifications",[t("titleOptions")+" > "+t("titleOptionsInterface")+" > "+t("optSectionNotifications")]);function me(a,b,c){ac!=="Opera"||ma()||delete b.buttons;chrome.notifications.create(a,b,c)}
function ne(a){return a.Ga?a.Ga():Rc(a,F.get("def_naming"))}function oe(a,b){return ma()?[b,a]:[a,b]}async function pe(a){await bd();chrome.runtime.sendMessage({target:"off",cmd:"a",data:a})}function qe(a,b){return`${a?"tfi0_":"tfin_"}${b.cr_id}_${b.id}`}function re(a){const [b,c]=a.slice(5).split("_");return[Number(b),c]}chrome.notifications.onClicked.addListener(function(a){if(a.indexOf("tfi0_")!==-1){var [b]=re(a);isNaN(b)||(chrome.downloads.open(b),chrome.notifications.clear(a,function(){}))}});
chrome.notifications.onClicked.addListener(M(function(a){var b=a.startsWith("tfi");if(b||a.indexOf("task_")!=-1||a.indexOf("terr_")!=-1||a.indexOf("tmsg_")!=-1){const c=F.get("click_notify");if(b&&c===Wa&&a.startsWith("tfi0_"))return;if(b&&c===Xa)[b]=re(a),!isNaN(b)&&chrome.downloads.show(b);else if(c===Wa||c==Xa||c==Ta){let e;b?[,e]=re(a):e=a.slice(5);S.o().then(function(){ia({cmd:"u_scroll",id:e})})}else if(c!=Ua){se();return}}else a.indexOf("tip_")!=-1?L.set(a,100):a.indexOf("int_")!=-1&&S.o();
chrome.notifications.clear(a,function(){})}));
chrome.notifications.onButtonClicked.addListener(function(a,b){if(a=="reload_update"){if(b==0){chrome.runtime.reload();return}}else if(a.indexOf("task_")!=-1||a.indexOf("terr_")!=-1)S.o().then(function(){ia({cmd:"u_scroll",id:a.substring(5)})});else if(a.indexOf("tfi")!==-1){const [c]=re(a);if(isNaN(c))return;b==0?chrome.downloads.open(c):b==1&&chrome.downloads.show(c)}else a.indexOf("tip_")!=-1&&(L.set(a,100),b==1&&S.wa({xa:"interface.int-notifications"}));chrome.notifications.clear(a,function(){})});
async function te(a){await L.get("noup_"+a)||(me("reload_update",{type:"basic",title:t("msgTitleUpdateAvail",[a]),priority:2,message:t("msgTextUpdateAvail"),iconUrl:"/icons/noty/update.png",buttons:[{title:t("btnUpdateReload")},{title:t("btnLater")}]},function(){}),L.set("noup_"+a,1))}
async function ue(){let [a,b]=await Promise.all([L.get("tip_notifications",0),Hb.get("#ss-tip_notifications",!1)]);if(!(a>=6||b)){++a;if(a===6){a=0;const c={type:"basic",title:t("titleTips"),priority:1,message:le,iconUrl:"/icons/logo/128.png",buttons:[{title:t("btnGotIt"),iconUrl:"/icons/tick.png"}]};c.buttons.push({title:t("btnTakeMeThere"),iconUrl:"/icons/noty/gear.png"});me("tip_notifications",c,function(){});Hb.set("#ss-tip_notifications",!0)}L.set("tip_notifications",a)}}
function ve(a,b){if(a&&!a._suppress_noty&&a.state!=Ma&&a.state!=Na){var [c,e]=oe(ne(a),b?t("msgTaskAddPaused"):t("msgTaskStart"));me("task_"+a.id,{type:"basic",message:e,title:c,iconUrl:a.iconURL32||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACEElEQVRYhe2XsZLaMBCGfyfmmAMSGJ7k6stkGOBxrsprpKG5VEdDYV6DV7hH4A2SSUOj1aawZdaWtLIIXaKZHayV0ffvaiUB8K+3IuSsqooBgJmFAQwGAj7Xr4cZ5aj89ftyWX97eXm/SVVVVUxEnhlppm+GrbV8PB75fD7z237/c7fbPaVYH0JOZgYAWGtB1oKoNksEkmYJhq5mrQUALJdLbNabxWQ6PaVEqAI8f/sUXLm2ERHm889YrVaL8ePk9F0RoQoIywDgxiMvGGNARPg0m+Hrl+fFbDw+xaYqlfnRVRGTw+hn5HA4dCEPD4s8AQ7G0udaUfeaD8k3hrDZbkUAjPJjiepYxfhhATIF3Im88NNfOCV1m89FsMwoyzK6VIBSA6zBA0L9FRJBKAoSu6BowALWLjd70fcxrq8JiBehhDZg5y/AYFl4oeg7ycnNgCsyB5ZaWMKvoFj09VeyM8DXuQW4FiTSHoSzrmawALfHuIEWIuoE3OPnZqCeoSnAwsfE0h6Co7ktswR0MtCDBsGRyN27WhEOPgnDYB2eujPiAtqDKNV0+F+cAyl0fPv14a6fKSAA7D1qV/UddgH7J6EGTYBuLsJ0DbRk9d2bivAe4CHzDayBzmi88u8noHcUIw8YmDBTQFMFQ1ciyVfG1J9ko1F4OFvALTXw+vqjORG7f7uuPndt+77WD9H/3yLtD31m5EbWJHnAAAAAAElFTkSuQmCC",
buttons:[{title:t("btnOpenManager"),iconUrl:"/icons/noty/table.png"}]},function(){});setTimeout(function(){ue()},0)}}function we(a){if(a&&a.length&&!(a.length<=3)){for(let d=0;d<a.length-1;d++)a[d]._suppress_noty=!0;var b=a[0],c=a[a.length-1],e=F.get("def_naming");c.Ga=()=>[Rc(b,e),"...",Rc(c,e)].join(", ")}}
async function xe(a){if(a&&!a._suppress_noty){var b=!1;F.get("sound_finish")&&(pe("../snds/finish.ogg"),b=!0);if(F.get("notify_finish"))if(a.cr_id>=0){var c=RegExp("^(jpe?g|gif|png|bmp|ico|webp|svg)$","i"),[e,d]=oe(ne(a),t("msgTaskFinish"));b={type:"basic",message:d,iconUrl:a.iconURL32||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACEElEQVRYhe2XsZLaMBCGfyfmmAMSGJ7k6stkGOBxrsprpKG5VEdDYV6DV7hH4A2SSUOj1aawZdaWtLIIXaKZHayV0ffvaiUB8K+3IuSsqooBgJmFAQwGAj7Xr4cZ5aj89ftyWX97eXm/SVVVVUxEnhlppm+GrbV8PB75fD7z237/c7fbPaVYH0JOZgYAWGtB1oKoNksEkmYJhq5mrQUALJdLbNabxWQ6PaVEqAI8f/sUXLm2ERHm889YrVaL8ePk9F0RoQoIywDgxiMvGGNARPg0m+Hrl+fFbDw+xaYqlfnRVRGTw+hn5HA4dCEPD4s8AQ7G0udaUfeaD8k3hrDZbkUAjPJjiepYxfhhATIF3Im88NNfOCV1m89FsMwoyzK6VIBSA6zBA0L9FRJBKAoSu6BowALWLjd70fcxrq8JiBehhDZg5y/AYFl4oeg7ycnNgCsyB5ZaWMKvoFj09VeyM8DXuQW4FiTSHoSzrmawALfHuIEWIuoE3OPnZqCeoSnAwsfE0h6Co7ktswR0MtCDBsGRyN27WhEOPgnDYB2eujPiAtqDKNV0+F+cAyl0fPv14a6fKSAA7D1qV/UddgH7J6EGTYBuLsJ0DbRk9d2bivAe4CHzDayBzmi88u8noHcUIw8YmDBTQFMFQ1ciyVfG1J9ko1F4OFvALTXw+vqjORG7f7uuPndt+77WD9H/3yLtD31m5EbWJHnAAAAAAElFTkSuQmCC",
title:e,silent:b,buttons:[{title:t("optOptionOpenFile"),iconUrl:"/icons/noty/file.png"},{title:t("optOptionOpenFolder"),iconUrl:"/icons/noty/folder_open.png"}]};if(!ma()){var g="";if(await chrome.extension.isAllowedFileSchemeAccess()&&a.full_path){var m=ya(Ea(a.full_path)||a.file_ext||wa(a.url).file);m.O&&c.test(m.O)&&(g="file:///"+a.full_path)}g&&(F.get("notify_large_preview")?(b.type="image",b.imageUrl=g):(b.iconUrl=g,a.cb=!0))}c=F.get("click_notify")===Wa;me(qe(c,a),b,function(){ye(a)});setTimeout(function(){ue()},
0)}else console.error("missing cid",a.id);else ye(a)}}
function ze(a){if(a&&!a._suppress_noty){var b=!1;F.get("sound_error")&&(pe("../snds/error.ogg"),b=!0);if(F.get("notify_error")){var [c,e]=oe(ne(a),t("msgTaskInterrupt"));b={type:"basic",message:e,iconUrl:a.iconURL32||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACEElEQVRYhe2XsZLaMBCGfyfmmAMSGJ7k6stkGOBxrsprpKG5VEdDYV6DV7hH4A2SSUOj1aawZdaWtLIIXaKZHayV0ffvaiUB8K+3IuSsqooBgJmFAQwGAj7Xr4cZ5aj89ftyWX97eXm/SVVVVUxEnhlppm+GrbV8PB75fD7z237/c7fbPaVYH0JOZgYAWGtB1oKoNksEkmYJhq5mrQUALJdLbNabxWQ6PaVEqAI8f/sUXLm2ERHm889YrVaL8ePk9F0RoQoIywDgxiMvGGNARPg0m+Hrl+fFbDw+xaYqlfnRVRGTw+hn5HA4dCEPD4s8AQ7G0udaUfeaD8k3hrDZbkUAjPJjiepYxfhhATIF3Im88NNfOCV1m89FsMwoyzK6VIBSA6zBA0L9FRJBKAoSu6BowALWLjd70fcxrq8JiBehhDZg5y/AYFl4oeg7ycnNgCsyB5ZaWMKvoFj09VeyM8DXuQW4FiTSHoSzrmawALfHuIEWIuoE3OPnZqCeoSnAwsfE0h6Co7ktswR0MtCDBsGRyN27WhEOPgnDYB2eujPiAtqDKNV0+F+cAyl0fPv14a6fKSAA7D1qV/UddgH7J6EGTYBuLsJ0DbRk9d2bivAe4CHzDayBzmi88u8noHcUIw8YmDBTQFMFQ1ciyVfG1J9ko1F4OFvALTXw+vqjORG7f7uuPndt+77WD9H/3yLtD31m5EbWJHnAAAAAAElFTkSuQmCC",title:c,
silent:b,buttons:[{title:t("btnOpenManager"),iconUrl:"/icons/noty/table.png"}]};a.error_str&&(b.contextMessage=hb(a.error_str));me("terr_"+a.id,b,function(){ye(a)});setTimeout(function(){ue()},0)}else ye(a)}}function Ae(a,b){chrome.notifications.update("task_"+a.id,{title:b},function(){});a.cr_id>=0&&(chrome.notifications.update(qe(!0,a),{title:b},function(){}),chrome.notifications.update(qe(!1,a),{title:b},function(){}));chrome.notifications.update("terr_"+a.id,{title:b},function(){})}
function Be(a,b){chrome.notifications.update("task_"+a.id,{iconUrl:b},function(){});!a.cb&&a.cr_id>=0&&(chrome.notifications.update(qe(!0,a),{iconUrl:b},function(){}),chrome.notifications.update(qe(!1,a),{iconUrl:b},function(){}));chrome.notifications.update("terr_"+a.id,{iconUrl:b},function(){})}
function Ce(a){(F.get("notify_oneclick")||F.get("notify_progress"))&&chrome.notifications.clear("task_"+a.id,function(){});F.get("notify_finish")&&a.cr_id>=0&&(chrome.notifications.clear(qe(!0,a),function(){}),chrome.notifications.clear(qe(!1,a),function(){}));F.get("notify_error")&&chrome.notifications.clear("terr_"+a.id,function(){})}function ye(a){chrome.notifications.clear("task_"+a.id,function(){})}
function De(a){a==="tfin_"&&(a="tfi");chrome.notifications.getAll(function(b){for(var c in b)c.startsWith(a)&&chrome.notifications.clear(c,function(){})})}function se(){chrome.notifications.getAll(function(a){for(var b in a)chrome.notifications.clear(b,function(){})})}
const T=function(){function a(f){if(!f.filename)return null;var l=e(f.url,f.referrer);if(!l)return-1;f.finalUrl&&f.finalUrl!==l.url&&(l.eurl=f.finalUrl);let h=f.filename;l.full_path=h;l.naming="*name*.*ext*";l.file_ext=Ea(h);l.folder=Fa(h);l.finished_bytes=f.bytesReceived;l.size=f.fileSize||f.totalBytes;l.exists=f.exists;l.mime_type=f.mime;l.time_add=new Date(f.startTime);f.endTime&&(l.time_finish=new Date(f.endTime),l.time_elapsed=(+l.time_finish-+l.time_add)/1E3);f.error&&(l.error_str=f.error);
l.state=La;f.state=="in_progress"?f.paused||(l.state=z):f.state=="complete"?l.state=Ma:f.state=="interrupted"&&(l.state=Na);l.state==Ma?(l.size=l.finished_bytes,l.progress=100):l.progress=l.size>0?l.finished_bytes/l.size*100:0;f.danger!="safe"&&f.danger!="accepted"&&(l.X=!0);return l}function b(f,l,h=!0){O.B(f);if(h!=0){h=f;if(f.url.length>2097152){const {url:k,eurl:p,...q}=f;h=q}P({cmd:"u_fields",id:f.id,fields:l,data:h})}}function c(f,l,h,k){f[l]=h;b(f,[l],k)}function e(f,l){var h=new Lc;h.id=crypto.randomUUID();
h.batch_num=Zd.Zb(h);h.referer=l||"";h.eurl=h.url=f;return h}function d(f,l,h){if(f&&f.length){for(const w of f){w.naming_auto=!w.naming;if(!h&&w.folder){const C=Ba(w.folder);pa(C)&&ge.Ra(C,w.time_add)}O.B(w)}var k=f.map(w=>w.id),{promise:p,resolve:q}=jb();for(const w of k)Ud[w]=p;var r=()=>{for(const w of k)delete Ud[w];q()};f=l?K.Z("ft",k,!0):K.Z("bt",k,!1);Promise.all([O.va(),f.then(()=>K.va())]).then(()=>{P({cmd:"u_new",ids:!l&&k.length<=5?k:void 0,addtop:l,scroll_id:k[l?0:k.length-1]});r()})}}
function g(f,l,h){let k=!1;Vd=!0;const p=[];for(const q of f)k||q.state!==z&&q.state!==Ka||(k=!0),q.state===Ka&&(q.state=La,p.push(q.id)),ce().erase(q,l);Vd=!1;p.length>0&&Q.Ka(p);O.yc(f);if(f.length>50)se();else for(const q of f)Ce(q);h&&P({cmd:"u_clear",src:h,count:f.length>1?f.length:0});k&&de(-1)}async function m(f,l,h,k){console.log("Begin clearing tasks");f=await O.wc(f,k);g(f,l);P({cmd:"u_clear",count:f.length,src:h});console.log(f.length+" task(s) cleared");return f.length}return{jc:function(f){chrome.downloads.search({},
function(l){if(l&&l.length){Vd=!0;var h=[];for(const k of l)if(k.url!==be.Ya&&(l=a(k))){if(l==-1){S.o().then(function(){P({cmd:"u_alert",data:gb.noID})});break}ce().yb(l,k.id,k.filename,!0);h.push(l)}d(h,!1,!1);Vd=!1}f&&f()})},Ac:async function(){const f=await O.vc(z);if(f.length>0){Vd=!0;for(const l of f)c(l,"state",Ka);Q.enqueue(f.map(l=>l.id));Vd=!1;P({cmd:"u_tasks_by_field",data:f.map(l=>[l.id,Ka]),field:"state"});console.log(`re-queued ${f.length} tasks`)}},aa:b,T:c,gb:function(f,l){const h=
F.get("def_addtop");d([f],h,!l);S.pb(function(k){chrome.tabs.sendMessage(k.id,{cmd:"d_anim",addpause:l})});Td();F.get("notify_oneclick")&&ve(f,l);f.N?Ob(129,f.N):f.M?Ob(129,72,[Date.now()-f.M>1200?66:130,f.url.startsWith("http://")?131:132]):Ob(129,40);ld(f.url)},ib:e,uc:d,Dc:async function(f,l){if(f){f=await O.F(f);var h=-1234;F.get("start_interrupted")&&(h=Na);var k=[];for(const p of f)if(p.state===La||p.state===h)c(p,"state",Ka,!1),k.push(p.id);k.length&&(Q.enqueue(k,l),Q.pa(),P({cmd:"u_tasks_by_field",
data:k.map(p=>[p,Ka]),field:"state"}))}else console.error("not implemented")},Ec:async function(f){if(f){f=await O.F(f);var l=[],h=!1,k=[];for(const p of f)p.state==Ka?(c(p,"state",La,!1),k.push(p.id),l.push([p.id,La]),h=!0):p.state==z&&(ce().pause(p),h=!0);k.length>0&&Q.Ka(k);l.length&&P({cmd:"u_tasks_by_field",data:l,field:"state"});h&&Q.K()}else console.error("not implemented")},Rb:async function(f){f=await O.F(f);const l=[],h=[];Vd=!0;for(const k of f)ce().erase(k,!0,!0),k.state==Ka&&h.push(k.id),
l.push(k.id),Nc(k,La),O.B(k);Vd=!1;h.length>0&&Q.Ka(h);P({cmd:"u_tasks",ids:l});Q.K()},Bc:async function(f,l){f=await O.F(f);const h=[];Vd=!0;let k=Date.now()+f.length;for(const p of f)ce().erase(p,!0),Nc(p,void 0,--k),p.state==z?ce().download(p):(p.state=Ka,h.push(p.id)),Ce(p),O.B(p);Vd=!1;h.length>0&&(Q.enqueue(h,l),Q.K());P({cmd:"u_tasks",ids:f.map(p=>p.id)})},zc:async function(f,l,h){f=await O.F(f);g(f,l,h);Q.K()},vb:g,Tb:m,wb:async function(f,l,h){chrome.alarms.clear("auto-clear-1min-cd");chrome.alarms.clear("auto-clear-tasks");
if(!(l<0)){var k=l,p=Date.now();h?L.set("act",p):(h=await L.get("act",-1),h===-1&&(h=p,L.set("act",h)),k=Math.max(1,Math.ceil(l-Math.max(0,p-h)/6E4)));chrome.alarms.create("auto-clear-tasks",{delayInMinutes:k,periodInMinutes:l});console.log("setup auto_clear: "+f+", "+l+" mins, now: "+(new Date).toLocaleString());console.log(`auto_clear will start in ${k} mins @${new Date(Date.now()+6E4*k)}`)}},dc:async function(f){if(f){var l=F.get("autoclear_type"),h=F.get("autoclear_timer");if(f.name==="auto-clear-tasks"){if(l&&
h>0){const k={type:"basic",title:t("tipBtnClear"),priority:1,message:t("statusScheduledAutoClear",["60"]),contextMessage:"@"+(new Date(Date.now()+6E4)).toLocaleString(),iconUrl:"/icons/logo/128.png"};chrome.notifications.clear("int_auto_clear",()=>{chrome.notifications.create("int_auto_clear",k,function(){})});chrome.alarms.create("auto-clear-1min-cd",{delayInMinutes:1})}}else if(f.name==="auto-clear-1min-cd"&&l&&h>0&&(f=await m(l,!1,"bg",Date.now()-h*6E4),L.set("act",Date.now()),f>0)){const k={type:"basic",
title:t("tipBtnClear"),priority:1,message:t("statusTasksCleared",[String(f)]),iconUrl:"/icons/logo/128.png"};chrome.notifications.clear("int_auto_clear",()=>{chrome.notifications.create("int_auto_clear",k,function(){})})}}},reset:async function(){Vd=!0;const [f,l]=await L.get(["ver1","ver1_t"]);await Promise.all([void 0,chrome.storage.local.clear(),chrome.storage.sync.clear(),O.clear()]);const h={rld:1};if(f||l)f&&(h.ver1=f),l&&(h.ver1_t=l);await L.da(h);chrome.runtime.reload()}}}();
var Ee={},Fe={},U={};
(function(a){function b(){return b=Object.assign?Object.assign.bind():function(d){for(var g=1;g<arguments.length;g++){var m=arguments[g],f;for(f in m)Object.prototype.hasOwnProperty.call(m,f)&&(d[f]=m[f])}return d},b.apply(this,arguments)}Object.defineProperty(a,"__esModule",{value:!0});var c,e={0:11,1:0,2:3,3:0,4:0,5:0,6:0,7:11,8:11,9:1,10:10,11:0,12:11,13:0,14:-1};a.h=void 0;(c=a.h||(a.h={}))[c.H=0]="FUNCTION_WITH_ONE_ARG";c[c.ga=1]="NUMBER";c[c.s=2]="BINARY_OPERATOR_HIGH_PRECENDENCE";c[c.fa=3]=
"CONSTANT";c[c.U=4]="OPENING_PARENTHESIS";c[c.qa=5]="CLOSING_PARENTHESIS";c[c.Eb=6]="DECIMAL";c[c.Xa=7]="POSTFIX_FUNCTION_WITH_ONE_ARG";c[c.G=8]="FUNCTION_WITH_N_ARGS";c[c.za=9]="BINARY_OPERATOR_LOW_PRECENDENCE";c[c.Sa=10]="BINARY_OPERATOR_PERMUTATION";c[c.Ta=11]="COMMA";c[c.Aa=12]="EVALUATED_FUNCTION";c[c.Ba=13]="EVALUATED_FUNCTION_PARAMETER";c[c.Hc=14]="SPACE";a.Vb=function(d){return[{g:"sin",show:"sin",type:0,value:d.i.sin},{g:"cos",show:"cos",type:0,value:d.i.cos},{g:"tan",show:"tan",type:0,value:d.i.tan},
{g:"pi",show:"&pi;",type:3,value:"PI"},{g:"(",show:"(",type:4,value:"("},{g:")",show:")",type:5,value:")"},{g:"P",show:"P",type:10,value:d.i.Fb},{g:"C",show:"C",type:10,value:d.i.Db},{g:" ",show:" ",type:14,value:" ".anchor},{g:"asin",show:"asin",type:0,value:d.i.asin},{g:"acos",show:"acos",type:0,value:d.i.acos},{g:"atan",show:"atan",type:0,value:d.i.atan},{g:"7",show:"7",type:1,value:"7"},{g:"8",show:"8",type:1,value:"8"},{g:"9",show:"9",type:1,value:"9"},{g:"int",show:"Int",type:0,value:Math.floor},
{g:"cosh",show:"cosh",type:0,value:d.i.cosh},{g:"acosh",show:"acosh",type:0,value:d.i.acosh},{g:"ln",show:" ln",type:0,value:Math.log},{g:"^",show:"^",type:10,value:Math.pow},{g:"root",show:"root",type:0,value:Math.sqrt},{g:"4",show:"4",type:1,value:"4"},{g:"5",show:"5",type:1,value:"5"},{g:"6",show:"6",type:1,value:"6"},{g:"/",show:"&divide;",type:2,value:d.i.Xb},{g:"!",show:"!",type:7,value:d.i.mb},{g:"tanh",show:"tanh",type:0,value:d.i.tanh},{g:"atanh",show:"atanh",type:0,value:d.i.atanh},{g:"Mod",
show:" Mod ",type:2,value:d.i.lc},{g:"1",show:"1",type:1,value:"1"},{g:"2",show:"2",type:1,value:"2"},{g:"3",show:"3",type:1,value:"3"},{g:"*",show:"&times;",type:2,value:d.i.tb},{g:"sinh",show:"sinh",type:0,value:d.i.sinh},{g:"asinh",show:"asinh",type:0,value:d.i.asinh},{g:"e",show:"e",type:3,value:"E"},{g:"log",show:" log",type:0,value:d.i.log},{g:"0",show:"0",type:1,value:"0"},{g:".",show:".",type:6,value:"."},{g:"+",show:"+",type:9,value:d.i.add},{g:"-",show:"-",type:9,value:d.i.sub},{g:",",show:",",
type:11,value:","},{g:"Sigma",show:"&Sigma;",type:12,value:d.i.Cc},{g:"n",show:"n",type:13,value:"n"},{g:"Pi",show:"&Pi;",type:12,value:d.i.Hb},{g:"pow",show:"pow",type:8,value:Math.pow,P:2},{g:"&",show:"&",type:9,value:d.i.and}].map(function(g){return b({},g,{l:e[g.type]})})};a.ub=e})(U);Object.defineProperty(Fe,"__esModule",{value:!0});function V(a,b){for(var c=0;c<a.length;c++)a[c]+=b;return a}
var Ge={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,9:!0,12:!0,13:!0,14:!0},He={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,12:!0,13:!0},Ie={0:!0,3:!0,4:!0,8:!0,12:!0,13:!0},Je={},Ke={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,12:!0,13:!0},Le={1:!0},W=[[],"123789456+-*/()^!PCe0.,n &".split(""),["pi","ln","Pi"],"sin cos tan Del int Mod log pow".split(" "),"asin acos atan cosh root tanh sinh".split(" "),["acosh","atanh","asinh","Sigma"]];
function Me(a,b){for(var c=0;c<b.length;c++)if(b[c].g===a)return c;return-1}Fe.Ia=function(a){for(var b=0;b<a.length;b++){var c=a[b].g.length,e=-1;a[b].type===U.h.G&&void 0===a[b].P&&(a[b].P=2);W[c]=W[c]||[];for(var d=0;d<W[c].length;d++)if(a[b].g===W[c][d]){e=Me(W[c][d],this.R);break}-1===e?(this.R.push(a[b]),a[b].l=a[b].l??U.ub[a[b].type],W.length<=a[b].g.length&&(W[a[b].g.length]=[]),W[a[b].g.length].push(a[b].g)):(this.R[e]=a[b],a[b].l=a[b].l??U.ub[a[b].type])}};
Fe.Na=function(a,b){var c={value:this.i.Sb,type:U.h.H,l:4,show:"-"},e={value:")",show:")",type:U.h.qa,l:0},d={value:"(",type:U.h.U,l:0,show:"("},g=[d],m=[],f=Ge,l=0,h=Je,k="";void 0!==b&&this.Ia(b);var p,q;b=[];for(var r=a.length,w=0;w<r;w++)if(!(w<r-1&&" "===a[w]&&" "===a[w+1])){var C="";for(p=a.length-w>W.length-2?W.length-1:a.length-w;p>0;p--)if(void 0!==W[p])for(q=0;q<W[p].length;q++){var A;a:{for(A=0;A<p;A++)if(a[w+A]!==W[p][q][A]){A=!1;break a}A=!0}A&&(C=W[p][q],q=W[p].length,p=0)}if(w+=C.length-
1,""===C)throw Error("Can't understand after "+a.slice(w));b.push(this.R[Me(C,this.R)])}for(a=0;a<b.length;a++)if(C=b[a],14!==C.type){var H;p=C.g;q=C.type;r=C.value;var da=C.l;w=C.show;A=g[g.length-1];for(H=m.length;H--&&0===m[H];)if(-1!==[U.h.H,U.h.s,U.h.fa,U.h.U,U.h.qa,U.h.za,U.h.Sa,U.h.Ta,U.h.Aa,U.h.Ba].indexOf(q)){if(!0!==f[q])throw Error(p+" is not allowed after "+k);g.push(e);f=He;h=Ke;m.pop()}if(!0!==f[q])throw Error(p+" is not allowed after "+k);!0===h[q]&&(q=U.h.s,r=this.i.tb,w="&times;",
da=3,--a);k={value:r,type:q,l:da,show:w,P:C.P};if(q===U.h.H)f=Ge,h=Je,V(m,2),g.push(k),b[a+1].type!==U.h.U&&(g.push(d),m.push(2));else if(q===U.h.ga)A.type===U.h.ga?(A.value+=r,V(m,1)):g.push(k),f=He,h=Ie;else if(q===U.h.s)f=Ge,h=Je,V(m,2),g.push(k);else if(q===U.h.fa)g.push(k),f=He,h=Ke;else if(q===U.h.U)V(m,1),l++,f=Ge,h=Je,g.push(k);else if(q===U.h.qa){if(!l)throw Error("Closing parenthesis are more than opening one, wait What!!!");l--;f=He;h=Ke;g.push(k);V(m,1)}else if(q===U.h.Eb){if(A.fc)throw Error("Two decimals are not allowed in one number");
A.type!==U.h.ga&&(A={show:"0",value:0,type:U.h.ga,l:0},g.push(A));f=Le;V(m,1);h=Je;A.value+=r;A.fc=!0}else q===U.h.Xa&&(f=He,h=Ke,V(m,1),g.push(k));q===U.h.G?(f=Ge,h=Je,V(m,C.P+2),g.push(k),b[a+1].type!==U.h.U&&(g.push(d),m.push(C.P+2))):q===U.h.za?(A.type===U.h.za?A.value===this.i.add?(A.value=r,A.show=w,V(m,1)):A.value===this.i.sub&&"-"===w&&(A.value=this.i.add,A.show="+",V(m,1)):A.type!==U.h.qa&&A.type!==U.h.Xa&&A.type!==U.h.ga&&A.type!==U.h.fa&&A.type!==U.h.Ba?"-"===p&&(f=Ge,h=Je,V(m,1).push(2),
g.push(c),g.push(d)):(g.push(k),V(m,2)),f=Ge,h=Je):q===U.h.Sa?(f=Ge,h=Je,V(m,2),g.push(k)):q===U.h.Ta?(f=Ge,h=Je,g.push(k)):q===U.h.Aa?(f=Ge,h=Je,V(m,6),g.push(k),b[a+1].type!==U.h.U&&(g.push(d),m.push(6))):q===U.h.Ba&&(f=He,h=Ke,g.push(k));V(m,-1);k=p}else if(a>0&&a<b.length-1&&1===b[a+1].type&&(1===b[a-1].type||6===b[a-1].type))throw Error("Unexpected Space");for(H=m.length;H--;)g.push(e);if(!0!==f[5])throw Error("complete the expression");for(;l--;)g.push(e);return g.push(e),g};var Ne={};
(function(a){Object.defineProperty(a,"__esModule",{value:!0});a.Pa=function(b){for(var c,e,d,g=[],m,f=[{value:"(",type:4,l:0,show:"("}],l=1;l<b.length;l++)if(1===b[l].type||3===b[l].type||13===b[l].type)1===b[l].type&&(b[l].value=Number(b[l].value)),g.push(b[l]);else if(4===b[l].type)f.push(b[l]);else if(5===b[l].type)for(;4!==(null==(h=e=f.pop())?void 0:h.type);){var h;e&&g.push(e)}else if(11===b[l].type){for(;4!==(null==(k=e=f.pop())?void 0:k.type);){var k;e&&g.push(e)}f.push(e)}else{m=(c=b[l]).l;
e=(d=f[f.length-1]).l;d="Math.pow"==d.value&&"Math.pow"==c.value;if(!(m>e))for(;e>=m&&!d||d&&m<e;)e=f.pop(),d=f[f.length-1],e&&g.push(e),e=d.l,d="Math.pow"==c.value&&"Math.pow"==d.value;f.push(c)}return g}})(Ne);var Oe={};
(function(a){Object.defineProperty(a,"__esModule",{value:!0});a.oa=function(b,c){(c=c||{}).PI=Math.PI;c.E=Math.E;for(var e,d,g=[],m=void 0!==c.n,f=0;f<b.length;f++)if(1===b[f].type)g.push({value:b[f].value,type:1});else if(3===b[f].type)g.push({value:c[b[f].value],type:1});else if(0===b[f].type)d=g[g.length-1],Array.isArray(d)?d.push(b[f]):d.value=b[f].value(d.value);else if(7===b[f].type)d=g[g.length-1],Array.isArray(d)?d.push(b[f]):d.value=b[f].value(d.value);else if(8===b[f].type){d=[];for(e=0;e<
b[f].P;e++){var l=g.pop();l&&d.push(l.value)}g.push({type:1,value:b[f].value.apply(b[f],d.reverse())})}else 10===b[f].type?(e=g.pop(),d=g.pop(),Array.isArray(d)?((d=d.concat(e)).push(b[f]),g.push(d)):Array.isArray(e)?(e.unshift(d),e.push(b[f]),g.push(e)):g.push({type:1,value:b[f].value(d.value,e.value)})):2===b[f].type||9===b[f].type?(e=g.pop(),d=g.pop(),Array.isArray(d)?((d=d.concat(e)).push(b[f]),g.push(d)):Array.isArray(e)?(e.unshift(d),e.push(b[f]),g.push(e)):g.push({type:1,value:b[f].value(d.value,
e.value)})):12===b[f].type?(e=g.pop(),l=!Array.isArray(e)&&e?[e]:e||[],d=g.pop(),e=g.pop(),g.push({type:1,value:b[f].value(e.value,d.value,l)})):13===b[f].type&&(m?g.push({value:c[b[f].value],type:3}):g.push([b[f]]));if(g.length>1)throw Error("Uncaught Syntax error");return g[0].value}})(Oe);var Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});
Pe.Ub=function(a){return{ba:!0,acos:function(b){return a.i.ba?180/Math.PI*Math.acos(b):Math.acos(b)},add:function(b,c){return b+c},asin:function(b){return a.i.ba?180/Math.PI*Math.asin(b):Math.asin(b)},atan:function(b){return a.i.ba?180/Math.PI*Math.atan(b):Math.atan(b)},acosh:function(b){return Math.log(b+Math.sqrt(b*b-1))},asinh:function(b){return Math.log(b+Math.sqrt(b*b+1))},atanh:function(b){return Math.log((1+b)/(1-b))},Db:function(b,c){var e=1,d=b-c,g=c;g<d&&(g=d,d=c);for(c=g+1;c<=b;c++)e*=
c;b=a.i.mb(d);return"NaN"===b?"NaN":e/b},Sb:function(b){return-b},cos:function(b){return a.i.ba&&(b=a.i.Qa(b)),Math.cos(b)},cosh:function(b){return(Math.pow(Math.E,b)+Math.pow(Math.E,-1*b))/2},Xb:function(b,c){return b/c},mb:function(b){if(b%1!=0)return"NaN";for(var c=1,e=2;e<=b;e++)c*=e;return c},inverse:function(b){return 1/b},log:function(b){return Math.log(b)/Math.log(10)},lc:function(b,c){return b%c},tb:function(b,c){return b*c},Fb:function(b,c){var e=1;for(c=Math.floor(b)-Math.floor(c)+1;c<=
Math.floor(b);c++)e*=c;return e},Hb:function(b,c,e){for(var d=1;b<=c;b++)d*=Number(a.oa(e,{n:b}));return d},Zc:function(b){for(var c=1;b--;)c*=10;return c},Cc:function(b,c,e){for(var d=0;b<=c;b++)d+=Number(a.oa(e,{n:b}));return d},sin:function(b){return a.i.ba&&(b=a.i.Qa(b)),Math.sin(b)},sinh:function(b){return(Math.pow(Math.E,b)-Math.pow(Math.E,-1*b))/2},sub:function(b,c){return b-c},tan:function(b){return a.i.ba&&(b=a.i.Qa(b)),Math.tan(b)},tanh:function(b){return a.i.sinh(b)/a.i.cosh(b)},Qa:function(b){return b*
Math.PI/180},and:function(b,c){return b&c}}};var Qe=function(){function a(){this.Pa=Ne.Pa;this.Ia=Fe.Ia;this.Na=Fe.Na;this.oa=Oe.oa;this.i=Pe.Ub(this);this.R=U.Vb(this)}return a.prototype.eval=function(b,c,e){return this.oa(this.Pa(this.Na(b,c)),e)},a}();Qe.Ic=U.h;Qe.h=U.h;Ee=Qe;var Re,Se=Ee;Re=Se&&Se.Kc&&Object.prototype.hasOwnProperty.call(Se,"default")?Se["default"]:Se;const Te={0:11,1:0,2:3,3:0,4:0,5:0,6:0,7:11,8:11,9:1,10:10,11:0,12:11,13:0,14:-1};
var Ue={is:function(a,b){return(new RegExp("^("+b+")$")).test(a)},has:function(a,b){return(new RegExp(b)).test(a)},beginwith:function(a,b){return(new RegExp("^("+b+")")).test(a)},endwith:function(a,b){return(new RegExp("("+b+")$")).test(a)}},Ve={is:function(a,b){var c=X[b],e=X[b+"_"];if(c!=null&&e!=null)return typeof c=="function"&&(c=c()),typeof e=="function"&&(e=e()),a.getTime()>=c&&a.getTime()<=e;if(e=b.match(/(\d+)_([a-z]+)_ago/)){var d=parseInt(e[1]);if(isNaN(d)||d<=0)throw"bad number in: "+
b;c=X[e[2]+"_ago"];e=X[e[2]+"_ago_"];if(c&&e)return c=c(d),e=e(d),a.getTime()>=c&&a.getTime()<=e}throw"fail to parse: "+b;},btwn:function(a,b,c){c=c[0].value;typeof b=="string"&&(b=Date.parse(b));typeof c=="string"&&(c=Date.parse(c));return a.getTime()>b&&a.getTime()<c},_btwn:function(a,b,c){typeof b=="string"&&(b=Date.parse(b));typeof c=="string"&&(c=Date.parse(c));return a.getTime()>=b&&a.getTime()<c},btwn_:function(a,b,c){typeof b=="string"&&(b=Date.parse(b));typeof c=="string"&&(c=Date.parse(c));
return a.getTime()>b&&a.getTime()<=c},_btwn_:function(a,b,c){typeof b=="string"&&(b=Date.parse(b));typeof c=="string"&&(c=Date.parse(c));return a.getTime()>=b&&a.getTime()<=c},b4:function(a,b){typeof b=="string"&&(b=Date.parse(b));return a.getTime()<b},b4_:function(a,b){typeof b=="string"&&(b=Date.parse(b));return a.getTime()<=b},aft:function(a,b){typeof b=="string"&&(b=Date.parse(b));return a.getTime()>b},aft_:function(a,b){typeof b=="string"&&(b=Date.parse(b));return a.getTime()>=b}},We=0,Xe=0,
Ye=0,Ze=0,af=0,bf=0,X={mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,sun:0,download:z,inqueue:Ka,paused:La,finished:Ma,interrupted:Na,now:function(){return Ze},today:function(){return af},today_:function(){return bf},yesterday:function(){return af-864E5},yesterday_:function(){return af-1},this_week:function(){return af-864E5*We},this_week_:function(){return X.this_week()+6048E5-1},last_week:function(){return X.this_week()-6048E5},last_week_:function(){return X.this_week()-1},this_month:function(){var a=new Date(af);
a.setDate(1);return a.getTime()},this_month_:function(){var a=new Date(af);a.setMonth(Xe+1);a.setDate(1);return a.getTime()-1},last_month:function(){var a=new Date(af);a.setMonth(Xe-1);a.setDate(1);return a.getTime()},last_month_:function(){return X.this_month()-1},this_year:function(){var a=new Date(af);a.setMonth(0);a.setDate(1);return a.getTime()},this_year_:function(){var a=new Date(af);a.setFullYear(Ye+1);a.setMonth(0);a.setDate(1);return a.getTime()-1},last_year:function(){var a=new Date(af);
a.setFullYear(Ye-1);a.setMonth(0);a.setDate(1);return a.getTime()},last_year_:function(){return X.this_year()-1},days_ago:function(a){return af-a*864E5},days_ago_:function(a){return af-(a-1)*864E5-1},weeks_ago:function(a){return X.this_week()-a*6048E5},weeks_ago_:function(a){return X.this_week()-(a-1)*6048E5-1},months_ago:function(a){var b=new Date(X.this_month());b.setMonth(Xe-a);return b.getTime()},months_ago_:function(a){return X.months_ago(a-1)-1},years_ago:function(a){var b=new Date(X.this_year());
b.setFullYear(Ye-a);return b.getTime()},years_ago_:function(a){return X.years_ago(a-1)-1}};function cf(){let a=new Date;Ze=a.getTime();We=a.getDay();Xe=a.getMonth();Ye=a.getFullYear();a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);af=a.getTime();bf=af+864E5-1}cf();
const Y=Re.h,ef=[{type:Y.fa,g:"true",value:"true"},{type:Y.fa,g:"false",value:"false"},{type:Y.H,g:"Str",value:a=>df[a]},{type:Y.H,g:"mD",value:a=>new Date(a)},{type:Y.s,g:"<",value:(a,b)=>a<b,l:.8},{type:Y.s,g:"<=",value:(a,b)=>a<=b,l:.8},{type:Y.s,g:">",value:(a,b)=>a>b,l:.8},{type:Y.s,g:">=",value:(a,b)=>a>=b,l:.8},{type:Y.s,g:"=",value:(a,b)=>a===b,l:.7},{type:Y.s,g:"==",value:(a,b)=>a===b,l:.7},{type:Y.s,g:"!=",value:(a,b)=>a!==b,l:.7},{type:Y.s,g:"<>",value:(a,b)=>a!==b,l:.7},{type:Y.s,g:"&&",
value:(a,b)=>a&&b,l:.6},{type:Y.s,g:"||",value:(a,b)=>a||b,l:.5},{type:Y.H,g:"!",value:a=>!a},{type:Y.G,g:"Fd_is",value:function(a,b){return typeof a==="string"?Ue.is(a,b):Ve.is(a,b)}},{type:Y.G,g:"Fd_has",value:Ue.has},{type:Y.G,g:"Fd_beginwith",value:Ue.beginwith},{type:Y.G,g:"Fd_endwith",value:Ue.endwith},{type:Y.G,g:"Fd_aft",value:Ve.aft},{type:Y.G,g:"Fd_b4",value:Ve.b4},{type:Y.Aa,g:"Fd_btwn",value:Ve.btwn}].map(a=>({show:"",l:Te[a.type],...a}));
function Z(a,b){ef.push({type:Y.H,g:a,value:b,l:Te[Y.H],show:""})}
Z("Fd",function(a){if(ff===!0){var b=gf.cd;if(b){var c=wa(b),e;c.file&&c.file!=""&&(e=ya(c.file));var d=null;switch(a){case "host":d=c.host;break;case "query":case "anchor":d=c[a];break;case "subdirs":d=c.directory;break;case "name":d=e?e.ua:"";break;case "ext":d=e?e.O:"";break;case "url":d=b}a=d||""}else a=""}else if(b=hf,c=wa(b.url),e=ya(b.file_ext||(b.eurl!=b.url?wa(b.eurl).file:"")||c.file),a=Pc(b,a,c,e),a==void 0||a==null)a="";return a});Z("yearof",function(a){return(new Date(a)).getFullYear()});
Z("monthof",function(a){return(new Date(a)).getMonth()});Z("dateof",function(a){return(new Date(a)).getDate()});Z("dayof",function(a){return(new Date(a)).getDay()});Z("hourof",function(a){return(new Date(a)).getHours()});Z("minuteof",function(a){return(new Date(a)).getMinutes()});Z("secondof",function(a){return(new Date(a)).getSeconds()});Z("kb",function(a){return a<<10});Z("mb",function(a){return a<<20});Z("gb",function(a){return a<<30});Z("sec",function(a){return a*1E3});
Z("min",function(a){return a*6E4});Z("hr",function(a){return a*36E5});Z("hour",function(a){return a*36E5});let jf;const kf=new Map,df={};function lf(a){let b=kf.get(a);if(b)return b;b=kf.size+1;kf.set(a,b);df[b]=a;return b}let gf={};var ff,hf;
function mf(a,b,c){return b.replace(/\.match/g,".bmatch").replace(/\*([^\*]+)\*(?:\.(is|has|beginwith|endwith|aft|b4|btwn)[ ]*\()?/gi,(e,d,g)=>{e=`Fd(${`Str(${lf(d.trim().toLowerCase())})`})`;return g?`Fd_${g}(${e},`:e}).replace(/"([^"]+)"|'([^']+)'/gi,(e,d,g)=>`Str(${lf((d||g).trim())})`).replace(/\{([^\}]+)\}/gi,(e,d)=>{e=d?d.trim().toLowerCase():"";if(c[e]==1)throw"circular dependency of rules detected";a:{for(d=0;d<dd.length;++d)if(dd[d].int_name==e){d=dd[d].condition;break a}d=null}if(d==null||
d==void 0)throw"referenced rule {"+e+"} not found";c[e]=!0;d="("+mf(a,d,c)+")";delete c[e];return d}).replace(/\[([^\]]+)\]/gi,(e,d)=>{e=d?d.trim().toLowerCase():"";a:if(d=X[e],d!=void 0)d=typeof d=="function"?"mD("+d()+")":d;else{var g;if(g=e.match(/(\d+)_([a-z]+_ago_?)/)){d=parseInt(g[1]);if(isNaN(d)||d<=0)throw"bad number in: "+e;if(g=X[g[2]]){d="mD("+g(d)+")";break a}throw"not supported function: "+e;}d=null}if(d!=void 0&&d!=null)return d;d=Od(Qd,e,{});if(d==void 0||d==null)throw"constant/referenced ext filter ["+
e+"] not found";return`Str(${lf(d)})`})}function nf(a,b){if(!a)throw Error();if(b.recycled)return!1;hf=b;ff=!1;jf||(jf=new Re,b=jf.R.findIndex(c=>c.g==="!"),b!==-1&&jf.R.splice(b,1));a=jf.eval(a,ef,{"true":!0,"false":!1});ff=hf=void 0;return a}const of=new class{};function pf(a){var b=I.get("ud",[{},[]]);[b]=b;return b[a]}
function qf(a,b,c,e,d){if(a&&!(a.length>2048)){var g=I.get("ud",[{},[]]),[m,f]=g;if(m[a]!==void 0)for(let l=0;l<f.length;++l)if(f[l]===a){f.splice(l,1);break}f.length>=18&&(delete m[f[0]],f.shift());f.push(a);m[a]={download:(b||"").slice(0,512),text:(c||"").slice(0,256),title:(e||"").slice(0,256),page_title:(d||"").slice(0,256)};I.set("ud",g)}}
const rf=function(){function a(f,l,h){f=T.ib(f,l);if(!f)return null;h?(f.mime_type=h.mime,f.size=h.totalBytes,f.exists=h.exists,h.finalUrl&&h.finalUrl!==f.url&&(f.eurl=h.finalUrl)):f.exists=!0;(h=pf(f.url))?(f.text=h.text,f.title=h.title,f.desc=h.download||f.text||f.title,f.page_title=h.page_title):console.log("url desc not found");return f}function b(f){chrome.downloads.cancel(f,function(){chrome.downloads.erase({id:f})})}function c(f){zb().then(()=>{I.ma("mut",f)&&(console.log("cancel in Save As: "+
f),Q.K())})}const e=new Set,d=new Set,g=M(function(f){const l=f.url;if(l!=be.Ya){var h=I.ma("msat",l);if(h)h.state=z,I.ca("mut",f.id,h),h.M=Date.now();else if(f.state==="in_progress"&&(f.byExtensionId&&console.log(f.byExtensionId),!ce().ec(f))){var k=f.referrer;if(F.get("doneclick_rule")!=1)b(f.id),S.pb(function(p){const q={cmd:"d_one",task:{}};q.task.url=l;q.task.referer=k;const r=pf(l);r?(q.task.text=r.text,q.task.title=r.title,q.task.desc=r.download||r.text||r.title):console.log("desc not found");
chrome.tabs.sendMessage(p.id,q,function(w){w||S.o().then(function(){ia(q)})})});else{h=F.get("def_addpause");const p=a(l,k,f);if(p)if(h||!ce().ic())b(f.id),Nc(p,h?La:Ka),h||(Q.enqueue([p.id]),de(!0)),T.gb(p,h);else{if(l.startsWith("http://"))if(e.has(f.id)||d.has(l))e.delete(f.id),d.delete(l);else{b(f.id);chrome.downloads.download({url:l,saveAs:!1},q=>{q===void 0?(d.delete(l),console.error(chrome.runtime.lastError)):e.add(q)});d.add(l);return}p.state=z;I.ca("mut",f.id,p);p.M=Date.now()}else b(f.id),
S.o().then(function(){ia({cmd:"u_alert",data:gb.noID})})}}}}),m=M(function(f){const l=I.Oa("mut",f.id);if(l){for(var h in f){var k=f[h].current;switch(h){case "url":case "finalUrl":l.eurl=k;break;case "mime":l.mime_type=k;break;case "exists":l.exists=k;break;case "endTime":l.time_finish=new Date(k);break;case "state":k=="interrupted"?l.state=Na:k=="complete"?l.state=Ma:k=="in_progress"&&(k=f.paused,l.state=k&&k.current?La:z);break;case "paused":f.state||(l.state=k?La:z);break;case "error":if((l.error_str=
k)&&k.toUpperCase().indexOf("USER_")==0){I.ma("mut",f.id);console.log("cancel in Save As: "+f.id);Q.K();return}break;case "totalBytes":case "fileSize":l.size=k;break;case "danger":k!="safe"&&k!="accepted"&&(l.X=!0)}}(h=f.filename)&&!h.previous?(I.ma("mut",f.id),l.full_path=h.current,k=new Lc(l),k.sa=l.sa,k.la=l.la,k.X=l.X,k.N=l.N,k.M=l.M,ce().yb(k,f.id,h.current,!1)):I.ca("mut",f.id,l)}});return{fb:function(f,l,h){l=a(f,l);if(!l)return!1;l.N=h;I.ca("msat",f,l);chrome.downloads.download({url:f,method:"GET",
saveAs:!0},function(){});return!0},bc:function(f){return I.Oa("mut",f)},A:function(){chrome.downloads.onCreated.hasListener(g)||chrome.downloads.onCreated.addListener(g);chrome.downloads.onChanged.hasListener(m)||chrome.downloads.onChanged.addListener(m);chrome.downloads.onErased.hasListener(c)||chrome.downloads.onErased.addListener(c)},stop:function(){chrome.downloads.onCreated.removeListener(g);chrome.downloads.onChanged.removeListener(m);chrome.downloads.onErased.removeListener(c)}}}(),sf=function(){function a(n){n=
n.toLowerCase();return n=="c:"||n=="c:/"?"ChronoDownloads/":""}function b(n){T.T(n,"state",z);Rd.add(n);de(-1)}function c(n,u=!0){const x=Rd.remove(n.id);x&&x.Y&&(n.time_elapsed+=Math.max(0,Date.now()/1E3-x.Y));de(-1);n.active_threads=0;u!=0?chrome.downloads.search({id:n.cr_id},function(y){y&&y.length&&(n.finished_bytes=y[0].bytesReceived);n.state==Ma?(n.size=n.finished_bytes,n.progress=100,n.time_elapsed>0&&n.size>=10485760&&Vb(9,n.size*8/(n.time_elapsed*1E3))):n.progress=n.size>0?n.finished_bytes/
n.size*100:0;T.aa(n,["progress","size","time_elapsed"])}):T.aa(n,["time_elapsed"])}function e(n,u){O.Ma(u,n.id);n.cr_id=u;O.B(n)}function d(n){Yd({cmd:"u_accept",crid:n},function(u){u!==!0&&S.o().then(function(){ia({cmd:"u_accept",crid:n})})})}async function g(n){if(n=await O.La(n))O.sb(n),Rd.remove(n.id),de(-1),console.log("onerased")}async function m(n){const u=await O.La(n.id);if(u){var x=!1;n.exists&&!n.exists.current&&(x=!0);var y=!1,B=[],D=!1;for(const R in n){var G=n[R].current,J=void 0;switch(R){case "url":case "finalUrl":u.eurl=
G;J="eurl";break;case "filename":G=C(u,G,!1);(J=n.danger?n.danger.current:"")&&!G&&J!="safe"&&J!="accepted"&&d(n.id);J="naming";break;case "mime":u.mime_type=G;D=!0;break;case "exists":u.exists=G;J="exists";break;case "endTime":u.time_finish=new Date(G);J="time_finish";break;case "state":if(!x){if(G=="interrupted")G=Na;else if(G=="complete")G=Ma;else break;A(u,G)}break;case "error":u.error_str=G;D=!0;break;case "paused":if(x||n.state)break;G==1?G=La:(G=z,u.state!=z&&b(u));A(u,G);break;case "totalBytes":Ub(10,
G);case "fileSize":u.size=G;J="size";break;case "danger":n.filename||G=="safe"||G=="accepted"||d(n.id)}y||(J=="_all_"?y=!0:J&&B.push(J))}y?(O.B(u),Oc(u),P({cmd:"u_tasks",ids:[u.id]})):B.length>0?T.aa(u,B):D&&O.B(u)}}function f(){var n=F.get("fnconflict");if(n<0||n>=5)n=0;return H[n]}async function l(n,u,x){u.file_ext=x;var y={naming:F.get("def_naming"),folder:F.get("def_folder")};u.naming||(await Promise.all([Qd.load(!0),gd.load(!0)]),y=hd(D=>{if(D&&D!=""&&D!="true"){cf();try{var G=mf(of,D,{})}catch(R){console.log("Invalid filter expression: "+
R),G=null}}else G="true";try{var J=nf(G,u)}catch(R){ia({cmd:"u_badfilter",filter:D||""}),console.log("Invalid filter expression: "+R),J=!1}return J}));u.naming||(u.naming=y.naming);var B=Qc(u,u.naming);y="";Ga(B)?y=B:(u.naming=x,console.log("naming mask not good, changing to provided:"+x),y=x);u.sa=y;!u.folder&&F.get("always_use_last_location")&&(x=await ge.cc())&&(u.folder=x);x="";u.folder&&(x=be.ob());if(x){B=Ba(u.folder);let D=B.startsWith(x)?B.substr(x.length):B;if(!D){if(D=a(x))u.folder=Ca(x,
D)}else if(D==B){if(cb==F.get("folder_inaccessible"))return u.cr_id<0&&(u.cr_id=n),T.vb([u],!0,"saveas"),console.warn("unable to save to folder",D,"choose a new location in save-as dialog"),rf.fb(u.url,u.referer,134),Ob(96,136),"";D=a(x);u.folder=Ca(x,D)}u.la=B;y=Ca(D,y)}else u.folder="",u.Nb=!0,Ob(96,135);Oc(u);return y}function h(n){function u(y){r(y,!0);Nc(y,z);O.B(y);q(y);P({cmd:"u_tasks",ids:[y.id]})}function x(y){if(y.size<=0)u(y);else{var B=t("confirmCantResumeRestart",[Rc(y,F.get("def_naming"))]);
Yd({cmd:"u_confirm",data:B},function(D){D?u(y):A(y,Na)})}}b(n);n.cr_id==void 0||n.cr_id<0?x(n):chrome.downloads.search({id:n.cr_id},function(y){y&&y.length&&(y[0].canResume||y[0].state=="in_progress"&&!y[0].paused)?chrome.downloads.resume(n.cr_id,function(){}):x(n)})}function k(n,u,x){const y=I.get("sid",[]);for(let B=0;B<y.length;++B)if(y[B][n]===u){n=y[B];if(x===void 0)return n;x===!0?y.splice(B,1):x(n);I.set("sid",y);return n}}function p(n,u){const x=I.get("sid",[]);x.push({id:n,url:kb(u)});I.set("sid",
x)}function q(n){if(n.cr_id>=0)console.log("dy_engine.newDownload: call restart/resume instead");else if(b(n),k("id",n.id,u=>{delete u.Ha}))console.log("duplicate issue!!");else return chrome.downloads.download({url:n.url,method:"GET",saveAs:!1,conflictAction:f()},function(u){u==void 0&&(k("id",n.id,!0),n.cr_id=-2,chrome.runtime.lastError&&chrome.runtime.lastError.message&&(n.error_str=chrome.runtime.lastError.message),Rd.has(n.id)&&A(n,Na),console.log("fail to start download, "+JSON.stringify(chrome.runtime.lastError)))}),
p(n.id,n.url),!0}function r(n,u,x,y){c(n,!1);k("id",n.id,D=>{D.Ha=!0});var B=n.cr_id;B==void 0||B<0||(O.sb(n),y!=0&&(u?n.state==Ma?x!=1?ae(B,function(){chrome.downloads.erase({id:B},function(){})}):chrome.downloads.erase({id:B},function(){}):chrome.downloads.cancel(B,function(){chrome.downloads.erase({id:B},function(){})}):chrome.downloads.erase({id:B},function(){})))}function w(){const n=F.get("dy_max_con_tasks");return Rd.length()<n}function C(n,u,x=!0){let y=!1;if(!n||n.cr_id==void 0||n.cr_id<
0)return y;n.full_path=u;var B=Ba(u,!1),D=Ba(n.sa||"",!1);u=!!D&&B.endsWith(D);let [G,J]=Da(D);if(G){G[0]!="/"&&G[0]!="\\"&&(G="/"+G);var R=B.lastIndexOf(G);R==-1?(console.error(`missing subdir ${G} in filename ${B}`),[D,B]=Da(B)):(D=B.slice(0,R+1),B=B.slice(R+G.length))}else[D,B]=Da(B);n.folder=Ba(D);n.la!==n.folder&&console.warn(`folder changed: ${n.la} => ${n.folder}`);n.Nb&&(D=/downloads|documents|desktop/i.test(n.folder),kd(68,"page_referrer",`${Number(D)};${n.N?E(n.N):Number(!!(n.M&&Date.now()-
n.M>1200))}`));if(!u&&J&&J!=B&&(D=F.get("fnconflict"),D==ab||D==Za)){R=ya(J).ua||"";const ba=ya(B).ua||"";ba.length>R.length&&ba.indexOf(R)==0&&(D==ab?(T.vb([n],!0,"skip_cancel"),Q.K(),console.log("file name conflicts: "+J+", removing the task"),ia({cmd:"u_skipcancel",filename:J})):D==Za&&(r(n,!0,!0),Nc(n),n.error_str="fnConflict",A(n,Na),console.log("file name conflicts: "+J+", pausing the task")),y=!0)}y||u||(n.name_conflict=B,Oc(n),x!=0&&T.aa(n,["naming"]),Ae(n,B));Wb({[ya(B||"").O||"_"]:1});y||
(chrome.downloads.getFileIcon(n.cr_id,{size:16},function(ba){T.T(n,"iconURL16",ba)}),chrome.downloads.getFileIcon(n.cr_id,{size:32},function(ba){T.T(n,"iconURL32",ba);Be(n,ba)}),pa(n.folder)&&ge.Ra(n.folder));O.B(n);return y}function A(n,u){if(n){var x=n.state;n.state=u;u!=z&&(c(n),Q.K(),u==Ma?x!=u&&(xe(n),ac==="Opera"&&F.get("hide_cr_bar")&&setTimeout(()=>{chrome.downloads.setUiOptions&&chrome.downloads.setUiOptions({enabled:!1})},100)):u==Na?x!=u&&ze(n):F.get("notify_progress")&&ye(n));T.aa(n,["state"])}}
const H=["uniquify","overwrite","prompt","uniquify","uniquify"],da=M(async function(n,u){let x=!0,y=rf.bc(n.id);y||(x=!1,y=await O.La(n.id));if(y)if(y.N)u();else{var B=await l(n.id,y,n.filename);x?I.ca("mut",n.id,y):T.aa(y,["naming","folder"]);B?u({filename:B,conflictAction:f()}):u();return!0}else console.log("not found, could be a canceled to-be-paused task?",n.id),u()});return{version:1,A:function(){chrome.downloads.onChanged.addListener(M(m));chrome.downloads.onErased.addListener(M(g));chrome.downloads.onDeterminingFilename&&
chrome.downloads.onDeterminingFilename.addListener((n,u)=>{if(!be.onDeterminingFilename(n,u))return da(n,u),!0})},ec:function(n){const u=k("url",kb(n.url),!0);if(!u)return O.Ma(n.id),!1;if(u.Ha)return O.Ma(n.id),(async()=>{await chrome.downloads.cancel(n.id);await chrome.downloads.erase({id:n.id});const [x]=await O.F([u.id]);x?A(x,La):console.warn("missing running, already erased?",u.id)})(),console.log("ignore a _topause/erased task, cr_id:"+n.id),!0;(async()=>{const [x]=await O.F([u.id]);x?(e(x,
n.id),n.referrer&&(x.referer=n.referrer),x.mime_type=n.mime,T.T(x,"exists",n.exists),T.T(x,"size",n.totalBytes),n.finalUrl&&n.finalUrl!==x.url&&T.T(x,"eurl",n.finalUrl),Ub(10,x.size)):console.error("missing running",u.id)})();return!0},yb:function(n,u,x,y){e(n,u);y||T.gb(n,!1);n.state==z&&b(n);var B=!1;y?(n.full_path=x,O.B(n)):B=x?C(n,x):!1;n.X&&(B||setTimeout(function(){d(u)},0),delete n.X);n.size>0&&Ub(10,n.size)},download:function(n){if(!n)return!1;n.cr_id==void 0||n.cr_id<0?q(n):h(n);return!0},
pause:function(n){n.cr_id==void 0||n.cr_id<0?k("id",n.id,u=>{u.Ha=!0}):chrome.downloads.pause(n.cr_id,function(){})},erase:r,Qc:function(){},ic:w,hc:async function(n){if(!w())return Ia;var u=wa(n.url).authority,x=await chrome.downloads.search({state:"in_progress",urlRegex:"^((https?|ftp)://)?"+u+".*"}),y=Rd.ac(u);u=F.get("dy_max_per_server");let B=!1;const D={};for(var G of y)D[G]=!0;G=Object.keys(D).length;if(x&&x.length){const R=await O.qb(x.map(ba=>ba.id));y={};for(var J of R)y[J.cr_id]=J;J=-10;
for(const ba of x)x=(x=y[ba.id])?x.id:J--,D[x]=!0}if(Object.keys(D).length<u||G<u&&D[n.id]===!0)B=!0;return B?Ha:Ja},tc:async function(){var n=await chrome.downloads.search({state:"in_progress",paused:!1});let u=0;const x=n.length,y=[];if(!x)return[u,x,y];var B=n.map(J=>J.id),D=await O.qb(B);B={};for(var G of D)B[G.cr_id]=G;G=Date.now()/1E3;for(const J of n){n=B[J.id];if(!n)continue;D=J.bytesReceived;const R=J.totalBytes-D,ba=.001*(new Date(J.estimatedEndTime)).getTime(),Sd=ba-G;let nc=0;R>0&&Sd>
0&&(nc=R/Sd,u+=nc);n.speed=nc;n.finished_bytes=D;n.time_remained=J.estimatedEndTime==void 0?8553600:ba-G;y.push(n)}return[u,x,y]}}}();(globalThis.__cdmg__=globalThis.__cdmg__||{}).e=sf;
function tf(a,b,c,e,d,g){function m(p,q){p.url=p.url.replace(/ /g,"%20");var r=(r=p.url)||"";if(r.startsWith("blob:"))r=!0;else{var w=r.indexOf("data:")==0,C=r.indexOf("\r");C==-1&&(C=r.indexOf("\n"));C!=-1?r=r.substr(0,w?Math.min(C,1024):C):w&&r.length>1024&&(r=r.substr(0,1024));r=w?sa.test(r):ta.test(r)}if(!r)return console.log("unsupported url",p.url),null;/^(https?|ftp|data|blob):/i.test(p.url)==0&&(p.url="http://"+p.url);r=T.ib(p.url,p.referer);if(!r)return-1;r.naming=p.naming||"";p.folder&&
(r.folder=p.folder);r.text=p.text||"";r.title=p.title||"";r.desc=p.desc||"";r.page_title=q;r.max_threads_config=5;r.naming&&he.Ra(r.naming);return r}let f=!1;d=d&&F.get("notify_oneclick");const l=[],h=[];let k=Date.now()+a.length;for(const p of a){const q=m(p,e);if(q===-1){f=!0;break}else null!=q&&(q.time_add=new Date(--k),b||(q.state=Ka,h.push(q.id)),l.push(q))}we(l);l.length>0&&T.uc(l,c,!b);h.length>0&&Q.enqueue(h);if(d)for(c=0;c<l.length;c++)ve(l[c],b);Ob(129,g||40,void 0,a.length||1);l.length>
0&&(Td(),h.length>0&&Q.pa(),ld(l[0].url));f&&S.o().then(function(){ia({cmd:"u_alert",data:gb.noID})})}
const uf=function(){function a(d,g,m){chrome.contextMenus.create({id:d,title:g,contexts:m,documentUrlPatterns:["http://*/*","https://*/*","ftp://*/*"]})}function b(d){chrome.contextMenus.remove(d)}const c=M(function(d,g,m){const f={cmd:"d_one",task:{}};f.task.referer=g;f.task.url=d;if(d=pf(d))f.task.text=d.text,f.task.title=d.title,f.task.desc=d.download||d.text||d.title;chrome.tabs.sendMessage(m.id,f,function(l){l||(console.log("menu download no response"),S.o().then(function(){ia(f)}))})}),e=M(function(d,
g,m){g={url:d,referer:g};const f=F.get("def_addpause"),l=F.get("def_addtop");chrome.tabs.sendMessage(m.id,{cmd:"d_anim",addpause:f});m="";if(d=pf(d))g.text=d.text,g.title=d.title,g.desc=d.download||g.text||g.title,m=d.page_title;tf([g],f,l,m,!0,74)});return{zb:function(d){d?(a("d_link",t("menuDLink"),["link"]),a("d_image",t("menuDImage"),["image"]),a("d_video",t("menuDVideo"),["video"]),a("d_audio",t("menuDAudio"),["audio"])):(b("d_link"),b("d_image"),b("d_video"),b("d_audio"))},Ab:function(d){d?
(a("d_link_oneclick",t("menuDLinkOneClick"),["link"]),a("d_image_oneclick",t("menuDImageOneClick"),["image"]),a("d_video_oneclick",t("menuDVideoOneClick"),["video"]),a("d_audio_oneclick",t("menuDAudioOneClick"),["audio"])):(b("d_link_oneclick"),b("d_image_oneclick"),b("d_video_oneclick"),b("d_audio_oneclick"))},Bb:function(d){d?a("d_sniffer",t("tipBrowserAction"),["page"]):b("d_sniffer")},Qb:function(){a("ba_openmanager",t("menuOpenManager"),["action"]);a("ba_changedir",t("tipBtnChangeDefaultLocation"),
["action"]);a("ba_help",t("menuGetHelp"),["action"]);a("ba_faq",t("btnFAQ"),["action"]);a("ba_report",t("menuReportIssue"),["action"])},A:function(){chrome.contextMenus.onClicked.addListener((d,g)=>{switch(d.menuItemId){case "d_link":d.linkUrl&&c(d.linkUrl,d.pageUrl||d.frameUrl,g);break;case "d_image":case "d_video":case "d_audio":d.srcUrl&&c(d.srcUrl,d.pageUrl||d.frameUrl,g);break;case "d_link_oneclick":d.linkUrl&&e(d.linkUrl,d.pageUrl||d.frameUrl,g);break;case "d_image_oneclick":case "d_video_oneclick":case "d_audio_oneclick":d.srcUrl&&
e(d.srcUrl,d.pageUrl||d.frameUrl,g);break;case "d_sniffer":chrome.action.setPopup({popup:"/pop/sniffer.html?mnu=1"}).then(()=>{chrome.action.openPopup?.()});break;case "ba_openmanager":S.o();break;case "ba_changedir":la(bc.C);Ob(7,81,[65]);break;case "ba_help":S.wa({nb:!0,ea:g?.windowId,na:g?g.index+1:void 0,xa:"help"});break;case "ba_faq":la("https://faq.chronodownloader.net");break;case "ba_report":la("https://bugs.chronodownloader.net")}})}}}(),vf={hide_cr_bar:function(a){chrome.downloads.setUiOptions&&
chrome.downloads.setUiOptions({enabled:!a})},menu_d_dialog:function(a){uf.zb(a)},menu_d_oneclick:function(a){uf.Ab(a)},menu_d_sniffer:function(a){uf.Bb(a)},notify_error:function(a){a==0&&De("terr_")},notify_finish:function(a){a==0&&De("tfin_")},notify_oneclick:function(a){a==0&&De("task_")},notify_progress:function(a){a==0&&De("task_")},badge_downnum:function(){de(-1)},font_size:function(a){ia({cmd:"u_font_size",data:a})},dy_max_con_tasks:function(){Q.pa()},dy_max_per_server:function(){Q.pa()},pop_content:function(a){a===
1?(chrome.action.setPopup({popup:"/pop/sniffer.html"}),chrome.action.setTitle({title:t("tipBrowserAction")})):(chrome.action.setPopup({popup:"/pop/pop.html"}),chrome.action.setTitle({title:t("extName")}))}},wf=function(){const a="open_ui path_list_recents path_list_favs naming_list dlg_options browser_home_path_normalized new_task import g_b s_f t_remove".split(" "),b=M(function(c,e,d){switch(c.cmd){case "open_ui":S.o({Yb:!!c.data});d("y");break;case "open_options":S.wa({nb:c.forceTabMode,xa:c.section,
ea:c.uiWinId,na:c.pos});break;case "clear_noty":c.type&&De(c.type);break;case "blog":console.log(c.data);break;case "path_list_recents":return ge.rb().then(A=>{d({list:A})}),!0;case "path_list_favs":return K.get("path_fav",[]).then(A=>{d({list:A})}),!0;case "fav_path":c.fav==1?K.Z("path_fav",[c.path],!0):K.ta("path_fav",[c.path]);break;case "naming_list":return he.rb().then(A=>{d({list:A})}),!0;case "dlg_options":return chrome.extension.isAllowedFileSchemeAccess().then(A=>{var H=F;A={fontSize:H.get("font_size"),
useLastLocation:H.get("always_use_last_location"),folderSelection:H.get("chrono_folder_selection"),taskDef:{addtop:H.get("def_addtop")},canFileAccess:A};d(A)}),!0;case "browser_home_path_normalized":return be.ob(!0).then(A=>{d(A)}),!0;case "save_as":e=za(c.url);rf.fb(e,void 0,133);break;case "new_task":c.tasks&&tf(c.tasks,c.add_paused,c.addtop,c.page_title,c.notify,c.source);d("y");break;case "url_desc":qf(c.url,c.download,c.text,c.title,c.page_title||(e.tab?e.tab.title:""));break;case "poll_progress":ee();
break;case "import":if(c.src=="chrome")return T.jc(d),!0;break;case "gr":od();break;case "t_start":const [g,m]=c.data;T.Dc(g,m);break;case "t_stop":T.Ec(c.data);break;case "t_restart":const [f,l]=c.data;T.Bc(f,l);break;case "t_cancel":T.Rb(c.data);break;case "t_remove":T.zc(...c.data).then(()=>{d(!0)});break;case "t_clear":T.Tb(...c.data);break;case "s_ac":const [h,k]=c.data;T.wb(h,k,!0);break;case "g_b":d(!1);break;case "t_reset":T.reset();break;case "ui_ready":ke();fetch("https://www.chronodownloader.net?i").catch(()=>
{});break;case "s_f":return(async()=>{const [A,H,da]=c.data,[n]=await O.F([A]);n?(T.T(n,H,da,!1),d(!0)):d(!1)})(),!0;case "s_s":const [p,q]=c.data;if(F.set(p,q))vf[p]?.(q);break;case "s_q":Q.xb(c.data);break;case "s_ut":const [r,w,C]=c.data;r&&K.Ja("ft",r,!0);w&&K.Ja("bt",w,!1);C&&C.length&&Q.xb(C)}});return{external:function(c){switch(c.cmd){case "open_ui":S.o();break;case "open_options":case "open_set":S.wa({})}},kc:function(c,e,d){b(c,e,d);if(a.includes(c.cmd))return!0}}}();
function xf(a){function b(h,k,p){const q=Number(a[h]);isNaN(q)||(k[p||h]=q)}function c(h,k,p,q){const r=a[h];if(r)try{const w=JSON.parse(r);k[p||h]=q?q(w):w}catch(w){}}function e(h,k,p,q){if(k=Number(a[k])){var r=[];for(let w=0;w<k;++w){const C=h+String(w);try{const A=JSON.parse(a[C]);r.push(q?q(A):A)}catch(A){}}p[h]=r}}if(!a.ver1)return Promise.resolve();const d={},g={};d.ver1=a.ver1;d.ver1_t=Number(a.ver1_t)||Date.now();d.ucf=a.current_filter;var m=a["#tb_free_order"];if(m)try{const h=JSON.parse(m),
k=Object.keys(h);k.sort((p,q)=>h[p]-h[q]);d.fot=k.map(p=>String(p))}catch(h){}b("#autoclear_lasttime",d,"act");m="__pr_pb_c __pr_pb_d tip_rateshare tip_rateshare_wait tip_translate tip_notifications tip_dblclick tip_slide tip_taskfilter tip_openmanager tip_grid tip_copyselurls tip_colfit _glst".split(" ");for(var f of m)b("#"+f,d,f);c("#path_fav",d,"path_fav");f=Object.keys(a).filter(h=>h.startsWith("_glc_1_"));for(var l of f)f=a[l],f!==void 0&&(d[l]=f);l=h=>{for(const k in h)if(k!=="value"&&k!==
"time"&&k!=="cnt"){h.cnt=h[k];delete h[k];break}return h};e("naming_rt_","naming_rt_cnt",g,l);e("path_rt_","path_rt_cnt",d,l);c("disp_filters",g,void 0,h=>{for(let k=0;k<h.length;k+=2)h[k]=String(h[k]);return h});c("lfilters",g);c("rules",g,void 0,h=>{for(const k of h)k.id=String(k.id);return h});l=["tb_def_cols","tb_sort_cols"];for(const h in kc)if(f=a["#"+h],f!==void 0)if(l.includes(h))try{f=JSON.parse(f),g[h]=f}catch(k){}else switch(kc[h].type){case "int":case "float":case "select":f=Number(f);
isNaN(f)||(g[h]=f);break;case "bool":f==="true"?g[h]=!0:f==="false"&&(g[h]=!1);break;default:g[h]=f}return Promise.all([L.da(d),Ib.da(g)])}
const yf=function(){function a(d){return d?(d=d.match(/filename="([^"]+)"/i))?d[1]||"":"":""}function b(d){if(d.tabId!=-1){var g=-1,m="",f="";if(d.responseHeaders)for(var l=0;l<d.responseHeaders.length;++l){var h=d.responseHeaders[l];if(h.name.toLowerCase()=="content-type")m=(h.value||"").trim();else if(h.name.toLowerCase()=="content-length"){if(g=parseInt(h.value),isNaN(g)||!isFinite(g))g=-1}else h.name.toLowerCase()=="content-disposition"&&(f=a(h.value))}var k=ya(f).O||ya(wa(d.url).file).O;if(m&&
e.test(m)||k&&c.test(k))k||(m=m.match(/(?:[^\/]+)\/(?:x-)?(?:vnd\.)?(.+)/i))&&m[1]&&(k=va[m[1]]||m[1]),(async()=>{const [p,q]=await Promise.all([Hb.get("stid"),Xc()]),r={cmd:"stream_url",url:d.url,size:g,need_send:q&&d.tabId===p};f&&(r.desc=f);k&&(r.fext=k);chrome.tabs.sendMessage(d.tabId,r)})()}}var c=RegExp("^((bmp|cur|dds|exr|gif|ico|jpg|jpeg|pcx|pbm|pfm|pgm|ppm|png|psd|svg|tga|tif|tiff|webp)|(3gp|3g2|asf|avi|f4f|f4i|f4m|f4v|flv|h264|m4v|mkv|mov|mp4|mpg|ogg|ogv|qt|rm|rmvb|ts|vob|webm|wmv)|(aac|aif|ape|flac|oga|opus|m3u|m4a|mid|midi|mp3|ra|wav|wma|weba))$",
"i"),e=RegExp("(^(image|audio|video))|(application/vnd.rn-realmedia)","i");return{A:function(){if(!chrome.webRequest.onHeadersReceived.hasListener(b))try{chrome.webRequest.onHeadersReceived.addListener(b,{urls:["http://*/*","https://*/*"],types:"main_frame sub_frame stylesheet script image font object xmlhttprequest ping csp_report media websocket other".split(" ")},["responseHeaders"])}catch(d){console.log("Failed to add listener"),console.log(d)}},stop:function(){chrome.webRequest.onHeadersReceived.removeListener(b)}}}();
globalThis.addEventListener("error",a=>{(a=tb(a.error))&&kd(137,"page_referrer",a)},!0);globalThis.addEventListener("unhandledrejection",a=>{(a=tb(a.reason))&&kd(138,"page_referrer",a)});chrome.runtime.onUpdateAvailable.addListener(function(a){te(a.version)});function zf(a,b){return a[0]-b[0]||a[1]-b[1]||a[2]-b[2]}function Af(a){a=a.split(".");for(var b=Array(3),c=0;c<a.length&&c<3;++c){var e=parseInt(a[c]);if(isNaN(e)||!isFinite(e))e=0;b[c]=e}for(;c<3;++c)b[c]=0;return b}
async function Bf(a){if(zf(a,[0,12,0])<0){await bd();const {promise:b,resolve:c}=jb();chrome.runtime.sendMessage({target:"off",cmd:"d3"},function(e){e?xf(e).then(c):(console.error("failed to get localStorage"),c())});await b;await L.set("rld",2);chrome.runtime.reload()}zf(a,[0,13,0])<0&&(await F.load(),F.get("click_notify")===Ta&&F.set("click_notify",Wa),F.set("win_mode",!1),chrome.storage.local.remove(["_glst","_glc_1_dz","_glc_1_fe_us","_glc_1_sf"]));console.log("new version storage updated")}
async function Cf(a){caches.delete("chp");let b=!1,c;const e=chrome.runtime.getManifest().version;let d=!1;if(a){const g=Af(a),m=Af(e);e!=="0.12.2"&&(g[2]=m[2]=0);zf(g,m)<0&&(d=!0);a!==e&&(c=g)}else L.da({ver1:e,ver1_t:Date.now()}),d=b=!0;c&&await Bf(c);d&&setTimeout(()=>{S.o({lb:{u:b?"1":"2"}}).then(function(){P({cmd:"u_updated",data:b})})},1E3)}
async function Df(){if(!I.get("fsu",!1)){I.set("fsu",!0);console.log("onStartup");I.set("cdft",0);var a=F.get("menu_d_dialog"),b=F.get("menu_d_oneclick"),c=F.get("menu_d_sniffer"),e=!F.get("hide_cr_bar");uf.zb(a);uf.Ab(b);chrome.action.openPopup&&uf.Bb(c);chrome.downloads.setUiOptions&&chrome.downloads.setUiOptions({enabled:e});uf.Qb();vf.pop_content(F.get("pop_content"));L.get("rld").then(d=>{d&&(S.o().then(function(){P({cmd:"u_updated",data:d===1})}),L.erase("rld"))});await T.Ac();Q.pa();a=F.get("autoclear_type");
b=F.get("autoclear_timer");T.wb(a,b,!1);Ef();od()}}function Ef(){const a=/((ftp)|(https?)):\/\/.+/;chrome.windows.getAll({populate:!0},function(b){const c=["cs/sniffer.js","cs/main.js"],e=[!0,!1];for(const d of b)if(b=d.tabs)for(const g of b)if(g.url&&a.test(g.url))for(b=0;b<c.length;++b)chrome.scripting.executeScript({target:{tabId:g.id,allFrames:e[b]},files:[c[b]]}).then(function(){chrome.runtime.lastError&&console.warn(chrome.runtime.lastError)}).catch(m=>{console.warn(m)})})}
function Ff(a){a.reason!=="update"&&a.reason!=="install"||Cf(a.reason==="update"?a.previousVersion:void 0)}Date.now()>1740009692193||(chrome.runtime.onInstalled.addListener(Ff),M(Df)(),sf.A(),uf.A(),be.A(),S.A(),rf.A(),yf.A(),chrome.runtime.onMessage.addListener(wf.kc),chrome.runtime.onMessageExternal.addListener(wf.external),chrome.alarms.onAlarm.addListener(M(T.dc)));
