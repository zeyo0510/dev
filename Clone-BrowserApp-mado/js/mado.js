/* Copyright (c) 2016 Armand Grillet.
See the license in the "About" section for further information. */
function Counter(a){this.charsDiv=$("#character-nb"),this.countedDiv=a,this.wordsDiv=$("#word-nb"),this.charsDiv.add(this.wordsDiv).on("click",$.proxy(function(){this.toggleInformationDisplayed()},this)),this.charsDiv.css("display","none"),this.update()}function DisplayManager(a){this.conversionDiv=$("#html-conversion"),this.currentGallery=void 0,this.editor=a,this.galleries=[],this.imagesDisplayed=new ImageArray,this.imgFormats=["png","bmp","jpeg","jpg","gif","png","svg","xbm","webp"],this.loadedImagePath=void 0,this.imagePosition=void 0,this.styleManager=new StyleManager,this.tempConversion=void 0,this.urlManager=new UrlManager(this.conversionDiv),chrome.storage.onChanged.addListener($.proxy(function(a,b){for(var c in a)switch(c){case"gfm":this.setSyntax()}},this)),this.setSyntax()}function Editor(){this.markdown=$("#markdown"),this.conversionDiv=$("#html-conversion"),this.counter=new Counter(this.markdown[0]),this.displayManager=new DisplayManager(this),this.helpManager=new HelpManager,this.imageManager=new ImageManager(this),this.linkManager=new LinkManager(this),this.nameManager=new NameManager(this),this.saveStateManager=new SaveStateManager(this),this.scrollManager=new ScrollManager(this.markdown,this.conversionDiv),this.webImageManager=new WebImageManager(this),this.markdown.on("input propertychange",$.proxy(function(){this.convert()},this)),this.markdown.on("keydown",function(a){if(9===a.keyCode){a.preventDefault();var b=this.selectionStart,c=this.selectionEnd;$(this).val($(this).val().substring(0,b)+"    "+$(this).val().substring(c)),this.selectionStart=this.selectionEnd=b+4}}),this.markdown.on("keydown",$.proxy(function(a){9===a.keyCode&&this.convert()},this)),this.init()}function HelpManager(){this.help=$("#help-input"),this.helpButton=$("#help-button"),this.helpDisplayer=$("#help-input-displayer"),this.resultsContainer=$("#help-results-container"),this.helpSubjects=["Headers","Bold","Italic","BoldItalic","OrderedLists","UnorderedLists","InlineStyleLinks","ReferenceStyleLinks","InlineStyleImages","ReferenceStyleImages","Code","Blockquotes","InlineHTML","HorizontalRules","LineBreaks","Tables","Question"],$(document).click($.proxy(function(a){$(a.target).closest("#help-button").length&&this.helpDisplayer.hasClass("hidden")?(this.reset(),this.helpDisplayer.removeClass("hidden"),this.help.focus()):this.helpDisplayer.hasClass("hidden")||$(a.target).closest("#help-input-displayer").length||(this.resultsContainer.addClass("hidden"),this.helpDisplayer.addClass("hidden"))},this)),Mousetrap.bind(["ctrl+h"],$.proxy(function(a){return this.helpButton.click(),!1},this)),this.help.keyup($.proxy(function(a){27==a.keyCode&&this.helpButton.click()},this)),this.help.on("input propertychange",$.proxy(function(a){this.searchAnswers()},this)),$("#result-switch-1, #result-switch-2, #result-switch-3").on("click",$.proxy(function(a){this["switch"](a.target.id.substr(a.target.id.length-1))},this))}function ImageArray(){this.images=[]}function ImageManager(a){this.altInput=$("#alt-input"),this.cancelImageButton=$("#cancel-image"),this.galleriesButton=$("#galleries-button"),this.imageButton=$("#image-button"),this.imageDisplayer=$("#image-insertion-displayer"),this.imageBox=$("#image-insertion-box"),this.imageBrowser=$("#browse-image"),this.insertImageButton=$("#insert-image"),this.editor=a,this.startSelection=void 0,this.firstEndSelection=void 0,this.endSelection=void 0,this.initialSelection=void 0,this.imageLoaded=void 0,$(document).click($.proxy(function(a){$(a.target).closest("#image-button").length?this.imageDisplayer.hasClass("hidden")?(this.reset(),this.display()):this.imageDisplayer.toggleClass("hidden"):this.imageDisplayer.hasClass("hidden")||$(a.target).closest("#image-insertion-displayer").length||this.imageDisplayer.toggleClass("hidden")},this)),this.insertImageButton.on("click",$.proxy(function(a){this.apply()},this)),this.imageBrowser.on("click",$.proxy(function(a){this.chooseImage()},this)),this.galleriesButton.on("click",$.proxy(function(a){this.setGalleries()},this)),this.cancelImageButton.on("click",$.proxy(function(a){this.cancel()},this)),this.altInput.keyup($.proxy(function(a){switch(a.keyCode){case 13:this.apply();break;case 27:this.cancel();break;default:this.update()}},this))}function LinkManager(a){this.cancelLinkButton=$("#cancel-link"),this.insertLink=$("#insert-link"),this.linkButton=$("#link-button"),this.linkDisplayer=$("#link-insertion-displayer"),this.urlInput=$("#url-input"),this.hypertextInput=$("#hypertext-input"),this.editor=a,this.startSelection=void 0,this.firstEndSelection=void 0,this.endSelection=void 0,this.initialSelection=void 0,$(document).click($.proxy(function(a){$(a.target).closest("#link-button").length?this.linkDisplayer.hasClass("hidden")?(this.reset(),this.display()):this.linkDisplayer.addClass("hidden"):this.linkDisplayer.hasClass("hidden")||$(a.target).closest("#link-insertion-displayer").length||this.linkDisplayer.toggleClass("hidden")},this)),this.insertLink.on("click",$.proxy(function(a){this.apply()},this)),this.cancelLinkButton.on("click",$.proxy(function(a){this.cancel()},this)),Mousetrap.bind(["command+k","ctrl+k"],$.proxy(function(a){return this.linkButton.click(),!1},this)),this.urlInput.keyup($.proxy(function(a){switch(a.keyCode){case 13:this.apply();break;case 27:this.cancel();break;default:this.update()}},this)),this.hypertextInput.keydown($.proxy(function(a){9==a.keyCode&&(a.preventDefault(),this.urlInput.select())},this)),this.hypertextInput.keyup($.proxy(function(a){switch(a.keyCode){case 13:this.apply();break;case 27:this.cancel();break;default:this.update()}},this))}function NameManager(){this.windowName=$("#doc-name"),this.headTitle=$("title")[0],this.name=void 0}function SaveStateManager(a){this.saveState=$("#save-state"),this.editor=a,this.savedText=a.getMarkdown()}function ScrollManager(a,b){this.centerLine=$("#center-line-container"),this.atTheBottom=void 0,this.firstZone=a,this.secondZone=b,this.lastFirstZoneHeight=a[0].scrollHeight;var c=this;a.add(b).on("scroll",function(a){$(this).is(":hover")&&c.asyncScroll(this.id)})}function StyleManager(){this.styleButton=$("#style-tool"),this.styleDisplayer=$("#style-tool-displayer"),this.homeRadio=$("#home-style"),this.clinicRadio=$("#clinic-style"),this.tramwayRadio=$("#tramway-style"),$(document).click($.proxy(function(a){$(a.target).closest(this.styleButton).length&&this.styleDisplayer.hasClass("hidden")?this.styleDisplayer.removeClass("hidden"):this.styleDisplayer.hasClass("hidden")||$(a.target).closest(this.styleDisplayer).length||this.styleDisplayer.addClass("hidden")},this)),this.homeRadio.add(this.clinicRadio).add(this.tramwayRadio).on("click",$.proxy(function(a){this.setStyle(a.target.id.slice(0,-6))},this)),chrome.storage.onChanged.addListener($.proxy(function(a,b){for(var c in a)switch(c){case"style":this.getStyle()}},this)),this.getStyle()}function UrlManager(a){this.linkUrlSpan=$("#link-url"),a.on("mouseenter","a",$.proxy(function(a){this.linkUrlSpan.html(-1==a.currentTarget.href.indexOf("chrome-extension://")?a.currentTarget.href:a.currentTarget.hash),this.linkUrlSpan.addClass("show")},this)),a.on("mouseleave","a",$.proxy(function(){this.linkUrlSpan.removeClass("show")},this)),a.on("click","a",function(b){-1!=b.currentTarget.href.indexOf("chrome-extension://")&&(b.preventDefault(),""!==b.currentTarget.hash&&0!==$(b.currentTarget.hash).length&&a.scrollTop($(b.currentTarget.hash).position().top))})}function WebImageManager(a){this.cancelWebImageButton=$("#cancel-webimage"),this.insertWebImageButton=$("#insert-webimage"),this.webImageButton=$("#webimage-button"),this.webImageUrlInput=$("#webimage-url"),this.webImageAltInput=$("#webimage-alt-input"),this.webImageDisplayer=$("#webimage-insertion-displayer"),this.webImageBox=$("#webimage-insertion-box"),this.editor=a,this.startSelection=void 0,this.firstEndSelection=void 0,this.endSelection=void 0,this.initialSelection=void 0,$(document).click($.proxy(function(a){$(a.target).closest("#webimage-button").length?this.webImageDisplayer.hasClass("hidden")?(this.reset(),this.display()):this.webImageDisplayer.addClass("hidden"):this.webImageDisplayer.hasClass("hidden")||$(a.target).closest("#webimage-insertion-box").length||this.webImageDisplayer.toggleClass("hidden")},this)),this.insertWebImageButton.on("click",$.proxy(function(a){this.apply()},this)),this.cancelWebImageButton.on("click",$.proxy(function(a){this.cancel()},this)),this.webImageAltInput.add(this.webImageUrlInput).keyup($.proxy(function(a){switch(a.keyCode){case 13:this.apply();break;case 27:this.cancel();break;default:this.update()}},this)),this.webImageAltInput.keydown($.proxy(function(a){9==a.keyCode&&(a.preventDefault(),this.onlineImageUrlInput.select())},this))}function App(a){this.editor=a,this.lastBounds=chrome.app.window.current().outerBounds,this.dragAndDropManager=new DnDManager(this,"body"),this.exportManager=new ExportManager(this),this.labelManager=new LabelManager,this.moreWindowsManager=new MoreWindowsManager,this.newFileManager=new NewFileManager(this),this.openFileManager=new OpenFileManager(this),this.printManager=new PrintManager,this.recentFilesManager=new RecentFilesManager(this),this.saveFileManager=new SaveFileManager(this),this.saveFileAsManager=new SaveFileAsManager(this),this.switchManager=new SwitchManager}function DnDManager(a,b){this.documentSection=$("#document"),this.app=a,this.dragMessageAlreadyVisible=!1,this.selector=document.querySelector(b),this.extensionsAllowed=[".markdown",".md",".txt"],this.filePath=void 0,this.overCount=0,this.selector.addEventListener("dragenter",$.proxy(function(a){this.dragenter(a)},this)),this.selector.addEventListener("dragover",$.proxy(function(a){this.dragover(a)},this)),this.selector.addEventListener("dragleave",$.proxy(function(a){this.dragleave(a)},this)),this.selector.addEventListener("drop",$.proxy(function(a){this.drop(a)},this))}function ExportManager(a){this.exportButton=$("#export"),this.app=a,this.exportButton.on("click",$.proxy(function(){this.apply()},this))}function LabelManager(){this.bigWidth=void 0,this.topbarButtons=[["#export","msgExport"],["#new","msgNew"],["#open","msgOpen"],["#print","msgPrint"],["#recent-button","msgRecent"],["#save","msgSave"],["#save-as","msgSaveAs"]],this.lastWidth=void 0,chrome.app.window.current().onBoundsChanged.addListener($.proxy(function(){this.update()},this)),this.init()}function MoreWindowsManager(){this.moreButton=$("#more-button"),this.moreDisplayer=$("#more-displayer"),this.moreBox=$("#more-container"),this.settingsLine=$("#settings"),this.shortcutsLine=$("#shortcuts"),this.aboutLine=$("#about"),$(document).click($.proxy(function(a){$(a.target).closest("#more-button").length?this.moreDisplayer.toggleClass("hidden"):this.moreDisplayer.hasClass("hidden")||$(a.target).closest("#more-container").length||this.moreDisplayer.addClass("hidden")},this)),this.settingsLine.add(this.shortcutsLine).add(this.aboutLine).on("click",$.proxy(function(a){this.apply(a.currentTarget.id)},this))}function NewFileManager(a){this.newButton=$("#new"),this.app=a,this.newButton.on("click",$.proxy(function(){this.apply()},this)),Mousetrap.bind(["command+n","ctrl+n"],$.proxy(function(a){return this.apply(),!1},this))}function OpenFileManager(a){this.openButton=$("#open"),this.app=a,this.openButton.on("click",$.proxy(function(){this.apply()},this)),Mousetrap.bind(["command+o","ctrl+o"],$.proxy(function(a){return this.apply(),!1},this))}function PrintManager(){this.printButton=$("#print"),this.printButton.on("click",function(){window.print()}),Mousetrap.bind(["command+p","ctrl+p"],function(a){return window.print(),!1})}function RecentFilesManager(a){this.recentButton=$("#recent-button"),this.recentFilesDisplayer=$("#recent-files-displayer"),this.recentFilesContainer=$("#recent-files-container"),this.app=a,this.recentFiles=[],$(document).click($.proxy(function(a){$(a.target).closest("#recent-button").length&&this.recentFilesDisplayer.hasClass("hidden")?(this.displayRecentFiles(),this.recentFilesDisplayer.toggleClass("hidden")):this.recentFilesDisplayer.hasClass("hidden")||$(a.target).closest("#recent-files-container").length||this.recentFilesDisplayer.addClass("hidden")},this)),chrome.storage.onChanged.addListener($.proxy(function(a,b){for(var c in a)switch(c){case"recentFiles":this.init();break;case"newFile":this.update()}},this)),this.init()}function SaveFileAsManager(a){this.saveAsButton=$("#save-as"),this.app=a,this.saveAsButton.on("click",$.proxy(function(){this.apply()},this)),Mousetrap.bind(["command+shift+s","ctrl+shift+s"],$.proxy(function(a){return this.apply(),!1},this))}function SaveFileManager(a){this.saveButton=$("#save"),this.app=a,this.fileToSave=void 0,this.saveButton.on("click",$.proxy(function(){this.apply()},this)),Mousetrap.bind(["command+s","ctrl+s"],$.proxy(function(a){return this.apply(),!1},this)),this.init()}function SwitchManager(){this.madoFooter=$("#mado-footer"),this.switchCursor=$("#switch-cursor"),this.switchToMD=$("#switch-md"),this.switchToBoth=$("#switch-both"),this.switchToHTML=$("#switch-html"),this.workspace=$("#workspace"),this.switchButtons=[this.switchToMD,this.switchToBoth,this.switchToHTML],this.previousSize=chrome.app.window.current().outerBounds.width,chrome.app.window.current().onBoundsChanged.addListener($.proxy(function(){chrome.app.window.current().outerBounds.width<1160&&this.switchToBoth.hasClass("activated")?this.switchToMD.click():chrome.app.window.current().outerBounds.width>=1160&&this.previousSize<1160&&this.switchToBoth.click(),this.previousSize=chrome.app.window.current().outerBounds.width},this)),this.switchToMD.add(this.switchToBoth).add(this.switchToHTML).on("click",$.proxy(function(a){this.activate(a.currentTarget.id)},this)),Mousetrap.bind(["command+alt+left","ctrl+alt+left"],$.proxy(function(a){return this["switch"]("left"),!1},this)),Mousetrap.bind(["command+alt+right","ctrl+alt+right"],$.proxy(function(a){return this["switch"]("right"),!1},this)),this.activate(chrome.app.window.current().outerBounds.width>1159?"switch-both":"switch-md")}function AppWindow(a){this.cancelCloseButton=$("#cancel"),this.closeDisplayer=$("#close-alert-displayer"),this.head=$("head")[0],this.quitCloseButton=$("#quit"),this.saveAndQuitCloseButton=$("#save-quit"),this.close=$("#window-close-button"),this.maximize=$("#window-maximize"),this.minimize=$("#window-minimize"),this.app=a,$(document).click($.proxy(function(a){$(a.target).closest(this.close).length?this.closeWindow():this.closeDisplayer.hasClass("visible")&&!$(a.target).closest(this.closeDisplayer).length&&this.closeDisplayer.attr("class","hidden")},this)),Mousetrap.bind(["command+w","ctrl+w"],$.proxy(function(a){return this.closeWindow(),!1},this)),this.maximize.on("click",function(a){chrome.app.window.current().isMaximized()?chrome.app.window.current().restore():chrome.app.window.current().maximize()}),this.minimize.on("click",function(a){chrome.app.window.current().minimize()}),this.cancelCloseButton.on("click",$.proxy(function(a){this.closeDisplayer.attr("class","hidden")},this)),this.quitCloseButton.on("click",$.proxy(function(a){this.quitCloseWindow()},this)),this.saveAndQuitCloseButton.on("click",$.proxy(function(a){this.saveQuitCloseWindow()},this)),this.init()}window.onload=function(){var a=new Editor,b=new App(a);new AppWindow(b);$(".localized-placeholder").each(function(){$(this).attr("placeholder",chrome.i18n.getMessage($(this).attr("placeholder")))}),$(".localized").each(function(){$(this).html(chrome.i18n.getMessage(this.innerHTML))})},Counter.prototype={constructor:Counter,display:function(a){this.charsDiv.html("&nbsp;"+a.characters+" "+chrome.i18n.getMessage("msgCharacters")+"&nbsp;"),this.wordsDiv.html("&nbsp;"+a.words+" "+chrome.i18n.getMessage("msgWords")+"&nbsp;"),1==a.characters&&this.charsDiv.html("&nbsp; "+chrome.i18n.getMessage("msgCharacter")+"&nbsp;"),1==a.words&&this.wordsDiv.html("&nbsp;"+a.words+" "+chrome.i18n.getMessage("msgWord")+"&nbsp;")},toggleInformationDisplayed:function(){"none"==this.charsDiv.css("display")?(this.charsDiv.css("display","inline"),this.wordsDiv.css("display","none")):(this.charsDiv.css("display","none"),this.wordsDiv.css("display","inline"))},update:function(){Countable.count(this.countedDiv,$.proxy(function(a){this.display(a)},this),{stripTags:!0})}},DisplayManager.prototype={constructor:DisplayManager,displayImages:function(){if(this.tempConversion.indexOf('<img src="',this.imagePosition)>-1)if(this.imagePosition=this.tempConversion.indexOf('<img src="',this.imagePosition)+'<img src="'.length,this.loadedImagePath=this.tempConversion.substring(this.imagePosition,this.tempConversion.indexOf('"',this.imagePosition)),this.imagesDisplayed.hasPath(this.loadedImagePath)){var a=this.imagesDisplayed.getImage(this.loadedImagePath);this.tempConversion=this.tempConversion.substring(0,this.imagePosition)+a+this.tempConversion.substring(this.imagePosition+this.loadedImagePath.length),this.displayImages()}else"http://"==this.loadedImagePath.substring(0,7)||"https://"==this.loadedImagePath.substring(0,8)?navigator.onLine?this.getOnlineImage():tempConversion=tempConversion.substring(0,this.imagePosition-10)+'<span class="nofile-link"> <span class="nofile-visual">'+chrome.i18n.getMessage("msgNoInternet")+'</span>&nbsp;</span><img class="nofile" srcset="img/nointernet.png 1x, img/nointernet@2x.png 2x'+tempConversion.substring(this.imagePosition+this.loadedImagePath.length):this.imgFormats.indexOf(this.loadedImagePath.substr(this.loadedImagePath.lastIndexOf(".")+1).toLowerCase())>-1?this.getOfflineImage():"data:"!=this.loadedImagePath.substring(0,5)&&"blob:"!=this.loadedImagePath.substring(0,5)&&(this.tempConversion=this.tempConversion.substring(0,this.imagePosition-10)+'<span class="nofile-link"> <span class="nofile-visual">'+chrome.i18n.getMessage("msgNotAnImage")+'</span>&nbsp;</span><img class="nofile" srcset="img/notimage.png 1x, img/notimage@2x.png 2x'+this.tempConversion.substring(this.imagePosition+this.loadedImagePath.length),this.displayImages());else this.imagesDisplayed.clean(),this.imagePosition=0,this.finishDisplaying()},finishDisplaying:function(){this.conversionDiv.html(this.tempConversion),$("#html-conversion a").each(function(){"#"!=$(this).attr("href").substring(0,1)&&"http"!=$(this).attr("href").substring(0,4)&&$(this).attr("href","http://"+$(this).attr("href")),$(this).attr("target","_blank")}),$("#html-conversion .nofile-visual").on("click",$.proxy(function(a){this.editor.setGalleries()},this))},galleryAnalysis:function(a){var b=this;a<this.galleries.length?(this.currentGallery=a,this.galleries.forEach(function(c,d,e){d==a&&c.root.createReader().readEntries(function(a){b.getImages(a,0)})})):(this.tempConversion=this.tempConversion.substring(0,this.imagePosition-10)+'<span class="nofile-link"> <span class="nofile-visual">'+this.loadedImagePath.replace(/\\/g,"/").substring(this.loadedImagePath.lastIndexOf("/")+1)+" "+chrome.i18n.getMessage("msgNotFound")+"</span>&nbsp;</span><img class='nofile' srcset='img/nofile.png 1x, img/nofile@2x.png 2x'"+this.tempConversion.substring(this.imagePosition+this.loadedImagePath.length),this.displayImages())},getImages:function(a,b){if(b<a.length)if(a[b].isDirectory&&-1!=this.loadedImagePath.indexOf(a[b].fullPath.replace(/\'/g,"&#39;")))a[b].createReader().readEntries($.proxy(function(a){this.getImages(a,0)},this));else if(-1!=this.loadedImagePath.indexOf(a[b].fullPath.replace(/\'/g,"&#39;"))){var c=this;a[b].file(function(a){var b=new FileReader;b.onloadend=function(a){c.imagesDisplayed.addImage(c.loadedImagePath,a.target.result),c.tempConversion=c.tempConversion.substring(0,c.imagePosition)+a.target.result+c.tempConversion.substring(c.imagePosition+c.loadedImagePath.length),c.displayImages()},b.readAsDataURL(a)})}else this.getImages(a,b+1);else this.galleryAnalysis(this.currentGallery+1)},getOfflineImage:function(){chrome.mediaGalleries.getMediaFileSystems({interactive:"no"},$.proxy(function(a){this.galleries=a,this.galleryAnalysis(0)},this))},getOnlineImage:function(){var a=new XMLHttpRequest;a.responseType="blob",a.onload=$.proxy(function(){if(a.response.type.indexOf("image")>-1){var b=window.URL.createObjectURL(a.response);this.imagesDisplayed.addImage(this.loadedImagePath,b),this.tempConversion=this.tempConversion.substring(0,this.imagePosition)+b+this.tempConversion.substring(this.imagePosition+this.loadedImagePath.length)}else this.tempConversion=this.tempConversion.substring(0,this.imagePosition-10)+'<span class="nofile-link"> <span class="nofile-visual">'+chrome.i18n.getMessage("msgNotAnImage")+'</span>&nbsp;</span><img class="nofile" srcset="img/notimage.png 1x, img/notimage@2x.png 2x'+this.tempConversion.substring(this.imagePosition+this.loadedImagePath.length);this.displayImages()},this),a.open("GET",this.loadedImagePath,!0),a.send(this.loadedImagePath)},setSyntax:function(){chrome.storage.local.get("gfm",$.proxy(function(a){void 0!==a.gfm?marked.setOptions({gfm:a.gfm}):chrome.storage.local.set({gfm:!0}),this.update()},this))},update:function(){this.editor.getLength()>0?(this.tempConversion=marked(this.editor.getMarkdown()),this.editor.checkHeight(),this.displayImages()):this.conversionDiv.html(chrome.i18n.getMessage("msgNoTextInEditor"))}},Editor.prototype={constructor:Editor,checkHeight:function(){this.scrollManager.checkZonesHeight()},convert:function(){this.displayManager.update(),this.saveStateManager.update(),this.counter.update()},focus:function(){this.markdown.focus()},getLength:function(){return this.markdown.val().length},getMarkdown:function(){return this.markdown.val()},getName:function(){return this.nameManager.getName()},getSelection:function(){return this.markdown.getSelection()},init:function(){var a=this;chrome.storage.local.get("editorInitFileEntry",function(b){b.editorInitFileEntry?chrome.fileSystem.restoreEntry(b.editorInitFileEntry,function(b){fileEntry=b,chrome.storage.local.remove("editorInitFileEntry"),fileEntry.file(function(b){var c=new FileReader;c.onload=function(b){chrome.storage.local.set({newFile:chrome.fileSystem.retainEntry(fileEntry),newFilePath:fileEntry.fullPath},function(){a.setMarkdown(b.target.result),a.saveWithName(fileEntry.fullPath.substring(fileEntry.fullPath.lastIndexOf("/")+1))})},c.readAsText(b)},function(a){console.log(a)})}):chrome.storage.local.get("firstLaunch",function(b){void 0===b.firstLaunch&&(a.setMarkdown(chrome.i18n.getMessage("msgFirstLaunch")),chrome.storage.local.set({firstLaunch:!1}))})})},isNamed:function(){return this.nameManager.isNamed()},isSaved:function(){return this.saveStateManager.isSaved()},replaceSelection:function(a,b,c){this.markdown.setSelection(b,c),this.markdown.replaceSelectedText(a,"select")},save:function(){this.saveStateManager.save()},saveWithName:function(a){this.nameManager.set(a),this.saveStateManager.save()},setGalleries:function(){this.imageManager.setGalleries()},setMarkdown:function(a,b,c){this.markdown.val(this.markdown.val().substring(0,b)+a+this.markdown.val().substring(c,this.markdown.val().length)),this.convert()},setSelection:function(a,b){this.markdown.setSelection(a,b)}},HelpManager.prototype={constructor:HelpManager,localizedMinLength:function(){switch(chrome.i18n.getUILanguage()){case"zh-CN":return 2;default:return 3}},reset:function(){this.help.val(""),this.resetAnswerDivs(1)},resetAnswerDivs:function(a){for(var b=a;3>=b;b++)""===$("#answer-"+b).html()?b=3:($("#answer-"+b).html(""),$("#result-"+b).attr("class","result"),$("#example-"+b).html(""))},searchAnswers:function(){if(0===this.help.val().length)this.resultsContainer.attr("class","hidden"),this.resetAnswerDivs(3);else if(this.help.val().length<this.localizedMinLength())switch(this.resultsContainer.attr("class","one-result no-result"),this.resetAnswerDivs(2),this.localizedMinLength()-this.help.val().length){case 2:$("#answer-1").html(chrome.i18n.getMessage("msgTwoMoreCharacters"));break;case 1:$("#answer-1").html(chrome.i18n.getMessage("msgOneMoreCharacter"))}else{for(var a=0,b=chrome.i18n,c=this.helpSubjects,d=0;d<c.length&&3>a;d++)for(var e=0,f="help"+c[d];""!==b.getMessage(f+e);){if(b.getMessage(f+e).toLowerCase().indexOf(this.help.val().toLowerCase())>-1){var g=b.getMessage(f+e),h=b.getMessage(f+"Result"),i=b.getMessage(f+"Example"),j=b.getMessage(f+e).toLowerCase().indexOf(this.help.val().toLowerCase());$("#answer-"+(a+1)).html('<h1 class="help-title">'+g.substring(0,j)+'<span class="match">'+g.substr(j,this.help.val().length)+"</span>"+g.substring(j+this.help.val().length)+"</h1>"+h),document.getElementById("example-"+(a+1)).innerHTML=i,a++;break}e++}switch(a){case 0:$("#answer-1").html(chrome.i18n.getMessage("msgNoHelpFound")),this.resultsContainer.attr("class","one-result no-result"),this.resetAnswerDivs(2);break;case 1:this.resultsContainer.attr("class","one-result"),this.resetAnswerDivs(2);break;case 2:this.resultsContainer.attr("class","two-results"),this.resetAnswerDivs(3);break;case 3:this.resultsContainer.attr("class","three-results")}}this.setResultsHeight()},setResultsHeight:function(){for(var a=0,b=1;3>=b;b++)""!==$("#answer-"+b).html()?($("#result-"+b).css("display","block"),$("#answer-"+b).outerHeight()>=$("#example-"+b).outerHeight()?$("#result-"+b).css("height",$("#answer-"+b).outerHeight()+"px"):$("#result-"+b).css("height",$("#example-"+b).outerHeight()+"px"),a+=$("#result-"+b).outerHeight()):($("#result-"+b).css("height",0),$("#result-"+b).css("display","none"));this.resultsContainer.css("height",a+"px")},"switch":function(a){$("#result-"+a).toggleClass("switched"),this.help.focus()}},ImageArray.prototype={constructor:ImageArray,addImage:function(a,b){this.images.push([a,b,!0])},clean:function(){for(var a=0;a<this.images.length;a++)this.images[a][2]?this.images[a][2]=!1:(this.images.splice(a,1),a--)},getImage:function(a){for(var b=0;b<this.images.length;b++){if(this.images[b][0]==a)return this.setUsed(a),this.images[b][1];if(b==this.images.length-1)throw"Image's path not available in image array."}},hasPath:function(a){for(var b=0;b<this.images.length;b++)if(this.images[b][0]==a)return!0;return!1},setUsed:function(a){for(var b=0;b<this.images.length;b++)if(this.images[b][0]==a){this.images[b][2]=!0;break}}},ImageManager.prototype={constructor:ImageManager,apply:function(){""===this.altInput.val()?(this.altInput.addClass("flash"),this.altInput.focus(),setTimeout($.proxy(function(){this.altInput.removeClass("flash")},this),800)):void 0!==this.imageLoaded&&(this.imageDisplayer.addClass("hidden"),this.editor.focus(),this.editor.setSelection(this.endSelection,this.endSelection))},cancel:function(){this.imageDisplayer.toggleClass("hidden"),this.editor.replaceSelection(this.initialSelection,this.startSelection,this.endSelection,"select")},chooseImage:function(){var a=this;chrome.fileSystem.chooseEntry({type:"openFile",accepts:[{mimeTypes:["image/*"]}]},function(b){b&&chrome.fileSystem.getDisplayPath(b,function(b){var c=b.substring(b.replace(/\\/g,"/").lastIndexOf("/")+1);a.setImageBrowser(c),a.imageLoaded=b.replace(/\\/g,"/"),a.update(),a.altInput.focus()})})},display:function(){this.imageDisplayer.toggleClass("hidden");var a=this.editor.getSelection();this.initialSelection=a.text,this.startSelection=a.start,this.firstEndSelection=a.end,this.endSelection=a.end,/!\[.*\]\(.*\)/.test(a.text)&&"!"==a.text[0]&&")"==a.text.slice(-1)?(/!\[.*\]\(.*\s+".*"\)/.test(a.text)?this.imageLoaded=a.text.match(/\(.*\)/)[0].substring(2,a.text.match(/\(.*\s+"/)[0].length-2).replace(/\\/g,"/"):this.imageLoaded=a.text.match(/\(.*\)/)[0].substring(2,a.text.match(/\(.*\)/)[0].length-1).replace(/\\/g,"/"),this.setImageBrowser(this.imageLoaded.substring(this.imageLoaded.replace(/\\/g,"/").lastIndexOf("/")+1)),this.altInput.val(a.text.match(/!\[.+\]/)[0].substring(2,a.text.match(/!\[.+\]/)[0].length-1))):this.altInput.val(a.text),this.altInput.focus()},reset:function(){this.imageBrowser.html(chrome.i18n.getMessage("msgChooseAnImage")),this.altInput.val(""),this.imageLoaded=void 0},setGalleries:function(){chrome.mediaGalleries.getMediaFileSystems({interactive:"yes"},$.proxy(function(a){this.editor.convert()},this))},setImageBrowser:function(a){this.imageBrowser.html(a.length>15?a.substring(0,6)+"(…)"+a.substring(a.length-6):a)},update:function(){var a;a=this.imageLoaded?"!["+this.altInput.val()+"]("+this.imageLoaded+")":"!["+this.altInput.val()+"]()",this.editor.setMarkdown(a,this.startSelection,this.endSelection),this.endSelection=this.startSelection+a.length}},LinkManager.prototype={constructor:LinkManager,apply:function(){""===this.urlInput.val()?(this.urlInput.addClass("flash"),this.urlInput.focus(),setTimeout($.proxy(function(){this.urlInput.removeClass("flash")},this),800)):(this.linkDisplayer.addClass("hidden"),this.editor.focus(),this.editor.setSelection(this.endSelection,this.endSelection))},cancel:function(){this.linkDisplayer.toggleClass("hidden"),this.editor.replaceSelection(this.initialSelection,this.startSelection,this.endSelection,"select")},display:function(){this.linkDisplayer.toggleClass("hidden");var a=this.editor.getSelection(),b=a.text;this.initialSelection=b,this.startSelection=a.start,this.firstEndSelection=a.end,this.endSelection=a.end,/\[.*\]\(.*\)/.test(b)&&"["==b[0]&&")"==b.slice(-1)?(this.hypertextInput.val(b.match(/\[.*\]/)[0].substring(1,b.match(/\[.*\]/)[0].length-1)),this.urlInput.val(b.match(/\(.*\)/)[0].substring(1,b.match(/\(.*\)/)[0].length-1))):this.hypertextInput.val(b),this.urlInput.focus()},reset:function(){this.urlInput.val(""),this.hypertextInput.val("")},update:function(){var a;a=""===this.hypertextInput.val()?"["+this.urlInput.val()+"]("+this.urlInput.val()+")":"["+this.hypertextInput.val()+"]("+this.urlInput.val()+")",this.editor.setMarkdown(a,this.startSelection,this.endSelection),this.endSelection=this.startSelection+a.length}},NameManager.prototype={constructor:NameManager,getName:function(){return this.name},isNamed:function(){return this.name?!0:!1},set:function(a){this.name=a,this.windowName.html(a+"&nbsp;-"),this.headTitle.innerHTML=a+" - Mado"}},SaveStateManager.prototype={constructor:SaveStateManager,isSaved:function(){return this.editor.getMarkdown()==this.savedText?!0:!1},save:function(){this.savedText=this.editor.getMarkdown(),this.update()},update:function(){this.saveState.html(this.editor.getMarkdown()!=this.savedText?'<span class="little-icon-unsaved"></span>':"")}},ScrollManager.prototype={constructor:ScrollManager,asyncScroll:function(a){a==this.firstZone[0].id?this.secondZone.scrollTop(this.firstZone.scrollTop()/(this.firstZone[0].scrollHeight-this.firstZone[0].offsetHeight)*(this.secondZone[0].scrollHeight-this.secondZone[0].offsetHeight)):this.firstZone.scrollTop(this.secondZone.scrollTop()/(this.secondZone[0].scrollHeight-this.secondZone[0].offsetHeight)*(this.firstZone[0].scrollHeight-this.firstZone[0].offsetHeight)),this.firstZone.scrollTop()+this.firstZone[0].offsetHeight==this.firstZone[0].scrollHeight?this.atTheBottom=!0:this.atTheBottom=!1},checkZonesHeight:function(){this.lastFirstZoneHeight<this.firstZone[0].scrollHeight&&this.atTheBottom&&(this.firstZone.scrollTop(this.firstZone[0].scrollHeight-this.firstZone[0].offsetHeight),this.secondZone.scrollTop(this.secondZone[0].scrollHeight-this.secondZone[0].offsetHeight)),this.lastFirstZoneHeight=this.firstZone[0].scrollHeight}},StyleManager.prototype={constructor:StyleManager,getStyle:function(){chrome.storage.local.get("style",$.proxy(function(a){if(a.style){switch(a.style){case"home":this.homeRadio[0].checked=!0;break;case"clinic":this.clinicRadio[0].checked=!0;break;case"tramway":this.tramwayRadio[0].checked=!0}this.setStyle(a.style)}else this.homeRadio[0].checked=!0,this.setStyle("home")},this))},setStyle:function(a){for(var b=0;b<document.styleSheets.length;b++)-1!=document.styleSheets.item(b).href.indexOf("css/themes/")&&(-1==document.styleSheets.item(b).href.indexOf(a)?document.styleSheets.item(b).disabled=!0:document.styleSheets.item(b).disabled=!1);chrome.storage.local.set({style:a})}},UrlManager.prototype={constructor:UrlManager
},WebImageManager.prototype={constructor:WebImageManager,apply:function(){""===this.webImageAltInput.val()?(this.webImageAltInput.attr("class","flash"),this.webImageAltInput.focus(),setTimeout($.proxy(function(){this.altInput.removeClass("flash")},this),800)):""===this.webImageUrlInput.val()?(this.webImageUrlInput.attr("class","flash"),this.webImageUrlInput.focus(),this.webImageUrlInput.attr("class","")):(this.webImageDisplayer.addClass("hidden"),this.editor.focus(),this.editor.setSelection(this.endSelection,this.endSelection))},cancel:function(){this.webImageDisplayer.toggleClass("hidden"),this.editor.replaceSelection(this.initialSelection,this.startSelection,this.endSelection,"select")},display:function(){this.webImageDisplayer.toggleClass("hidden");var a=this.editor.getSelection();this.initialSelection=a.text,this.startSelection=a.start,this.firstEndSelection=a.end,this.endSelection=a.end,/!\[.*\]\(.*\)/.test(a.text)&&"!"==a.text[0]&&")"==a.text.slice(-1)?(this.webImageAltInput.val(a.text.match(/!\[.*\]/)[0].substring(2,a.text.match(/!\[.*\]/)[0].length-1)),this.webImageUrlInput.val(a.text.match(/\(.*\)/)[0].substring(1,a.text.match(/\(.*\)/)[0].length-1))):this.webImageAltInput.val(a.text),this.webImageUrlInput.focus()},reset:function(){this.webImageAltInput.val(""),this.webImageUrlInput.val(""),this.initialSelection=this.editor.getMarkdown()},update:function(){var a="!["+this.webImageAltInput.val()+"]("+this.webImageUrlInput.val()+")";this.editor.setMarkdown(a,this.startSelection,this.endSelection),this.endSelection=this.startSelection+a.length}},App.prototype={constructor:App,focusOnEditor:function(){this.editor.focus()},getEditorText:function(){return this.editor.getMarkdown()},getName:function(){return this.editor.getName()},isDocumentNamed:function(){return this.editor.isNamed()},isDocumentSaved:function(){return this.editor.isSaved()},isEntrySaved:function(){return this.saveFileManager.isSaved()},newFile:function(){this.newFileManager.apply()},openFile:function(a){this.openFileManager.open(a)},resetEditor:function(){this.editor.setMarkdown("",0,this.editor.getMarkdown().length)},setDocumentSaved:function(){this.editor.save()},save:function(a){this.saveFileManager.apply(a)},saveAs:function(a){this.saveFileAsManager.apply(a)},setEditorEntry:function(a){this.saveFileManager.setFileToSave(a),this.editor.saveWithName(a.fullPath.substring(a.fullPath.lastIndexOf("/")+1))},setEditorWithEntry:function(a,b){this.saveFileManager.setFileToSave(a),this.editor.setMarkdown(b,0,this.editor.getMarkdown().length),this.editor.saveWithName(a.fullPath.substring(a.fullPath.lastIndexOf("/")+1))}},DnDManager.prototype={constructor:DnDManager,dragenter:function(a){a.stopPropagation(),a.preventDefault(),this.overCount++,this.selector.classList.add("dropping")},dragover:function(a){this.dragMessageAlreadyVisible||(this.documentSection.attr("class","dragging"),this.dragMessageAlreadyVisible=!0),a.stopPropagation(),a.preventDefault()},dragleave:function(a){this.documentSection.attr("class",""),this.dragMessageAlreadyVisible=!1,a.stopPropagation(),a.preventDefault(),--this.overCount<=0&&(this.selector.classList.remove("dropping"),this.overCount=0)},drop:function(a){this.documentSection.attr("class",""),this.dragMessageAlreadyVisible=!1,a.stopPropagation(),a.preventDefault(),this.selector.classList.remove("dropping");var b=a.dataTransfer.items[0].webkitGetAsEntry().fullPath;-1!=this.extensionsAllowed.indexOf(b.substring(b.lastIndexOf("."),b.length))&&this.app.openFile(a.dataTransfer.items[0].webkitGetAsEntry())}},ExportManager.prototype={constructor:ExportManager,apply:function(){var a=marked(this.app.getEditorText()),b=chrome.i18n.getMessage("msgDocument")+".html";this.app.getName()&&(b=this.app.getName().replace(/\.[^\/.]+$/,"")+".html"),chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:b},function(b){b&&b.createWriter(function(b){b.write(new Blob([a],{type:"text/HTML"}))},function(a){console.log(a)})})}},LabelManager.prototype={constructor:LabelManager,displayLabels:function(){$(".nav-label").each(function(){$(this).removeClass("hidden"),$(this).removeAttr("title")});for(var a=0;a<this.topbarButtons.length;a++)$(this.topbarButtons[a][0]).removeAttr("title")},hideLabels:function(){$(".nav-label").each(function(){$(this).addClass("hidden")});for(var a=0;a<this.topbarButtons.length;a++)$(this.topbarButtons[a][0]).attr("title",chrome.i18n.getMessage(this.topbarButtons[a][1]))},init:function(){switch(chrome.i18n.getUILanguage()){case"fr":this.hideLabels();break;default:this.bigWidth=1600,this.lastWidth=chrome.app.window.current().outerBounds.width,chrome.app.window.current().outerBounds.width<this.bigWidth&&this.hideLabels()}},update:function(){chrome.app.window.current().outerBounds.width<this.bigWidth&&this.lastWidth>=this.bigWidth?this.hideLabels():chrome.app.window.current().outerBounds.width>=this.bigWidth&&this.lastWidth<this.bigWidth&&this.displayLabels(),this.lastWidth=chrome.app.window.current().outerBounds.width}},MoreWindowsManager.prototype={constructor:MoreWindowsManager,apply:function(a){var b={outerBounds:{left:Math.round(window.screenX+($(window).width()-498)/2),top:Math.round(window.screenY+($(window).height()-664)/2),width:498,height:664},frame:"none",id:a,resizable:!1};"settings"==a&&(b.alwaysOnTop=!0),chrome.app.window.create("more/"+a+".html",b,function(a){a.outerBounds.setPosition(Math.round(window.screenX+($(window).width()-498)/2),Math.round(window.screenY+($(window).height()-664)/2))}),this.moreDisplayer.toggleClass("hidden")}},NewFileManager.prototype={constructor:NewFileManager,apply:function(){this.app.getEditorText().length>0&&this.app.getEditorText()!=chrome.i18n.getMessage("msgFirstLaunch")||this.app.isDocumentNamed()?chrome.app.window.create("mado.html",{outerBounds:{left:window.screenX+20,top:window.screenY+20,width:window.innerWidth,height:window.innerHeight,minWidth:750,minHeight:330},frame:"none"}):this.app.getEditorText()==chrome.i18n.getMessage("msgFirstLaunch")&&(this.app.resetEditor(),this.app.focusOnEditor())}},OpenFileManager.prototype={constructor:OpenFileManager,apply:function(){chrome.fileSystem.chooseEntry({type:"openFile",accepts:[{extensions:["markdown","md","txt"]}]},$.proxy(function(a){a&&this.open(a)},this))},open:function(a){var b=this;a&&a.file(function(c){var d=new FileReader;d.onload=function(c){b.app.getEditorText().length>0&&b.app.getEditorText()!=chrome.i18n.getMessage("msgFirstLaunch")||b.app.isDocumentNamed()?chrome.storage.local.set({appInitFileEntry:chrome.fileSystem.retainEntry(a),editorInitFileEntry:chrome.fileSystem.retainEntry(a),newFile:chrome.fileSystem.retainEntry(a),newFilePath:a.fullPath},function(){b.app.newFile()}):chrome.storage.local.set({newFile:chrome.fileSystem.retainEntry(a),newFilePath:a.fullPath},function(){b.app.setEditorWithEntry(a,c.target.result)})},d.readAsText(c)},function(a){console.log(a)})}},PrintManager.prototype={constructor:PrintManager},RecentFilesManager.prototype={constructor:RecentFilesManager,checkRecentFile:function(a){if(a<this.recentFiles.length)if(void 0===this.recentFiles[a])b.recentFiles.splice(a,1),b.checkRecentFile(a);else{var b=this;chrome.fileSystem.isRestorable(b.recentFiles[a].id,function(c){c?chrome.fileSystem.restoreEntry(b.recentFiles[a].id,function(c){c?b.checkRecentFile(a+1):(b.recentFiles.splice(a,1),b.checkRecentFile(a))}):(b.recentFiles.splice(a,1),b.checkRecentFile(a))})}else chrome.storage.local.set({recentFiles:this.recentFiles})},displayRecentFiles:function(){var a=this;this.recentFilesContainer.html("");for(var b=this.recentFiles.length-1;b>=0;b--)this.recentFilesContainer.html(this.recentFilesContainer.html()+'<li class="recent-file" id="recent-'+b+'"><div class="recent-file-wrapped"><p>'+this.recentFiles[b].path.substring(this.recentFiles[b].path.lastIndexOf("/")+1)+'</p><div class="delete-recent-button little-icon-delete" id="delete-button-'+b+'"></div></div></li>');$(".recent-file").on("click",function(b){if(!$(b.target).closest("#delete-button-"+this.id.charAt(this.id.length-1)).length){var c=a.recentFiles[this.id.charAt(this.id.length-1)].id;chrome.fileSystem.restoreEntry(c,function(b){a.app.openFile(b),a.recentFilesDisplayer.attr("class","hidden")})}}),$(".delete-recent-button").on("click",function(){a.removeFile(this.id.charAt(this.id.length-1))});var c=document.createElement("li");c.setAttribute("id","recent-files-info"),""!==this.recentFilesContainer.html()?(c.setAttribute("class","clear-all"),$(c).html('<div class="icon-recent-clear"></div><span class="clear-all-text">'+chrome.i18n.getMessage("msgClearAll")+"</span>")):($(c).attr("class"," "),$(c).html(chrome.i18n.getMessage("msgNoRecentDocument"))),this.recentFilesContainer[0].appendChild(c),$(".clear-all").on("click",function(b){a.removeAllFiles(b)})},init:function(){chrome.storage.local.get("recentFiles",$.proxy(function(a){a.recentFiles&&(this.recentFiles=a.recentFiles,this.checkRecentFile(0))},this))},removeAllFiles:function(a){a.stopPropagation();var b=this.recentFiles.length;chrome.storage.local.set({recentFiles:[]},function(){for(var a=b-1;a>=0;a--)$("#recent-"+a).remove(),$("#recent-files-info").attr("class"," "),$("#recent-files-info").html(chrome.i18n.getMessage("msgNoRecentDocument"))})},removeFile:function(a){$("#recent-"+a).attr("class","recent-file deleted"),this.recentFiles.splice(a,1),chrome.storage.local.set({recentFiles:this.recentFiles}),setTimeout(function(){$("#recent-"+a).remove(),0===$("#recent-files-displayer .recent-file").length&&($("#recent-files-info").attr("class"," "),$("#recent-files-info").html("No recent document."))},100)},update:function(){chrome.storage.local.get(["newFile","newFilePath"],$.proxy(function(a){this.recentFiles.push({path:a.newFilePath,id:a.newFile});for(var b=0;b<this.recentFiles.length-1;b++)this.recentFiles[b].path==a.newFilePath&&(this.recentFiles.splice(b,1),b--);for(;this.recentFiles.length>7;)this.recentFiles.shift();chrome.storage.local.set({recentFiles:this.recentFiles})},this))}},SaveFileAsManager.prototype={constructor:SaveFileAsManager,apply:function(a){var b=this;chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:chrome.i18n.getMessage("msgDocument")+".md"},function(c){c&&c.createWriter(function(d){var e=!1;d.onwriteend=function(d){return e?void chrome.storage.local.set({newFile:chrome.fileSystem.retainEntry(c),newFilePath:c.fullPath},function(){b.app.setEditorEntry(c),a&&a()}):(e=!0,void this.truncate(this.position))},d.write(new Blob([b.app.getEditorText()],{type:"plain/text"}))},function(a){console.log(a)})})}},SaveFileManager.prototype={constructor:SaveFileManager,apply:function(a){var b=this;this.fileToSave?this.fileToSave.createWriter(function(c){var d=!1;c.onwriteend=function(c){return d?void chrome.storage.local.set({newFile:chrome.fileSystem.retainEntry(b.fileToSave),newFilePath:b.fileToSave.fullPath},function(){b.app.setDocumentSaved(),a&&a()}):(d=!0,void this.truncate(this.position))},c.write(new Blob([b.app.getEditorText()],{type:"plain/text"}))},function(a){console.log(a)}):this.app.saveAs()},init:function(){var a=this;chrome.storage.local.get("appInitFileEntry",function(b){b.appInitFileEntry&&chrome.fileSystem.restoreEntry(b.appInitFileEntry,function(b){a.fileToSave=b,chrome.storage.local.remove("appInitFileEntry")})})},isSaved:function(){return this.fileToSave?!0:!1},setFileToSave:function(a){this.fileToSave=a}},SwitchManager.prototype={constructor:SwitchManager,activate:function(a){for(var b=0;b<this.switchButtons.length;b++)this.switchButtons[b].attr("id")!=a?this.switchButtons[b].removeClass("activated"):this.switchButtons[b].addClass("activated");switch(a){case this.switchButtons[0].attr("id"):this.workspace.add(this.switchCursor).add(this.madoFooter).attr("class","markdown-view");break;case this.switchButtons[1].attr("id"):this.workspace.add(this.switchCursor).attr("class","normal"),this.madoFooter.attr("class","");break;case this.switchButtons[2].attr("id"):this.workspace.add(this.switchCursor).attr("class","conversion-view"),this.madoFooter.attr("class","")}},"switch":function(a){if(window.innerWidth>1159)for(var b=0;b<this.switchButtons.length;b++)this.switchButtons[b].hasClass("activated")&&("left"==a&&b>0?this.switchButtons[b-1].click():"right"==a&&b<this.switchButtons.length-1&&this.switchButtons[b+1].click(),b=this.switchButtons.length);else"left"==a?this.switchToMD.click():this.switchToHTML.click()}},AppWindow.prototype={constructor:AppWindow,closeWindow:function(){this.app.isDocumentSaved()?this.setNewBounds(function(){chrome.app.window.current().close()}):this.closeDisplayer.attr("class","visible")},init:function(){var a,b=document.createElement("link");b.setAttribute("rel","stylesheet"),b.setAttribute("type","text/css"),a=navigator.appVersion.indexOf("Mac")>-1?"mac":navigator.appVersion.indexOf("Win")>-1?"windows":navigator.appVersion.indexOf("Linux")>-1?"linux":"chromeos",b.setAttribute("href","css/window-frame-"+a+".css"),this.close.attr("class","cta little-icon-"+a.substring(0,3)+"-close"),this.maximize.attr("class","cta little-icon-"+a.substring(0,3)+"-maximize"),this.minimize.attr("class","cta little-icon-"+a.substring(0,3)+"-minimize"),this.head.appendChild(b)},quitCloseWindow:function(){this.setNewBounds(function(){chrome.app.window.current().close()})},saveQuitCloseWindow:function(){this.setNewBounds($.proxy(function(){this.app.isEntrySaved()?this.app.save(function(){chrome.app.window.current().close()}):this.app.saveAs(function(){chrome.app.window.current().close()})},this))},setNewBounds:function(a){chrome.runtime.getBackgroundPage($.proxy(function(b){b.newBounds(chrome.app.window.current().outerBounds),a()},this))}};