/*
 *  This file is part of Stream Recorder  v2.2.2  <https://www.hlsloader.com/>
 *  Note that the source code is copyrighted. We do not grant you the right to modify or distribute it.
 */

const _export_=(()=>{const e=["https://www.hlsloader.com/","https://www.altextension.com/stream/"],DISABLE_ON_YOUTUBE_REGEXP=/^https?:\/\/www\.youtube\.com\//,o={ar:"ar",am:"am",bg:"bg",bn:"bn",ca:"ca",cs:"cs",da:"da",de:"de",el:"el",en:"en",en_AU:"en",en_GB:"en",en_US:"en",es:"es",es_419:"e4",et:"et",fa:"fa",fi:"fi",fil:"fp",fr:"fr",gu:"gu",he:"he",hi:"hi",hr:"hr",hu:"hu",id:"id",it:"it",ja:"ja",kn:"kn",ko:"ko",lt:"lt",lv:"lv",ml:"ml",mr:"mr",ms:"ms",nl:"nl",no:"no",pl:"pl",pt_BR:"br",pt_PT:"pt",ro:"ro",ru:"ru",sk:"sk",sl:"sl",sr:"sr",sv:"sv",sw:"sw",ta:"ta",te:"te",th:"th",tr:"tr",uk:"uk",vi:"vi",zh_CN:"cn",zh_TW:"tw"},t=navigator.userAgent,s=(t.includes("Firefox"),!t.includes("Edg")&&t.includes("Chrome"),t.includes("Mobi"),t.includes("Chrome")&&Number((t.match(/Chrome\/(\d+)/)||[])[1]||0),"message_to_serviceworker"),n=e=>{const o=typeof e,t=("number"===o?e:"string"===o?e.charCodeAt(0):1234)%64;return"color:#"+((t>>4&3)<<22|(t>>2&3)<<14|(3&t)<<6|1048576).toString(16)},r=(e="",o,t,...s)=>[("number"==typeof e?"tabId ":"")+"%c"+e+"%c ["+o+"]%c "+(t="object"==typeof t?JSON.stringify(t):t||""),n(e),"color:#f60b91","",...s],a=t.includes("Chrome")?chrome:"object"==typeof browser&&browser;if(!a)return;a.runtime.getManifest();const c=e[0],l=(e=>o[e?.replace("-","_")]||"en")(a.i18n.getUILanguage());new URL(c+("en"===l?"":l+"/")+"record.html").origin,new RegExp(e.join("|").replace(/http/g,"^http").replace(/\./g,"\\."));const external_functions={help:()=>{console.log("Commands",["log","reset","show","rules"])},log:()=>{a.storage.local.get(["log"]).then((e=>{let o=e.log;o=!o,a.storage.local.set({log:o}),console.log("Logging",o?"ON":"OFF")}),(e=>{console.log(e)}))},show:()=>{(async()=>{const e=await chrome.storage.local.getBytesInUse()+" / "+chrome.storage.local.QUOTA_BYTES;console.log("local storage   : "+e),console.log(await a.storage.local.get().catch((e=>{console.log(e)}))),console.log("session storage : "+await chrome.storage.session.getBytesInUse()+" / "+chrome.storage.session.QUOTA_BYTES),console.log(await a.storage.session.get().catch((e=>{console.log(e)})))})()},rules:()=>{(async()=>{console.log("sessionrules",await a.declarativeNetRequest.getSessionRules().catch((e=>{console.log(e)})))})()},reset:()=>{a.storage.local.clear().catch((e=>{console.log(e)})),a.storage.session.clear().catch((e=>{console.log(e)}))}};Object.assign({},external_functions);a.declarativeNetRequest?.updateSessionRules({removeRuleIds:[2147483647]}).catch(((...e)=>o=>{e.includes("ignorable")||console.log(...e,":",o?.message||"catch unkown")})("updateSessionRules"));const i=(()=>{let e;try{e=localStorage}catch(o){e={}}return e})(),g=i.HLS_LOG||i.hls_log,d={tabId:-1,frameId:-1,sessionId:-1,url:location.href.match(/[^#]+/)[0],origin:location.host?location.origin:location.ancestorOrigins[0]},m=async()=>{const e=location.href;if(DISABLE_ON_YOUTUBE_REGEXP.test(e))return;const o=window.matchMedia("(prefers-color-scheme:dark)").matches,t=await(async e=>(async(e,o,t)=>(g&&e===s&&console.log(...((e="",o,t,...s)=>[("number"==typeof e?"frameId ":"")+"%c"+e+"%c ["+o+"]%c "+(t="object"==typeof t?JSON.stringify(t):t||""),n(e),"color:#f60b91","",...s])(t,"sendMessageToSW",o.cmd.toUpperCase()+":"+JSON.stringify(o.params))),o.type=e,new Promise(((s,n)=>{try{a.runtime.sendMessage(o,(n=>{const c=a.runtime.lastError;g&&c&&console.log(...r(t,"error@"+e+"("+o.cmd+")",JSON.stringify(o.params)+" "+JSON.stringify(c))),s(c?{error:c}:n)}))}catch(e){s({error:e.message})}}))))(s,e,d.frameId))({cmd:"c2b_notify_ready",params:{title:document.title,darkmode:o}});if(t?.accept){const{yourinfo:e}=t;Object.assign(d,e),a.runtime.onMessage.addListener(((e,o,t)=>{g&&console.log(...r("content","onMessage("+e.cmd+")",JSON.stringify(e.params)));const{cmd:s,params:n}=e;if("b2c_check_alive"===s)return t({title:document.title});if("b2c_check_navigation"===s){const{prevUrl:e,currentUrl:o}=n,s=navigation.entries(),r=s.at(-1),a=s.at(-2);let c="none";return navigation.currentEntry?.index===r?.index?r?.url===o&&a?.url===e&&(c="moved"):c="moved",t(c)}if("b2c_console_log"===s){const{message:e}=n;return console.log(e),t()}}))}},u=()=>{document.removeEventListener("DOMContentLoaded",u),window.removeEventListener("load",u),m()};"loading"!==document.readyState?setTimeout(m,1):(document.addEventListener("DOMContentLoaded",u),window.addEventListener("load",u))})();