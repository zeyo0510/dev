const e=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++r)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},t={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const s=e[t],i=t+1<e.length,o=i?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=s>>2,h=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const s=e[n++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[n++];t[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],i=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==i||null==o||null==a)throw Error();const c=s<<2|i>>4;if(r.push(c),64!==o){const e=i<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},n=function(n){return function(n){const r=e(n);return t.encodeByteArray(r,!0)}(n).replace(/\./g,"")};class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function r(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r=t||"demo-project",s=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[n(JSON.stringify({alg:"none",type:"JWT"})),n(JSON.stringify(o)),""].join(".")}function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function i(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())}function o(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function a(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function c(){const e=s();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function u(){return!function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class FirebaseError extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],i=s?function(e,t){return e.replace(h,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new FirebaseError(r,o,n)}}const h=/\{\$([^}]+)}/g;function l(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const s of n){if(!r.includes(s))return!1;const n=e[s],i=t[s];if(d(n)&&d(i)){if(!l(n,i))return!1}else if(n!==i)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function d(e){return null!==e&&"object"==typeof e}function f(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function p(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function m(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class ObserverProxy{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=g),void 0===r.error&&(r.error=g),void 0===r.complete&&(r.complete=g);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function g(){}function y(e){return e&&e._delegate?e._delegate:e}class Component{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}class Provider{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Deferred;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:"[DEFAULT]"})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,"[DEFAULT]"===r?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:"[DEFAULT]":e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ComponentContainer{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Provider(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const v=[];var w;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(w||(w={}));const I={debug:w.DEBUG,verbose:w.VERBOSE,info:w.INFO,warn:w.WARN,error:w.ERROR,silent:w.SILENT},_=w.INFO,b={[w.DEBUG]:"log",[w.VERBOSE]:"log",[w.INFO]:"info",[w.WARN]:"warn",[w.ERROR]:"error"},T=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),s=b[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)};class Logger{constructor(e){this.name=e,this._logLevel=_,this._logHandler=T,this._userLogHandler=null,v.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in w))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?I[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,w.DEBUG,...e),this._logHandler(this,w.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,w.VERBOSE,...e),this._logHandler(this,w.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,w.INFO,...e),this._logHandler(this,w.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,w.WARN,...e),this._logHandler(this,w.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,w.ERROR,...e),this._logHandler(this,w.ERROR,...e)}}class PlatformLoggerServiceImpl{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const E="@firebase/app",S=new Logger("@firebase/app"),A={[E]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},k=new Map,C=new Map;function R(e,t){try{e.container.addComponent(t)}catch(n){S.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function N(e){const t=e.name;if(C.has(t))return S.debug(`There were multiple attempts to register component ${t}.`),!1;C.set(t,e);for(const t of k.values())R(t,e);return!0}function D(e,t){return e.container.getProvider(t)}function O(e,t,n="[DEFAULT]"){D(e,t).clearInstance(n)}const P=new ErrorFactory("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class FirebaseAppImpl{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Component("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw P.create("app-deleted",{appName:this._name})}}function L(e="[DEFAULT]"){const t=k.get(e);if(!t)throw P.create("no-app",{appName:e});return t}function x(e,t,n){var r;let s=null!==(r=A[e])&&void 0!==r?r:e;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const e=[`Unable to register library "${s}" with version "${t}":`];return i&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void S.warn(e.join(" "))}N(new Component(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}var M;M="",N(new Component("platform-logger",(e=>new PlatformLoggerServiceImpl(e)),"PRIVATE")),x(E,"0.7.11",M),x(E,"0.7.11","esm2017"),x("fire-js","");x("firebase","9.6.1","app");var U=Object.freeze({__proto__:null,FirebaseError,SDK_VERSION:"9.6.1",_DEFAULT_ENTRY_NAME:"[DEFAULT]",_addComponent:R,_addOrOverwriteComponent:function(e,t){e.container.addOrOverwriteComponent(t)},_apps:k,_clearComponents:function(){C.clear()},_components:C,_getProvider:D,_registerComponent:N,_removeServiceInstance:O,deleteApp:async function(e){const t=e.name;k.has(t)&&(k.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)},getApp:L,getApps:function(){return Array.from(k.values())},initializeApp:function(e,t={}){if("object"!=typeof t){t={name:t}}const n=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw P.create("bad-app-name",{appName:String(r)});const s=k.get(r);if(s){if(l(e,s.options)&&l(n,s.config))return s;throw P.create("duplicate-app",{appName:r})}const i=new ComponentContainer(r);for(const e of C.values())i.addComponent(e);const o=new FirebaseAppImpl(e,n,i);return k.set(r,o),o},onLog:function(e,t){if(null!==e&&"function"!=typeof e)throw P.create("invalid-log-argument");!function(e,t){for(const n of v){let r=null;t&&t.level&&(r=I[t.level]),n.userLogHandler=null===e?null:(t,n,...s)=>{const i=s.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:w[n].toLowerCase(),message:i,args:s,type:t.name})}}}(e,t)},registerVersion:x,setLogLevel:function(e){var t;t=e,v.forEach((e=>{e.setLogLevel(t)}))}});function F(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n}function V(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const q=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},$=V,B=new ErrorFactory("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),z=new Logger("@firebase/auth");function H(e,...t){z.logLevel<=w.ERROR&&z.error(`Auth (9.6.1): ${e}`,...t)}function K(e,...t){throw X(e,...t)}function W(e,...t){return X(e,...t)}function Q(e,t,n){const r=Object.assign(Object.assign({},$()),{[t]:n});return new ErrorFactory("auth","Firebase",r).create(t,{appName:e.name})}function J(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&K(e,"argument-error"),Q(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function X(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return B.create(e,...t)}function Y(e,t,...n){if(!e)throw X(t,...n)}function Z(e){const t="INTERNAL ASSERTION FAILED: "+e;throw H(t),new Error(t)}function te(e,t){e||Z(t)}const ie=new Map;function he(e){te(e instanceof Function,"Expected a class definition");let t=ie.get(e);return t?(te(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ie.set(e,t),t)}function de(e,t){const n=D(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(l(n.getOptions(),null!=t?t:{}))return e;K(e,"already-initialized")}return n.initialize({options:t})}function fe(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function pe(){return"http:"===me()||"https:"===me()}function me(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Delay{constructor(e,t){this.shortDelay=e,this.longDelay=t,te(t>e,"Short delay should be less than long delay!"),this.isMobile=i()||a()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(pe()||o()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function ge(e,t){te(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class FetchProvider{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void Z("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void Z("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void Z("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ye={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},ve=new Delay(3e4,6e4);function we(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Ie(e,t,n,r,s={}){return be(e,s,(async()=>{let s={},i={};r&&("GET"===t?i=r:s={body:JSON.stringify(r)});const o=f(Object.assign({key:e.config.apiKey},i)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),FetchProvider.fetch()(Ee(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},s))}))}async function be(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},ye),t);try{const t=new NetworkTimeout(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw Se(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const t=s.ok?i.errorMessage:i.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Se(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw Se(e,"email-already-in-use",i);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Q(e,a,o);K(e,a)}}catch(t){if(t instanceof FirebaseError)throw t;K(e,"network-request-failed")}}async function Te(e,t,n,r,s={}){const i=await Ie(e,t,n,r,s);return"mfaPendingCredential"in i&&K(e,"multi-factor-auth-required",{_serverResponse:i}),i}function Ee(e,t,n,r){const s=`${t}${n}?${r}`;return e.config.emulator?ge(e.config,s):`${e.config.apiScheme}://${s}`}class NetworkTimeout{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(W(this.auth,"timeout"))),ve.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Se(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=W(e,t,r);return s.customData._tokenResponse=n,s}function Ae(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function ke(e,t=!1){const n=y(e),r=await n.getIdToken(t),s=Re(r);Y(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i="object"==typeof s.firebase?s.firebase:void 0,o=null==i?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Ae(Ce(s.auth_time)),issuedAtTime:Ae(Ce(s.iat)),expirationTime:Ae(Ce(s.exp)),signInProvider:o||null,signInSecondFactor:(null==i?void 0:i.sign_in_second_factor)||null}}function Ce(e){return 1e3*Number(e)}function Re(e){const[n,r,s]=e.split(".");if(void 0===n||void 0===r||void 0===s)return H("JWT malformed, contained fewer than 3 sections"),null;try{const e=function(e){try{return t.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(r);return e?JSON.parse(e):(H("Failed to decode base64 JWT payload"),null)}catch(e){return H("Caught error parsing JWT payload as JSON",e),null}}async function Ne(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof FirebaseError&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class ProactiveRefresh{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class UserMetadata{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ae(this.lastLoginAt),this.creationTime=Ae(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function De(e){var t;const n=e.auth,r=await e.getIdToken(),s=await Ne(e,async function(e,t){return Ie(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));Y(null==s?void 0:s.users.length,n,"internal-error");const i=s.users[0];e._notifyReloadListener(i);const o=(null===(t=i.providerUserInfo)||void 0===t?void 0:t.length)?i.providerUserInfo.map((e=>{var{providerId:t}=e,n=F(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const h=e.isAnonymous,l=!(e.email&&i.passwordHash||(null==a?void 0:a.length)),d=!!h&&l,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new UserMetadata(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(e,f)}async function Oe(e){const t=y(e);await De(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}class StsTokenManager{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Y(e.idToken,"internal-error"),Y(void 0!==e.idToken,"internal-error"),Y(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=Re(e);return Y(t,"internal-error"),Y(void 0!==t.exp,"internal-error"),Y(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Y(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await be(e,{},(async()=>{const n=f({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,i=Ee(e,r,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",FetchProvider.fetch()(i,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:s}=t,i=new StsTokenManager;return n&&(Y("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(Y("string"==typeof r,"internal-error",{appName:e}),i.accessToken=r),s&&(Y("number"==typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new StsTokenManager,this.toJSON())}_performRefresh(){return Z("not implemented")}}function Pe(e,t){Y("string"==typeof e||void 0===e,"internal-error",{appName:t})}class UserImpl{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,s=F(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new ProactiveRefresh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.metadata=new UserMetadata(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Ne(this,this.stsTokenManager.getToken(this.auth,e));return Y(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return ke(this,e)}reload(){return Oe(this)}_assign(e){this!==e&&(Y(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new UserImpl(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){Y(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await De(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Ne(this,async function(e,t){return Ie(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,s,i,o,a,c,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,l=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,f=null!==(i=t.photoURL)&&void 0!==i?i:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:_,stsTokenManager:b}=t;Y(v&&b,e,"internal-error");const T=StsTokenManager.fromJSON(this.name,b);Y("string"==typeof v,e,"internal-error"),Pe(h,e.name),Pe(l,e.name),Y("boolean"==typeof w,e,"internal-error"),Y("boolean"==typeof I,e,"internal-error"),Pe(d,e.name),Pe(f,e.name),Pe(p,e.name),Pe(m,e.name),Pe(g,e.name),Pe(y,e.name);const E=new UserImpl({uid:v,auth:e,email:l,emailVerified:w,displayName:h,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return _&&Array.isArray(_)&&(E.providerData=_.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const r=new StsTokenManager;r.updateFromServerResponse(t);const s=new UserImpl({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await De(s),s}}class InMemoryPersistence{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}InMemoryPersistence.type="NONE";const xe=InMemoryPersistence;function Me(e,t,n){return`firebase:${e}:${t}:${n}`}class PersistenceUserManager{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:s}=this.auth;this.fullUserKey=Me(this.userKey,r.apiKey,s),this.fullPersistenceKey=Me("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?UserImpl._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new PersistenceUserManager(he(xe),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let s=r[0]||he(xe);const i=Me(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(i);if(t){const r=UserImpl._fromJSON(e,t);n!==s&&(o=r),s=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(i,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==s)try{await e._remove(i)}catch(e){}}))),new PersistenceUserManager(s,e,n)):new PersistenceUserManager(s,e,n)}}function Ue(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Ke(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Fe(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Qe(t))return"Blackberry";if(Ye(t))return"Webos";if(Ve(t))return"Safari";if((t.includes("chrome/")||ze(t))&&!t.includes("edge/"))return"Chrome";if(We(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Fe(e=s()){return/firefox\//i.test(e)}function Ve(e=s()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ze(e=s()){return/crios\//i.test(e)}function Ke(e=s()){return/iemobile/i.test(e)}function We(e=s()){return/android/i.test(e)}function Qe(e=s()){return/blackberry/i.test(e)}function Ye(e=s()){return/webos/i.test(e)}function Ze(e=s()){return/iphone|ipad|ipod/i.test(e)}function tt(e=s()){return Ze(e)||We(e)||Ye(e)||Qe(e)||/windows phone/i.test(e)||Ke(e)}function nt(e,t=[]){let n;switch(e){case"Browser":n=Ue(s());break;case"Worker":n=`${Ue(s())}-${e}`;break;default:n=e}return`${n}/JsCore/9.6.1/${t.length?t.join(","):"FirebaseCore-web"}`}class AuthImpl{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Subscription(this),this.idTokenSubscription=new Subscription(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=B,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=he(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await PersistenceUserManager.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e):void 0}async initializeCurrentUser(e){var t;let n=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==n?void 0:n._redirectEventId,i=await this.tryRedirectSignIn(e);r&&r!==s||!(null==i?void 0:i.user)||(n=i.user)}return n?n._redirectEventId?(Y(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)):this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await De(e)}catch(e){if("auth/network-request-failed"!==e.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?y(e):null;return t&&Y(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&Y(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(he(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ErrorFactory("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&he(e)||this._popupRedirectResolver;Y(t,this,"argument-error"),this.redirectPersistenceManager=await PersistenceUserManager.create(this,[he(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t),i=this._isInitialized?Promise.resolve():this._initializationPromise;return Y(i,this,"internal-error"),i.then((()=>s(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Y(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};return this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId),e}}function rt(e){return y(e)}class Subscription{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new ObserverProxy(e,t);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Y(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function it(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ot(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class AuthCredential{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Z("not implemented")}_getIdTokenResponse(e){return Z("not implemented")}_linkToIdToken(e,t){return Z("not implemented")}_getReauthenticationResolver(e){return Z("not implemented")}}async function ut(e,t){return Ie(e,"POST","/v1/accounts:resetPassword",we(e,t))}async function ht(e,t){return Ie(e,"POST","/v1/accounts:update",t)}async function lt(e,t){return Ie(e,"POST","/v1/accounts:sendOobCode",we(e,t))}class EmailAuthCredential extends AuthCredential{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new EmailAuthCredential(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new EmailAuthCredential(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return Te(e,"POST","/v1/accounts:signInWithPassword",we(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Te(e,"POST","/v1/accounts:signInWithEmailLink",we(e,t))}(e,{email:this._email,oobCode:this._password});default:K(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ht(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Te(e,"POST","/v1/accounts:signInWithEmailLink",we(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:K(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function pt(e,t){return Te(e,"POST","/v1/accounts:signInWithIdp",we(e,t))}class OAuthCredential extends AuthCredential{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new OAuthCredential(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):K("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,s=F(t,["providerId","signInMethod"]);if(!n||!r)return null;const i=new OAuthCredential(n,r);return i.idToken=s.idToken||void 0,i.accessToken=s.accessToken||void 0,i.secret=s.secret,i.nonce=s.nonce,i.pendingToken=s.pendingToken||null,i}_getIdTokenResponse(e){return pt(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,pt(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,pt(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=f(t)}return e}}const gt={USER_NOT_FOUND:"user-not-found"};class PhoneAuthCredential extends AuthCredential{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new PhoneAuthCredential({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new PhoneAuthCredential({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Te(e,"POST","/v1/accounts:signInWithPhoneNumber",we(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Te(e,"POST","/v1/accounts:signInWithPhoneNumber",we(e,t));if(n.temporaryProof)throw Se(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Te(e,"POST","/v1/accounts:signInWithPhoneNumber",we(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),gt)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}=e;return n||t||r||s?new PhoneAuthCredential({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}):null}}class ActionCodeURL{constructor(e){var t,n,r,s,i,o;const a=p(m(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Y(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(i=a.languageCode)&&void 0!==i?i:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=p(m(e)).link,n=t?p(m(t)).deep_link_id:null,r=p(m(e)).deep_link_id;return(r?p(m(r)).link:null)||r||n||t||e}(e);try{return new ActionCodeURL(t)}catch(e){return null}}}class EmailAuthProvider{constructor(){this.providerId=EmailAuthProvider.PROVIDER_ID}static credential(e,t){return EmailAuthCredential._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ActionCodeURL.parseLink(t);return Y(n,"argument-error"),EmailAuthCredential._fromEmailAndCode(e,n.code,n.tenantId)}}EmailAuthProvider.PROVIDER_ID="password",EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD="password",EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class FederatedAuthProvider{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class BaseOAuthProvider extends FederatedAuthProvider{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class OAuthProvider extends BaseOAuthProvider{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return Y("providerId"in t&&"signInMethod"in t,"argument-error"),OAuthCredential._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Y(e.idToken||e.accessToken,"argument-error"),OAuthCredential._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return OAuthProvider.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return OAuthProvider.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:s,nonce:i,providerId:o}=e;if(!(n||r||t||s))return null;if(!o)return null;try{return new OAuthProvider(o)._credential({idToken:t,accessToken:n,nonce:i,pendingToken:s})}catch(e){return null}}}class FacebookAuthProvider extends BaseOAuthProvider{constructor(){super("facebook.com")}static credential(e){return OAuthCredential._fromParams({providerId:FacebookAuthProvider.PROVIDER_ID,signInMethod:FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return FacebookAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return FacebookAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return FacebookAuthProvider.credential(e.oauthAccessToken)}catch(e){return null}}}FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD="facebook.com",FacebookAuthProvider.PROVIDER_ID="facebook.com";class GoogleAuthProvider extends BaseOAuthProvider{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return OAuthCredential._fromParams({providerId:GoogleAuthProvider.PROVIDER_ID,signInMethod:GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return GoogleAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return GoogleAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return GoogleAuthProvider.credential(t,n)}catch(e){return null}}}GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD="google.com",GoogleAuthProvider.PROVIDER_ID="google.com";class GithubAuthProvider extends BaseOAuthProvider{constructor(){super("github.com")}static credential(e){return OAuthCredential._fromParams({providerId:GithubAuthProvider.PROVIDER_ID,signInMethod:GithubAuthProvider.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return GithubAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return GithubAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return GithubAuthProvider.credential(e.oauthAccessToken)}catch(e){return null}}}GithubAuthProvider.GITHUB_SIGN_IN_METHOD="github.com",GithubAuthProvider.PROVIDER_ID="github.com";class SAMLAuthCredential extends AuthCredential{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return pt(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,pt(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,pt(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:s}=t;return n&&r&&s&&n===r?new SAMLAuthCredential(n,s):null}static _create(e,t){return new SAMLAuthCredential(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class SAMLAuthProvider extends FederatedAuthProvider{constructor(e){Y(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return SAMLAuthProvider.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return SAMLAuthProvider.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=SAMLAuthCredential.fromJSON(e);return Y(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return SAMLAuthCredential._create(n,t)}catch(e){return null}}}class TwitterAuthProvider extends BaseOAuthProvider{constructor(){super("twitter.com")}static credential(e,t){return OAuthCredential._fromParams({providerId:TwitterAuthProvider.PROVIDER_ID,signInMethod:TwitterAuthProvider.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return TwitterAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return TwitterAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return TwitterAuthProvider.credential(t,n)}catch(e){return null}}}async function vt(e,t){return Te(e,"POST","/v1/accounts:signUp",we(e,t))}TwitterAuthProvider.TWITTER_SIGN_IN_METHOD="twitter.com",TwitterAuthProvider.PROVIDER_ID="twitter.com";class UserCredentialImpl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const s=await UserImpl._fromIdTokenResponse(e,n,r),i=wt(n);return new UserCredentialImpl({user:s,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=wt(n);return new UserCredentialImpl({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function wt(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class MultiFactorError extends FirebaseError{constructor(e,t,n,r){var s;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,MultiFactorError.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new MultiFactorError(e,t,n,r)}}function It(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw MultiFactorError._fromErrorAndOperation(e,n,t,r);throw n}))}function bt(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function Tt(e,t,n=!1){const r=await Ne(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return UserCredentialImpl._forOperation(e,"link",r)}async function Et(e,t,n){await De(t);const r=!1===e?"provider-already-linked":"no-such-provider";Y(bt(t.providerData).has(n)===e,t.auth,r)}async function At(e,t,n=!1){const{auth:r}=e,s="reauthenticate";try{const i=await Ne(e,It(r,s,t,e),n);Y(i.idToken,r,"internal-error");const o=Re(i.idToken);Y(o,r,"internal-error");const{sub:a}=o;return Y(e.uid===a,r,"user-mismatch"),UserCredentialImpl._forOperation(e,s,i)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&K(r,"user-mismatch"),e}}async function kt(e,t,n=!1){const r="signIn",s=await It(e,r,t),i=await UserCredentialImpl._fromIdTokenResponse(e,r,s);return n||await e._updateCurrentUser(i.user),i}async function Ct(e,t){return kt(rt(e),t)}async function Rt(e,t){const n=y(e);return await Et(!1,n,t.providerId),Tt(n,t)}async function Nt(e,t){return At(y(e),t)}class MultiFactorInfoImpl{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?PhoneMultiFactorInfo._fromServerResponse(e,t):K(e,"internal-error")}}class PhoneMultiFactorInfo extends MultiFactorInfoImpl{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new PhoneMultiFactorInfo(t)}}function Dt(e,t,n){var r;Y((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),Y(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(Y(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(Y(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Ot(e,t){const n=y(e),r=await ut(n,{oobCode:t}),s=r.requestType;switch(Y(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Y(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Y(r.mfaInfo,n,"internal-error");default:Y(r.email,n,"internal-error")}let i=null;return r.mfaInfo&&(i=MultiFactorInfoImpl._fromServerResponse(rt(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function Pt(e,t,n){const{auth:r}=e,s={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(s.email=t),n&&(s.password=n);const i=await Ne(e,ht(r,s));await e._updateTokensIfNecessary(i,!0)}class GenericAdditionalUserInfo{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class FederatedAdditionalUserInfoWithUsername extends GenericAdditionalUserInfo{constructor(e,t,n,r){super(e,t,n),this.username=r}}class FacebookAdditionalUserInfo extends GenericAdditionalUserInfo{constructor(e,t){super(e,"facebook.com",t)}}class GithubAdditionalUserInfo extends FederatedAdditionalUserInfoWithUsername{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class GoogleAdditionalUserInfo extends GenericAdditionalUserInfo{constructor(e,t){super(e,"google.com",t)}}class TwitterAdditionalUserInfo extends FederatedAdditionalUserInfoWithUsername{constructor(e,t,n){super(e,"twitter.com",t,n)}}class MultiFactorSessionImpl{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new MultiFactorSessionImpl("enroll",e)}static _fromMfaPendingCredential(e){return new MultiFactorSessionImpl("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return MultiFactorSessionImpl._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return MultiFactorSessionImpl._fromIdtoken(e.multiFactorSession.idToken)}return null}}class MultiFactorResolverImpl{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=rt(e),r=t.customData._serverResponse,s=(r.mfaInfo||[]).map((e=>MultiFactorInfoImpl._fromServerResponse(n,e)));Y(r.mfaPendingCredential,n,"internal-error");const i=MultiFactorSessionImpl._fromMfaPendingCredential(r.mfaPendingCredential);return new MultiFactorResolverImpl(i,s,(async e=>{const s=await e._process(n,i);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:s.idToken,refreshToken:s.refreshToken});switch(t.operationType){case"signIn":const e=await UserCredentialImpl._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return Y(t.user,n,"internal-error"),UserCredentialImpl._forOperation(t.user,t.operationType,o);default:K(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class MultiFactorUserImpl{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>MultiFactorInfoImpl._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new MultiFactorUserImpl(e)}async getSession(){return MultiFactorSessionImpl._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e,r=await this.getSession(),s=await Ne(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(s),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken(),r=await Ne(this.user,(s=this.user.auth,i={idToken:n,mfaEnrollmentId:t},Ie(s,"POST","/v2/accounts/mfaEnrollment:withdraw",we(s,i))));var s,i;this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==e.code)throw e}}}const Lt=new WeakMap;class BrowserPersistenceClass{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem("__sak","1"),this.storage.removeItem("__sak"),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class BrowserLocalPersistence extends BrowserPersistenceClass{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=s();return Ve(e)||Ze(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=tt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);c()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}BrowserLocalPersistence.type="LOCAL";const xt=BrowserLocalPersistence;class BrowserSessionPersistence extends BrowserPersistenceClass{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}BrowserSessionPersistence.type="SESSION";const Mt=BrowserSessionPersistence;class Receiver{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Receiver(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:s}=t.data,i=this.handlersMap[r];if(!(null==i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(i).map((async e=>e(t.origin,s))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Ut(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Receiver.receivers=[];class Sender{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,i;return new Promise(((o,a)=>{const c=Ut("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);i={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(u),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{i&&this.removeMessageHandler(i)}))}}function Ft(){return window}function Vt(){return void 0!==Ft().WorkerGlobalScope&&"function"==typeof Ft().importScripts}const qt="firebaseLocalStorageDb";class DBPromise{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function $t(e,t){return e.transaction(["firebaseLocalStorage"],t?"readwrite":"readonly").objectStore("firebaseLocalStorage")}function Bt(){const e=indexedDB.open(qt,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains("firebaseLocalStorage")?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(qt);return new DBPromise(e).toPromise()}(),t(await Bt()))}))}))}async function zt(e,t,n){const r=$t(e,!0).put({fbase_key:t,value:n});return new DBPromise(r).toPromise()}function Ht(e,t){const n=$t(e,!0).delete(t);return new DBPromise(n).toPromise()}class IndexedDBLocalPersistence{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Bt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Vt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Receiver._getInstance(Vt()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Sender(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Bt();return await zt(e,"__sak","1"),await Ht(e,"__sak"),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>zt(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=$t(e,!1).get(t),r=await new DBPromise(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Ht(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=$t(e,!1).getAll();return new DBPromise(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:s}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}IndexedDBLocalPersistence.type="LOCAL";const Kt=IndexedDBLocalPersistence;function Qt(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=W("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}))}function Jt(e){return`__${e}${Math.floor(1e6*Math.random())}`}class MockReCaptcha{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new MockWidget(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||1e12;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||1e12;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||1e12;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class MockWidget{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;Y(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Xt=Jt("rcb"),Yt=new Delay(3e4,6e4);class ReCaptchaLoaderImpl{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!Ft().grecaptcha}load(e,t=""){return Y(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(Ft().grecaptcha):new Promise(((n,r)=>{const s=Ft().setTimeout((()=>{r(W(e,"network-request-failed"))}),Yt.get());Ft()[Xt]=()=>{Ft().clearTimeout(s),delete Ft()[Xt];const i=Ft().grecaptcha;if(!i)return void r(W(e,"internal-error"));const o=i.render;i.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(i)};Qt(`https://www.google.com/recaptcha/api.js??${f({onload:Xt,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(s),r(W(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!Ft().grecaptcha&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class MockReCaptchaLoaderImpl{async load(e){return new MockReCaptcha(e)}clearedOneInstance(){}}const en={theme:"light",type:"image"};class ConfirmationResultImpl{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=PhoneAuthCredential._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function tn(e,t,n){var r;const s=await n.verify();try{let i;if(Y("string"==typeof s,e,"argument-error"),Y("recaptcha"===n.type,e,"argument-error"),i="string"==typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){Y("enroll"===t.type,e,"internal-error");return(await function(e,t){return Ie(e,"POST","/v2/accounts/mfaEnrollment:start",we(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo}{Y("signin"===t.type,e,"internal-error");const n=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;Y(n,e,"missing-multi-factor-info");return(await function(e,t){return Ie(e,"POST","/v2/accounts/mfaSignIn:start",we(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Ie(e,"POST","/v1/accounts:sendVerificationCode",we(e,t))}(e,{phoneNumber:i.phoneNumber,recaptchaToken:s});return t}}finally{n._reset()}}class PhoneAuthProvider{constructor(e){this.providerId=PhoneAuthProvider.PROVIDER_ID,this.auth=rt(e)}verifyPhoneNumber(e,t){return tn(this.auth,e,y(t))}static credential(e,t){return PhoneAuthCredential._fromVerification(e,t)}static credentialFromResult(e){const t=e;return PhoneAuthProvider.credentialFromTaggedObject(t)}static credentialFromError(e){return PhoneAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?PhoneAuthCredential._fromTokenResponse(t,n):null}}function nn(e,t){return t?he(t):(Y(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}PhoneAuthProvider.PROVIDER_ID="phone",PhoneAuthProvider.PHONE_SIGN_IN_METHOD="phone";class IdpCredential extends AuthCredential{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return pt(e,this._buildIdpRequest())}_linkToIdToken(e,t){return pt(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return pt(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function sn(e){return kt(e.auth,new IdpCredential(e),e.bypassAuthState)}function an(e){const{auth:t,user:n}=e;return Y(n,t,"internal-error"),At(n,new IdpCredential(e),e.bypassAuthState)}async function cn(e){const{auth:t,user:n}=e;return Y(n,t,"internal-error"),Tt(n,new IdpCredential(e),e.bypassAuthState)}class AbstractPopupRedirectOperation{constructor(e,t,n,r,s=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:s,error:i,type:o}=e;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return sn;case"linkViaPopup":case"linkViaRedirect":return cn;case"reauthViaPopup":case"reauthViaRedirect":return an;default:K(this.auth,"internal-error")}}resolve(e){te(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){te(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const un=new Delay(2e3,1e4);class PopupOperation extends AbstractPopupRedirectOperation{constructor(e,t,n,r,s){super(e,t,r,s),this.provider=n,this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction&&PopupOperation.currentPopupAction.cancel(),PopupOperation.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Y(e,this.auth,"internal-error"),e}async onExecution(){te(1===this.filter.length,"Popup operations only handle one event");const e=Ut();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(W(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(W(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(W(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,un.get())};e()}}PopupOperation.currentPopupAction=null;const dn=new Map;class RedirectAction extends AbstractPopupRedirectOperation{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=dn.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=wn(t),r=vn(e);if(!await r._isAvailable())return!1;const s="true"===await r._get(n);return await r._remove(n),s}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}dn.set(this.auth._key(),e)}return this.bypassAuthState||dn.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function mn(e,t){return vn(e)._set(wn(t),"true")}function vn(e){return he(e._redirectPersistence)}function wn(e){return Me("pendingRedirect",e.config.apiKey,e.name)}async function In(e,t,n=!1){const r=rt(e),s=nn(r,t),i=new RedirectAction(r,s,n),o=await i.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function _n(e){const t=Ut(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class AuthEventManager{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Sn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Sn(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(W(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(bn(e))}saveEventToCache(e){this.cachedEventUids.add(bn(e)),this.lastProcessedEventTime=Date.now()}}function bn(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Sn({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const An=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Cn=/^https?/;async function Rn(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Ie(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Dn(e))return}catch(e){}K(e,"unauthorized-domain")}function Dn(e){const t=fe(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===r}if(!Cn.test(n))return!1;if(An.test(e))return r===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const Pn=new Delay(3e4,6e4);function Ln(){const e=Ft().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Un=null;function Vn(e){return Un=Un||function(e){return new Promise(((t,n)=>{var r,s,i;function o(){Ln(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Ln(),n(W(e,"network-request-failed"))},timeout:Pn.get()})}if(null===(s=null===(r=Ft().gapi)||void 0===r?void 0:r.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(i=Ft().gapi)||void 0===i?void 0:i.load)){const t=Jt("iframefcb");return Ft()[t]=()=>{gapi.load?o():n(W(e,"network-request-failed"))},Qt(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Un=null,e}))}(e),Un}const jn=new Delay(5e3,15e3),qn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Bn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Gn(e){const t=e.config;Y(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?ge(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:"9.6.1"},s=Bn.get(e.config.apiHost);s&&(r.eid=s);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${f(r).slice(1)}`}const zn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class AuthPopup{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Hn(e,t,n,r=500,i=600){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},zn),{width:r.toString(),height:i.toString(),top:o,left:a}),h=s().toLowerCase();n&&(c=ze(h)?"_blank":n),Fe(h)&&(t=t||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=s()){var t;return Ze(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(h)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new AuthPopup(null);const d=window.open(t||"",c,l);Y(d,e,"popup-blocked");try{d.focus()}catch(e){}return new AuthPopup(d)}function Wn(e,t,n,r,s,i){Y(e.config.authDomain,e,"auth-domain-config-required"),Y(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:"9.6.1",eventId:s};if(t instanceof FederatedAuthProvider){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(i||{}))o[e]=t}if(t instanceof BaseOAuthProvider){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/__/auth/handler`;return ge(e,"emulator/auth/handler")}(e)}?${f(a).slice(1)}`}const Qn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Mt,this._completeRedirectFn=In}async _openPopup(e,t,n,r){var s;te(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");return Hn(e,Wn(e,t,n,fe(),r),Ut())}async _openRedirect(e,t,n,r){var s;return await this._originValidation(e),s=Wn(e,t,n,fe(),r),Ft().location.href=s,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(te(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Vn(e),n=Ft().gapi;return Y(n,e,"internal-error"),t.open({where:document.body,url:Gn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:qn,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const s=W(e,"network-request-failed"),i=Ft().setTimeout((()=>{r(s)}),jn.get());function o(){Ft().clearTimeout(i),n(t)}t.ping(o).then(o,(()=>{r(s)}))}))))}(e),n=new AuthEventManager(e);return t.register("authEvent",(t=>{Y(null==t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send("webStorageSupport",{type:"webStorageSupport"},(n=>{var r;const s=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==s&&t(!!s),K(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Rn(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return tt()||Ve()||Ze()}};class PhoneMultiFactorAssertionImpl extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return Z("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new PhoneMultiFactorAssertionImpl(e)}_finalizeEnroll(e,t,n){return function(e,t){return Ie(e,"POST","/v2/accounts/mfaEnrollment:finalize",we(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return Ie(e,"POST","/v2/accounts/mfaSignIn:finalize",we(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class PhoneMultiFactorGenerator{constructor(){}static assertion(e){return PhoneMultiFactorAssertionImpl._fromCredential(e)}}PhoneMultiFactorGenerator.FACTOR_ID="phone";var Jn;class AuthInterop{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Y(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}Jn="Browser",N(new Component("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),{apiKey:r,authDomain:s}=n.options;return(e=>{Y(r&&!r.includes(":"),"invalid-api-key",{appName:e.name}),Y(!(null==s?void 0:s.includes(":")),"argument-error",{appName:e.name});const n={apiKey:r,authDomain:s,clientPlatform:Jn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nt(Jn)},i=new AuthImpl(e,n);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(he);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(i,t),i})(n)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),N(new Component("auth-internal",(e=>(e=>new AuthInterop(e))(rt(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),x("@firebase/auth","0.19.4",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Jn)),x("@firebase/auth","0.19.4","esm2017");var Xn,Yn=Object.freeze({__proto__:null,ActionCodeOperation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"},ActionCodeURL,AuthCredential,AuthErrorCodes:{ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized"},EmailAuthCredential,EmailAuthProvider,FacebookAuthProvider,FactorId:{PHONE:"phone"},GithubAuthProvider,GoogleAuthProvider,OAuthCredential,OAuthProvider,OperationType:{LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},PhoneAuthCredential,PhoneAuthProvider,PhoneMultiFactorGenerator,ProviderId:{FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},RecaptchaVerifier:class{constructor(e,t=Object.assign({},en),n){this.parameters=t,this.type="recaptcha",this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=rt(n),this.isInvisible="invisible"===this.parameters.size,Y("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof e?document.getElementById(e):e;Y(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new MockReCaptchaLoaderImpl:new ReCaptchaLoaderImpl,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){Y(!this.parameters.sitekey,this.auth,"argument-error"),Y(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Y("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=Ft()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){Y(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Y(pe()&&!Vt(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await Ie(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);Y(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Y(this.recaptcha,this.auth,"internal-error"),this.recaptcha}},SAMLAuthProvider,SignInMethod:{EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},TwitterAuthProvider,applyActionCode:async function(e,t){await async function(e,t){return Ie(e,"POST","/v1/accounts:update",we(e,t))}(y(e),{oobCode:t})},browserLocalPersistence:xt,browserPopupRedirectResolver:Qn,browserSessionPersistence:Mt,checkActionCode:Ot,confirmPasswordReset:async function(e,t,n){await ut(y(e),{oobCode:t,newPassword:n})},connectAuthEmulator:function(e,t,n){const r=rt(e);Y(r._canInitEmulator,r,"emulator-config-failed"),Y(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const s=!!(null==n?void 0:n.disableWarnings),i=it(t),{host:o,port:a}=function(e){const t=it(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const e=s[1];return{host:e,port:ot(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:ot(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${i}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()},createUserWithEmailAndPassword:async function(e,t,n){const r=rt(e),s=await vt(r,{returnSecureToken:!0,email:t,password:n}),i=await UserCredentialImpl._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(i.user),i},debugErrorMap:q,deleteUser:async function(e){return y(e).delete()},fetchSignInMethodsForEmail:async function(e,t){const n={identifier:t,continueUri:pe()?fe():"http://localhost"},{signinMethods:r}=await async function(e,t){return Ie(e,"POST","/v1/accounts:createAuthUri",we(e,t))}(y(e),n);return r||[]},getAdditionalUserInfo:function(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,s=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},i=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=Re(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new GenericAdditionalUserInfo(i,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new FacebookAdditionalUserInfo(i,s);case"github.com":return new GithubAdditionalUserInfo(i,s);case"google.com":return new GoogleAdditionalUserInfo(i,s);case"twitter.com":return new TwitterAdditionalUserInfo(i,s,e.screenName||null);case"custom":case"anonymous":return new GenericAdditionalUserInfo(i,null);default:return new GenericAdditionalUserInfo(i,r,s)}}(n)},getAuth:function(e=L()){const t=D(e,"auth");return t.isInitialized()?t.getImmediate():de(e,{popupRedirectResolver:Qn,persistence:[Kt,xt,Mt]})},getIdToken:function(e,t=!1){return y(e).getIdToken(t)},getIdTokenResult:ke,getMultiFactorResolver:function(e,t){var n;const r=y(e),s=t;return Y(t.customData.operationType,r,"argument-error"),Y(null===(n=s.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),MultiFactorResolverImpl._fromError(r,s)},getRedirectResult:async function(e,t){return await rt(e)._initializationPromise,In(e,t,!1)},inMemoryPersistence:xe,indexedDBLocalPersistence:Kt,initializeAuth:de,isSignInWithEmailLink:function(e,t){const n=ActionCodeURL.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)},linkWithCredential:Rt,linkWithPhoneNumber:async function(e,t,n){const r=y(e);await Et(!1,r,"phone");const s=await tn(r.auth,t,y(n));return new ConfirmationResultImpl(s,(e=>Rt(r,e)))},linkWithPopup:async function(e,t,n){const r=y(e);J(r.auth,t,FederatedAuthProvider);const s=nn(r.auth,n);return new PopupOperation(r.auth,"linkViaPopup",t,s,r).executeNotNull()},linkWithRedirect:function(e,t,n){return async function(e,t,n){const r=y(e);J(r.auth,t,FederatedAuthProvider);const s=nn(r.auth,n);await Et(!1,r,t.providerId),await mn(s,r.auth);const i=await _n(r);return s._openRedirect(r.auth,t,"linkViaRedirect",i)}(e,t,n)},multiFactor:function(e){const t=y(e);return Lt.has(t)||Lt.set(t,MultiFactorUserImpl._fromUser(t)),Lt.get(t)},onAuthStateChanged:function(e,t,n,r){return y(e).onAuthStateChanged(t,n,r)},onIdTokenChanged:function(e,t,n,r){return y(e).onIdTokenChanged(t,n,r)},parseActionCodeURL:function(e){return ActionCodeURL.parseLink(e)},prodErrorMap:$,reauthenticateWithCredential:Nt,reauthenticateWithPhoneNumber:async function(e,t,n){const r=y(e),s=await tn(r.auth,t,y(n));return new ConfirmationResultImpl(s,(e=>Nt(r,e)))},reauthenticateWithPopup:async function(e,t,n){const r=y(e);J(r.auth,t,FederatedAuthProvider);const s=nn(r.auth,n);return new PopupOperation(r.auth,"reauthViaPopup",t,s,r).executeNotNull()},reauthenticateWithRedirect:function(e,t,n){return async function(e,t,n){const r=y(e);J(r.auth,t,FederatedAuthProvider);const s=nn(r.auth,n);await mn(s,r.auth);const i=await _n(r);return s._openRedirect(r.auth,t,"reauthViaRedirect",i)}(e,t,n)},reload:Oe,sendEmailVerification:async function(e,t){const n=y(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Dt(n.auth,r,t);const{email:s}=await async function(e,t){return lt(e,t)}(n.auth,r);s!==e.email&&await e.reload()},sendPasswordResetEmail:async function(e,t,n){const r=y(e),s={requestType:"PASSWORD_RESET",email:t};n&&Dt(r,s,n),await async function(e,t){return lt(e,t)}(r,s)},sendSignInLinkToEmail:async function(e,t,n){const r=y(e),s={requestType:"EMAIL_SIGNIN",email:t};Y(n.handleCodeInApp,r,"argument-error"),n&&Dt(r,s,n),await async function(e,t){return lt(e,t)}(r,s)},setPersistence:function(e,t){return y(e).setPersistence(t)},signInAnonymously:async function(e){var t;const n=rt(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new UserCredentialImpl({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await vt(n,{returnSecureToken:!0}),s=await UserCredentialImpl._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(s.user),s},signInWithCredential:Ct,signInWithCustomToken:async function(e,t){const n=rt(e),r=await async function(e,t){return Te(e,"POST","/v1/accounts:signInWithCustomToken",we(e,t))}(n,{token:t,returnSecureToken:!0}),s=await UserCredentialImpl._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(s.user),s},signInWithEmailAndPassword:function(e,t,n){return Ct(y(e),EmailAuthProvider.credential(t,n))},signInWithEmailLink:async function(e,t,n){const r=y(e),s=EmailAuthProvider.credentialWithLink(t,n||fe());return Y(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Ct(r,s)},signInWithPhoneNumber:async function(e,t,n){const r=rt(e),s=await tn(r,t,y(n));return new ConfirmationResultImpl(s,(e=>Ct(r,e)))},signInWithPopup:async function(e,t,n){const r=rt(e);J(e,t,FederatedAuthProvider);const s=nn(r,n);return new PopupOperation(r,"signInViaPopup",t,s).executeNotNull()},signInWithRedirect:function(e,t,n){return async function(e,t,n){const r=rt(e);J(e,t,FederatedAuthProvider);const s=nn(r,n);return await mn(s,r),s._openRedirect(r,t,"signInViaRedirect")}(e,t,n)},signOut:function(e){return y(e).signOut()},unlink:async function(e,t){const n=y(e);await Et(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return Ie(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),s=bt(r||[]);return n.providerData=n.providerData.filter((e=>s.has(e.providerId))),s.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n},updateCurrentUser:function(e,t){return y(e).updateCurrentUser(t)},updateEmail:function(e,t){return Pt(y(e),t,null)},updatePassword:function(e,t){return Pt(y(e),null,t)},updatePhoneNumber:async function(e,t){await Tt(y(e),t)},updateProfile:async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=y(e),s={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},i=await Ne(r,async function(e,t){return Ie(e,"POST","/v1/accounts:update",t)}(r.auth,s));r.displayName=i.displayName||null,r.photoURL=i.photoUrl||null;const o=r.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(i)},useDeviceLanguage:function(e){y(e).useDeviceLanguage()},verifyBeforeUpdateEmail:async function(e,t,n){const r=y(e),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Dt(r.auth,s,n);const{email:i}=await async function(e,t){return lt(e,t)}(r.auth,s);i!==e.email&&await e.reload()},verifyPasswordResetCode:async function(e,t){const{data:n}=await Ot(y(e),t);return n.email}}),Zn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},er={},nr=nr||{},rr=Zn||self;function ir(){}function or(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function dr(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var fr="closure_uid_"+(1e9*Math.random()>>>0),pr=0;function mr(e,t,n){return e.call.apply(e.bind,arguments)}function gr(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function yr(e,t,n){return(yr=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?mr:gr).apply(null,arguments)}function wr(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function Ir(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}function _r(){this.s=this.s,this.o=this.o}_r.prototype.s=!1,_r.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0))(function(e){Object.prototype.hasOwnProperty.call(e,fr)&&e[fr]||(e[fr]=++pr)})(this)},_r.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const br=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},Tr=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,s="string"==typeof e?e.split(""):e;for(let i=0;i<r;i++)i in s&&t.call(n,s[i],i,e)};function Er(e){return Array.prototype.concat.apply([],arguments)}function Ar(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function Rr(e){return/^[\s\xa0]*$/.test(e)}var Or,Pr=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Lr(e,t){return-1!=e.indexOf(t)}function Mr(e,t){return e<t?-1:e>t?1:0}e:{var Hr=rr.navigator;if(Hr){var Xr=Hr.userAgent;if(Xr){Or=Xr;break e}}Or=""}function Zr(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function es(e){const t={};for(const n in e)t[n]=e[n];return t}var ts="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ns(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<ts.length;t++)n=ts[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function rs(e){return rs[" "](e),e}rs[" "]=ir;var ss,is,os=Lr(Or,"Opera"),as=Lr(Or,"Trident")||Lr(Or,"MSIE"),cs=Lr(Or,"Edge"),us=cs||as,hs=Lr(Or,"Gecko")&&!(Lr(Or.toLowerCase(),"webkit")&&!Lr(Or,"Edge"))&&!(Lr(Or,"Trident")||Lr(Or,"MSIE"))&&!Lr(Or,"Edge"),ls=Lr(Or.toLowerCase(),"webkit")&&!Lr(Or,"Edge");function ds(){var e=rr.document;return e?e.documentMode:void 0}e:{var fs="",ps=(is=Or,hs?/rv:([^\);]+)(\)|;)/.exec(is):cs?/Edge\/([\d\.]+)/.exec(is):as?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(is):ls?/WebKit\/(\S+)/.exec(is):os?/(?:Version)[ \/]?(\S+)/.exec(is):void 0);if(ps&&(fs=ps?ps[1]:""),as){var ms=ds();if(null!=ms&&ms>parseFloat(fs)){ss=String(ms);break e}}ss=fs}var gs,ys={};function vs(){return function(e){var t=ys;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){let e=0;const t=Pr(String(ss)).split("."),n=Pr("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var s=t[o]||"",i=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;e=Mr(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||Mr(0==s[2].length,0==i[2].length)||Mr(s[2],i[2]),s=s[3],i=i[3]}while(0==e)}return 0<=e}))}if(rr.document&&as){var ws=ds();gs=ws||(parseInt(ss,10)||void 0)}else gs=void 0;var Is=gs,_s=function(){if(!rr.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{rr.addEventListener("test",ir,t),rr.removeEventListener("test",ir,t)}catch(e){}return e}();function bs(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function Ts(e,t){if(bs.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(hs){e:{try{rs(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Es[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Ts.Z.h.call(this)}}bs.prototype.h=function(){this.defaultPrevented=!0},Ir(Ts,bs);var Es={2:"touch",3:"pen",4:"mouse"};Ts.prototype.h=function(){Ts.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var As="closure_listenable_"+(1e6*Math.random()|0),Rs=0;function Ps(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=s,this.key=++Rs,this.ca=this.fa=!1}function js(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Qs(e){this.src=e,this.g={},this.h=0}function Xs(e,t){var n=t.type;if(n in e.g){var r,s=e.g[n],i=br(s,t);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(js(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ei(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.ca&&i.listener==t&&i.capture==!!n&&i.ia==r)return s}return-1}Qs.prototype.add=function(e,t,n,r,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=ei(e,t,r,s);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new Ps(t,this.src,i,!!r,s)).fa=n,e.push(t)),t};var ti="closure_lm_"+(1e6*Math.random()|0),ni={};function ii(e,t,n,r,s){if(r&&r.once)return hi(e,t,n,r,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)ii(e,t[i],n,r,s);return null}return n=wi(n),e&&e[As]?e.N(t,n,dr(r)?!!r.capture:!!r,s):ui(e,t,n,!1,r,s)}function ui(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var o=dr(s)?!!s.capture:!!s,a=gi(e);if(a||(e[ti]=a=new Qs(e)),(n=a.add(t,n,r,o,i)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=mi;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)_s||(s=o),void 0===s&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(fi(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function hi(e,t,n,r,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)hi(e,t[i],n,r,s);return null}return n=wi(n),e&&e[As]?e.O(t,n,dr(r)?!!r.capture:!!r,s):ui(e,t,n,!0,r,s)}function li(e,t,n,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)li(e,t[i],n,r,s);else r=dr(r)?!!r.capture:!!r,n=wi(n),e&&e[As]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=ei(i=e.g[t],n,r,s))&&(js(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete e.g[t],e.h--)))):e&&(e=gi(e))&&(t=e.g[t.toString()],e=-1,t&&(e=ei(t,n,r,s)),(n=-1<e?t[e]:null)&&di(n))}function di(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[As])Xs(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(fi(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=gi(t))?(Xs(n,e),0==n.h&&(n.src=null,t[ti]=null)):js(e)}}}function fi(e){return e in ni?ni[e]:ni[e]="on"+e}function mi(e,t){if(e.ca)e=!0;else{t=new Ts(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&di(e),e=n.call(r,t)}return e}function gi(e){return(e=e[ti])instanceof Qs?e:null}var yi="__closure_events_fn_"+(1e9*Math.random()>>>0);function wi(e){return"function"==typeof e?e:(e[yi]||(e[yi]=function(t){return e.handleEvent(t)}),e[yi])}function _i(){_r.call(this),this.i=new Qs(this),this.P=this,this.I=null}function bi(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new bs(t,e);else if(t instanceof bs)t.target=t.target||e;else{var s=t;ns(t=new bs(r,e),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=t.g=n[i];s=Ti(o,r,!0,t)&&s}if(s=Ti(o=t.g=e,r,!0,t)&&s,s=Ti(o,r,!1,t)&&s,n)for(i=0;i<n.length;i++)s=Ti(o=t.g=n[i],r,!1,t)&&s}function Ti(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&Xs(e.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}Ir(_i,_r),_i.prototype[As]=!0,_i.prototype.removeEventListener=function(e,t,n,r){li(this,e,t,n,r)},_i.prototype.M=function(){if(_i.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)js(n[r]);delete t.g[e],t.h--}}this.I=null},_i.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},_i.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ei=rr.JSON.stringify;function Si(){var e=Li;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var ki,Ci=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new wb),(e=>e.reset()));class wb{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ni(e){rr.setTimeout((()=>{throw e}),0)}function Oi(e,t){ki||function(){var e=rr.Promise.resolve(void 0);ki=function(){e.then(xi)}}(),Pi||(ki(),Pi=!0),Li.add(e,t)}var Pi=!1,Li=new class{constructor(){this.h=this.g=null}add(e,t){const n=Ci.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function xi(){for(var e;e=Si();){try{e.h.call(e.g)}catch(e){Ni(e)}var t=Ci;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Pi=!1}function Mi(e,t){_i.call(this),this.h=e||1,this.g=t||rr,this.j=yr(this.kb,this),this.l=Date.now()}function Ui(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function Vi(e,t,n){if("function"==typeof e)n&&(e=yr(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=yr(e.handleEvent,e)}return 2147483647<Number(t)?-1:rr.setTimeout(e,t||0)}function Bi(e){e.g=Vi((()=>{e.g=null,e.i&&(e.i=!1,Bi(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}Ir(Mi,_i),(Xn=Mi.prototype).da=!1,Xn.S=null,Xn.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),bi(this,"tick"),this.da&&(Ui(this),this.start()))}},Xn.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Xn.M=function(){Mi.Z.M.call(this),Ui(this),delete this.g};class Ib extends _r{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Bi(this)}M(){super.M(),this.g&&(rr.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Wi(e){_r.call(this),this.h=e,this.g={}}Ir(Wi,_r);var Xi=[];function Yi(e,t,n,r){Array.isArray(n)||(n&&(Xi[0]=n.toString()),n=Xi);for(var s=0;s<n.length;s++){var i=ii(t,n[s],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function Zi(e){Zr(e.g,(function(e,t){this.g.hasOwnProperty(t)&&di(e)}),e),e.g={}}function to(){this.g=!0}function co(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ei(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Wi.prototype.M=function(){Wi.Z.M.call(this),Zi(this)},Wi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},to.prototype.Aa=function(){this.g=!1},to.prototype.info=function(){};var uo={},ho=null;function lo(){return ho=ho||new _i}function fo(e){bs.call(this,uo.Ma,e)}function po(e){const t=lo();bi(t,new fo(t,e))}function mo(e,t){bs.call(this,uo.STAT_EVENT,e),this.stat=t}function go(e){const t=lo();bi(t,new mo(t,e))}function yo(e,t){bs.call(this,uo.Na,e),this.size=t}function vo(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return rr.setTimeout((function(){e()}),t)}uo.Ma="serverreachability",Ir(fo,bs),uo.STAT_EVENT="statevent",Ir(mo,bs),uo.Na="timingevent",Ir(yo,bs);var wo={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Io={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function _o(){}function bo(e){return e.h||(e.h=e.i())}function To(){}_o.prototype.h=null;var Eo,So={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ao(){bs.call(this,"d")}function ko(){bs.call(this,"c")}function Co(){}function Ro(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new Wi(this),this.P=Do,e=us?125:void 0,this.W=new Mi(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new No}function No(){this.i=null,this.g="",this.h=!1}Ir(Ao,bs),Ir(ko,bs),Ir(Co,_o),Co.prototype.g=function(){return new XMLHttpRequest},Co.prototype.i=function(){return{}},Eo=new Co;var Do=45e3,Oo={},Po={};function xo(e,t,n){e.K=1,e.v=pa(ca(t)),e.s=n,e.U=!0,Vo(e,null)}function Vo(e,t){e.F=Date.now(),Ko(e),e.A=ca(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),ka(n.h,"t",r),e.C=0,n=e.l.H,e.h=new No,e.g=Cc(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Ib(yr(e.Ia,e,e.g),e.O)),Yi(e.V,e.g,"readystatechange",e.gb),t=e.H?es(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),po(1),function(e,t,n,r,s,i){e.info((function(){if(e.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function jo(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function $o(e,t,n){let r,s=!0;for(;!e.I&&e.C<n.length;){if(r=Go(e,n),r==Po){4==t&&(e.o=4,go(14),s=!1),co(e.j,e.m,null,"[Incomplete Response]");break}if(r==Oo){e.o=4,go(15),co(e.j,e.m,n,"[Invalid Chunk]"),s=!1;break}co(e.j,e.m,r,null),ta(e,r)}jo(e)&&r!=Po&&r!=Oo&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,go(16),s=!1),e.i=e.i&&s,s?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ic(t),t.L=!0,go(11))):(co(e.j,e.m,n,"[Invalid Chunked Response]"),ea(e),Xo(e))}function Go(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Po:(n=Number(t.substring(n,r)),isNaN(n)?Oo:(r+=1)+n>t.length?Po:(t=t.substr(r,n),e.C=r+n,t))}function Ko(e){e.Y=Date.now()+e.P,Wo(e,e.P)}function Wo(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=vo(yr(e.eb,e),t)}function Qo(e){e.B&&(rr.clearTimeout(e.B),e.B=null)}function Xo(e){0==e.l.G||e.I||Tc(e.l,e)}function ea(e){Qo(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Ui(e.W),Zi(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function ta(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||Pa(n.i,e)))if(n.I=e.N,!e.J&&Pa(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;bc(n),lc(n)}wc(n),go(18)}}else n.ta=s[1],0<n.ta-n.U&&37500>s[2]&&n.N&&0==n.A&&!n.v&&(n.v=vo(yr(n.ab,n),6e3));if(1>=Oa(n.i)&&n.ka){try{n.ka()}catch(e){}n.ka=void 0}}else Sc(n,11)}else if((e.J||n.g==e)&&bc(n),!Rr(t))for(s=n.Ca.g.parse(t),t=0;t<s.length;t++){let u=s[t];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const t=u[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const s=u[4];null!=s&&(n.za=s,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.i;!i.g&&(Lr(e,"spdy")||Lr(e,"quic")||Lr(e,"h2"))&&(i.j=i.l,i.g=new Set,i.h&&(La(i,i.h),i.h=null))}if(r.D){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,fa(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=kc(r,r.H?r.la:null,r.W),o.J){xa(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(Qo(a),Ko(a)),r.g=o}else vc(r);0<n.l.length&&pc(n)}else"stop"!=u[0]&&"close"!=u[0]||Sc(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Sc(n,7):hc(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}po(4)}catch(e){}}function na(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(or(e)||"string"==typeof e)Tr(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(or(e)||"string"==typeof e){n=[];for(var r=e.length,s=0;s<r;s++)n.push(s)}else for(s in n=[],r=0,e)n[r++]=s;s=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(or(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var i=0;i<s;i++)t.call(void 0,r[i],n&&n[i],e)}}function ra(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof ra)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function sa(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];ia(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var s={};for(n=t=0;t<e.g.length;)ia(s,r=e.g[t])||(e.g[n++]=r,s[r]=1),t++;e.g.length=n}}function ia(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(Xn=Ro.prototype).setTimeout=function(e){this.P=e},Xn.gb=function(e){e=e.target;const t=this.L;t&&3==ic(e)?t.l():this.Ia(e)},Xn.Ia=function(e){try{if(e==this.g)e:{const h=ic(this.g);var t=this.g.Da();const l=this.g.ba();if(!(3>h)&&(3!=h||us||this.g&&(this.h.h||this.g.ga()||oc(this.g)))){this.I||4!=h||7==t||po(8==t||0>=l?3:2),Qo(this);var n=this.g.ba();this.N=n;t:if(jo(this)){var r=oc(this.g);e="";var s=r.length,i=4==ic(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ea(this),Xo(this);var o="";break t}this.h.i=new rr.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:i&&t==s-1});r.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,s,i,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Rr(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,go(12),ea(this),Xo(this);break e}co(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,ta(this,n)}this.U?($o(this,h,o),us&&this.i&&3==h&&(Yi(this.V,this.W,"tick",this.fb),this.W.start())):(co(this.j,this.m,o,null),ta(this,o)),4==h&&ea(this),this.i&&!this.I&&(4==h?Tc(this.l,this):(this.i=!1,Ko(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,go(12)):(this.o=0,go(13)),ea(this),Xo(this)}}}catch(e){}},Xn.fb=function(){if(this.g){var e=ic(this.g),t=this.g.ga();this.C<t.length&&(Qo(this),$o(this,e,t),this.i&&4!=e&&Ko(this))}},Xn.cancel=function(){this.I=!0,ea(this)},Xn.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(po(3),go(17)),ea(this),this.o=2,Xo(this)):Wo(this,this.Y-e)},(Xn=ra.prototype).R=function(){sa(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},Xn.T=function(){return sa(this),this.g.concat()},Xn.get=function(e,t){return ia(this.h,e)?this.h[e]:t},Xn.set=function(e,t){ia(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},Xn.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var s=n[r],i=this.get(s);e.call(t,i,s,this)}};var oa=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function aa(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof aa){this.g=void 0!==t?t:e.g,ua(this,e.j),this.s=e.s,ha(this,e.i),la(this,e.m),this.l=e.l,t=e.h;var n=new Ta;n.i=t.i,t.g&&(n.g=new ra(t.g),n.h=t.h),da(this,n),this.o=e.o}else e&&(n=String(e).match(oa))?(this.g=!!t,ua(this,n[1]||"",!0),this.s=ma(n[2]||""),ha(this,n[3]||"",!0),la(this,n[4]),this.l=ma(n[5]||"",!0),da(this,n[6]||"",!0),this.o=ma(n[7]||"")):(this.g=!!t,this.h=new Ta(null,this.g))}function ca(e){return new aa(e)}function ua(e,t,n){e.j=n?ma(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ha(e,t,n){e.i=n?ma(t,!0):t}function la(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function da(e,t,n){t instanceof Ta?(e.h=t,function(e,t){t&&!e.j&&(Ea(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Sa(this,t),ka(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=ga(t,_a)),e.h=new Ta(t,e.g))}function fa(e,t,n){e.h.set(t,n)}function pa(e){return fa(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ma(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ga(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ya),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ya(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}aa.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ga(t,va,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(ga(t,va,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(ga(n,"/"==n.charAt(0)?Ia:wa,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",ga(n,ba)),e.join("")};var va=/[#\/\?@]/g,wa=/[#\?:]/g,Ia=/[#\?]/g,_a=/[#\?@]/g,ba=/#/g;function Ta(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Ea(e){e.g||(e.g=new ra,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),s=null;if(0<=r){var i=e[n].substring(0,r);s=e[n].substring(r+1)}else i=e[n];t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Sa(e,t){Ea(e),t=Ca(e,t),ia(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,ia((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&sa(e)))}function Aa(e,t){return Ea(e),t=Ca(e,t),ia(e.g.h,t)}function ka(e,t,n){Sa(e,t),0<n.length&&(e.i=null,e.g.set(Ca(e,t),Ar(n)),e.h+=n.length)}function Ca(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(Xn=Ta.prototype).add=function(e,t){Ea(this),this.i=null,e=Ca(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Xn.forEach=function(e,t){Ea(this),this.g.forEach((function(n,r){Tr(n,(function(n){e.call(t,n,r,this)}),this)}),this)},Xn.T=function(){Ea(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var s=e[r],i=0;i<s.length;i++)n.push(t[r]);return n},Xn.R=function(e){Ea(this);var t=[];if("string"==typeof e)Aa(this,e)&&(t=Er(t,this.g.get(Ca(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=Er(t,e[n])}return t},Xn.set=function(e,t){return Ea(this),this.i=null,Aa(this,e=Ca(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Xn.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},Xn.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),e.push(o)}}return this.i=e.join("&")};function Ra(e){this.l=e||Na,rr.PerformanceNavigationTiming?e=0<(e=rr.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(rr.g&&rr.g.Ea&&rr.g.Ea()&&rr.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Na=10;function Da(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Oa(e){return e.h?1:e.g?e.g.size:0}function Pa(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function La(e,t){e.g?e.g.add(t):e.h=t}function xa(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Ma(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return Ar(e.i)}function Ua(){}function Fa(){this.g=new Ua}function Va(e,t,n){const r=n||"";try{na(e,(function(e,n){let s=e;dr(e)&&(s=Ei(e)),t.push(r+n+"="+encodeURIComponent(s))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function ja(e,t,n,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch(e){}}function qa(e){this.l=e.$b||null,this.j=e.ib||!1}function $a(e,t){_i.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Ga,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ra.prototype.cancel=function(){if(this.i=Ma(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},Ua.prototype.stringify=function(e){return rr.JSON.stringify(e,void 0)},Ua.prototype.parse=function(e){return rr.JSON.parse(e,void 0)},Ir(qa,_o),qa.prototype.g=function(){return new $a(this.l,this.j)},qa.prototype.i=function(e){return function(){return e}}({}),Ir($a,_i);var Ga=0;function za(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Ha(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Ka(e)}function Ka(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Xn=$a.prototype).open=function(e,t){if(this.readyState!=Ga)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Ka(this)},Xn.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||rr).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},Xn.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ha(this)),this.readyState=Ga},Xn.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ka(this)),this.g&&(this.readyState=3,Ka(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==rr.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;za(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},Xn.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ha(this):Ka(this),3==this.readyState&&za(this)}},Xn.Ua=function(e){this.g&&(this.response=this.responseText=e,Ha(this))},Xn.Ta=function(e){this.g&&(this.response=e,Ha(this))},Xn.ha=function(){this.g&&Ha(this)},Xn.setRequestHeader=function(e,t){this.v.append(e,t)},Xn.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Xn.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty($a.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Wa=rr.JSON.parse;function Qa(e){_i.call(this),this.headers=new ra,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Ja,this.K=this.L=!1}Ir(Qa,_i);var Ja="",Xa=/^https?$/i,Ya=["POST","PUT"];function Za(e){return"content-type"==e.toLowerCase()}function ec(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,tc(e),rc(e)}function tc(e){e.D||(e.D=!0,bi(e,"complete"),bi(e,"error"))}function nc(e){if(e.h&&void 0!==nr&&(!e.C[1]||4!=ic(e)||2!=e.ba()))if(e.v&&4==ic(e))Vi(e.Fa,0,e);else if(bi(e,"readystatechange"),4==ic(e)){e.h=!1;try{const a=e.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var s=String(e.H).match(oa)[1]||null;if(!s&&rr.self&&rr.self.location){var i=rr.self.location.protocol;s=i.substr(0,i.length-1)}r=!Xa.test(s?s.toLowerCase():"")}n=r}if(n)bi(e,"complete"),bi(e,"success");else{e.m=6;try{var o=2<ic(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.ba()+"]",tc(e)}}finally{rc(e)}}}function rc(e,t){if(e.g){sc(e);const n=e.g,r=e.C[0]?ir:null;e.g=null,e.C=null,t||bi(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function sc(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(rr.clearTimeout(e.A),e.A=null)}function ic(e){return e.g?e.g.readyState:0}function oc(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Ja:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function ac(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return Zr(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):fa(e,t,n))}function cc(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function uc(e){this.za=0,this.l=[],this.h=new to,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=cc("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=cc("baseRetryDelayMs",5e3,e),this.$a=cc("retryDelaySeedMs",1e4,e),this.Ya=cc("forwardChannelMaxRetries",2,e),this.ra=cc("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new Ra(e&&e.concurrentRequestLimit),this.Ca=new Fa,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function hc(e){if(dc(e),3==e.G){var t=e.V++,n=ca(e.F);fa(n,"SID",e.J),fa(n,"RID",t),fa(n,"TYPE","terminate"),gc(e,n),(t=new Ro(e,e.h,t,void 0)).K=2,t.v=pa(ca(n)),n=!1,rr.navigator&&rr.navigator.sendBeacon&&(n=rr.navigator.sendBeacon(t.v.toString(),"")),!n&&rr.Image&&((new Image).src=t.v,n=!0),n||(t.g=Cc(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Ko(t)}Ac(e)}function lc(e){e.g&&(Ic(e),e.g.cancel(),e.g=null)}function dc(e){lc(e),e.u&&(rr.clearTimeout(e.u),e.u=null),bc(e),e.i.cancel(),e.m&&("number"==typeof e.m&&rr.clearTimeout(e.m),e.m=null)}function fc(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&pc(e)}function pc(e){Da(e.i)||e.m||(e.m=!0,Oi(e.Ha,e),e.C=0)}function mc(e,t){var n;n=t?t.m:e.V++;const r=ca(e.F);fa(r,"SID",e.J),fa(r,"RID",n),fa(r,"AID",e.U),gc(e,r),e.o&&e.s&&ac(r,e.o,e.s),n=new Ro(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=yc(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),La(e.i,n),xo(n,r,t)}function gc(e,t){e.j&&na({},(function(e,n){fa(t,n,e)}))}function yc(e,t,n){n=Math.min(e.l.length,n);var r=e.j?yr(e.j.Oa,e.j,e):null;e:{var s=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=s[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let i=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(n-=t,0>n)t=Math.max(0,s[o].h-100),i=!1;else try{Va(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(i){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function vc(e){e.g||e.u||(e.Y=1,Oi(e.Ga,e),e.A=0)}function wc(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=vo(yr(e.Ga,e),Ec(e,e.A)),e.A++,!0)}function Ic(e){null!=e.B&&(rr.clearTimeout(e.B),e.B=null)}function _c(e){e.g=new Ro(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=ca(e.oa);fa(t,"RID","rpc"),fa(t,"SID",e.J),fa(t,"CI",e.N?"0":"1"),fa(t,"AID",e.U),gc(e,t),fa(t,"TYPE","xmlhttp"),e.o&&e.s&&ac(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=pa(ca(t)),n.s=null,n.U=!0,Vo(n,e)}function bc(e){null!=e.v&&(rr.clearTimeout(e.v),e.v=null)}function Tc(e,t){var n=null;if(e.g==t){bc(e),Ic(e),e.g=null;var r=2}else{if(!Pa(e.i,t))return;n=t.D,xa(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var s=e.C;bi(r=lo(),new yo(r,n,t,s)),pc(e)}else vc(e);else if(3==(s=t.o)||0==s&&0<e.I||!(1==r&&function(e,t){return!(Oa(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=vo(yr(e.Ha,e,t),Ec(e,e.C)),e.C++,0)))}(e,t)||2==r&&wc(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),s){case 1:Sc(e,5);break;case 4:Sc(e,10);break;case 3:Sc(e,6);break;default:Sc(e,2)}}function Ec(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function Sc(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=yr(e.jb,e);n||(n=new aa("//www.google.com/images/cleardot.gif"),rr.location&&"http"==rr.location.protocol||ua(n,"https"),pa(n)),function(e,t){const n=new to;if(rr.Image){const r=new Image;r.onload=wr(ja,n,r,"TestLoadImage: loaded",!0,t),r.onerror=wr(ja,n,r,"TestLoadImage: error",!1,t),r.onabort=wr(ja,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=wr(ja,n,r,"TestLoadImage: timeout",!1,t),rr.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else go(2);e.G=0,e.j&&e.j.va(t),Ac(e),dc(e)}function Ac(e){e.G=0,e.I=-1,e.j&&(0==Ma(e.i).length&&0==e.l.length||(e.i.i.length=0,Ar(e.l),e.l.length=0),e.j.ua())}function kc(e,t,n){let r=function(e){return e instanceof aa?ca(e):new aa(e,void 0)}(n);if(""!=r.i)t&&ha(r,t+"."+r.i),la(r,r.m);else{const e=rr.location;r=function(e,t,n,r){var s=new aa(null,void 0);return e&&ua(s,e),t&&ha(s,t),n&&la(s,n),r&&(s.l=r),s}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&Zr(e.aa,(function(e,t){fa(r,t,e)})),t=e.D,n=e.sa,t&&n&&fa(r,t,n),fa(r,"VER",e.ma),gc(e,r),r}function Cc(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new Qa(new qa({ib:!0})):new Qa(e.qa)).L=e.H,t}function Rc(){}function Nc(){if(as&&!(10<=Number(Is)))throw Error("Environmental error: no available transport.")}function Dc(e,t){_i.call(this),this.g=new uc(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!Rr(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Rr(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Lc(this)}function Oc(e){Ao.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Pc(){ko.call(this),this.status=1}function Lc(e){this.g=e}(Xn=Qa.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Eo.g(),this.C=this.u?bo(this.u):bo(Eo),this.g.onreadystatechange=yr(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void ec(this,e)}e=n||"";const s=new ra(this.headers);r&&na(r,(function(e,t){s.set(t,e)})),r=function(e){e:{var t=Za;const n=e.length,r="string"==typeof e?e.split(""):e;for(let s=0;s<n;s++)if(s in r&&t.call(void 0,r[s],s,e)){t=s;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(s.T()),n=rr.FormData&&e instanceof rr.FormData,!(0<=br(Ya,t))||r||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{sc(this),0<this.B&&((this.K=function(e){return as&&vs()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=yr(this.pa,this)):this.A=Vi(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){ec(this,e)}},Xn.pa=function(){void 0!==nr&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,bi(this,"timeout"),this.abort(8))},Xn.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,bi(this,"complete"),bi(this,"abort"),rc(this))},Xn.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),rc(this,!0)),Qa.Z.M.call(this)},Xn.Fa=function(){this.s||(this.F||this.v||this.l?nc(this):this.cb())},Xn.cb=function(){nc(this)},Xn.ba=function(){try{return 2<ic(this)?this.g.status:-1}catch(e){return-1}},Xn.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Xn.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Wa(t)}},Xn.Da=function(){return this.m},Xn.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(Xn=uc.prototype).ma=8,Xn.G=1,Xn.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},Xn.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const s=new Ro(this,this.h,e,void 0);let i=this.s;if(this.P&&(i?(i=es(i),ns(i,this.P)):i=this.P),null===this.o&&(s.H=i),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=yc(this,s,t),fa(n=ca(this.F),"RID",e),fa(n,"CVER",22),this.D&&fa(n,"X-HTTP-Session-Id",this.D),gc(this,n),this.o&&i&&ac(n,this.o,i),La(this.i,s),this.Ra&&fa(n,"TYPE","init"),this.ja?(fa(n,"$req",t),fa(n,"SID","null"),s.$=!0,xo(s,n,null)):xo(s,n,t),this.G=2}}else 3==this.G&&(e?mc(this,e):0==this.l.length||Da(this.i)||mc(this))},Xn.Ga=function(){if(this.u=null,_c(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=vo(yr(this.bb,this),e)}},Xn.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,go(10),lc(this),_c(this))},Xn.ab=function(){null!=this.v&&(this.v=null,lc(this),wc(this),go(19))},Xn.jb=function(e){e?(this.h.info("Successfully pinged google.com"),go(2)):(this.h.info("Failed to ping google.com"),go(1))},(Xn=Rc.prototype).xa=function(){},Xn.wa=function(){},Xn.va=function(){},Xn.ua=function(){},Xn.Oa=function(){},Nc.prototype.g=function(e,t){return new Dc(e,t)},Ir(Dc,_i),Dc.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Oi(yr(e.hb,e,t))),go(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=kc(e,null,e.W),pc(e)},Dc.prototype.close=function(){hc(this.g)},Dc.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,fc(this.g,t)}else this.v?((t={}).__data__=Ei(e),fc(this.g,t)):fc(this.g,e)},Dc.prototype.M=function(){this.g.j=null,delete this.j,hc(this.g),delete this.g,Dc.Z.M.call(this)},Ir(Oc,Ao),Ir(Pc,ko),Ir(Lc,Rc),Lc.prototype.xa=function(){bi(this.g,"a")},Lc.prototype.wa=function(e){bi(this.g,new Oc(e))},Lc.prototype.va=function(e){bi(this.g,new Pc(e))},Lc.prototype.ua=function(){bi(this.g,"b")},Nc.prototype.createWebChannel=Nc.prototype.g,Dc.prototype.send=Dc.prototype.u,Dc.prototype.open=Dc.prototype.m,Dc.prototype.close=Dc.prototype.close,wo.NO_ERROR=0,wo.TIMEOUT=8,wo.HTTP_ERROR=6,Io.COMPLETE="complete",To.EventType=So,So.OPEN="a",So.CLOSE="b",So.ERROR="c",So.MESSAGE="d",_i.prototype.listen=_i.prototype.N,Qa.prototype.listenOnce=Qa.prototype.O,Qa.prototype.getLastError=Qa.prototype.La,Qa.prototype.getLastErrorCode=Qa.prototype.Da,Qa.prototype.getStatus=Qa.prototype.ba,Qa.prototype.getResponseJson=Qa.prototype.Qa,Qa.prototype.getResponseText=Qa.prototype.ga,Qa.prototype.send=Qa.prototype.ea;var xc=er.createWebChannelTransport=function(){return new Nc},Mc=er.getStatEventTarget=function(){return lo()},Uc=er.ErrorCode=wo,Fc=er.EventType=Io,Vc=er.Event=uo,jc=er.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},qc=er.FetchXmlHttpFactory=qa,$c=er.WebChannel=To,Bc=er.XhrIo=Qa;const Gc="@firebase/firestore";class D$1{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}D$1.UNAUTHENTICATED=new D$1(null),D$1.GOOGLE_CREDENTIALS=new D$1("google-credentials-uid"),D$1.FIRST_PARTY=new D$1("first-party-uid"),D$1.MOCK_USER=new D$1("mock-user");let zc="9.6.1";const Hc=new Logger("@firebase/firestore");function Kc(){return Hc.logLevel}function Wc(e,...t){if(Hc.logLevel<=w.DEBUG){const n=t.map(Xc);Hc.debug(`Firestore (${zc}): ${e}`,...n)}}function Qc(e,...t){if(Hc.logLevel<=w.ERROR){const n=t.map(Xc);Hc.error(`Firestore (${zc}): ${e}`,...n)}}function Jc(e,...t){if(Hc.logLevel<=w.WARN){const n=t.map(Xc);Hc.warn(`Firestore (${zc}): ${e}`,...n)}}function Xc(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Yc(e="Unexpected state"){const t=`FIRESTORE (${zc}) INTERNAL ASSERTION FAILED: `+e;throw Qc(t),new Error(t)}function Zc(e,t){e||Yc()}function tu(e,t){return e}const iu={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class j extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Q$1{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class W$1{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class G{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(D$1.UNAUTHENTICATED)))}shutdown(){}}class z$1{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class H$1{constructor(e){this.t=e,this.currentUser=D$1.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new Q$1;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Q$1,e.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const t=s;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Wc("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Wc("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Q$1)}}),0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Wc("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Zc("string"==typeof t.accessToken),new W$1(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Zc(null===e||"string"==typeof e),new D$1(e)}}class J$1{constructor(e,t,n){this.type="FirstParty",this.user=D$1.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class Y$1{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new J$1(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(D$1.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class X$1{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Z$1{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,t){this.o=n=>{e.enqueueRetryable((()=>(e=>(null!=e.error&&Wc("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`),t(e.token)))(n)))};const n=e=>{Wc("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit((e=>n(e))),setTimeout((()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?n(e):Wc("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Zc("string"==typeof e.token),new X$1(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class et{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.p(e),this.T=e=>t.writeSequenceNumber(e))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function au(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}et.I=-1;class st{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=au(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<t&&(n+=e.charAt(r[s]%e.length))}return n}}function hu(e,t){return e<t?-1:e>t?1:0}function lu(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function du(e){return e+"\0"}class at{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new j(iu.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new j(iu.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new j(iu.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new j(iu.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return at.fromMillis(Date.now())}static fromDate(e){return at.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new at(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?hu(this.nanoseconds,e.nanoseconds):hu(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ct{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ct(e)}static min(){return new ct(new at(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function pu(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function yu(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function vu(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class ft{constructor(e,t,n){void 0===t?t=0:t>e.length&&Yc(),void 0===n?n=e.length-t:n>e.length-t&&Yc(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ft.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ft?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),s=t.get(r);if(n<s)return-1;if(n>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class dt extends ft{construct(e,t,n){return new dt(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new j(iu.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new dt(t)}static emptyPath(){return new dt([])}}const Iu=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class _t extends ft{construct(e,t,n){return new _t(e,t,n)}static isValidIdentifier(e){return Iu.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),_t.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new _t(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(0===n.length)throw new j(iu.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new j(iu.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new j(iu.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(s(),r++)}if(s(),i)throw new j(iu.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new _t(t)}static emptyPath(){return new _t([])}}class mt{constructor(e){this.fields=e,e.sort(_t.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return lu(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class yt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new yt(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new yt(t)}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return hu(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}yt.EMPTY_BYTE_STRING=new yt("");const bu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Tu(e){if(Zc(!!e),"string"==typeof e){let t=0;const n=bu.exec(e);if(Zc(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Eu(e.seconds),nanos:Eu(e.nanos)}}function Eu(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Su(e){return"string"==typeof e?yt.fromBase64String(e):yt.fromUint8Array(e)}function Au(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ru(e){const t=e.mapValue.fields.__previous_value__;return Au(t)?Ru(t):t}function Nu(e){const t=Tu(e.mapValue.fields.__local_write_time__.timestampValue);return new at(t.seconds,t.nanos)}function Ou(e){return null==e}function Pu(e){return 0===e&&1/e==-1/0}function Lu(e){return"number"==typeof e&&Number.isInteger(e)&&!Pu(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class St{constructor(e){this.path=e}static fromPath(e){return new St(dt.fromString(e))}static fromName(e){return new St(dt.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===dt.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return dt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new St(new dt(e.slice()))}}function Mu(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Au(e)?4:10:Yc()}function Uu(e,t){const n=Mu(e);if(n!==Mu(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Nu(e).isEqual(Nu(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Tu(e.timestampValue),r=Tu(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Su(e.bytesValue).isEqual(Su(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Eu(e.geoPointValue.latitude)===Eu(t.geoPointValue.latitude)&&Eu(e.geoPointValue.longitude)===Eu(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Eu(e.integerValue)===Eu(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Eu(e.doubleValue),r=Eu(t.doubleValue);return n===r?Pu(n)===Pu(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return lu(e.arrayValue.values||[],t.arrayValue.values||[],Uu);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(pu(n)!==pu(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Uu(n[e],r[e])))return!1;return!0}(e,t);default:return Yc()}}function Vu(e,t){return void 0!==(e.values||[]).find((e=>Uu(e,t)))}function Gu(e,t){const n=Mu(e),r=Mu(t);if(n!==r)return hu(n,r);switch(n){case 0:return 0;case 1:return hu(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Eu(e.integerValue||e.doubleValue),r=Eu(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return zu(e.timestampValue,t.timestampValue);case 4:return zu(Nu(e),Nu(t));case 5:return hu(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Su(e),r=Su(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=hu(n[e],r[e]);if(0!==t)return t}return hu(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=hu(Eu(e.latitude),Eu(t.latitude));return 0!==n?n:hu(Eu(e.longitude),Eu(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Gu(n[e],r[e]);if(t)return t}return hu(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let e=0;e<r.length&&e<i.length;++e){const t=hu(r[e],i[e]);if(0!==t)return t;const o=Gu(n[r[e]],s[i[e]]);if(0!==o)return o}return hu(r.length,i.length)}(e.mapValue,t.mapValue);default:throw Yc()}}function zu(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return hu(e,t);const n=Tu(e),r=Tu(t),s=hu(n.seconds,r.seconds);return 0!==s?s:hu(n.nanos,r.nanos)}function Ku(e){return Qu(e)}function Qu(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Tu(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Su(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,St.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Qu(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+=`${s}:${Qu(e.fields[s])}`;return n+"}"}(e.mapValue):Yc();var t,n}function Ju(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Yu(e){return!!e&&"integerValue"in e}function Zu(e){return!!e&&"arrayValue"in e}function eh(e){return!!e&&"nullValue"in e}function th(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nh(e){return!!e&&"mapValue"in e}function sh(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return yu(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=sh(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=sh(e.arrayValue.values[n]);return t}return Object.assign({},e)}class jt{constructor(e){this.value=e}static empty(){return new jt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!nh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sh(t)}setAll(e){let t=_t.emptyPath(),n={},r=[];e.forEach(((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=s.popLast()}e?n[s.lastSegment()]=sh(e):r.push(s.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());nh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Uu(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];nh(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){yu(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new jt(sh(this.value))}}function ih(e){const t=[];return yu(e.fields,((e,n)=>{const r=new _t([e]);if(nh(n)){const e=ih(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new mt(t)}class Wt{constructor(e,t,n,r,s){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=s}static newInvalidDocument(e){return new Wt(e,0,ct.min(),jt.empty(),0)}static newFoundDocument(e,t,n){return new Wt(e,1,t,n,0)}static newNoDocument(e,t){return new Wt(e,2,t,jt.empty(),0)}static newUnknownDocument(e,t){return new Wt(e,3,t,jt.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=jt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=jt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Wt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new Wt(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Gt{constructor(e,t=null,n=[],r=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.R=null}}function oh(e,t=null,n=[],r=[],s=null,i=null,o=null){return new Gt(e,t,n,r,s,i,o)}function uh(e){const t=tu(e);if(null===t.R){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>function(e){return e.field.canonicalString()+e.op.toString()+Ku(e.value)}(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Ou(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=ph(t.startAt)),t.endAt&&(e+="|ub:",e+=ph(t.endAt)),t.R=e}return t.R}function hh(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!mh(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(n=e.filters[s],r=t.filters[s],n.op!==r.op||!n.field.isEqual(r.field)||!Uu(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!yh(e.startAt,t.startAt)&&yh(e.endAt,t.endAt)}function dh(e){return St.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Zt extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,n):new ee(e,t,n):"array-contains"===t?new re(e,n):"in"===t?new oe(e,n):"not-in"===t?new ae(e,n):"array-contains-any"===t?new ce(e,n):new Zt(e,t,n)}static P(e,t,n){return"in"===t?new ne(e,n):new se(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(Gu(t,this.value)):null!==t&&Mu(this.value)===Mu(t)&&this.v(Gu(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Yc()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class ee extends Zt{constructor(e,t,n){super(e,t,n),this.key=St.fromName(n.referenceValue)}matches(e){const t=St.comparator(e.key,this.key);return this.v(t)}}class ne extends Zt{constructor(e,t){super(e,"in",t),this.keys=fh("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class se extends Zt{constructor(e,t){super(e,"not-in",t),this.keys=fh("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function fh(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>St.fromName(e.referenceValue)))}class re extends Zt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Zu(t)&&Vu(t.arrayValue,this.value)}}class oe extends Zt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Vu(this.value.arrayValue,t)}}class ae extends Zt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Vu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Vu(this.value.arrayValue,t)}}class ce extends Zt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Zu(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Vu(this.value.arrayValue,e)))}}class ue{constructor(e,t){this.position=e,this.before=t}}function ph(e){return`${e.before?"b":"a"}:${e.position.map((e=>Ku(e))).join(",")}`}class le{constructor(e,t="asc"){this.field=e,this.dir=t}}function mh(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function gh(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(r=i.field.isKeyField()?St.comparator(St.fromName(o.referenceValue),n.key):Gu(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function yh(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Uu(e.position[n],t.position[n]))return!1;return!0}class _e{constructor(e,t=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.S=null,this.D=null,this.startAt,this.endAt}}function vh(e,t,n,r,s,i,o,a){return new _e(e,t,n,r,s,i,o,a)}function wh(e){return new _e(e)}function Ih(e){return!Ou(e.limit)&&"F"===e.limitType}function _h(e){return!Ou(e.limit)&&"L"===e.limitType}function bh(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Th(e){for(const t of e.filters)if(t.V())return t.field;return null}function Eh(e){return null!==e.collectionGroup}function Sh(e){const t=tu(e);if(null===t.S){t.S=[];const e=Th(t),n=bh(t);if(null!==e&&null===n)e.isKeyField()||t.S.push(new le(e)),t.S.push(new le(_t.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.S.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.S.push(new le(_t.keyField(),e))}}}return t.S}function Ah(e){const t=tu(e);if(!t.D)if("F"===t.limitType)t.D=oh(t.path,t.collectionGroup,Sh(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of Sh(t)){const t="desc"===n.dir?"asc":"desc";e.push(new le(n.field,t))}const n=t.endAt?new ue(t.endAt.position,!t.endAt.before):null,r=t.startAt?new ue(t.startAt.position,!t.startAt.before):null;t.D=oh(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.D}function kh(e,t,n){return new _e(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Ch(e,t){return hh(Ah(e),Ah(t))&&e.limitType===t.limitType}function Rh(e){return`${uh(Ah(e))}|lt:${e.limitType}`}function Nh(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>{return`${(t=e).field.canonicalString()} ${t.op} ${Ku(t.value)}`;var t})).join(", ")}]`),Ou(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: "+ph(e.startAt)),e.endAt&&(t+=", endAt: "+ph(e.endAt)),`Target(${t})`}(Ah(e))}; limitType=${e.limitType})`}function Dh(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):St.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!gh(e.startAt,Sh(e),t))&&(!e.endAt||!gh(e.endAt,Sh(e),t))}(e,t)}function Oh(e){return(t,n)=>{let r=!1;for(const s of Sh(e)){const e=Lh(s,t,n);if(0!==e)return e;r=r||s.field.isKeyField()}return 0}}function Lh(e,t,n){const r=e.field.isKeyField()?St.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),s=n.data.field(e);return null!==r&&null!==s?Gu(r,s):Yc()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Yc()}}function xh(e,t){if(e.C){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pu(t)?"-0":t}}function Mh(e){return{integerValue:""+e}}function Uh(e,t){return Lu(t)?Mh(t):xh(e,t)}class $e{constructor(){this._=void 0}}function Fh(e,t,n){return e instanceof Le?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Be?qh(e,t):e instanceof qe?$h(e,t):function(e,t){const n=jh(e,t),r=Bh(n)+Bh(e.N);return Yu(n)&&Yu(e.N)?Mh(r):xh(e.k,r)}(e,t)}function Vh(e,t,n){return e instanceof Be?qh(e,t):e instanceof qe?$h(e,t):n}function jh(e,t){return e instanceof je?Yu(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class Le extends $e{}class Be extends $e{constructor(e){super(),this.elements=e}}function qh(e,t){const n=Gh(t);for(const t of e.elements)n.some((e=>Uu(e,t)))||n.push(t);return{arrayValue:{values:n}}}class qe extends $e{constructor(e){super(),this.elements=e}}function $h(e,t){let n=Gh(t);for(const t of e.elements)n=n.filter((e=>!Uu(e,t)));return{arrayValue:{values:n}}}class je extends $e{constructor(e,t){super(),this.k=e,this.N=t}}function Bh(e){return Eu(e.integerValue||e.doubleValue)}function Gh(e){return Zu(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ge{constructor(e,t){this.field=e,this.transform=t}}class He{constructor(e,t){this.version=e,this.transformResults=t}}class Je{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Je}static exists(e){return new Je(void 0,e)}static updateTime(e){return new Je(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function zh(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Xe{}function Hh(e,t,n){e instanceof rn?function(e,t,n){const r=e.value.clone(),s=Yh(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof on?function(e,t,n){if(!zh(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Yh(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(Xh(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Kh(e,t,n){e instanceof rn?function(e,t,n){if(!zh(e.precondition,t))return;const r=e.value.clone(),s=Zh(e.fieldTransforms,n,t);r.setAll(s),t.convertToFoundDocument(Jh(t),r).setHasLocalMutations()}(e,t,n):e instanceof on?function(e,t,n){if(!zh(e.precondition,t))return;const r=Zh(e.fieldTransforms,n,t),s=t.data;s.setAll(Xh(e)),s.setAll(r),t.convertToFoundDocument(Jh(t),s).setHasLocalMutations()}(e,t,n):function(e,t){zh(e.precondition,t)&&t.convertToNoDocument(ct.min())}(e,t)}function Wh(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=jh(r.transform,e||null);null!=s&&(null==n&&(n=jt.empty()),n.set(r.field,s))}return n||null}function Qh(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&lu(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Be&&t instanceof Be||e instanceof qe&&t instanceof qe?lu(e.elements,t.elements,Uu):e instanceof je&&t instanceof je?Uu(e.N,t.N):e instanceof Le&&t instanceof Le}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function Jh(e){return e.isFoundDocument()?e.version:ct.min()}class rn extends Xe{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class on extends Xe{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}}function Xh(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Yh(e,t,n){const r=new Map;Zc(e.length===n.length);for(let s=0;s<n.length;s++){const i=e[s],o=i.transform,a=t.data.field(i.field);r.set(i.field,Vh(o,a,n[s]))}return r}function Zh(e,t,n){const r=new Map;for(const s of e){const e=s.transform,i=n.data.field(s.field);r.set(s.field,Fh(e,i,t))}return r}class hn extends Xe{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class ln extends Xe{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class fn{constructor(e){this.count=e}}var el,tl;function nl(e){switch(e){default:return Yc();case iu.CANCELLED:case iu.UNKNOWN:case iu.DEADLINE_EXCEEDED:case iu.RESOURCE_EXHAUSTED:case iu.INTERNAL:case iu.UNAVAILABLE:case iu.UNAUTHENTICATED:return!1;case iu.INVALID_ARGUMENT:case iu.NOT_FOUND:case iu.ALREADY_EXISTS:case iu.PERMISSION_DENIED:case iu.FAILED_PRECONDITION:case iu.ABORTED:case iu.OUT_OF_RANGE:case iu.UNIMPLEMENTED:case iu.DATA_LOSS:return!0}}function rl(e){if(void 0===e)return Qc("GRPC error has no .code"),iu.UNKNOWN;switch(e){case el.OK:return iu.OK;case el.CANCELLED:return iu.CANCELLED;case el.UNKNOWN:return iu.UNKNOWN;case el.DEADLINE_EXCEEDED:return iu.DEADLINE_EXCEEDED;case el.RESOURCE_EXHAUSTED:return iu.RESOURCE_EXHAUSTED;case el.INTERNAL:return iu.INTERNAL;case el.UNAVAILABLE:return iu.UNAVAILABLE;case el.UNAUTHENTICATED:return iu.UNAUTHENTICATED;case el.INVALID_ARGUMENT:return iu.INVALID_ARGUMENT;case el.NOT_FOUND:return iu.NOT_FOUND;case el.ALREADY_EXISTS:return iu.ALREADY_EXISTS;case el.PERMISSION_DENIED:return iu.PERMISSION_DENIED;case el.FAILED_PRECONDITION:return iu.FAILED_PRECONDITION;case el.ABORTED:return iu.ABORTED;case el.OUT_OF_RANGE:return iu.OUT_OF_RANGE;case el.UNIMPLEMENTED:return iu.UNIMPLEMENTED;case el.DATA_LOSS:return iu.DATA_LOSS;default:return Yc()}}(tl=el||(el={}))[tl.OK=0]="OK",tl[tl.CANCELLED=1]="CANCELLED",tl[tl.UNKNOWN=2]="UNKNOWN",tl[tl.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",tl[tl.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",tl[tl.NOT_FOUND=5]="NOT_FOUND",tl[tl.ALREADY_EXISTS=6]="ALREADY_EXISTS",tl[tl.PERMISSION_DENIED=7]="PERMISSION_DENIED",tl[tl.UNAUTHENTICATED=16]="UNAUTHENTICATED",tl[tl.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",tl[tl.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",tl[tl.ABORTED=10]="ABORTED",tl[tl.OUT_OF_RANGE=11]="OUT_OF_RANGE",tl[tl.UNIMPLEMENTED=12]="UNIMPLEMENTED",tl[tl.INTERNAL=13]="INTERNAL",tl[tl.UNAVAILABLE=14]="UNAVAILABLE",tl[tl.DATA_LOSS=15]="DATA_LOSS";class gn{constructor(e,t){this.comparator=e,this.root=t||pn.EMPTY}insert(e,t){return new gn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,pn.BLACK,null,null))}remove(e){return new gn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,pn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new yn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new yn(this.root,e,this.comparator,!1)}getReverseIterator(){return new yn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new yn(this.root,e,this.comparator,!0)}}class yn{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class pn{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:pn.RED,this.left=null!=r?r:pn.EMPTY,this.right=null!=s?s:pn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new pn(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return pn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return pn.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,pn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,pn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Yc();if(this.right.isRed())throw Yc();const e=this.left.check();if(e!==this.right.check())throw Yc();return e+(this.isRed()?0:1)}}pn.EMPTY=null,pn.RED=!0,pn.BLACK=!1,pn.EMPTY=new class{constructor(){this.size=0}get key(){throw Yc()}get value(){throw Yc()}get color(){throw Yc()}get left(){throw Yc()}get right(){throw Yc()}copy(e,t,n,r,s){return this}insert(e,t,n){return new pn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Tn{constructor(e){this.comparator=e,this.data=new gn(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new En(this.data.getIterator())}getIteratorFrom(e){return new En(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Tn))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Tn(this.comparator);return t.data=e,t}}class En{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const sl=new gn(St.comparator);function il(){return sl}const ol=new gn(St.comparator);function al(){return ol}const cl=new gn(St.comparator);function ul(){return cl}const hl=new Tn(St.comparator);function ll(...e){let t=hl;for(const n of e)t=t.add(n);return t}const dl=new Tn(hu);function fl(){return dl}class Nn{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,kn.createSynthesizedTargetChangeForCurrentChange(e,t)),new Nn(ct.min(),n,fl(),il(),ll())}}class kn{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t){return new kn(yt.EMPTY_BYTE_STRING,t,ll(),ll(),ll())}}class xn{constructor(e,t,n,r){this.$=e,this.removedTargetIds=t,this.key=n,this.F=r}}class $n{constructor(e,t){this.targetId=e,this.O=t}}class Fn{constructor(e,t,n=yt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class On{constructor(){this.M=0,this.L=ml(),this.B=yt.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.M}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=ll(),t=ll(),n=ll();return this.L.forEach(((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Yc()}})),new kn(this.B,this.U,e,t,n)}H(){this.q=!1,this.L=ml()}J(e,t){this.q=!0,this.L=this.L.insert(e,t)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.M+=1}Z(){this.M-=1}tt(){this.q=!0,this.U=!0}}class Mn{constructor(e){this.et=e,this.nt=new Map,this.st=il(),this.it=pl(),this.rt=new Tn(hu)}ot(e){for(const t of e.$)e.F&&e.F.isFoundDocument()?this.at(t,e.F):this.ct(t,e.key,e.F);for(const t of e.removedTargetIds)this.ct(t,e.key,e.F)}ut(e){this.forEachTarget(e,(t=>{const n=this.ht(t);switch(e.state){case 0:this.lt(t)&&n.W(e.resumeToken);break;case 1:n.Z(),n.K||n.H(),n.W(e.resumeToken);break;case 2:n.Z(),n.K||this.removeTarget(t);break;case 3:this.lt(t)&&(n.tt(),n.W(e.resumeToken));break;case 4:this.lt(t)&&(this.ft(t),n.W(e.resumeToken));break;default:Yc()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach(((e,n)=>{this.lt(n)&&t(n)}))}dt(e){const t=e.targetId,n=e.O.count,r=this.wt(t);if(r){const e=r.target;if(dh(e))if(0===n){const n=new St(e.path);this.ct(t,n,Wt.newNoDocument(n,ct.min()))}else Zc(1===n);else this._t(t)!==n&&(this.ft(t),this.rt=this.rt.add(t))}}gt(e){const t=new Map;this.nt.forEach(((n,r)=>{const s=this.wt(r);if(s){if(n.current&&dh(s.target)){const t=new St(s.target.path);null!==this.st.get(t)||this.yt(r,t)||this.ct(r,t,Wt.newNoDocument(t,e))}n.j&&(t.set(r,n.G()),n.H())}}));let n=ll();this.it.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.wt(e);return!t||2===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))}));const r=new Nn(e,t,this.rt,this.st,n);return this.st=il(),this.it=pl(),this.rt=new Tn(hu),r}at(e,t){if(!this.lt(e))return;const n=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,n),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}ct(e,t,n){if(!this.lt(e))return;const r=this.ht(e);this.yt(e,t)?r.J(t,1):r.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),n&&(this.st=this.st.insert(t,n))}removeTarget(e){this.nt.delete(e)}_t(e){const t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let t=this.nt.get(e);return t||(t=new On,this.nt.set(e,t)),t}Tt(e){let t=this.it.get(e);return t||(t=new Tn(hu),this.it=this.it.insert(e,t)),t}lt(e){const t=null!==this.wt(e);return t||Wc("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new On),this.et.getRemoteKeysForTarget(e).forEach((t=>{this.ct(e,t,null)}))}yt(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}function pl(){return new gn(St.comparator)}function ml(){return new gn(St.comparator)}const gl={asc:"ASCENDING",desc:"DESCENDING"},yl={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Kn{constructor(e,t){this.databaseId=e,this.C=t}}function vl(e,t){return e.C?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function wl(e,t){return e.C?t.toBase64():t.toUint8Array()}function Il(e,t){return vl(e,t.toTimestamp())}function _l(e){return Zc(!!e),ct.fromTimestamp(function(e){const t=Tu(e);return new at(t.seconds,t.nanos)}(e))}function bl(e,t){return function(e){return new dt(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Tl(e){const t=dt.fromString(e);return Zc(Kl(t)),t}function El(e,t){return bl(e.databaseId,t.path)}function Sl(e,t){const n=Tl(t);if(n.get(1)!==e.databaseId.projectId)throw new j(iu.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new j(iu.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new St(Rl(n))}function Al(e,t){return bl(e.databaseId,t)}function kl(e){const t=Tl(e);return 4===t.length?dt.emptyPath():Rl(t)}function Cl(e){return new dt(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Rl(e){return Zc(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Nl(e,t,n){return{name:El(e,t),fields:n.value.mapValue.fields}}function Dl(e,t,n){const r=Sl(e,t.name),s=_l(t.updateTime),i=new jt({mapValue:{fields:t.fields}}),o=Wt.newFoundDocument(r,s,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Ol(e,t){let n;if(t instanceof rn)n={update:Nl(e,t.key,t.value)};else if(t instanceof hn)n={delete:El(e,t.key)};else if(t instanceof on)n={update:Nl(e,t.key,t.data),updateMask:Hl(t.fieldMask)};else{if(!(t instanceof ln))return Yc();n={verify:El(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Le)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Be)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof qe)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof je)return{fieldPath:t.field.canonicalString(),increment:n.N};throw Yc()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Il(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Yc()}(e,t.precondition)),n}function Pl(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Je.updateTime(_l(e.updateTime)):void 0!==e.exists?Je.exists(e.exists):Je.none()}(t.currentDocument):Je.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Zc("REQUEST_TIME"===t.setToServerValue),n=new Le;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Be(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new qe(e)}else"increment"in t?n=new je(e,t.increment):Yc();const r=_t.fromServerFormat(t.fieldPath);return new Ge(r,n)}(e,t))):[];if(t.update){t.update.name;const s=Sl(e,t.update.name),i=new jt({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new mt(t.map((e=>_t.fromServerFormat(e))))}(t.updateMask);return new on(s,i,e,n,r)}return new rn(s,i,n,r)}if(t.delete){const r=Sl(e,t.delete);return new hn(r,n)}if(t.verify){const r=Sl(e,t.verify);return new ln(r,n)}return Yc()}function Ll(e,t){return{documents:[Al(e,t.path)]}}function xl(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Al(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Al(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(e){if(0===e.length)return;const t=e.map((e=>function(e){if("=="===e.op){if(th(e.value))return{unaryFilter:{field:$l(e.field),op:"IS_NAN"}};if(eh(e.value))return{unaryFilter:{field:$l(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(th(e.value))return{unaryFilter:{field:$l(e.field),op:"IS_NOT_NAN"}};if(eh(e.value))return{unaryFilter:{field:$l(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$l(e.field),op:ql(e.op),value:e.value}}}(e)));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);s&&(n.structuredQuery.where=s);const i=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:$l(e.field),direction:jl(e.dir)}}(e)))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(e,t){return e.C||Ou(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=Fl(t.startAt)),t.endAt&&(n.structuredQuery.endAt=Fl(t.endAt)),n}function Ml(e){let t=kl(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Zc(1===r);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=Ul(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new le(Bl(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ou(t)?null:t}(n.limit));let c=null;n.startAt&&(c=Vl(n.startAt));let u=null;return n.endAt&&(u=Vl(n.endAt)),vh(t,s,o,i,a,"F",c,u)}function Ul(e){return e?void 0!==e.unaryFilter?[zl(e)]:void 0!==e.fieldFilter?[Gl(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((e=>Ul(e))).reduce(((e,t)=>e.concat(t))):Yc():[]}function Fl(e){return{before:e.before,values:e.position}}function Vl(e){const t=!!e.before,n=e.values||[];return new ue(n,t)}function jl(e){return gl[e]}function ql(e){return yl[e]}function $l(e){return{fieldPath:e.canonicalString()}}function Bl(e){return _t.fromServerFormat(e.fieldPath)}function Gl(e){return Zt.create(Bl(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Yc()}}(e.fieldFilter.op),e.fieldFilter.value)}function zl(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Bl(e.unaryFilter.field);return Zt.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Bl(e.unaryFilter.field);return Zt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Bl(e.unaryFilter.field);return Zt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Bl(e.unaryFilter.field);return Zt.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Yc()}}function Hl(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Kl(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Wl(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Jl(t)),t=Ql(e.get(n),t);return Jl(t)}function Ql(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Jl(e){return e+""}function Xl(e){const t=e.length;if(Zc(t>=2),2===t)return Zc(""===e.charAt(0)&&""===e.charAt(1)),dt.emptyPath();const n=t-2,r=[];let s="";for(let i=0;i<t;){const t=e.indexOf("",i);switch((t<0||t>n)&&Yc(),e.charAt(t+1)){case"":const n=e.substring(i,t);let o;0===s.length?o=n:(s+=n,o=s,s=""),r.push(o);break;case"":s+=e.substring(i,t),s+="\0";break;case"":s+=e.substring(i,t+1);break;default:Yc()}i=t+2}return new dt(r)}class Vs{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class Ss{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}Ss.store="owner",Ss.key="owner";class Ds{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}Ds.store="mutationQueues",Ds.keyPath="userId";class Cs{constructor(e,t,n,r,s){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=s}}Cs.store="mutations",Cs.keyPath="batchId",Cs.userMutationsIndex="userMutationsIndex",Cs.userMutationsKeyPath=["userId","batchId"];class Ns{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Wl(t)]}static key(e,t,n){return[e,Wl(t),n]}}Ns.store="documentMutations",Ns.PLACEHOLDER=new Ns;class ks{constructor(e,t){this.path=e,this.readTime=t}}class xs{constructor(e,t){this.path=e,this.version=t}}class $s{constructor(e,t,n,r,s,i){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=s,this.parentPath=i}}$s.store="remoteDocuments",$s.readTimeIndex="readTimeIndex",$s.readTimeIndexPath="readTime",$s.collectionReadTimeIndex="collectionReadTimeIndex",$s.collectionReadTimeIndexPath=["parentPath","readTime"];class Fs{constructor(e){this.byteSize=e}}Fs.store="remoteDocumentGlobal",Fs.key="remoteDocumentGlobalKey";class Os{constructor(e,t,n,r,s,i,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=i,this.query=o}}Os.store="targets",Os.keyPath="targetId",Os.queryTargetsIndexName="queryTargetsIndex",Os.queryTargetsKeyPath=["canonicalId","targetId"];class Ms{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}Ms.store="targetDocuments",Ms.keyPath=["targetId","path"],Ms.documentTargetsIndex="documentTargetsIndex",Ms.documentTargetsKeyPath=["path","targetId"];class Ls{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}Ls.key="targetGlobalKey",Ls.store="targetGlobal";class Bs{constructor(e,t){this.collectionId=e,this.parent=t}}Bs.store="collectionParents",Bs.keyPath=["collectionId","parent"];class Us{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}Us.store="clientMetadata",Us.keyPath="clientId";class qs{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}qs.store="bundles",qs.keyPath="bundleId";class Ks{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}Ks.store="namedQueries",Ks.keyPath="name";const Yl=[Ds.store,Cs.store,Ns.store,$s.store,Os.store,Ss.store,Ls.store,Ms.store,Us.store,Fs.store,Bs.store,qs.store,Ks.store],Zl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ws{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}class Gs{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Yc(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Gs(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Gs?t:Gs.resolve(t)}catch(e){return Gs.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Gs.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Gs.reject(t)}static resolve(e){return new Gs(((t,n)=>{t(e)}))}static reject(e){return new Gs(((t,n)=>{n(e)}))}static waitFor(e){return new Gs(((t,n)=>{let r=0,s=0,i=!1;e.forEach((e=>{++r,e.next((()=>{++s,i&&s===r&&t()}),(e=>n(e)))})),i=!0,s===r&&t()}))}static or(e){let t=Gs.resolve(!1);for(const n of e)t=t.next((e=>e?Gs.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}}class zs{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.It=new Q$1,this.transaction.oncomplete=()=>{this.It.resolve()},this.transaction.onabort=()=>{t.error?this.It.reject(new Ys(e,t.error)):this.It.resolve()},this.transaction.onerror=t=>{const n=rd(t.target.error);this.It.reject(new Ys(e,n))}}static open(e,t,n,r){try{return new zs(t,e.transaction(r,n))}catch(e){throw new Ys(t,e)}}get At(){return this.It.promise}abort(e){e&&this.It.reject(e),this.aborted||(Wc("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){const t=this.transaction.objectStore(e);return new Zs(t)}}class Hs{constructor(e,t,n){this.name=e,this.version=t,this.Rt=n,12.2===Hs.Pt(s())&&Qc("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Wc("SimpleDb","Removing database:",e),td(window.indexedDB.deleteDatabase(e)).toPromise()}static bt(){if("object"!=typeof indexedDB)return!1;if(Hs.vt())return!0;const e=s(),t=Hs.Pt(e),n=0<t&&t<10,r=Hs.Vt(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static vt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.St)}static Dt(e,t){return e.store(t)}static Pt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Vt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Ct(e){return this.db||(Wc("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Ys(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new j(iu.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new j(iu.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Ys(e,r))},r.onupgradeneeded=e=>{Wc("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.Rt.Nt(t,r.transaction,e.oldVersion,this.version).next((()=>{Wc("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.kt&&(this.db.onversionchange=e=>this.kt(e)),this.db}xt(e){this.kt=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const s="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.Ct(e);const t=zs.open(this.db,e,s?"readonly":"readwrite",n),i=r(t).catch((e=>(t.abort(e),Gs.reject(e)))).toPromise();return i.catch((()=>{})),await t.At,i}catch(e){const t="FirebaseError"!==e.name&&i<3;if(Wc("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Js{constructor(e){this.$t=e,this.Ft=!1,this.Ot=null}get isDone(){return this.Ft}get Mt(){return this.Ot}set cursor(e){this.$t=e}done(){this.Ft=!0}Lt(e){this.Ot=e}delete(){return td(this.$t.delete())}}class Ys extends j{constructor(e,t){super(iu.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ed(e){return"IndexedDbTransactionError"===e.name}class Zs{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Wc("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Wc("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),td(n)}add(e){return Wc("SimpleDb","ADD",this.store.name,e,e),td(this.store.add(e))}get(e){return td(this.store.get(e)).next((t=>(void 0===t&&(t=null),Wc("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return Wc("SimpleDb","DELETE",this.store.name,e),td(this.store.delete(e))}count(){return Wc("SimpleDb","COUNT",this.store.name),td(this.store.count())}Bt(e,t){const n=this.cursor(this.options(e,t)),r=[];return this.Ut(n,((e,t)=>{r.push(t)})).next((()=>r))}qt(e,t){Wc("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Kt=!1;const r=this.cursor(n);return this.Ut(r,((e,t,n)=>n.delete()))}jt(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.Ut(r,t)}Qt(e){const t=this.cursor({});return new Gs(((n,r)=>{t.onerror=e=>{const t=rd(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}Ut(e,t){const n=[];return new Gs(((r,s)=>{e.onerror=e=>{s(e.target.error)},e.onsuccess=e=>{const s=e.target.result;if(!s)return void r();const i=new Js(s),o=t(s.primaryKey,s.value,i);if(o instanceof Gs){const e=o.catch((e=>(i.done(),Gs.reject(e))));n.push(e)}i.isDone?r():null===i.Mt?s.continue():s.continue(i.Mt)}})).next((()=>Gs.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Kt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function td(e){return new Gs(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=rd(e.target.error);n(t)}}))}let nd=!1;function rd(e){const t=Hs.Pt(s());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new j("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nd||(nd=!0,setTimeout((()=>{throw e}),0)),e}}return e}class si extends Ws{constructor(e,t){super(),this.Wt=e,this.currentSequenceNumber=t}}function sd(e,t){const n=tu(e);return Hs.Dt(n.Wt,t)}class ri{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Hh(r,e,n[t])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Kh(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Kh(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach((t=>{const n=e.get(t.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(ct.min())}))}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ll())}isEqual(e){return this.batchId===e.batchId&&lu(this.mutations,e.mutations,((e,t)=>Qh(e,t)))&&lu(this.baseMutations,e.baseMutations,((e,t)=>Qh(e,t)))}}class oi{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Zc(e.mutations.length===n.length);let r=ul();const s=e.mutations;for(let e=0;e<s.length;e++)r=r.insert(s[e].key,n[e].version);return new oi(e,t,n,r)}}class ai{constructor(e,t,n,r,s=ct.min(),i=ct.min(),o=yt.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(e){return new ai(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new ai(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ai(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class ci{constructor(e){this.Gt=e}}function id(e,t){if(t.document)return Dl(e.Gt,t.document,!!t.hasCommittedMutations);if(t.noDocument){const e=St.fromSegments(t.noDocument.path),n=hd(t.noDocument.readTime),r=Wt.newNoDocument(e,n);return t.hasCommittedMutations?r.setHasCommittedMutations():r}if(t.unknownDocument){const e=St.fromSegments(t.unknownDocument.path),n=hd(t.unknownDocument.version);return Wt.newUnknownDocument(e,n)}return Yc()}function od(e,t,n){const r=ad(n),s=t.key.path.popLast().toArray();if(t.isFoundDocument()){const n=function(e,t){return{name:El(e,t.key),fields:t.data.value.mapValue.fields,updateTime:vl(e,t.version.toTimestamp())}}(e.Gt,t),i=t.hasCommittedMutations;return new $s(null,null,n,i,r,s)}if(t.isNoDocument()){const e=t.key.path.toArray(),n=ud(t.version),i=t.hasCommittedMutations;return new $s(null,new ks(e,n),null,i,r,s)}if(t.isUnknownDocument()){const e=t.key.path.toArray(),n=ud(t.version);return new $s(new xs(e,n),null,null,!0,r,s)}return Yc()}function ad(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function cd(e){const t=new at(e[0],e[1]);return ct.fromTimestamp(t)}function ud(e){const t=e.toTimestamp();return new Vs(t.seconds,t.nanoseconds)}function hd(e){const t=new at(e.seconds,e.nanoseconds);return ct.fromTimestamp(t)}function ld(e,t){const n=(t.baseMutations||[]).map((t=>Pl(e.Gt,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Pl(e.Gt,t))),s=at.fromMillis(t.localWriteTimeMs);return new ri(t.batchId,s,n,r)}function dd(e){const t=hd(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?hd(e.lastLimboFreeSnapshotVersion):ct.min();let r;var s;return void 0!==e.query.documents?(Zc(1===(s=e.query).documents.length),r=Ah(wh(kl(s.documents[0])))):r=function(e){return Ah(Ml(e))}(e.query),new ai(r,e.targetId,0,e.lastListenSequenceNumber,t,n,yt.fromBase64String(e.resumeToken))}function fd(e,t){const n=ud(t.snapshotVersion),r=ud(t.lastLimboFreeSnapshotVersion);let s;s=dh(t.target)?Ll(e.Gt,t.target):xl(e.Gt,t.target);const i=t.resumeToken.toBase64();return new Os(t.targetId,uh(t.target),n,i,t.sequenceNumber,r,s)}function pd(e){const t=Ml({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?kh(t,t.limit,"L"):t}class pi{getBundleMetadata(e,t){return md(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:hd(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return md(e).put({bundleId:(n=t).id,createTime:ud(_l(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return gd(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:pd(t.bundledQuery),readTime:hd(t.readTime)};var t}))}saveNamedQuery(e,t){return gd(e).put(function(e){return{name:e.name,readTime:ud(_l(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function md(e){return sd(e,qs.store)}function gd(e){return sd(e,Ks.store)}class Ii{constructor(){this.zt=new Ai}addToCollectionParentIndex(e,t){return this.zt.add(t),Gs.resolve()}getCollectionParents(e,t){return Gs.resolve(this.zt.getEntries(t))}}class Ai{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Tn(dt.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Tn(dt.comparator)).toArray()}}class Ri{constructor(){this.Ht=new Ai}addToCollectionParentIndex(e,t){if(!this.Ht.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.Ht.add(t)}));const s={collectionId:n,parent:Wl(r)};return yd(e).put(s)}return Gs.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[du(t),""],!1,!0);return yd(e).Bt(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Xl(r.parent))}return n}))}}function yd(e){return sd(e,Bs.store)}const vd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class vi{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new vi(e,vi.DEFAULT_COLLECTION_PERCENTILE,vi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function wd(e,t,n){const r=e.store(Cs.store),s=e.store(Ns.store),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.jt({range:o},((e,t,n)=>(a++,n.delete())));i.push(c.next((()=>{Zc(1===a)})));const u=[];for(const e of n.mutations){const r=Ns.key(t,e.key.path,n.batchId);i.push(s.delete(r)),u.push(e.key)}return Gs.waitFor(i).next((()=>u))}function Id(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Yc();t=e.noDocument}return JSON.stringify(t).length}vi.DEFAULT_COLLECTION_PERCENTILE=10,vi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,vi.DEFAULT=new vi(41943040,vi.DEFAULT_COLLECTION_PERCENTILE,vi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),vi.DISABLED=new vi(-1,0,0);class Di{constructor(e,t,n,r){this.userId=e,this.k=t,this.Jt=n,this.referenceDelegate=r,this.Yt={}}static Xt(e,t,n,r){Zc(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Di(s,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return bd(e).jt({index:Cs.userMutationsIndex,range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const s=Td(e),i=bd(e);return i.add({}).next((o=>{Zc("number"==typeof o);const a=new ri(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>Ol(e.Gt,t))),s=n.mutations.map((t=>Ol(e.Gt,t)));return new Cs(t,n.batchId,n.localWriteTime.toMillis(),r,s)}(this.k,this.userId,a),u=[];let h=new Tn(((e,t)=>hu(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Ns.key(this.userId,e.key.path,o);h=h.add(e.key.path.popLast()),u.push(i.put(c)),u.push(s.put(t,Ns.PLACEHOLDER))}return h.forEach((t=>{u.push(this.Jt.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Yt[o]=a.keys()})),Gs.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return bd(e).get(t).next((e=>e?(Zc(e.userId===this.userId),ld(this.k,e)):null))}Zt(e,t){return this.Yt[t]?Gs.resolve(this.Yt[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Yt[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return bd(e).jt({index:Cs.userMutationsIndex,range:r},((e,t,r)=>{t.userId===this.userId&&(Zc(t.batchId>=n),s=ld(this.k,t)),r.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return bd(e).jt({index:Cs.userMutationsIndex,range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return bd(e).Bt(Cs.userMutationsIndex,t).next((e=>e.map((e=>ld(this.k,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Ns.prefixForPath(this.userId,t.path),r=IDBKeyRange.lowerBound(n),s=[];return Td(e).jt({range:r},((n,r,i)=>{const[o,a,c]=n,u=Xl(a);if(o===this.userId&&t.path.isEqual(u))return bd(e).get(c).next((e=>{if(!e)throw Yc();Zc(e.userId===this.userId),s.push(ld(this.k,e))}));i.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Tn(hu);const r=[];return t.forEach((t=>{const s=Ns.prefixForPath(this.userId,t.path),i=IDBKeyRange.lowerBound(s),o=Td(e).jt({range:i},((e,r,s)=>{const[i,o,a]=e,c=Xl(o);i===this.userId&&t.path.isEqual(c)?n=n.add(a):s.done()}));r.push(o)})),Gs.waitFor(r).next((()=>this.te(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,s=Ns.prefixForPath(this.userId,n),i=IDBKeyRange.lowerBound(s);let o=new Tn(hu);return Td(e).jt({range:i},((e,t,s)=>{const[i,a,c]=e,u=Xl(a);i===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):s.done()})).next((()=>this.te(e,o)))}te(e,t){const n=[],r=[];return t.forEach((t=>{r.push(bd(e).get(t).next((e=>{if(null===e)throw Yc();Zc(e.userId===this.userId),n.push(ld(this.k,e))})))})),Gs.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return wd(e.Wt,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.ee(t.batchId)})),Gs.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}ee(e){delete this.Yt[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Gs.resolve();const n=IDBKeyRange.lowerBound(Ns.prefixForUser(this.userId)),r=[];return Td(e).jt({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Xl(e[1]);r.push(t)}else n.done()})).next((()=>{Zc(0===r.length)}))}))}containsKey(e,t){return _d(e,this.userId,t)}ne(e){return Ed(e).get(this.userId).next((e=>e||new Ds(this.userId,-1,"")))}}function _d(e,t,n){const r=Ns.prefixForPath(t,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Td(e).jt({range:i,Kt:!0},((e,n,r)=>{const[i,a,c]=e;i===t&&a===s&&(o=!0),r.done()})).next((()=>o))}function bd(e){return sd(e,Cs.store)}function Td(e){return sd(e,Ns.store)}function Ed(e){return sd(e,Ds.store)}class $i{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new $i(0)}static re(){return new $i(-1)}}class Fi{constructor(e,t){this.referenceDelegate=e,this.k=t}allocateTargetId(e){return this.oe(e).next((t=>{const n=new $i(t.highestTargetId);return t.highestTargetId=n.next(),this.ae(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.oe(e).next((e=>ct.fromTimestamp(new at(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.oe(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.oe(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.ae(e,r))))}addTargetData(e,t){return this.ce(e,t).next((()=>this.oe(e).next((n=>(n.targetCount+=1,this.ue(t,n),this.ae(e,n))))))}updateTargetData(e,t){return this.ce(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Sd(e).delete(t.targetId))).next((()=>this.oe(e))).next((t=>(Zc(t.targetCount>0),t.targetCount-=1,this.ae(e,t))))}removeTargets(e,t,n){let r=0;const s=[];return Sd(e).jt(((i,o)=>{const a=dd(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,s.push(this.removeTargetData(e,a)))})).next((()=>Gs.waitFor(s))).next((()=>r))}forEachTarget(e,t){return Sd(e).jt(((e,n)=>{const r=dd(n);t(r)}))}oe(e){return Ad(e).get(Ls.key).next((e=>(Zc(null!==e),e)))}ae(e,t){return Ad(e).put(Ls.key,t)}ce(e,t){return Sd(e).put(fd(this.k,t))}ue(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.oe(e).next((e=>e.targetCount))}getTargetData(e,t){const n=uh(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Sd(e).jt({range:r,index:Os.queryTargetsIndexName},((e,n,r)=>{const i=dd(n);hh(t,i.target)&&(s=i,r.done())})).next((()=>s))}addMatchingKeys(e,t,n){const r=[],s=kd(e);return t.forEach((t=>{const i=Wl(t.path);r.push(s.put(new Ms(n,i))),r.push(this.referenceDelegate.addReference(e,n,t))})),Gs.waitFor(r)}removeMatchingKeys(e,t,n){const r=kd(e);return Gs.forEach(t,(t=>{const s=Wl(t.path);return Gs.waitFor([r.delete([n,s]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=kd(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=kd(e);let s=ll();return r.jt({range:n,Kt:!0},((e,t,n)=>{const r=Xl(e[1]),i=new St(r);s=s.add(i)})).next((()=>s))}containsKey(e,t){const n=Wl(t.path),r=IDBKeyRange.bound([n],[du(n)],!1,!0);let s=0;return kd(e).jt({index:Ms.documentTargetsIndex,Kt:!0,range:r},(([e,t],n,r)=>{0!==e&&(s++,r.done())})).next((()=>s>0))}Et(e,t){return Sd(e).get(t).next((e=>e?dd(e):null))}}function Sd(e){return sd(e,Os.store)}function Ad(e){return sd(e,Ls.store)}function kd(e){return sd(e,Ms.store)}async function Cd(e){if(e.code!==iu.FAILED_PRECONDITION||e.message!==Zl)throw e;Wc("LocalStore","Unexpectedly lost primary lease")}function Rd([e,t],[n,r]){const s=hu(e,n);return 0===s?hu(t,r):s}class qi{constructor(e){this.he=e,this.buffer=new Tn(Rd),this.le=0}fe(){return++this.le}de(e){const t=[e,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Rd(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Ki{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.we=!1,this._e=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.me(e)}stop(){this._e&&(this._e.cancel(),this._e=null)}get started(){return null!==this._e}me(e){const t=this.we?3e5:6e4;Wc("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this._e=null,this.we=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){ed(e)?Wc("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Cd(e)}await this.me(e)}))}}class ji{constructor(e,t){this.ge=e,this.params=t}calculateTargetCount(e,t){return this.ge.ye(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Gs.resolve(et.I);const n=new qi(t);return this.ge.forEachTarget(e,(e=>n.de(e.sequenceNumber))).next((()=>this.ge.pe(e,(e=>n.de(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.ge.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.ge.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Wc("LruGarbageCollector","Garbage collection skipped; disabled"),Gs.resolve(vd)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(Wc("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vd):this.Te(e,t)))}getCacheSize(e){return this.ge.getCacheSize(e)}Te(e,t){let n,r,s,i,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(Wc("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,i=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(s=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),Kc()<=w.DEBUG&&Wc("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-u}ms\n\tDetermined least recently used ${r} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Gs.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:e}))))}}class Qi{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new ji(e,t)}(this,t)}ye(e){const t=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Ee(e){let t=0;return this.pe(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pe(e,t){return this.Ie(e,((e,n)=>t(n)))}addReference(e,t,n){return Nd(e,n)}removeReference(e,t,n){return Nd(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Nd(e,t)}Ae(e,t){return function(e,t){let n=!1;return Ed(e).Qt((r=>_d(e,r,t).next((e=>(e&&(n=!0),Gs.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Ie(e,((i,o)=>{if(o<=t){const t=this.Ae(e,i).next((t=>{if(!t)return s++,n.getEntry(e,i).next((()=>(n.removeEntry(i),kd(e).delete([0,Wl(i.path)]))))}));r.push(t)}})).next((()=>Gs.waitFor(r))).next((()=>n.apply(e))).next((()=>s))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Nd(e,t)}Ie(e,t){const n=kd(e);let r,s=et.I;return n.jt({index:Ms.documentTargetsIndex},(([e,n],{path:i,sequenceNumber:o})=>{0===e?(s!==et.I&&t(new St(Xl(r)),s),s=o,r=i):s=et.I})).next((()=>{s!==et.I&&t(new St(Xl(r)),s)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Nd(e,t){return kd(e).put(function(e,t){return new Ms(0,Wl(e.path),t)}(t,e.currentSequenceNumber))}class Gi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}forEach(e){yu(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return vu(this.inner)}}class zi{constructor(){this.changes=new Gi((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:ct.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:Wt.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Gs.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Hi{constructor(e,t){this.k=e,this.Jt=t}addEntry(e,t,n){return Od(e).put(Pd(t),n)}removeEntry(e,t){const n=Od(e),r=Pd(t);return n.delete(r)}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Re(e,n))))}getEntry(e,t){return Od(e).get(Pd(t)).next((e=>this.Pe(t,e)))}be(e,t){return Od(e).get(Pd(t)).next((e=>({document:this.Pe(t,e),size:Id(e)})))}getEntries(e,t){let n=il();return this.ve(e,t,((e,t)=>{const r=this.Pe(e,t);n=n.insert(e,r)})).next((()=>n))}Ve(e,t){let n=il(),r=new gn(St.comparator);return this.ve(e,t,((e,t)=>{const s=this.Pe(e,t);n=n.insert(e,s),r=r.insert(e,Id(t))})).next((()=>({documents:n,Se:r})))}ve(e,t,n){if(t.isEmpty())return Gs.resolve();const r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),s=t.getIterator();let i=s.getNext();return Od(e).jt({range:r},((e,t,r)=>{const o=St.fromSegments(e);for(;i&&St.comparator(i,o)<0;)n(i,null),i=s.getNext();i&&i.isEqual(o)&&(n(i,t),i=s.hasNext()?s.getNext():null),i?r.Lt(i.path.toArray()):r.done()})).next((()=>{for(;i;)n(i,null),i=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n){let r=il();const s=t.path.length+1,i={};if(n.isEqual(ct.min())){const e=t.path.toArray();i.range=IDBKeyRange.lowerBound(e)}else{const e=t.path.toArray(),r=ad(n);i.range=IDBKeyRange.lowerBound([e,r],!0),i.index=$s.collectionReadTimeIndex}return Od(e).jt(i,((e,n,i)=>{if(e.length!==s)return;const o=id(this.k,n);t.path.isPrefixOf(o.key.path)?Dh(t,o)&&(r=r.insert(o.key,o)):i.done()})).next((()=>r))}newChangeBuffer(e){return new Ji(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return Dd(e).get(Fs.key).next((e=>(Zc(!!e),e)))}Re(e,t){return Dd(e).put(Fs.key,t)}Pe(e,t){if(t){const e=id(this.k,t);if(!e.isNoDocument()||!e.version.isEqual(ct.min()))return e}return Wt.newInvalidDocument(e)}}class Ji extends zi{constructor(e,t){super(),this.De=e,this.trackRemovals=t,this.Ce=new Gi((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new Tn(((e,t)=>hu(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((s,i)=>{const o=this.Ce.get(s);if(i.document.isValidDocument()){const a=od(this.De.k,i.document,this.getReadTime(s));r=r.add(s.path.popLast());const c=Id(a);n+=c-o,t.push(this.De.addEntry(e,s,a))}else if(n-=o,this.trackRemovals){const n=od(this.De.k,Wt.newNoDocument(s,ct.min()),this.getReadTime(s));t.push(this.De.addEntry(e,s,n))}else t.push(this.De.removeEntry(e,s))})),r.forEach((n=>{t.push(this.De.Jt.addToCollectionParentIndex(e,n))})),t.push(this.De.updateMetadata(e,n)),Gs.waitFor(t)}getFromCache(e,t){return this.De.be(e,t).next((e=>(this.Ce.set(t,e.size),e.document)))}getAllFromCache(e,t){return this.De.Ve(e,t).next((({documents:e,Se:t})=>(t.forEach(((e,t)=>{this.Ce.set(e,t)})),e)))}}function Dd(e){return sd(e,Fs.store)}function Od(e){return sd(e,$s.store)}function Pd(e){return e.path.toArray()}class tr{constructor(e){this.k=e}Nt(e,t,n,r){Zc(n<r&&n>=0&&r<=11);const s=new zs("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(Ss.store)}(e),function(e){e.createObjectStore(Ds.store,{keyPath:Ds.keyPath}),e.createObjectStore(Cs.store,{keyPath:Cs.keyPath,autoIncrement:!0}).createIndex(Cs.userMutationsIndex,Cs.userMutationsKeyPath,{unique:!0}),e.createObjectStore(Ns.store)}(e),Ld(e),function(e){e.createObjectStore($s.store)}(e));let i=Gs.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(Ms.store),e.deleteObjectStore(Os.store),e.deleteObjectStore(Ls.store)}(e),Ld(e)),i=i.next((()=>function(e){const t=e.store(Ls.store),n=new Ls(0,0,ct.min().toTimestamp(),0);return t.put(Ls.key,n)}(s)))),n<4&&r>=4&&(0!==n&&(i=i.next((()=>function(e,t){return t.store(Cs.store).Bt().next((n=>{e.deleteObjectStore(Cs.store),e.createObjectStore(Cs.store,{keyPath:Cs.keyPath,autoIncrement:!0}).createIndex(Cs.userMutationsIndex,Cs.userMutationsKeyPath,{unique:!0});const r=t.store(Cs.store),s=n.map((e=>r.put(e)));return Gs.waitFor(s)}))}(e,s)))),i=i.next((()=>{!function(e){e.createObjectStore(Us.store,{keyPath:Us.keyPath})}(e)}))),n<5&&r>=5&&(i=i.next((()=>this.Ne(s)))),n<6&&r>=6&&(i=i.next((()=>(function(e){e.createObjectStore(Fs.store)}(e),this.ke(s))))),n<7&&r>=7&&(i=i.next((()=>this.xe(s)))),n<8&&r>=8&&(i=i.next((()=>this.$e(e,s)))),n<9&&r>=9&&(i=i.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){const t=e.objectStore($s.store);t.createIndex($s.readTimeIndex,$s.readTimeIndexPath,{unique:!1}),t.createIndex($s.collectionReadTimeIndex,$s.collectionReadTimeIndexPath,{unique:!1})}(t)}))),n<10&&r>=10&&(i=i.next((()=>this.Fe(s)))),n<11&&r>=11&&(i=i.next((()=>{!function(e){e.createObjectStore(qs.store,{keyPath:qs.keyPath})}(e),function(e){e.createObjectStore(Ks.store,{keyPath:Ks.keyPath})}(e)}))),i}ke(e){let t=0;return e.store($s.store).jt(((e,n)=>{t+=Id(n)})).next((()=>{const n=new Fs(t);return e.store(Fs.store).put(Fs.key,n)}))}Ne(e){const t=e.store(Ds.store),n=e.store(Cs.store);return t.Bt().next((t=>Gs.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.Bt(Cs.userMutationsIndex,r).next((n=>Gs.forEach(n,(n=>{Zc(n.userId===t.userId);const r=ld(this.k,n);return wd(e,t.userId,r).next((()=>{}))}))))}))))}xe(e){const t=e.store(Ms.store),n=e.store($s.store);return e.store(Ls.store).get(Ls.key).next((e=>{const r=[];return n.jt(((n,s)=>{const i=new dt(n),o=function(e){return[0,Wl(e)]}(i);r.push(t.get(o).next((n=>n?Gs.resolve():(n=>t.put(new Ms(0,Wl(n),e.highestListenSequenceNumber)))(i))))})).next((()=>Gs.waitFor(r)))}))}$e(e,t){e.createObjectStore(Bs.store,{keyPath:Bs.keyPath});const n=t.store(Bs.store),r=new Ai,s=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Wl(r)})}};return t.store($s.store).jt({Kt:!0},((e,t)=>{const n=new dt(e);return s(n.popLast())})).next((()=>t.store(Ns.store).jt({Kt:!0},(([e,t,n],r)=>{const i=Xl(t);return s(i.popLast())}))))}Fe(e){const t=e.store(Os.store);return t.jt(((e,n)=>{const r=dd(n),s=fd(this.k,r);return t.put(s)}))}}function Ld(e){e.createObjectStore(Ms.store,{keyPath:Ms.keyPath}).createIndex(Ms.documentTargetsIndex,Ms.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Os.store,{keyPath:Os.keyPath}).createIndex(Os.queryTargetsIndexName,Os.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Ls.store)}const xd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class sr{constructor(e,t,n,r,s,i,o,a,c,u){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Oe=s,this.window=i,this.document=o,this.Me=c,this.Le=u,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=e=>Promise.resolve(),!sr.bt())throw new j(iu.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Qi(this,r),this.Ge=t+"main",this.k=new ci(a),this.ze=new Hs(this.Ge,11,new tr(this.k)),this.He=new Fi(this.referenceDelegate,this.k),this.Jt=new Ri,this.Je=function(e,t){return new Hi(e,t)}(this.k,this.Jt),this.Ye=new pi,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===u&&Qc("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ze().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new j(iu.FAILED_PRECONDITION,xd);return this.tn(),this.en(),this.nn(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.He.getHighestSequenceNumber(e)))})).then((e=>{this.Be=new et(e,this.Me)})).then((()=>{this.Ue=!0})).catch((e=>(this.ze&&this.ze.close(),Promise.reject(e))))}sn(e){return this.We=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ze.xt((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget((async()=>{this.started&&await this.Ze()})))}Ze(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Ud(e).put(new Us(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next((()=>{if(this.isPrimary)return this.rn(e).next((e=>{e||(this.isPrimary=!1,this.Oe.enqueueRetryable((()=>this.We(!1))))}))})).next((()=>this.on(e))).next((t=>this.isPrimary&&!t?this.an(e).next((()=>!1)):!!t&&this.cn(e).next((()=>!0)))))).catch((e=>{if(ed(e))return Wc("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Wc("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Oe.enqueueRetryable((()=>this.We(e))),this.isPrimary=e}))}rn(e){return Md(e).get(Ss.key).next((e=>Gs.resolve(this.un(e))))}hn(e){return Ud(e).delete(this.clientId)}async ln(){if(this.isPrimary&&!this.fn(this.Qe,18e5)){this.Qe=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=sd(e,Us.store);return t.Bt().next((e=>{const n=this.dn(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return Gs.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.Xe)for(const t of e)this.Xe.removeItem(this.wn(t.clientId))}}nn(){this.je=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Ze().then((()=>this.ln())).then((()=>this.nn()))))}un(e){return!!e&&e.ownerId===this.clientId}on(e){return this.Le?Gs.resolve(!0):Md(e).get(Ss.key).next((t=>{if(null!==t&&this.fn(t.leaseTimestampMs,5e3)&&!this._n(t.ownerId)){if(this.un(t)&&this.networkEnabled)return!0;if(!this.un(t)){if(!t.allowTabSynchronization)throw new j(iu.FAILED_PRECONDITION,xd);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ud(e).Bt().next((e=>void 0===this.dn(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&Wc("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Ue=!1,this.mn(),this.je&&(this.je.cancel(),this.je=null),this.gn(),this.yn(),await this.ze.runTransaction("shutdown","readwrite",[Ss.store,Us.store],(e=>{const t=new si(e,et.I);return this.an(t).next((()=>this.hn(t)))})),this.ze.close(),this.pn()}dn(e,t){return e.filter((e=>this.fn(e.updateTimeMs,t)&&!this._n(e.clientId)))}Tn(){return this.runTransaction("getActiveClients","readonly",(e=>Ud(e).Bt().next((e=>this.dn(e,18e5).map((e=>e.clientId))))))}get started(){return this.Ue}getMutationQueue(e){return Di.Xt(e,this.k,this.Jt,this.referenceDelegate)}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getIndexManager(){return this.Jt}getBundleCache(){return this.Ye}runTransaction(e,t,n){Wc("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite";let s;return this.ze.runTransaction(e,r,Yl,(r=>(s=new si(r,this.Be?this.Be.next():et.I),"readwrite-primary"===t?this.rn(s).next((e=>!!e||this.on(s))).next((t=>{if(!t)throw Qc(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable((()=>this.We(!1))),new j(iu.FAILED_PRECONDITION,Zl);return n(s)})).next((e=>this.cn(s).next((()=>e)))):this.En(s).next((()=>n(s)))))).then((e=>(s.raiseOnCommittedEvent(),e)))}En(e){return Md(e).get(Ss.key).next((e=>{if(null!==e&&this.fn(e.leaseTimestampMs,5e3)&&!this._n(e.ownerId)&&!this.un(e)&&!(this.Le||this.allowTabSynchronization&&e.allowTabSynchronization))throw new j(iu.FAILED_PRECONDITION,xd)}))}cn(e){const t=new Ss(this.clientId,this.allowTabSynchronization,Date.now());return Md(e).put(Ss.key,t)}static bt(){return Hs.bt()}an(e){const t=Md(e);return t.get(Ss.key).next((e=>this.un(e)?(Wc("IndexedDbPersistence","Releasing primary lease."),t.delete(Ss.key)):Gs.resolve()))}fn(e,t){const n=Date.now();return!(e<n-t||e>n&&(Qc(`Detected an update time that is in the future: ${e} > ${n}`),1))}tn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ke=()=>{this.Oe.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Ze())))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}gn(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}en(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.qe=()=>{this.mn(),u()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.qe))}yn(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}_n(e){var t;try{const n=null!==(null===(t=this.Xe)||void 0===t?void 0:t.getItem(this.wn(e)));return Wc("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Qc("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}mn(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(e){Qc("Failed to set zombie client id.",e)}}pn(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(e){}}wn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Md(e){return sd(e,Ss.store)}function Ud(e){return sd(e,Us.store)}function Fd(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class ar{constructor(e,t){this.progress=e,this.In=t}}class cr{constructor(e,t,n){this.Je=e,this.An=t,this.Jt=n}Rn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next((n=>this.Pn(e,t,n)))}Pn(e,t,n){return this.Je.getEntry(e,t).next((e=>{for(const t of n)t.applyToLocalView(e);return e}))}bn(e,t){e.forEach(((e,n)=>{for(const e of t)e.applyToLocalView(n)}))}vn(e,t){return this.Je.getEntries(e,t).next((t=>this.Vn(e,t).next((()=>t))))}Vn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>this.bn(t,e)))}getDocumentsMatchingQuery(e,t,n){return function(e){return St.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Sn(e,t.path):Eh(t)?this.Dn(e,t,n):this.Cn(e,t,n)}Sn(e,t){return this.Rn(e,new St(t)).next((e=>{let t=al();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}Dn(e,t,n){const r=t.collectionGroup;let s=al();return this.Jt.getCollectionParents(e,r).next((i=>Gs.forEach(i,(i=>{const o=function(e,t){return new _e(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,i.child(r));return this.Cn(e,o,n).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}Cn(e,t,n){let r,s;return this.Je.getDocumentsMatchingQuery(e,t,n).next((n=>(r=n,this.An.getAllMutationBatchesAffectingQuery(e,t)))).next((t=>(s=t,this.Nn(e,s,r).next((e=>{r=e;for(const e of s)for(const t of e.mutations){const n=t.key;let s=r.get(n);null==s&&(s=Wt.newInvalidDocument(n),r=r.insert(n,s)),Kh(t,s,e.localWriteTime),s.isFoundDocument()||(r=r.remove(n))}}))))).next((()=>(r.forEach(((e,n)=>{Dh(t,n)||(r=r.remove(e))})),r)))}Nn(e,t,n){let r=ll();for(const e of t)for(const t of e.mutations)t instanceof on&&null===n.get(t.key)&&(r=r.add(t.key));let s=n;return this.Je.getEntries(e,r).next((e=>(e.forEach(((e,t)=>{t.isFoundDocument()&&(s=s.insert(e,t))})),s)))}}class ur{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.kn=n,this.xn=r}static $n(e,t){let n=ll(),r=ll();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new ur(e,t.fromCache,n,r)}}class hr{Fn(e){this.On=e}getDocumentsMatchingQuery(e,t,n,r){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(ct.min())?this.Mn(e,t):this.On.vn(e,r).next((s=>{const i=this.Ln(t,s);return(Ih(t)||_h(t))&&this.Bn(t.limitType,i,r,n)?this.Mn(e,t):(Kc()<=w.DEBUG&&Wc("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Nh(t)),this.On.getDocumentsMatchingQuery(e,t,n).next((e=>(i.forEach((t=>{e=e.insert(t.key,t)})),e))))}))}Ln(e,t){let n=new Tn(Oh(e));return t.forEach(((t,r)=>{Dh(e,r)&&(n=n.add(r))})),n}Bn(e,t,n,r){if(n.size!==t.size)return!0;const s="F"===e?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Mn(e,t){return Kc()<=w.DEBUG&&Wc("QueryEngine","Using full collection scan to execute query:",Nh(t)),this.On.getDocumentsMatchingQuery(e,t,ct.min())}}class lr{constructor(e,t,n,r){this.persistence=e,this.Un=t,this.k=r,this.qn=new gn(hu),this.Kn=new Gi((e=>uh(e)),hh),this.jn=ct.min(),this.An=e.getMutationQueue(n),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new cr(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.Fn(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.qn)))}}function Vd(e,t,n,r){return new lr(e,t,n,r)}async function jd(e,t){const n=tu(e);let r=n.An,s=n.Wn;const i=await n.persistence.runTransaction("Handle user change","readonly",(e=>{let i;return n.An.getAllMutationBatches(e).next((o=>(i=o,r=n.persistence.getMutationQueue(t),s=new cr(n.Qn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(e)))).next((t=>{const n=[],r=[];let o=ll();for(const e of i){n.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return s.vn(e,o).next((e=>({Gn:e,removedBatchIds:n,addedBatchIds:r})))}))}));return n.An=r,n.Wn=s,n.Un.Fn(n.Wn),i}function qd(e){const t=tu(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.He.getLastRemoteSnapshotVersion(e)))}function $d(e,t,n,r,s){let i=ll();return n.forEach((e=>i=i.add(e))),t.getEntries(e,i).next((e=>{let i=il();return n.forEach(((n,o)=>{const a=e.get(n),c=(null==s?void 0:s.get(n))||r;o.isNoDocument()&&o.version.isEqual(ct.min())?(t.removeEntry(n,c),i=i.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o,c),i=i.insert(n,o)):Wc("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)})),i}))}function Bd(e,t){const n=tu(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.An.getNextMutationBatchAfterBatchId(e,t))))}function Gd(e,t){const n=tu(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.He.getTargetData(e,t).next((s=>s?(r=s,Gs.resolve(r)):n.He.allocateTargetId(e).next((s=>(r=new ai(t,s,0,e.currentSequenceNumber),n.He.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.qn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qn=n.qn.insert(e.targetId,e),n.Kn.set(t,e.targetId)),e}))}async function zd(e,t,n){const r=tu(e),s=r.qn.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(e=>r.persistence.referenceDelegate.removeTarget(e,s)))}catch(e){if(!ed(e))throw e;Wc("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.qn=r.qn.remove(t),r.Kn.delete(s.target)}function Hd(e,t,n){const r=tu(e);let s=ct.min(),i=ll();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=tu(e),s=r.Kn.get(n);return void 0!==s?Gs.resolve(r.qn.get(s)):r.He.getTargetData(t,n)}(r,e,Ah(t)).next((t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(e,t.targetId).next((e=>{i=e}))})).next((()=>r.Un.getDocumentsMatchingQuery(e,t,n?s:ct.min(),n?i:ll()))).next((e=>({documents:e,zn:i})))))}function Kd(e,t){const n=tu(e),r=tu(n.He),s=n.qn.get(t);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.Et(e,t).next((e=>e?e.target:null))))}function Wd(e){const t=tu(e);return t.persistence.runTransaction("Get new document changes","readonly",(e=>function(e,t,n){const r=tu(e);let s=il(),i=ad(n);const o=Od(t),a=IDBKeyRange.lowerBound(i,!0);return o.jt({index:$s.readTimeIndex,range:a},((e,t)=>{const n=id(r.k,t);s=s.insert(n.key,n),i=t.readTime})).next((()=>({In:s,readTime:cd(i)})))}(t.Qn,e,t.jn))).then((({In:e,readTime:n})=>(t.jn=n,e)))}async function Qd(e,t,n=ll()){const r=await Gd(e,Ah(pd(t.bundledQuery))),s=tu(e);return s.persistence.runTransaction("Save named query","readwrite",(e=>{const i=_l(t.readTime);if(r.snapshotVersion.compareTo(i)>=0)return s.Ye.saveNamedQuery(e,t);const o=r.withResumeToken(yt.EMPTY_BYTE_STRING,i);return s.qn=s.qn.insert(o.targetId,o),s.He.updateTargetData(e,o).next((()=>s.He.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>s.He.addMatchingKeys(e,n,r.targetId))).next((()=>s.Ye.saveNamedQuery(e,t)))}))}class vr{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,t){return Gs.resolve(this.Xn.get(t))}saveBundleMetadata(e,t){var n;return this.Xn.set(t.id,{id:(n=t).id,version:n.version,createTime:_l(n.createTime)}),Gs.resolve()}getNamedQuery(e,t){return Gs.resolve(this.Zn.get(t))}saveNamedQuery(e,t){return this.Zn.set(t.name,function(e){return{name:e.name,query:pd(e.bundledQuery),readTime:_l(e.readTime)}}(t)),Gs.resolve()}}class Vr{constructor(){this.ts=new Tn(Sr.es),this.ns=new Tn(Sr.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,t){const n=new Sr(e,t);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}rs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.os(new Sr(e,t))}cs(e,t){e.forEach((e=>this.removeReference(e,t)))}us(e){const t=new St(new dt([])),n=new Sr(t,e),r=new Sr(t,e+1),s=[];return this.ns.forEachInRange([n,r],(e=>{this.os(e),s.push(e.key)})),s}hs(){this.ts.forEach((e=>this.os(e)))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const t=new St(new dt([])),n=new Sr(t,e),r=new Sr(t,e+1);let s=ll();return this.ns.forEachInRange([n,r],(e=>{s=s.add(e.key)})),s}containsKey(e){const t=new Sr(e,0),n=this.ts.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Sr{constructor(e,t){this.key=e,this.fs=t}static es(e,t){return St.comparator(e.key,t.key)||hu(e.fs,t.fs)}static ss(e,t){return hu(e.fs,t.fs)||St.comparator(e.key,t.key)}}class Dr{constructor(e,t){this.Jt=e,this.referenceDelegate=t,this.An=[],this.ds=1,this.ws=new Tn(Sr.es)}checkEmpty(e){return Gs.resolve(0===this.An.length)}addMutationBatch(e,t,n,r){const s=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];const i=new ri(s,t,n,r);this.An.push(i);for(const t of r)this.ws=this.ws.add(new Sr(t.key,s)),this.Jt.addToCollectionParentIndex(e,t.key.path.popLast());return Gs.resolve(i)}lookupMutationBatch(e,t){return Gs.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.gs(n),s=r<0?0:r;return Gs.resolve(this.An.length>s?this.An[s]:null)}getHighestUnacknowledgedBatchId(){return Gs.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(e){return Gs.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Sr(t,0),r=new Sr(t,Number.POSITIVE_INFINITY),s=[];return this.ws.forEachInRange([n,r],(e=>{const t=this._s(e.fs);s.push(t)})),Gs.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Tn(hu);return t.forEach((e=>{const t=new Sr(e,0),r=new Sr(e,Number.POSITIVE_INFINITY);this.ws.forEachInRange([t,r],(e=>{n=n.add(e.fs)}))})),Gs.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;St.isDocumentKey(s)||(s=s.child(""));const i=new Sr(new St(s),0);let o=new Tn(hu);return this.ws.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.fs)),!0)}),i),Gs.resolve(this.ys(o))}ys(e){const t=[];return e.forEach((e=>{const n=this._s(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Zc(0===this.ps(t.batchId,"removed")),this.An.shift();let n=this.ws;return Gs.forEach(t.mutations,(r=>{const s=new Sr(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.ws=n}))}ee(e){}containsKey(e,t){const n=new Sr(t,0),r=this.ws.firstAfterOrEqual(n);return Gs.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.An.length,Gs.resolve()}ps(e,t){return this.gs(e)}gs(e){return 0===this.An.length?0:e-this.An[0].batchId}_s(e){const t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}class Cr{constructor(e,t){this.Jt=e,this.Ts=t,this.docs=new gn(St.comparator),this.size=0}addEntry(e,t,n){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Ts(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:o,readTime:n}),this.size+=o-i,this.Jt.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Gs.resolve(n?n.document.clone():Wt.newInvalidDocument(t))}getEntries(e,t){let n=il();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.clone():Wt.newInvalidDocument(e))})),Gs.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=il();const s=new St(t.path.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:e,value:{document:s,readTime:o}}=i.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||Dh(t,s)&&(r=r.insert(s.key,s.clone()))}return Gs.resolve(r)}Es(e,t){return Gs.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Nr(this)}getSize(e){return Gs.resolve(this.size)}}class Nr extends zi{constructor(e){super(),this.De=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.document.isValidDocument()?t.push(this.De.addEntry(e,r.document,this.getReadTime(n))):this.De.removeEntry(n)})),Gs.waitFor(t)}getFromCache(e,t){return this.De.getEntry(e,t)}getAllFromCache(e,t){return this.De.getEntries(e,t)}}class kr{constructor(e){this.persistence=e,this.Is=new Gi((e=>uh(e)),hh),this.lastRemoteSnapshotVersion=ct.min(),this.highestTargetId=0,this.As=0,this.Rs=new Vr,this.targetCount=0,this.Ps=$i.ie()}forEachTarget(e,t){return this.Is.forEach(((e,n)=>t(n))),Gs.resolve()}getLastRemoteSnapshotVersion(e){return Gs.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Gs.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.Ps.next(),Gs.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.As&&(this.As=t),Gs.resolve()}ce(e){this.Is.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ps=new $i(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,t){return this.ce(t),this.targetCount+=1,Gs.resolve()}updateTargetData(e,t){return this.ce(t),Gs.resolve()}removeTargetData(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,Gs.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.Is.forEach(((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Is.delete(i),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Gs.waitFor(s).next((()=>r))}getTargetCount(e){return Gs.resolve(this.targetCount)}getTargetData(e,t){const n=this.Is.get(t)||null;return Gs.resolve(n)}addMatchingKeys(e,t,n){return this.Rs.rs(t,n),Gs.resolve()}removeMatchingKeys(e,t,n){this.Rs.cs(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach((t=>{s.push(r.markPotentiallyOrphaned(e,t))})),Gs.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Rs.us(t),Gs.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Rs.ls(t);return Gs.resolve(n)}containsKey(e,t){return Gs.resolve(this.Rs.containsKey(t))}}class xr{constructor(e,t){this.bs={},this.Be=new et(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new kr(this),this.Jt=new Ii,this.Je=function(e,t){return new Cr(e,t)}(this.Jt,(e=>this.referenceDelegate.vs(e))),this.k=new ci(t),this.Ye=new vr(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let t=this.bs[e.toKey()];return t||(t=new Dr(this.Jt,this.referenceDelegate),this.bs[e.toKey()]=t),t}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,t,n){Wc("MemoryPersistence","Starting transaction:",e);const r=new $r(this.Be.next());return this.referenceDelegate.Vs(),n(r).next((e=>this.referenceDelegate.Ss(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Ds(e,t){return Gs.or(Object.values(this.bs).map((n=>()=>n.containsKey(e,t))))}}class $r extends Ws{constructor(e){super(),this.currentSequenceNumber=e}}class Fr{constructor(e){this.persistence=e,this.Cs=new Vr,this.Ns=null}static ks(e){return new Fr(e)}get xs(){if(this.Ns)return this.Ns;throw Yc()}addReference(e,t,n){return this.Cs.addReference(n,t),this.xs.delete(n.toString()),Gs.resolve()}removeReference(e,t,n){return this.Cs.removeReference(n,t),this.xs.add(n.toString()),Gs.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),Gs.resolve()}removeTarget(e,t){this.Cs.us(t.targetId).forEach((e=>this.xs.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.xs.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Vs(){this.Ns=new Set}Ss(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Gs.forEach(this.xs,(n=>{const r=St.fromPath(n);return this.$s(e,r).next((e=>{e||t.removeEntry(r)}))})).next((()=>(this.Ns=null,t.apply(e))))}updateLimboDocument(e,t){return this.$s(e,t).next((e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())}))}vs(e){return 0}$s(e,t){return Gs.or([()=>Gs.resolve(this.Cs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ds(e,t)])}}function Jd(e,t){return`firestore_clients_${e}_${t}`}function Xd(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Yd(e,t){return`firestore_targets_${e}_${t}`}class Br{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Fs(e,t,n){const r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new j(r.error.code,r.error.message))),i?new Br(e,t,r.state,s):(Qc("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ur{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Fs(e,t){const n=JSON.parse(t);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new j(n.error.code,n.error.message))),s?new Ur(e,n.state,r):(Qc("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class qr{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Fs(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=fl();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Lu(n.activeTargetIds[e]),s=s.add(n.activeTargetIds[e]);return r?new qr(e,s):(Qc("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Kr{constructor(e,t){this.clientId=e,this.onlineState=t}static Fs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Kr(t.clientId,t.onlineState):(Qc("SharedClientState",`Failed to parse online state: ${e}`),null)}}class jr{constructor(){this.activeTargetIds=fl()}Ms(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Qr{constructor(e,t,n,r,s){this.window=e,this.Oe=t,this.persistenceKey=n,this.Bs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Us=this.qs.bind(this),this.Ks=new gn(hu),this.started=!1,this.js=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Qs=Jd(this.persistenceKey,this.Bs),this.Ws=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Ks=this.Ks.insert(this.Bs,new jr),this.Gs=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.zs=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.Hs=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.Js=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Ys=function(e){return`firestore_bundle_loaded_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.Us)}static bt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Tn();for(const t of e){if(t===this.Bs)continue;const e=this.getItem(Jd(this.persistenceKey,t));if(e){const n=qr.Fs(t,e);n&&(this.Ks=this.Ks.insert(n.clientId,n))}}this.Xs();const t=this.storage.getItem(this.Js);if(t){const e=this.Zs(t);e&&this.ti(e)}for(const e of this.js)this.qs(e);this.js=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ei(this.Ks)}isActiveQueryTarget(e){let t=!1;return this.Ks.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ni(e,"pending")}updateMutationState(e,t,n){this.ni(e,t,n),this.si(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Yd(this.persistenceKey,e));if(n){const r=Ur.Fs(e,n);r&&(t=r.state)}}return this.ii.Ms(e),this.Xs(),t}removeLocalQueryTarget(e){this.ii.Ls(e),this.Xs()}isLocalQueryTarget(e){return this.ii.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Yd(this.persistenceKey,e))}updateQueryState(e,t,n){this.ri(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.si(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.oi(e)}notifyBundleLoaded(){this.ai()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Wc("SharedClientState","READ",e,t),t}setItem(e,t){Wc("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){Wc("SharedClientState","REMOVE",e),this.storage.removeItem(e)}qs(e){const t=e;if(t.storageArea===this.storage){if(Wc("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Qs)return void Qc("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.Gs.test(t.key)){if(null==t.newValue){const e=this.ci(t.key);return this.ui(e,null)}{const e=this.hi(t.key,t.newValue);if(e)return this.ui(e.clientId,e)}}else if(this.zs.test(t.key)){if(null!==t.newValue){const e=this.li(t.key,t.newValue);if(e)return this.fi(e)}}else if(this.Hs.test(t.key)){if(null!==t.newValue){const e=this.di(t.key,t.newValue);if(e)return this.wi(e)}}else if(t.key===this.Js){if(null!==t.newValue){const e=this.Zs(t.newValue);if(e)return this.ti(e)}}else if(t.key===this.Ws){const e=function(e){let t=et.I;if(null!=e)try{const n=JSON.parse(e);Zc("number"==typeof n),t=n}catch(e){Qc("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==et.I&&this.sequenceNumberHandler(e)}else if(t.key===this.Ys)return this.syncEngine._i()}else this.js.push(t)}))}}get ii(){return this.Ks.get(this.Bs)}Xs(){this.setItem(this.Qs,this.ii.Os())}ni(e,t,n){const r=new Br(this.currentUser,e,t,n),s=Xd(this.persistenceKey,this.currentUser,e);this.setItem(s,r.Os())}si(e){const t=Xd(this.persistenceKey,this.currentUser,e);this.removeItem(t)}oi(e){const t={clientId:this.Bs,onlineState:e};this.storage.setItem(this.Js,JSON.stringify(t))}ri(e,t,n){const r=Yd(this.persistenceKey,e),s=new Ur(e,t,n);this.setItem(r,s.Os())}ai(){this.setItem(this.Ys,"value-not-used")}ci(e){const t=this.Gs.exec(e);return t?t[1]:null}hi(e,t){const n=this.ci(e);return qr.Fs(n,t)}li(e,t){const n=this.zs.exec(e),r=Number(n[1]),s=void 0!==n[2]?n[2]:null;return Br.Fs(new D$1(s),r,t)}di(e,t){const n=this.Hs.exec(e),r=Number(n[1]);return Ur.Fs(r,t)}Zs(e){return Kr.Fs(e)}async fi(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.mi(e.batchId,e.state,e.error);Wc("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}wi(e){return this.syncEngine.gi(e.targetId,e.state,e.error)}ui(e,t){const n=t?this.Ks.insert(e,t):this.Ks.remove(e),r=this.ei(this.Ks),s=this.ei(n),i=[],o=[];return s.forEach((e=>{r.has(e)||i.push(e)})),r.forEach((e=>{s.has(e)||o.push(e)})),this.syncEngine.yi(i,o).then((()=>{this.Ks=n}))}ti(e){this.Ks.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ei(e){let t=fl();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class Wr{constructor(){this.pi=new jr,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.pi.Ms(e),this.Ti[e]||"not-current"}updateQueryState(e,t,n){this.Ti[e]=t}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new jr,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class Gr{Ei(e){}shutdown(){}}class zr{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.Pi(),this.bi=[],this.vi()}Ei(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){Wc("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.bi)e(0)}Pi(){Wc("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.bi)e(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Zd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Jr{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Fi(e){this.ki(e)}Oi(e){this.xi(e)}}class Yr extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.Mi=t+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,t,n,r,s){const i=this.Ui(e,t);Wc("RestConnection","Sending: ",i,n);const o={};return this.qi(o,r,s),this.Ki(e,i,o,n).then((e=>(Wc("RestConnection","Received: ",e),e)),(t=>{throw Jc("RestConnection",`${e} failed with error: `,t,"url: ",i,"request:",n),t}))}ji(e,t,n,r,s){return this.Bi(e,t,n,r,s)}qi(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+zc,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}Ui(e,t){const n=Zd[e];return`${this.Mi}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,t,n,r){return new Promise(((s,i)=>{const o=new Bc;o.listenOnce(Fc.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case Uc.NO_ERROR:const t=o.getResponseJson();Wc("Connection","XHR received:",JSON.stringify(t)),s(t);break;case Uc.TIMEOUT:Wc("Connection",'RPC "'+e+'" timed out'),i(new j(iu.DEADLINE_EXCEEDED,"Request time out"));break;case Uc.HTTP_ERROR:const n=o.getStatus();if(Wc("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(iu).indexOf(t)>=0?t:iu.UNKNOWN}(e.status);i(new j(t,e.message))}else i(new j(iu.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new j(iu.UNAVAILABLE,"Connection failed."));break;default:Yc()}}finally{Wc("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(r);o.send(t,"POST",a,n,15)}))}Qi(e,t,n){const r=[this.Mi,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=xc(),h=Mc(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(l.xmlHttpFactory=new qc({})),this.qi(l.initMessageHeaders,t,n),i()||a()||s().indexOf("Electron/")>=0||c()||s().indexOf("MSAppHost/")>=0||o()||(l.httpHeadersOverwriteParam="$httpHeaders");const d=r.join("");Wc("Connection","Creating WebChannel: "+d,l);const f=u.createWebChannel(d,l);let p=!1,m=!1;const g=new Jr({Vi:e=>{m?Wc("Connection","Not sending because WebChannel is closed:",e):(p||(Wc("Connection","Opening WebChannel transport."),f.open(),p=!0),Wc("Connection","WebChannel sending:",e),f.send(e))},Si:()=>f.close()}),y=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return y(f,$c.EventType.OPEN,(()=>{m||Wc("Connection","WebChannel transport opened.")})),y(f,$c.EventType.CLOSE,(()=>{m||(m=!0,Wc("Connection","WebChannel transport closed"),g.Fi())})),y(f,$c.EventType.ERROR,(e=>{m||(m=!0,Jc("Connection","WebChannel transport errored:",e),g.Fi(new j(iu.UNAVAILABLE,"The operation could not be completed")))})),y(f,$c.EventType.MESSAGE,(e=>{var t;if(!m){const n=e.data[0];Zc(!!n);const r=n,s=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(s){Wc("Connection","WebChannel received error:",s);const e=s.status;let t=function(e){const t=el[e];if(void 0!==t)return rl(t)}(e),n=s.message;void 0===t&&(t=iu.INTERNAL,n="Unknown error status: "+e+" with message "+s.message),m=!0,g.Fi(new j(t,n)),f.close()}else Wc("Connection","WebChannel received:",n),g.Oi(n)}})),y(h,Vc.STAT_EVENT,(e=>{e.stat===jc.PROXY?Wc("Connection","Detected buffering proxy"):e.stat===jc.NOPROXY&&Wc("Connection","Detected no buffering proxy")})),setTimeout((()=>{g.$i()}),0),g}}function ef(){return"undefined"!=typeof window?window:null}function tf(){return"undefined"!=typeof document?document:null}function nf(e){return new Kn(e,!0)}class eo{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Oe=e,this.timerId=t,this.Wi=n,this.Gi=r,this.zi=s,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const t=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),r=Math.max(0,t-n);r>0&&Wc("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Hi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ji=this.Oe.enqueueAfterDelay(this.timerId,r,(()=>(this.Yi=Date.now(),e()))),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class no{constructor(e,t,n,r,s,i,o,a){this.Oe=e,this.nr=n,this.sr=r,this.ir=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.rr=0,this.ar=null,this.cr=null,this.stream=null,this.ur=new eo(e,t)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}async stop(){this.hr()&&await this.close(0)}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.ar&&(this.ar=this.Oe.enqueueAfterDelay(this.nr,6e4,(()=>this.mr())))}gr(e){this.yr(),this.stream.send(e)}async mr(){if(this.lr())return this.close(0)}yr(){this.ar&&(this.ar.cancel(),this.ar=null)}pr(){this.cr&&(this.cr.cancel(),this.cr=null)}async close(e,t){this.yr(),this.pr(),this.ur.cancel(),this.rr++,4!==e?this.ur.reset():t&&t.code===iu.RESOURCE_EXHAUSTED?(Qc(t.toString()),Qc("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):t&&t.code===iu.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Tr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ni(t)}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),t=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.rr===t&&this.Ir(e,n)}),(t=>{e((()=>{const e=new j(iu.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Ar(e)}))}))}Ir(e,t){const n=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di((()=>{n((()=>(this.state=2,this.cr=this.Oe.enqueueAfterDelay(this.sr,1e4,(()=>(this.lr()&&(this.state=3),Promise.resolve()))),this.listener.Di())))})),this.stream.Ni((e=>{n((()=>this.Ar(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}dr(){this.state=5,this.ur.Zi((async()=>{this.state=0,this.start()}))}Ar(e){return Wc("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return t=>{this.Oe.enqueueAndForget((()=>this.rr===e?t():(Wc("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class so extends no{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.k=s}Rr(e,t){return this.ir.Qi("Listen",e,t)}onMessage(e){this.ur.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Yc()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(e,t){return e.C?(Zc(void 0===t||"string"==typeof t),yt.fromBase64String(t||"")):(Zc(void 0===t||t instanceof Uint8Array),yt.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?iu.UNKNOWN:rl(e.code);return new j(t,e.message||"")}(o);n=new Fn(r,s,i,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=Sl(e,r.document.name),i=_l(r.document.updateTime),o=new jt({mapValue:{fields:r.document.fields}}),a=Wt.newFoundDocument(s,i,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new xn(c,u,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=Sl(e,r.document),i=r.readTime?_l(r.readTime):ct.min(),o=Wt.newNoDocument(s,i),a=r.removedTargetIds||[];n=new xn([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=Sl(e,r.document),i=r.removedTargetIds||[];n=new xn([],i,s,null)}else{if(!("filter"in t))return Yc();{t.filter;const e=t.filter;e.targetId;const r=e.count||0,s=new fn(r),i=e.targetId;n=new $n(i,s)}}return n}(this.k,e),n=function(e){if(!("targetChange"in e))return ct.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ct.min():t.readTime?_l(t.readTime):ct.min()}(e);return this.listener.Pr(t,n)}br(e){const t={};t.database=Cl(this.k),t.addTarget=function(e,t){let n;const r=t.target;return n=dh(r)?{documents:Ll(e,r)}:{query:xl(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=wl(e,t.resumeToken):t.snapshotVersion.compareTo(ct.min())>0&&(n.readTime=vl(e,t.snapshotVersion.toTimestamp())),n}(this.k,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Yc()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.k,e);n&&(t.labels=n),this.gr(t)}vr(e){const t={};t.database=Cl(this.k),t.removeTarget=e,this.gr(t)}}class io extends no{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.k=s,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,t){return this.ir.Qi("Write",e,t)}onMessage(e){if(Zc(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const t=function(e,t){return e&&e.length>0?(Zc(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?_l(e.updateTime):_l(t);return n.isEqual(ct.min())&&(n=_l(t)),new He(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=_l(e.commitTime);return this.listener.Cr(n,t)}return Zc(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=Cl(this.k),this.gr(e)}Dr(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Ol(this.k,e)))};this.gr(t)}}class ro extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.ir=n,this.k=r,this.$r=!1}Fr(){if(this.$r)throw new j(iu.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,t,n){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.ir.Bi(e,t,n,r,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===iu.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new j(iu.UNKNOWN,e.toString())}))}ji(e,t,n){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.ir.ji(e,t,n,r,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===iu.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new j(iu.UNKNOWN,e.toString())}))}terminate(){this.$r=!0}}class oo{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Or=0,this.Mr=null,this.Lr=!0}Br(){0===this.Or&&(this.Ur("Unknown"),this.Mr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.Mr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve()))))}Kr(e){"Online"===this.state?this.Ur("Unknown"):(this.Or++,this.Or>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Or=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(Qc(t),this.Lr=!1):Wc("OnlineStateTracker",t)}jr(){null!==this.Mr&&(this.Mr.cancel(),this.Mr=null)}}class ao{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=s,this.Hr.Ei((e=>{n.enqueueAndForget((async()=>{df(this)&&(Wc("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=tu(e);t.Gr.add(4),await sf(t),t.Jr.set("Unknown"),t.Gr.delete(4),await rf(t)}(this))}))})),this.Jr=new oo(n,r)}}async function rf(e){if(df(e))for(const t of e.zr)await t(!0)}async function sf(e){for(const t of e.zr)await t(!1)}function of(e,t){const n=tu(e);n.Wr.has(t.targetId)||(n.Wr.set(t.targetId,t),lf(n)?hf(n):Rf(n).lr()&&cf(n,t))}function af(e,t){const n=tu(e),r=Rf(n);n.Wr.delete(t),r.lr()&&uf(n,t),0===n.Wr.size&&(r.lr()?r._r():df(n)&&n.Jr.set("Unknown"))}function cf(e,t){e.Yr.X(t.targetId),Rf(e).br(t)}function uf(e,t){e.Yr.X(t),Rf(e).vr(t)}function hf(e){e.Yr=new Mn({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Wr.get(t)||null}),Rf(e).start(),e.Jr.Br()}function lf(e){return df(e)&&!Rf(e).hr()&&e.Wr.size>0}function df(e){return 0===tu(e).Gr.size}function ff(e){e.Yr=void 0}async function pf(e){e.Wr.forEach(((t,n)=>{cf(e,t)}))}async function mf(e,t){ff(e),lf(e)?(e.Jr.Kr(t),hf(e)):e.Jr.set("Unknown")}async function gf(e,t,n){if(e.Jr.set("Online"),t instanceof Fn&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Wr.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Wr.delete(r),e.Yr.removeTarget(r))}(e,t)}catch(n){Wc("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await yf(e,n)}else if(t instanceof xn?e.Yr.ot(t):t instanceof $n?e.Yr.dt(t):e.Yr.ut(t),!n.isEqual(ct.min()))try{const t=await qd(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Yr.gt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.Wr.get(r);s&&e.Wr.set(r,s.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.Wr.get(t);if(!n)return;e.Wr.set(t,n.withResumeToken(yt.EMPTY_BYTE_STRING,n.snapshotVersion)),uf(e,t);const r=new ai(n.target,t,1,n.sequenceNumber);cf(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Wc("RemoteStore","Failed to raise snapshot:",t),await yf(e,t)}}async function yf(e,t,n){if(!ed(t))throw t;e.Gr.add(1),await sf(e),e.Jr.set("Offline"),n||(n=()=>qd(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Wc("RemoteStore","Retrying IndexedDB access"),await n(),e.Gr.delete(1),await rf(e)}))}function vf(e,t){return t().catch((n=>yf(e,n,t)))}async function wf(e){const t=tu(e),n=Nf(t);let r=t.Qr.length>0?t.Qr[t.Qr.length-1].batchId:-1;for(;If(t);)try{const e=await Bd(t.localStore,r);if(null===e){0===t.Qr.length&&n._r();break}r=e.batchId,_f(t,e)}catch(e){await yf(t,e)}bf(t)&&Tf(t)}function If(e){return df(e)&&e.Qr.length<10}function _f(e,t){e.Qr.push(t);const n=Nf(e);n.lr()&&n.Sr&&n.Dr(t.mutations)}function bf(e){return df(e)&&!Nf(e).hr()&&e.Qr.length>0}function Tf(e){Nf(e).start()}async function Ef(e){Nf(e).kr()}async function Sf(e){const t=Nf(e);for(const n of e.Qr)t.Dr(n.mutations)}async function Af(e,t,n){const r=e.Qr.shift(),s=oi.from(r,t,n);await vf(e,(()=>e.remoteSyncer.applySuccessfulWrite(s))),await wf(e)}async function kf(e,t){t&&Nf(e).Sr&&await async function(e,t){if(nl(n=t.code)&&n!==iu.ABORTED){const n=e.Qr.shift();Nf(e).wr(),await vf(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await wf(e)}var n}(e,t),bf(e)&&Tf(e)}async function Cf(e,t){const n=tu(e);t?(n.Gr.delete(2),await rf(n)):t||(n.Gr.add(2),await sf(n),n.Jr.set("Unknown"))}function Rf(e){return e.Xr||(e.Xr=function(e,t,n){const r=tu(e);return r.Fr(),new so(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:pf.bind(null,e),Ni:mf.bind(null,e),Pr:gf.bind(null,e)}),e.zr.push((async t=>{t?(e.Xr.wr(),lf(e)?hf(e):e.Jr.set("Unknown")):(await e.Xr.stop(),ff(e))}))),e.Xr}function Nf(e){return e.Zr||(e.Zr=function(e,t,n){const r=tu(e);return r.Fr(),new io(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:Ef.bind(null,e),Ni:kf.bind(null,e),Nr:Sf.bind(null,e),Cr:Af.bind(null,e)}),e.zr.push((async t=>{t?(e.Zr.wr(),await wf(e)):(await e.Zr.stop(),e.Qr.length>0&&(Wc("RemoteStore",`Stopping write stream with ${e.Qr.length} pending writes`),e.Qr=[]))}))),e.Zr}class Fo{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new Q$1,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,o=new Fo(e,t,i,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new j(iu.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Df(e,t){if(Qc("AsyncQueue",`${t}: ${e}`),ed(e))return new j(iu.UNAVAILABLE,`${t}: ${e}`);throw e}class Mo{constructor(e){this.comparator=e?(t,n)=>e(t,n)||St.comparator(t.key,n.key):(e,t)=>St.comparator(e.key,t.key),this.keyedMap=al(),this.sortedSet=new gn(this.comparator)}static emptySet(e){return new Mo(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Mo))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Mo;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Lo{constructor(){this.eo=new gn(St.comparator)}track(e){const t=e.doc.key,n=this.eo.get(t);n?0!==e.type&&3===n.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==n.type?this.eo=this.eo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.eo=this.eo.remove(t):1===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):Yc():this.eo=this.eo.insert(t,e)}no(){const e=[];return this.eo.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Bo{constructor(e,t,n,r,s,i,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Bo(e,t,Mo.emptySet(t),s,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ch(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Uo{constructor(){this.so=void 0,this.listeners=[]}}class qo{constructor(){this.queries=new Gi((e=>Rh(e)),Ch),this.onlineState="Unknown",this.io=new Set}}async function Of(e,t){const n=tu(e),r=t.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new Uo),s)try{i.so=await n.onListen(r)}catch(e){const n=Df(e,`Initialization of query '${Nh(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,i),i.listeners.push(t),t.ro(n.onlineState),i.so&&t.oo(i.so)&&Mf(n)}async function Pf(e,t){const n=tu(e),r=t.query;let s=!1;const i=n.queries.get(r);if(i){const e=i.listeners.indexOf(t);e>=0&&(i.listeners.splice(e,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Lf(e,t){const n=tu(e);let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.listeners)t.oo(e)&&(r=!0);s.so=e}}r&&Mf(n)}function xf(e,t,n){const r=tu(e),s=r.queries.get(t);if(s)for(const e of s.listeners)e.onError(n);r.queries.delete(t)}function Mf(e){e.io.forEach((e=>{e.next()}))}class zo{constructor(e,t,n){this.query=e,this.ao=t,this.co=!1,this.uo=null,this.onlineState="Unknown",this.options=n||{}}oo(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Bo(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.co?this.ho(e)&&(this.ao.next(e),t=!0):this.lo(e,this.onlineState)&&(this.fo(e),t=!0),this.uo=e,t}onError(e){this.ao.error(e)}ro(e){this.onlineState=e;let t=!1;return this.uo&&!this.co&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}lo(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return!(this.options.wo&&n||e.docs.isEmpty()&&"Offline"!==t)}ho(e){if(e.docChanges.length>0)return!0;const t=this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}fo(e){e=Bo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.ao.next(e)}}class Ho{constructor(e,t){this.payload=e,this.byteLength=t}_o(){return"metadata"in this.payload}}class Jo{constructor(e){this.k=e}Hn(e){return Sl(this.k,e)}Jn(e){return e.metadata.exists?Dl(this.k,e.document,!1):Wt.newNoDocument(this.Hn(e.metadata.name),this.Yn(e.metadata.readTime))}Yn(e){return _l(e)}}class Yo{constructor(e,t,n){this.mo=e,this.localStore=t,this.k=n,this.queries=[],this.documents=[],this.progress=Uf(e)}yo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}po(e){const t=new Map,n=new Jo(this.k);for(const r of e)if(r.metadata.queries){const e=n.Hn(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||ll()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const s=tu(e);let i=ll(),o=il(),a=ul();for(const e of n){const n=t.Hn(e.metadata.name);e.document&&(i=i.add(n)),o=o.insert(n,t.Jn(e)),a=a.insert(n,t.Yn(e.metadata.readTime))}const c=s.Qn.newChangeBuffer({trackRemovals:!0}),u=await Gd(s,function(e){return Ah(wh(dt.fromString(`__bundle__/docs/${e}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",(e=>$d(e,c,o,ct.min(),a).next((t=>(c.apply(e),t))).next((t=>s.He.removeMatchingKeysForTargetId(e,u.targetId).next((()=>s.He.addMatchingKeys(e,i,u.targetId))).next((()=>s.Wn.Vn(e,t))).next((()=>t))))))}(this.localStore,new Jo(this.k),this.documents,this.mo.id),t=this.po(this.documents);for(const e of this.queries)await Qd(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",new ar(Object.assign({},this.progress),e)}}function Uf(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Zo{constructor(e){this.key=e}}class ta$1{constructor(e){this.key=e}}class ea$1{constructor(e,t){this.query=e,this.To=t,this.Eo=null,this.current=!1,this.Io=ll(),this.mutatedKeys=ll(),this.Ao=Oh(e),this.Ro=new Mo(this.Ao)}get Po(){return this.To}bo(e,t){const n=t?t.vo:new Lo,r=t?t.Ro:this.Ro;let s=t?t.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a=Ih(this.query)&&r.size===this.query.limit?r.last():null,c=_h(this.query)&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),h=Dh(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Vo(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Ao(h,a)>0||c&&this.Ao(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))})),Ih(this.query)||_h(this.query))for(;i.size>this.query.limit;){const e=Ih(this.query)?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{Ro:i,vo:n,Bn:o,mutatedKeys:s}}Vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const s=e.vo.no();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Yc()}};return n(e)-n(t)}(e.type,t.type)||this.Ao(e.doc,t.doc))),this.So(n);const i=t?this.Do():[],o=0===this.Io.size&&this.current?1:0,a=o!==this.Eo;return this.Eo=o,0!==s.length||a?{snapshot:new Bo(this.query,e.Ro,r,s,e.mutatedKeys,0===o,a,!1),Co:i}:{Co:i}}ro(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new Lo,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach((e=>this.To=this.To.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.To=this.To.delete(e))),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=ll(),this.Ro.forEach((e=>{this.No(e.key)&&(this.Io=this.Io.add(e.key))}));const t=[];return e.forEach((e=>{this.Io.has(e)||t.push(new ta$1(e))})),this.Io.forEach((n=>{e.has(n)||t.push(new Zo(n))})),t}ko(e){this.To=e.zn,this.Io=ll();const t=this.bo(e.documents);return this.applyChanges(t,!0)}xo(){return Bo.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class na$1{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class sa$1{constructor(e){this.key=e,this.$o=!1}}class ia$1{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Fo={},this.Oo=new Gi((e=>Rh(e)),Ch),this.Mo=new Map,this.Lo=new Set,this.Bo=new gn(St.comparator),this.Uo=new Map,this.qo=new Vr,this.Ko={},this.jo=new Map,this.Qo=$i.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}async function Ff(e,t){const n=hp(e);let r,s;const i=n.Oo.get(t);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.xo();else{const e=await Gd(n.localStore,Ah(t)),i=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,s=await Vf(n,t,r,"current"===i),n.isPrimaryClient&&of(n.remoteStore,e)}return s}async function Vf(e,t,n,r){e.Go=(t,n,r)=>async function(e,t,n,r){let s=t.view.bo(n);s.Bn&&(s=await Hd(e.localStore,t.query,!1).then((({documents:e})=>t.view.bo(e,s))));const i=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(s,e.isPrimaryClient,i);return Jf(e,t.targetId,o.Co),o.snapshot}(e,t,n,r);const s=await Hd(e.localStore,t,!0),i=new ea$1(t,s.zn),o=i.bo(s.documents),a=kn.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),c=i.applyChanges(o,e.isPrimaryClient,a);Jf(e,n,c.Co);const u=new na$1(t,n,i);return e.Oo.set(t,u),e.Mo.has(n)?e.Mo.get(n).push(t):e.Mo.set(n,[t]),c.snapshot}async function jf(e,t){const n=tu(e),r=n.Oo.get(t),s=n.Mo.get(r.targetId);if(s.length>1)return n.Mo.set(r.targetId,s.filter((e=>!Ch(e,t)))),void n.Oo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await zd(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),af(n.remoteStore,r.targetId),Wf(n,r.targetId)})).catch(Cd)):(Wf(n,r.targetId),await zd(n.localStore,r.targetId,!0))}async function qf(e,t){const n=tu(e);try{const e=await function(e,t){const n=tu(e),r=t.snapshotVersion;let s=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const i=n.Qn.newChangeBuffer({trackRemovals:!0});s=n.qn;const o=[];t.targetChanges.forEach(((t,i)=>{const a=s.get(i);if(!a)return;o.push(n.He.removeMatchingKeys(e,t.removedDocuments,i).next((()=>n.He.addMatchingKeys(e,t.addedDocuments,i))));const c=t.resumeToken;if(c.approximateByteSize()>0){const u=a.withResumeToken(c,r).withSequenceNumber(e.currentSequenceNumber);s=s.insert(i,u),function(e,t,n){return Zc(t.resumeToken.approximateByteSize()>0),0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,t)&&o.push(n.He.updateTargetData(e,u))}}));let a=il();if(t.documentUpdates.forEach(((r,s)=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push($d(e,i,t.documentUpdates,r,void 0).next((e=>{a=e}))),!r.isEqual(ct.min())){const t=n.He.getLastRemoteSnapshotVersion(e).next((t=>n.He.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Gs.waitFor(o).next((()=>i.apply(e))).next((()=>n.Wn.Vn(e,a))).next((()=>a))})).then((e=>(n.qn=s,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Uo.get(t);r&&(Zc(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.$o=!0:e.modifiedDocuments.size>0?Zc(r.$o):e.removedDocuments.size>0&&(Zc(r.$o),r.$o=!1))})),await Zf(n,e,t)}catch(e){await Cd(e)}}function $f(e,t,n){const r=tu(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Oo.forEach(((n,r)=>{const s=r.view.ro(t);s.snapshot&&e.push(s.snapshot)})),function(e,t){const n=tu(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.ro(t)&&(r=!0)})),r&&Mf(n)}(r.eventManager,t),e.length&&r.Fo.Pr(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Bf(e,t,n){const r=tu(e);r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.Uo.get(t),i=s&&s.key;if(i){let e=new gn(St.comparator);e=e.insert(i,Wt.newNoDocument(i,ct.min()));const n=ll().add(i),s=new Nn(ct.min(),new Map,new Tn(hu),e,n);await qf(r,s),r.Bo=r.Bo.remove(i),r.Uo.delete(t),Yf(r)}else await zd(r.localStore,t,!1).then((()=>Wf(r,t,n))).catch(Cd)}async function Gf(e,t){const n=tu(e),r=t.batch.batchId;try{const e=await function(e,t){const n=tu(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),s=n.Qn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const s=n.batch,i=s.keys();let o=Gs.resolve();return i.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const i=n.docVersions.get(e);Zc(null!==i),t.version.compareTo(i)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))}))})),o.next((()=>e.An.removeMutationBatch(t,s)))}(n,e,t,s).next((()=>s.apply(e))).next((()=>n.An.performConsistencyCheck(e))).next((()=>n.Wn.vn(e,r)))}))}(n.localStore,t);Kf(n,r,null),Hf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Zf(n,e)}catch(e){await Cd(e)}}async function zf(e,t,n){const r=tu(e);try{const e=await function(e,t){const n=tu(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.An.lookupMutationBatch(e,t).next((t=>(Zc(null!==t),r=t.keys(),n.An.removeMutationBatch(e,t)))).next((()=>n.An.performConsistencyCheck(e))).next((()=>n.Wn.vn(e,r)))}))}(r.localStore,t);Kf(r,t,n),Hf(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Zf(r,e)}catch(n){await Cd(n)}}function Hf(e,t){(e.jo.get(t)||[]).forEach((e=>{e.resolve()})),e.jo.delete(t)}function Kf(e,t,n){const r=tu(e);let s=r.Ko[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.Ko[r.currentUser.toKey()]=s}}function Wf(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Mo.get(t))e.Oo.delete(r),n&&e.Fo.zo(r,n);e.Mo.delete(t),e.isPrimaryClient&&e.qo.us(t).forEach((t=>{e.qo.containsKey(t)||Qf(e,t)}))}function Qf(e,t){e.Lo.delete(t.path.canonicalString());const n=e.Bo.get(t);null!==n&&(af(e.remoteStore,n),e.Bo=e.Bo.remove(t),e.Uo.delete(n),Yf(e))}function Jf(e,t,n){for(const r of n)r instanceof Zo?(e.qo.addReference(r.key,t),Xf(e,r)):r instanceof ta$1?(Wc("SyncEngine","Document no longer in limbo: "+r.key),e.qo.removeReference(r.key,t),e.qo.containsKey(r.key)||Qf(e,r.key)):Yc()}function Xf(e,t){const n=t.key,r=n.path.canonicalString();e.Bo.get(n)||e.Lo.has(r)||(Wc("SyncEngine","New document in limbo: "+n),e.Lo.add(r),Yf(e))}function Yf(e){for(;e.Lo.size>0&&e.Bo.size<e.maxConcurrentLimboResolutions;){const t=e.Lo.values().next().value;e.Lo.delete(t);const n=new St(dt.fromString(t)),r=e.Qo.next();e.Uo.set(r,new sa$1(n)),e.Bo=e.Bo.insert(n,r),of(e.remoteStore,new ai(Ah(wh(n.path)),r,2,et.I))}}async function Zf(e,t,n){const r=tu(e),s=[],i=[],o=[];r.Oo.isEmpty()||(r.Oo.forEach(((e,a)=>{o.push(r.Go(a,t,n).then((e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),s.push(e);const t=ur.$n(a.targetId,e);i.push(t)}})))})),await Promise.all(o),r.Fo.Pr(s),await async function(e,t){const n=tu(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Gs.forEach(t,(t=>Gs.forEach(t.kn,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Gs.forEach(t.xn,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!ed(e))throw e;Wc("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.qn.get(t),r=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(r);n.qn=n.qn.insert(t,s)}}}(r.localStore,i))}async function ep(e,t){const n=tu(e);if(!n.currentUser.isEqual(t)){Wc("SyncEngine","User change. New user:",t.toKey());const e=await jd(n.localStore,t);n.currentUser=t,function(e,t){e.jo.forEach((e=>{e.forEach((e=>{e.reject(new j(iu.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.jo.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Zf(n,e.Gn)}}function tp(e,t){const n=tu(e),r=n.Uo.get(t);if(r&&r.$o)return ll().add(r.key);{let e=ll();const r=n.Mo.get(t);if(!r)return e;for(const t of r){const r=n.Oo.get(t);e=e.unionWith(r.view.Po)}return e}}async function np(e,t){const n=tu(e),r=await Hd(n.localStore,t.query,!0),s=t.view.ko(r);return n.isPrimaryClient&&Jf(n,t.targetId,s.Co),s}async function rp(e){const t=tu(e);return Wd(t.localStore).then((e=>Zf(t,e)))}async function sp(e,t,n,r){const s=tu(e),i=await function(e,t){const n=tu(e),r=tu(n.An);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.Zt(e,t).next((t=>t?n.Wn.vn(e,t):Gs.resolve(null)))))}(s.localStore,t);null!==i?("pending"===n?await wf(s.remoteStore):"acknowledged"===n||"rejected"===n?(Kf(s,t,r||null),Hf(s,t),function(e,t){tu(tu(e).An).ee(t)}(s.localStore,t)):Yc(),await Zf(s,i)):Wc("SyncEngine","Cannot apply mutation batch with id: "+t)}async function ip(e,t,n){const r=tu(e),s=[],i=[];for(const e of t){let t;const n=r.Mo.get(e);if(n&&0!==n.length){t=await Gd(r.localStore,Ah(n[0]));for(const e of n){const t=r.Oo.get(e),n=await np(r,t);n.snapshot&&i.push(n.snapshot)}}else{const n=await Kd(r.localStore,e);t=await Gd(r.localStore,n),await Vf(r,op(n),e,!1)}s.push(t)}return r.Fo.Pr(i),s}function op(e){return vh(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function ap(e){const t=tu(e);return tu(tu(t.localStore).persistence).Tn()}async function cp(e,t,n,r){const s=tu(e);if(s.Wo)Wc("SyncEngine","Ignoring unexpected query state notification.");else if(s.Mo.has(t))switch(n){case"current":case"not-current":{const e=await Wd(s.localStore),r=Nn.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await Zf(s,e,r);break}case"rejected":await zd(s.localStore,t,!0),Wf(s,t,r);break;default:Yc()}}async function up(e,t,n){const r=hp(e);if(r.Wo){for(const e of t){if(r.Mo.has(e)){Wc("SyncEngine","Adding an already active target "+e);continue}const t=await Kd(r.localStore,e),n=await Gd(r.localStore,t);await Vf(r,op(t),n.targetId,!1),of(r.remoteStore,n)}for(const e of n)r.Mo.has(e)&&await zd(r.localStore,e,!1).then((()=>{af(r.remoteStore,e),Wf(r,e)})).catch(Cd)}}function hp(e){const t=tu(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=qf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=tp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Bf.bind(null,t),t.Fo.Pr=Lf.bind(null,t.eventManager),t.Fo.zo=xf.bind(null,t.eventManager),t}function lp(e){const t=tu(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Gf.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=zf.bind(null,t),t}class Oa$1{constructor(){this.synchronizeTabs=!1}async initialize(e){this.k=nf(e.databaseInfo.databaseId),this.sharedClientState=this.Jo(e),this.persistence=this.Yo(e),await this.persistence.start(),this.gcScheduler=this.Xo(e),this.localStore=this.Zo(e)}Xo(e){return null}Zo(e){return Vd(this.persistence,new hr,e.initialUser,this.k)}Yo(e){return new xr(Fr.ks,this.k)}Jo(e){return new Wr}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Ma$1 extends Oa$1{constructor(e,t,n){super(),this.ta=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=tu(e);return t.persistence.runTransaction("Synchronize last document change read time","readonly",(e=>function(e){const t=Od(e);let n=ct.min();return t.jt({index:$s.readTimeIndex,reverse:!0},((e,t,r)=>{t.readTime&&(n=cd(t.readTime)),r.done()})).next((()=>n))}(e))).then((e=>{t.jn=e}))}(this.localStore),await this.ta.initialize(this,e),await lp(this.ta.syncEngine),await wf(this.ta.remoteStore),await this.persistence.sn((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve())))}Zo(e){return Vd(this.persistence,new hr,e.initialUser,this.k)}Xo(e){const t=this.persistence.referenceDelegate.garbageCollector;return new Ki(t,e.asyncQueue)}Yo(e){const t=Fd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?vi.withCacheSize(this.cacheSizeBytes):vi.DEFAULT;return new sr(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,ef(),tf(),this.k,this.sharedClientState,!!this.forceOwnership)}Jo(e){return new Wr}}class La$1 extends Ma$1{constructor(e,t){super(e,t,!1),this.ta=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.ta.syncEngine;this.sharedClientState instanceof Qr&&(this.sharedClientState.syncEngine={mi:sp.bind(null,t),gi:cp.bind(null,t),yi:up.bind(null,t),Tn:ap.bind(null,t),_i:rp.bind(null,t)},await this.sharedClientState.start()),await this.persistence.sn((async e=>{await async function(e,t){const n=tu(e);if(hp(n),lp(n),!0===t&&!0!==n.Wo){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await ip(n,e.toArray());n.Wo=!0,await Cf(n.remoteStore,!0);for(const e of t)of(n.remoteStore,e)}else if(!1===t&&!1!==n.Wo){const e=[];let t=Promise.resolve();n.Mo.forEach(((r,s)=>{n.sharedClientState.isLocalQueryTarget(s)?e.push(s):t=t.then((()=>(Wf(n,s),zd(n.localStore,s,!0)))),af(n.remoteStore,s)})),await t,await ip(n,e),function(e){const t=tu(e);t.Uo.forEach(((e,n)=>{af(t.remoteStore,n)})),t.qo.hs(),t.Uo=new Map,t.Bo=new gn(St.comparator)}(n),n.Wo=!1,await Cf(n.remoteStore,!1)}}(this.ta.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())}))}Jo(e){const t=ef();if(!Qr.bt(t))throw new j(iu.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Fd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Qr(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Ba{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>$f(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ep.bind(null,this.syncEngine),await Cf(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new qo}createDatastore(e){const t=nf(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new Yr(r));var r;return function(e,t,n,r){return new ro(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,s=e=>$f(this.syncEngine,e,0),i=zr.bt()?new zr:new Gr,new ao(t,n,r,s,i);var t,n,r,s,i}createSyncEngine(e,t){return function(e,t,n,r,s,i,o){const a=new ia$1(e,t,n,r,s,i);return o&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=tu(e);Wc("RemoteStore","RemoteStore shutting down."),t.Gr.add(5),await sf(t),t.Hr.shutdown(),t.Jr.set("Unknown")}(this.remoteStore)}}function dp(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class qa$1{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ea(this.observer.next,e)}error(e){this.observer.error?this.ea(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}na(){this.muted=!0}ea(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Ka$1{constructor(e,t){this.sa=e,this.k=t,this.metadata=new Q$1,this.buffer=new Uint8Array,this.ia=new TextDecoder("utf-8"),this.ra().then((e=>{e&&e._o()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))}),(e=>this.metadata.reject(e)))}close(){return this.sa.cancel()}async getMetadata(){return this.metadata.promise}async Ho(){return await this.getMetadata(),this.ra()}async ra(){const e=await this.oa();if(null===e)return null;const t=this.ia.decode(e),n=Number(t);isNaN(n)&&this.aa(`length string (${t}) is not valid number`);const r=await this.ca(n);return new Ho(JSON.parse(r),e.length+n)}ua(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async oa(){for(;this.ua()<0&&!await this.ha(););if(0===this.buffer.length)return null;const e=this.ua();e<0&&this.aa("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async ca(e){for(;this.buffer.length<e;)await this.ha()&&this.aa("Reached the end of bundle when more is expected.");const t=this.ia.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}aa(e){throw this.sa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ha(){const e=await this.sa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class ja$1{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new j(iu.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=tu(e),r=Cl(n.k)+"/documents",s={documents:t.map((e=>El(n.k,e)))},i=await n.ji("BatchGetDocuments",r,s),o=new Map;i.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){Zc(!!t.found),t.found.name,t.found.updateTime;const n=Sl(e,t.found.name),r=_l(t.found.updateTime),s=new jt({mapValue:{fields:t.found.fields}});return Wt.newFoundDocument(n,r,s)}(e,t):"missing"in t?function(e,t){Zc(!!t.missing),Zc(!!t.readTime);const n=Sl(e,t.missing),r=_l(t.readTime);return Wt.newNoDocument(n,r)}(e,t):Yc()}(n.k,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());Zc(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new hn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=St.fromPath(t);this.mutations.push(new ln(n,this.precondition(n)))})),await async function(e,t){const n=tu(e),r=Cl(n.k)+"/documents",s={writes:t.map((e=>Ol(n.k,e)))};await n.Bi("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Yc();t=ct.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new j(iu.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Je.updateTime(t):Je.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ct.min()))throw new j(iu.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Je.updateTime(t)}return Je.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Qa$1{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.la=5,this.ur=new eo(this.asyncQueue,"transaction_retry")}run(){this.la-=1,this.fa()}fa(){this.ur.Zi((async()=>{const e=new ja$1(this.datastore),t=this.da(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.wa(e)}))))})).catch((e=>{this.wa(e)}))}))}da(e){try{const t=this.updateFunction(e);return!Ou(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}wa(e){this.la>0&&this._a(e)?(this.la-=1,this.asyncQueue.enqueueAndForget((()=>(this.fa(),Promise.resolve())))):this.deferred.reject(e)}_a(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!nl(t)}return!1}}class Wa$1{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=D$1.UNAUTHENTICATED,this.clientId=st.A(),this.authCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Wc("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(()=>Promise.resolve()))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new j(iu.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Q$1;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Df(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function fp(e,t){e.asyncQueue.verifyOperationInProgress(),Wc("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await jd(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}async function pp(e,t){e.asyncQueue.verifyOperationInProgress();const n=await mp(e);Wc("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>async function(e,t){const n=tu(e);n.asyncQueue.verifyOperationInProgress(),Wc("RemoteStore","RemoteStore received new credentials");const r=df(n);n.Gr.add(3),await sf(n),r&&n.Jr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Gr.delete(3),await rf(n)}(t.remoteStore,e))),e.onlineComponents=t}async function mp(e){return e.offlineComponents||(Wc("FirestoreClient","Using default OfflineComponentProvider"),await fp(e,new Oa$1)),e.offlineComponents}async function gp(e){return e.onlineComponents||(Wc("FirestoreClient","Using default OnlineComponentProvider"),await pp(e,new Ba)),e.onlineComponents}function yp(e){return mp(e).then((e=>e.persistence))}function vp(e){return mp(e).then((e=>e.localStore))}function wp(e){return gp(e).then((e=>e.remoteStore))}function Ip(e){return gp(e).then((e=>e.syncEngine))}async function _p(e){const t=await gp(e),n=t.eventManager;return n.onListen=Ff.bind(null,t.syncEngine),n.onUnlisten=jf.bind(null,t.syncEngine),n}function bp(e,t,n={}){const r=new Q$1;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,s){const i=new qa$1({next:i=>{t.enqueueAndForget((()=>Pf(e,o)));const a=i.docs.has(n);!a&&i.fromCache?s.reject(new j(iu.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&r&&"server"===r.source?s.reject(new j(iu.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(i)},error:e=>s.reject(e)}),o=new zo(wh(n.path),i,{includeMetadataChanges:!0,wo:!0});return Of(e,o)}(await _p(e),e.asyncQueue,t,n,r))),r.promise}function Tp(e,t,n={}){const r=new Q$1;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,s){const i=new qa$1({next:n=>{t.enqueueAndForget((()=>Pf(e,o))),n.fromCache&&"server"===r.source?s.reject(new j(iu.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),o=new zo(n,i,{includeMetadataChanges:!0,wo:!0});return Of(e,o)}(await _p(e),e.asyncQueue,t,n,r))),r.promise}function Ep(e,t,n,r){const s=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new Ka$1(e,t)}(function(e,t){if(e instanceof Uint8Array)return dp(e,t);if(e instanceof ArrayBuffer)return dp(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,nf(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=tu(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=tu(e),r=_l(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.Ye.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),void n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r));n._updateProgress(Uf(r));const s=new Yo(r,e.localStore,t.k);let i=await t.Ho();for(;i;){const e=await s.yo(i);e&&n._updateProgress(e),i=await t.Ho()}const o=await s.complete();await Zf(e,o.In,void 0),await function(e,t){const n=tu(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.Ye.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress)}catch(e){Jc("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e)}})(r,t,n).then((()=>{r.sharedClientState.notifyBundleLoaded()}))}(await Ip(e),s,r)}))}class fc$1{constructor(e,t,n,r,s,i,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class dc$1{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof dc$1&&e.projectId===this.projectId&&e.database===this.database}}const Sp=new Map;function Ap(e,t,n){if(!n)throw new j(iu.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function kp(e,t,n,r){if(!0===t&&!0===r)throw new j(iu.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Cp(e){if(!St.isDocumentKey(e))throw new j(iu.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Rp(e){if(St.isDocumentKey(e))throw new j(iu.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Np(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Yc()}function Dp(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new j(iu.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Np(e);throw new j(iu.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Op(e,t){if(t<=0)throw new j(iu.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Ic$1{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new j(iu.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new j(iu.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,kp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ac$1{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ic$1({}),this._settingsFrozen=!1,e instanceof dc$1?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new j(iu.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new dc$1(e.options.projectId)}(e))}get app(){if(!this._app)throw new j(iu.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new j(iu.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ic$1(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new G;switch(e.type){case"gapi":const t=e.client;return Zc(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new Y$1(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new j(iu.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Sp.get(e);t&&(Wc("ComponentProvider","Removing Datastore"),Sp.delete(e),t.terminate())}(this),Promise.resolve()}}class Pc$1{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new vc$1(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pc$1(this.firestore,e,this._key)}}class bc$1{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new bc$1(this.firestore,e,this._query)}}class vc$1 extends bc$1{constructor(e,t,n){super(e,t,wh(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pc$1(this.firestore,null,new St(e))}withConverter(e){return new vc$1(this.firestore,e,this._path)}}function Pp(e,t,...n){if(e=y(e),1===arguments.length&&(t=st.A()),Ap("doc","path",t),e instanceof Ac$1){const r=dt.fromString(t,...n);return Cp(r),new Pc$1(e,null,new St(r))}{if(!(e instanceof Pc$1||e instanceof vc$1))throw new j(iu.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(dt.fromString(t,...n));return Cp(r),new Pc$1(e.firestore,e instanceof vc$1?e.converter:null,new St(r))}}function Lp(e,t){return e=y(e),t=y(t),e instanceof bc$1&&t instanceof bc$1&&e.firestore===t.firestore&&Ch(e._query,t._query)&&e.converter===t.converter}class kc$1{constructor(){this.ma=Promise.resolve(),this.ga=[],this.ya=!1,this.pa=[],this.Ta=null,this.Ea=!1,this.Ia=!1,this.Aa=[],this.ur=new eo(this,"async_queue_retry"),this.Ra=()=>{const e=tf();e&&Wc("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ur.er()};const e=tf();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ra)}get isShuttingDown(){return this.ya}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pa(),this.ba(e)}enterRestrictedMode(e){if(!this.ya){this.ya=!0,this.Ia=e||!1;const t=tf();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ra)}}enqueue(e){if(this.Pa(),this.ya)return new Promise((()=>{}));const t=new Q$1;return this.ba((()=>this.ya&&this.Ia?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.ga.push(e),this.va())))}async va(){if(0!==this.ga.length){try{await this.ga[0](),this.ga.shift(),this.ur.reset()}catch(e){if(!ed(e))throw e;Wc("AsyncQueue","Operation failed with retryable error: "+e)}this.ga.length>0&&this.ur.Zi((()=>this.va()))}}ba(e){const t=this.ma.then((()=>(this.Ea=!0,e().catch((e=>{this.Ta=e,this.Ea=!1;throw Qc("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e})).then((e=>(this.Ea=!1,e))))));return this.ma=t,t}enqueueAfterDelay(e,t,n){this.Pa(),this.Aa.indexOf(e)>-1&&(t=0);const r=Fo.createAndSchedule(this,e,t,n,(e=>this.Va(e)));return this.pa.push(r),r}Pa(){this.Ta&&Yc()}verifyOperationInProgress(){}async Sa(){let e;do{e=this.ma,await e}while(e!==this.ma)}Da(e){for(const t of this.pa)if(t.timerId===e)return!0;return!1}Ca(e){return this.Sa().then((()=>{this.pa.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.pa)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Sa()}))}Na(e){this.Aa.push(e)}Va(e){const t=this.pa.indexOf(e);this.pa.splice(t,1)}}function xp(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class $c$1{constructor(){this._progressObserver={},this._taskCompletionResolver=new Q$1,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Oc$1 extends Ac$1{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new kc$1,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Up(this),this._firestoreClient.terminate()}}function Mp(e){return e._firestoreClient||Up(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Up(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new fc$1(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Wa$1(e._authCredentials,e._appCheckCredentials,e._queue,r)}function Fp(e,t,n){const r=new Q$1;return e.asyncQueue.enqueue((async()=>{try{await fp(e,n),await pp(e,t),r.resolve()}catch(e){if(!function(e){return"FirebaseError"===e.name?e.code===iu.FAILED_PRECONDITION||e.code===iu.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(e))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),r.reject(e)}})).then((()=>r.promise))}function Vp(e){if(e._initialized||e._terminated)throw new j(iu.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Zc$1{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new j(iu.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _t(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class eu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new eu(yt.fromBase64String(e))}catch(e){throw new j(iu.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new eu(yt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class nu{constructor(e){this._methodName=e}}class su{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new j(iu.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new j(iu.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return hu(this._lat,e._lat)||hu(this._long,e._long)}}const jp=/^__.*__$/;class ru{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new on(e,this.data,this.fieldMask,t,this.fieldTransforms):new rn(e,this.data,t,this.fieldTransforms)}}class ou{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new on(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function qp(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Yc()}}class cu{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.k=n,this.ignoreUndefinedProperties=r,void 0===s&&this.ka(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get xa(){return this.settings.xa}$a(e){return new cu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Fa(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.$a({path:n,Oa:!1});return r.Ma(e),r}La(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.$a({path:n,Oa:!1});return r.ka(),r}Ba(e){return this.$a({path:void 0,Oa:!0})}Ua(e){return tm(e,this.settings.methodName,this.settings.qa||!1,this.path,this.settings.Ka)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}ka(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ma(this.path.get(e))}Ma(e){if(0===e.length)throw this.Ua("Document fields must not be empty");if(qp(this.xa)&&jp.test(e))throw this.Ua('Document fields cannot begin and end with "__"')}}class uu{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.k=n||nf(e)}ja(e,t,n,r=!1){return new cu({xa:e,methodName:t,Ka:n,path:_t.emptyPath(),Oa:!1,qa:r},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function $p(e){const t=e._freezeSettings(),n=nf(e._databaseId);return new uu(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Bp(e,t,n,r,s,i={}){const o=e.ja(i.merge||i.mergeFields?2:0,t,n,s);Xp("Data must be an object, but it was:",o,r);const a=Qp(r,o);let c,u;if(i.merge)c=new mt(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=Yp(t,r,n);if(!o.contains(s))throw new j(iu.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);nm(e,s)||e.push(s)}c=new mt(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new ru(new jt(a),c,u)}class fu extends nu{_toFieldTransform(e){if(2!==e.xa)throw 1===e.xa?e.Ua(`${this._methodName}() can only appear at the top level of your update data`):e.Ua(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof fu}}function Gp(e,t,n){return new cu({xa:3,Ka:t.settings.Ka,methodName:e._methodName,Oa:n},t.databaseId,t.k,t.ignoreUndefinedProperties)}class wu extends nu{_toFieldTransform(e){return new Ge(e.path,new Le)}isEqual(e){return e instanceof wu}}class _u extends nu{constructor(e,t){super(e),this.Qa=t}_toFieldTransform(e){const t=Gp(this,e,!0),n=this.Qa.map((e=>Wp(e,t))),r=new Be(n);return new Ge(e.path,r)}isEqual(e){return this===e}}class mu extends nu{constructor(e,t){super(e),this.Qa=t}_toFieldTransform(e){const t=Gp(this,e,!0),n=this.Qa.map((e=>Wp(e,t))),r=new qe(n);return new Ge(e.path,r)}isEqual(e){return this===e}}class gu extends nu{constructor(e,t){super(e),this.Wa=t}_toFieldTransform(e){const t=new je(e.k,Uh(e.k,this.Wa));return new Ge(e.path,t)}isEqual(e){return this===e}}function zp(e,t,n,r){const s=e.ja(1,t,n);Xp("Data must be an object, but it was:",s,r);const i=[],o=jt.empty();yu(r,((e,r)=>{const a=em(t,e,n);r=y(r);const c=s.La(a);if(r instanceof fu)i.push(a);else{const e=Wp(r,c);null!=e&&(i.push(a),o.set(a,e))}}));const a=new mt(i);return new ou(o,a,s.fieldTransforms)}function Hp(e,t,n,r,s,i){const o=e.ja(1,t,n),a=[Yp(t,r,n)],c=[s];if(i.length%2!=0)throw new j(iu.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<i.length;e+=2)a.push(Yp(t,i[e])),c.push(i[e+1]);const u=[],h=jt.empty();for(let e=a.length-1;e>=0;--e)if(!nm(u,a[e])){const t=a[e];let n=c[e];n=y(n);const r=o.La(t);if(n instanceof fu)u.push(t);else{const e=Wp(n,r);null!=e&&(u.push(t),h.set(t,e))}}const l=new mt(u);return new ou(h,l,o.fieldTransforms)}function Kp(e,t,n,r=!1){return Wp(n,e.ja(r?4:3,t))}function Wp(e,t){if(Jp(e=y(e)))return Xp("Unsupported field value:",t,e),Qp(e,t);if(e instanceof nu)return function(e,t){if(!qp(t.xa))throw t.Ua(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Ua(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Oa&&4!==t.xa)throw t.Ua("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const s of e){let e=Wp(s,t.Ba(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=y(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Uh(t.k,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=at.fromDate(e);return{timestampValue:vl(t.k,n)}}if(e instanceof at){const n=new at(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:vl(t.k,n)}}if(e instanceof su)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof eu)return{bytesValue:wl(t.k,e._byteString)};if(e instanceof Pc$1){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Ua(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:bl(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Ua(`Unsupported field value: ${Np(e)}`)}(e,t)}function Qp(e,t){const n={};return vu(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):yu(e,((e,r)=>{const s=Wp(r,t.Fa(e));null!=s&&(n[e]=s)})),{mapValue:{fields:n}}}function Jp(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof at||e instanceof su||e instanceof eu||e instanceof Pc$1||e instanceof nu)}function Xp(e,t,n){if(!Jp(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Np(n);throw"an object"===r?t.Ua(e+" a custom object"):t.Ua(e+" "+r)}}function Yp(e,t,n){if((t=y(t))instanceof Zc$1)return t._internalPath;if("string"==typeof t)return em(e,t);throw tm("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}const Zp=new RegExp("[~\\*/\\[\\]]");function em(e,t,n){if(t.search(Zp)>=0)throw tm(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Zc$1(...t.split("."))._internalPath}catch(r){throw tm(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function tm(e,t,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new j(iu.INVALID_ARGUMENT,a+e+c)}function nm(e,t){return e.some((e=>e.isEqual(t)))}class Du{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Pc$1(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Cu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(rm("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Cu extends Du{data(){return super.data()}}function rm(e,t){return"string"==typeof t?em(e,t):t instanceof Zc$1?t._internalPath:t._delegate._internalPath}class ku{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class xu extends Du{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new $u(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(rm("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class $u extends xu{data(e={}){return super.data(e)}}class Fu{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ku(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new $u(this._firestore,this._userDataWriter,n.key,n,new ku(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new j(iu.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>({type:"added",doc:new $u(e._firestore,e._userDataWriter,n.doc.key,n.doc,new ku(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++})))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new $u(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ku(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:sm(t.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function sm(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Yc()}}function im(e){if(_h(e)&&0===e.explicitOrderBy.length)throw new j(iu.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Bu{}class qu extends Bu{constructor(e,t,n){super(),this.Ga=e,this.za=t,this.Ha=n,this.type="where"}_apply(e){const t=$p(e.firestore),n=function(e,t,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new j(iu.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on FieldPath.documentId().`);if("in"===i||"not-in"===i){cm(o,i);const t=[];for(const n of o)t.push(am(r,e,n));a={arrayValue:{values:t}}}else a=am(r,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||cm(o,i),a=Kp(n,"where",o,"in"===i||"not-in"===i);const c=Zt.create(s,i,a);return function(e,t){if(t.V()){const n=Th(e);if(null!==n&&!n.isEqual(t.field))throw new j(iu.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=bh(e);null!==r&&um(e,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new j(iu.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new j(iu.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,c),c}(e._query,0,t,e.firestore._databaseId,this.Ga,this.za,this.Ha);return new bc$1(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new _e(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}class ju extends Bu{constructor(e,t){super(),this.Ga=e,this.Ja=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new j(iu.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new j(iu.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new le(t,n);return function(e,t){if(null===bh(e)){const n=Th(e);null!==n&&um(e,n,t.field)}}(e,r),r}(e._query,this.Ga,this.Ja);return new bc$1(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new _e(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class Wu extends Bu{constructor(e,t,n){super(),this.type=e,this.Ya=t,this.Xa=n}_apply(e){return new bc$1(e.firestore,e.converter,kh(e._query,this.Ya,this.Xa))}}class Hu extends Bu{constructor(e,t,n){super(),this.type=e,this.Za=t,this.tc=n}_apply(e){const t=om(e,this.type,this.Za,this.tc);return new bc$1(e.firestore,e.converter,function(e,t){return new _e(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class Xu extends Bu{constructor(e,t,n){super(),this.type=e,this.Za=t,this.tc=n}_apply(e){const t=om(e,this.type,this.Za,this.tc);return new bc$1(e.firestore,e.converter,function(e,t){return new _e(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function om(e,t,n,r){if(n[0]=y(n[0]),n[0]instanceof Du)return function(e,t,n,r,s){if(!r)throw new j(iu.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of Sh(e))if(n.field.isKeyField())i.push(Ju(t,r.key));else{const e=r.data.field(n.field);if(Au(e))throw new j(iu.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new j(iu.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}i.push(e)}return new ue(i,s)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const s=$p(e.firestore);return function(e,t,n,r,s,i){const o=e.explicitOrderBy;if(s.length>o.length)throw new j(iu.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<s.length;i++){const c=s[i];if(o[i].field.isKeyField()){if("string"!=typeof c)throw new j(iu.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Eh(e)&&-1!==c.indexOf("/"))throw new j(iu.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(dt.fromString(c));if(!St.isDocumentKey(n))throw new j(iu.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new St(n);a.push(Ju(t,s))}else{const e=Kp(n,r,c);a.push(e)}}return new ue(a,i)}(e._query,e.firestore._databaseId,s,t,n,r)}}function am(e,t,n){if("string"==typeof(n=y(n))){if(""===n)throw new j(iu.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Eh(t)&&-1!==n.indexOf("/"))throw new j(iu.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(dt.fromString(n));if(!St.isDocumentKey(r))throw new j(iu.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ju(e,new St(r))}if(n instanceof Pc$1)return Ju(e,n._key);throw new j(iu.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${Np(n)}.`)}function cm(e,t){if(!Array.isArray(e)||0===e.length)throw new j(iu.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new j(iu.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function um(e,t,n){if(!n.isEqual(t))throw new j(iu.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class rh{convertValue(e,t="none"){switch(Mu(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Eu(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Su(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Yc()}}convertObject(e,t){const n={};return yu(e.fields,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new su(Eu(e.latitude),Eu(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ru(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Nu(e));default:return null}}convertTimestamp(e){const t=Tu(e);return new at(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=dt.fromString(e);Zc(Kl(n));const r=new dc$1(n.get(1),n.get(3)),s=new St(n.popFirst(5));return r.isEqual(t)||Qc(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function hm(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class ah extends rh{constructor(e){super(),this.firestore=e}convertBytes(e){return new eu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pc$1(this.firestore,null,t)}}class ch{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=$p(e)}set(e,t,n){this._verifyNotCommitted();const r=lm(e,this._firestore),s=hm(r.converter,t,n),i=Bp(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,Je.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const s=lm(e,this._firestore);let i;return i="string"==typeof(t=y(t))||t instanceof Zc$1?Hp(this._dataReader,"WriteBatch.update",s._key,t,n,r):zp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,Je.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=lm(e,this._firestore);return this._mutations=this._mutations.concat(new hn(t._key,Je.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new j(iu.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function lm(e,t){if((e=y(e)).firestore!==t)throw new j(iu.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class lh extends rh{constructor(e){super(),this.firestore=e}convertBytes(e){return new eu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pc$1(this.firestore,null,t)}}function dm(e,t){return function(e,t){const n=new Q$1;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=lp(e);try{const e=await function(e,t){const n=tu(e),r=at.now(),s=t.reduce(((e,t)=>e.add(t.key)),ll());let i;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>n.Wn.vn(e,s).next((s=>{i=s;const o=[];for(const e of t){const t=Wh(e,i.get(e.key));null!=t&&o.push(new on(e.key,t,ih(t.value.mapValue),Je.exists(!0)))}return n.An.addMutationBatch(e,r,o,t)})))).then((e=>(e.applyToLocalDocumentSet(i),{batchId:e.batchId,changes:i})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ko[e.currentUser.toKey()];r||(r=new gn(hu)),r=r.insert(t,n),e.Ko[e.currentUser.toKey()]=r}(r,e.batchId,n),await Zf(r,e.changes),await wf(r.remoteStore)}catch(e){const t=Df(e,"Failed to persist write");n.reject(t)}}(await Ip(e),t,n))),n.promise}(Mp(e),t)}function fm(e,t,n){const r=n.docs.get(t._key),s=new lh(e);return new xu(e,s,t._key,r,new ku(n.hasPendingWrites,n.fromCache),t.converter)}class Ph extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=$p(e)}get(e){const t=lm(e,this._firestore),n=new ah(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return Yc();const r=e[0];if(r.isFoundDocument())return new Du(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Du(this._firestore,n,t._key,null,t.converter);throw Yc()}))}set(e,t,n){const r=lm(e,this._firestore),s=hm(r.converter,t,n),i=Bp(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(e,t,n,...r){const s=lm(e,this._firestore);let i;return i="string"==typeof(t=y(t))||t instanceof Zc$1?Hp(this._dataReader,"Transaction.update",s._key,t,n,r):zp(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){const t=lm(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=lm(e,this._firestore),n=new lh(this._firestore);return super.get(e).then((e=>new xu(this._firestore,n,t._key,e._document,new ku(!1,!1),t.converter)))}}!function(e,t=!0){zc="9.6.1",N(new Component("firestore",((e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=new Oc$1(r,new H$1(e.getProvider("auth-internal")),new Z$1(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),s._setSettings(n),s}),"PUBLIC")),x(Gc,"3.4.1",e),x(Gc,"3.4.1","esm2017")}();var pm=Object.freeze({__proto__:null,AbstractUserDataWriter:rh,Bytes:eu,CACHE_SIZE_UNLIMITED:-1,CollectionReference:vc$1,DocumentReference:Pc$1,DocumentSnapshot:xu,FieldPath:Zc$1,FieldValue:nu,Firestore:Oc$1,FirestoreError:j,GeoPoint:su,LoadBundleTask:$c$1,Query:bc$1,QueryConstraint:Bu,QueryDocumentSnapshot:$u,QuerySnapshot:Fu,SnapshotMetadata:ku,Timestamp:at,Transaction:Ph,WriteBatch:ch,_DatabaseId:dc$1,_DocumentKey:St,_EmptyAppCheckTokenProvider:class{getToken(){return Promise.resolve(new X$1(""))}invalidateToken(){}start(e,t){}shutdown(){}},_EmptyAuthCredentialsProvider:G,_FieldPath:_t,_cast:Dp,_debugAssert:function(e,t){e||Yc()},_isBase64Available:function(){return"undefined"!=typeof atob},_logWarn:Jc,_validateIsNotUsedTogether:kp,addDoc:function(e,t){const n=Dp(e.firestore,Oc$1),r=Pp(e),s=hm(e.converter,t);return dm(n,[Bp($p(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,Je.exists(!1))]).then((()=>r))},arrayRemove:function(...e){return new mu("arrayRemove",e)},arrayUnion:function(...e){return new _u("arrayUnion",e)},clearIndexedDbPersistence:function(e){if(e._initialized&&!e._terminated)throw new j(iu.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Q$1;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!Hs.bt())return Promise.resolve();const t=e+"main";await Hs.delete(t)}(Fd(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise},collection:function(e,t,...n){if(e=y(e),Ap("collection","path",t),e instanceof Ac$1){const r=dt.fromString(t,...n);return Rp(r),new vc$1(e,null,r)}{if(!(e instanceof Pc$1||e instanceof vc$1))throw new j(iu.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(dt.fromString(t,...n));return Rp(r),new vc$1(e.firestore,null,r)}},collectionGroup:function(e,t){if(e=Dp(e,Ac$1),Ap("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new j(iu.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new bc$1(e,null,function(e){return new _e(dt.emptyPath(),e)}(t))},connectFirestoreEmulator:function(e,t,n,s={}){var i;const o=(e=Dp(e,Ac$1))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==t&&Jc("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},o),{host:`${t}:${n}`,ssl:!1})),s.mockUserToken){let t,n;if("string"==typeof s.mockUserToken)t=s.mockUserToken,n=D$1.MOCK_USER;else{t=r(s.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const o=s.mockUserToken.sub||s.mockUserToken.user_id;if(!o)throw new j(iu.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new D$1(o)}e._authCredentials=new z$1(new W$1(t,n))}},deleteDoc:function(e){return dm(Dp(e.firestore,Oc$1),[new hn(e._key,Je.none())])},deleteField:function(){return new fu("deleteField")},disableNetwork:function(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await yp(e),n=await wp(e);return t.setNetworkEnabled(!1),async function(e){const t=tu(e);t.Gr.add(0),await sf(t),t.Jr.set("Offline")}(n)}))}(Mp(e=Dp(e,Oc$1)))},doc:Pp,documentId:function(){return new Zc$1("__name__")},enableIndexedDbPersistence:function(e,t){Vp(e=Dp(e,Oc$1));const n=Mp(e),r=e._freezeSettings(),s=new Ba;return Fp(n,s,new Ma$1(s,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))},enableMultiTabIndexedDbPersistence:function(e){Vp(e=Dp(e,Oc$1));const t=Mp(e),n=e._freezeSettings(),r=new Ba;return Fp(t,r,new La$1(r,n.cacheSizeBytes))},enableNetwork:function(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await yp(e),n=await wp(e);return t.setNetworkEnabled(!0),function(e){const t=tu(e);return t.Gr.delete(0),rf(t)}(n)}))}(Mp(e=Dp(e,Oc$1)))},endAt:function(...e){return new Xu("endAt",e,!1)},endBefore:function(...e){return new Xu("endBefore",e,!0)},ensureFirestoreConfigured:Mp,executeWrite:dm,getDoc:function(e){e=Dp(e,Pc$1);const t=Dp(e.firestore,Oc$1);return bp(Mp(t),e._key).then((n=>fm(t,e,n)))},getDocFromCache:function(e){e=Dp(e,Pc$1);const t=Dp(e.firestore,Oc$1),n=Mp(t),r=new lh(t);return function(e,t){const n=new Q$1;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=tu(e);return n.persistence.runTransaction("read document","readonly",(e=>n.Wn.Rn(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new j(iu.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=Df(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await vp(e),t,n))),n.promise}(n,e._key).then((n=>new xu(t,r,e._key,n,new ku(null!==n&&n.hasLocalMutations,!0),e.converter)))},getDocFromServer:function(e){e=Dp(e,Pc$1);const t=Dp(e.firestore,Oc$1);return bp(Mp(t),e._key,{source:"server"}).then((n=>fm(t,e,n)))},getDocs:function(e){e=Dp(e,bc$1);const t=Dp(e.firestore,Oc$1),n=Mp(t),r=new lh(t);return im(e._query),Tp(n,e._query).then((n=>new Fu(t,r,e,n)))},getDocsFromCache:function(e){e=Dp(e,bc$1);const t=Dp(e.firestore,Oc$1),n=Mp(t),r=new lh(t);return function(e,t){const n=new Q$1;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Hd(e,t,!0),s=new ea$1(t,r.zn),i=s.bo(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(e){const r=Df(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await vp(e),t,n))),n.promise}(n,e._query).then((n=>new Fu(t,r,e,n)))},getDocsFromServer:function(e){e=Dp(e,bc$1);const t=Dp(e.firestore,Oc$1),n=Mp(t),r=new lh(t);return Tp(n,e._query,{source:"server"}).then((n=>new Fu(t,r,e,n)))},getFirestore:function(e=L()){return D(e,"firestore").getImmediate()},increment:function(e){return new gu("increment",e)},initializeFirestore:function(e,t){const n=D(e,"firestore");if(n.isInitialized()){const e=n.getImmediate();if(l(n.getOptions(),t))return e;throw new j(iu.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new j(iu.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:t})},limit:function(e){return Op("limit",e),new Wu("limit",e,"F")},limitToLast:function(e){return Op("limitToLast",e),new Wu("limitToLast",e,"L")},loadBundle:function(e,t){const n=Mp(e=Dp(e,Oc$1)),r=new $c$1;return Ep(n,e._databaseId,t,r),r},namedQuery:function(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=tu(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.Ye.getNamedQuery(e,t)))}(await vp(e),t)))}(Mp(e=Dp(e,Oc$1)),t).then((t=>t?new bc$1(e,null,t.query):null))},onSnapshot:function(e,...t){var n,r,s;e=y(e);let i={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||xp(t[o])||(i=t[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(xp(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}let c,u,h;if(e instanceof Pc$1)u=Dp(e.firestore,Oc$1),h=wh(e._key.path),c={next:n=>{t[o]&&t[o](fm(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Dp(e,bc$1);u=Dp(n.firestore,Oc$1),h=n._query;const r=new lh(u);c={next:e=>{t[o]&&t[o](new Fu(u,r,n,e))},error:t[o+1],complete:t[o+2]},im(e._query)}return function(e,t,n,r){const s=new qa$1(r),i=new zo(t,s,n);return e.asyncQueue.enqueueAndForget((async()=>Of(await _p(e),i))),()=>{s.na(),e.asyncQueue.enqueueAndForget((async()=>Pf(await _p(e),i)))}}(Mp(u),h,a,c)},onSnapshotsInSync:function(e,t){return function(e,t){const n=new qa$1(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){tu(e).io.add(t),t.next()}(await _p(e),n))),()=>{n.na(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){tu(e).io.delete(t)}(await _p(e),n)))}}(Mp(e=Dp(e,Oc$1)),xp(t)?t:{next:t})},orderBy:function(e,t="asc"){const n=t,r=rm("orderBy",e);return new ju(r,n)},query:function(e,...t){for(const n of t)e=n._apply(e);return e},queryEqual:Lp,refEqual:function(e,t){return e=y(e),t=y(t),(e instanceof Pc$1||e instanceof vc$1)&&(t instanceof Pc$1||t instanceof vc$1)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter},runTransaction:function(e,t){return function(e,t){const n=new Q$1;return e.asyncQueue.enqueueAndForget((async()=>{const r=await function(e){return gp(e).then((e=>e.datastore))}(e);new Qa$1(e.asyncQueue,r,t,n).run()})),n.promise}(Mp(e=Dp(e,Oc$1)),(n=>t(new Ph(e,n))))},serverTimestamp:function(){return new wu("serverTimestamp")},setDoc:function(e,t,n){e=Dp(e,Pc$1);const r=Dp(e.firestore,Oc$1),s=hm(e.converter,t,n);return dm(r,[Bp($p(r),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,Je.none())])},setLogLevel:function(e){Hc.setLogLevel(e)},snapshotEqual:function(e,t){return e instanceof xu&&t instanceof xu?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Fu&&t instanceof Fu&&e._firestore===t._firestore&&Lp(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)},startAfter:function(...e){return new Hu("startAfter",e,!1)},startAt:function(...e){return new Hu("startAt",e,!0)},terminate:function(e){return O(e.app,"firestore"),e._delete()},updateDoc:function(e,t,n,...r){e=Dp(e,Pc$1);const s=Dp(e.firestore,Oc$1),i=$p(s);let o;return o="string"==typeof(t=y(t))||t instanceof Zc$1?Hp(i,"updateDoc",e._key,t,n,r):zp(i,"updateDoc",e._key,t),dm(s,[o.toMutation(e._key,Je.exists(!0))])},waitForPendingWrites:function(e){return function(e){const t=new Q$1;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=tu(e);df(n.remoteStore)||Wc("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=tu(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.An.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.jo.get(e)||[];r.push(t),n.jo.set(e,r)}catch(e){const n=Df(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Ip(e),t))),t.promise}(Mp(e=Dp(e,Oc$1)))},where:function(e,t,n){const r=t,s=rm("where",e);return new qu(s,r,n)},writeBatch:function(e){return Mp(e=Dp(e,Oc$1)),new ch(e,(t=>dm(e,t)))}});function mm(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function gm(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map((e=>gm(e)));if("function"==typeof e||"object"==typeof e)return mm(e,(e=>gm(e)));throw new Error("Data cannot be encoded in JSON: "+e)}function ym(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map((e=>ym(e))):"function"==typeof e||"object"==typeof e?mm(e,(e=>ym(e))):e}const vm={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class FunctionsError extends FirebaseError{constructor(e,t,n){super(`functions/${e}`,t||""),this.details=n}}class ContextProvider{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then((e=>this.auth=e),(()=>{})),this.messaging||t.get().then((e=>this.messaging=e),(()=>{})),this.appCheck||n.get().then((e=>this.appCheck=e),(()=>{}))}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){if(this.appCheck){const e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}class FunctionsService{constructor(e,t,n,r,s="us-central1",i){this.app=e,this.fetchImpl=i,this.emulatorOrigin=null,this.contextProvider=new ContextProvider(t,n,r),this.cancelAllRequests=new Promise((e=>{this.deleteService=()=>Promise.resolve(e())}));try{const e=new URL(s);this.customDomain=e.origin,this.region="us-central1"}catch(e){this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;if(null!==this.emulatorOrigin){return`${this.emulatorOrigin}/${t}/${this.region}/${e}`}return null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function wm(e,t,n){return r=>async function(e,t,n,r){const s=e._url(t),i={data:n=gm(n)},o={},a=await e.contextProvider.getContext();a.authToken&&(o.Authorization="Bearer "+a.authToken);a.messagingToken&&(o["Firebase-Instance-ID-Token"]=a.messagingToken);null!==a.appCheckToken&&(o["X-Firebase-AppCheck"]=a.appCheckToken);const c=function(e){let t=null;return{promise:new Promise(((n,r)=>{t=setTimeout((()=>{r(new FunctionsError("deadline-exceeded","deadline-exceeded"))}),e)})),cancel:()=>{t&&clearTimeout(t)}}}(r.timeout||7e4),u=await Promise.race([Im(s,i,o,e.fetchImpl),c.promise,e.cancelAllRequests]);if(c.cancel(),!u)throw new FunctionsError("cancelled","Firebase Functions instance was deleted.");const h=function(e,t){let n,r=function(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),s=r;try{const e=t&&t.error;if(e){const t=e.status;if("string"==typeof t){if(!vm[t])return new FunctionsError("internal","internal");r=vm[t],s=t}const i=e.message;"string"==typeof i&&(s=i),n=e.details,void 0!==n&&(n=ym(n))}}catch(e){}return"ok"===r?null:new FunctionsError(r,s,n)}(u.status,u.json);if(h)throw h;if(!u.json)throw new FunctionsError("internal","Response is not valid JSON object.");let l=u.json.data;void 0===l&&(l=u.json.result);if(void 0===l)throw new FunctionsError("internal","Response is missing data field.");return{data:ym(l)}}(e,t,r,n||{})}async function Im(e,t,n,r){let s;n["Content-Type"]="application/json";try{s=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let i=null;try{i=await s.json()}catch(e){}return{status:s.status,json:i}}const _m="@firebase/functions";!function(e,t){N(new Component("functions",((t,{instanceIdentifier:n})=>{const r=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),i=t.getProvider("messaging-internal"),o=t.getProvider("app-check-internal");return new FunctionsService(r,s,i,o,n,e)}),"PUBLIC").setMultipleInstances(!0)),x(_m,"0.7.6",t),x(_m,"0.7.6","esm2017")}(fetch.bind(self));var bm=Object.freeze({__proto__:null,connectFunctionsEmulator:function(e,t,n){!function(e,t,n){e.emulatorOrigin=`http://${t}:${n}`}(y(e),t,n)},getFunctions:function(e=L(),t="us-central1"){return D(y(e),"functions").getImmediate({identifier:t})},httpsCallable:function(e,t,n){return wm(y(e),t,n)}});class StorageError extends FirebaseError{constructor(e,t){super(Tm(e),`Firebase Storage: ${t} (${Tm(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,StorageError.prototype)}_codeEquals(e){return Tm(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function Tm(e){return"storage/"+e}function Em(){return new StorageError("unknown","An unknown error occurred, please check the error payload for server response.")}function Sm(){return new StorageError("canceled","User canceled the upload/download.")}function Am(){return new StorageError("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function km(e){return new StorageError("invalid-argument",e)}function Cm(){return new StorageError("app-deleted","The Firebase app was deleted.")}function Rm(e){return new StorageError("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Nm(e,t){return new StorageError("invalid-format","String does not match format '"+e+"': "+t)}function Dm(e){throw new StorageError("internal-error","Internal error: "+e)}class Location{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Location.makeFromUrl(e,t)}catch(t){return new Location(e,"")}if(""===n.path)return n;throw new StorageError("invalid-default-bucket","Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const s=new RegExp("^gs://"+r+"(/(.*))?$","i");function i(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:s,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp(`^https?://${"firebasestorage.googleapis.com"===t?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:i}];for(let t=0;t<a.length;t++){const r=a[t],s=r.regex.exec(e);if(s){const e=s[r.indices.bucket];let t=s[r.indices.path];t||(t=""),n=new Location(e,t),r.postModify(n);break}}if(null==n)throw function(e){return new StorageError("invalid-url","Invalid URL '"+e+"'.")}(e);return n}}class FailRequest{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function Om(e){return"string"==typeof e||e instanceof String}function Pm(e){return Lm()&&e instanceof Blob}function Lm(){return"undefined"!=typeof Blob}function xm(e,t,n,r){if(r<t)throw km(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw km(`Invalid value for '${e}'. Expected ${n} or less.`)}function Mm(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function Um(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}var Fm;!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Fm||(Fm={}));class NetworkRequest{constructor(e,t,n,r,s,i,o,a,c,u,h){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=i,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new RequestEndStatus(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Fm.NO_ERROR,s=n.getStatus();if(!t||this.isRetryStatusCode_(s)){const t=n.getErrorCode()===Fm.ABORT;return void e(!1,new RequestEndStatus(!1,null,t))}const i=-1!==this.successCodes_.indexOf(s);e(!0,new RequestEndStatus(i,n))}))},t=(e,t)=>{const n=this.resolve_,r=this.reject_,s=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(s,s.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(e){r(e)}else if(null!==s){const e=Em();e.serverResponse=s.getErrorText(),this.errorCallback_?r(this.errorCallback_(s,e)):r(e)}else if(t.canceled){r(this.appDelete_?Cm():Sm())}else{r(new StorageError("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}};this.canceled_?t(0,new RequestEndStatus(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,s=null,i=null,o=!1,a=0;function c(){return 2===a}let u=!1;function h(...e){u||(u=!0,t.apply(null,e))}function l(t){s=setTimeout((()=>{s=null,e(f,c())}),t)}function d(){i&&clearTimeout(i)}function f(e,...t){if(u)return void d();if(e)return d(),void h.call(null,e,...t);if(c()||o)return d(),void h.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),l(n)}let p=!1;function m(e){p||(p=!0,d(),u||(null!==s?(e||(a=2),clearTimeout(s),l(0)):e||(a=1)))}return l(0),i=setTimeout((()=>{o=!0,m(!0)}),n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const t=e>=500&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r}}class RequestEndStatus{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Vm(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function jm(...e){const t=Vm();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(Lm())return new Blob(e);throw new StorageError("unsupported-environment","This browser doesn't seem to support creating Blobs")}const qm={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class StringData{constructor(e,t){this.data=e,this.contentType=t||null}}function $m(e,t){switch(e){case qm.RAW:return new StringData(Bm(t));case qm.BASE64:case qm.BASE64URL:return new StringData(Gm(e,t));case qm.DATA_URL:return new StringData(function(e){const t=new DataURLParts(e);return t.base64?Gm(qm.BASE64,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw Nm(qm.DATA_URL,"Malformed data URL.")}return Bm(t)}(t.rest)}(t),new DataURLParts(t).contentType)}throw Em()}function Bm(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296==(64512&r)){if(n<e.length-1&&56320==(64512&e.charCodeAt(n+1))){r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else t.push(239,191,189)}else 56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function Gm(e,t){switch(e){case qm.BASE64:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r){throw Nm(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case qm.BASE64URL:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r){throw Nm(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=atob(t)}catch(t){throw Nm(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}class DataURLParts{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw Nm(qm.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){if(!(e.length>=t.length))return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=e.substring(e.indexOf(",")+1)}}class FbsBlob{constructor(e,t){let n=0,r="";Pm(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(Pm(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new FbsBlob(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new FbsBlob(n,!0)}}static getBlob(...e){if(Lm()){const t=e.map((e=>e instanceof FbsBlob?e.data_:e));return new FbsBlob(jm.apply(null,t))}{const t=e.map((e=>Om(e)?$m(qm.RAW,e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let s=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)r[s++]=e[t]})),new FbsBlob(r,!0)}}uploadData(){return this.data_}}function zm(e){let t;try{t=JSON.parse(e)}catch(e){return null}return function(e){return"object"==typeof e&&!Array.isArray(e)}(t)?t:null}function Hm(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Km(e,t){return t}class Mapping{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Km}}let Wm=null;function Qm(){if(Wm)return Wm;const e=[];e.push(new Mapping("bucket")),e.push(new Mapping("generation")),e.push(new Mapping("metageneration")),e.push(new Mapping("name","fullPath",!0));const t=new Mapping("name");t.xform=function(e,t){return function(e){return!Om(e)||e.length<2?e:Hm(e)}(t)},e.push(t);const n=new Mapping("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new Mapping("timeCreated")),e.push(new Mapping("updated")),e.push(new Mapping("md5Hash",null,!0)),e.push(new Mapping("cacheControl",null,!0)),e.push(new Mapping("contentDisposition",null,!0)),e.push(new Mapping("contentEncoding",null,!0)),e.push(new Mapping("contentLanguage",null,!0)),e.push(new Mapping("contentType",null,!0)),e.push(new Mapping("metadata","customMetadata",!0)),Wm=e,Wm}function Jm(e,t,n){const r={type:"file"},s=n.length;for(let e=0;e<s;e++){const s=n[e];r[s.local]=s.xform(r,t[s.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,s=new Location(n,r);return t._makeStorageReference(s)}})}(r,e),r}function Xm(e,t,n){const r=zm(t);if(null===r)return null;return Jm(e,r,n)}function Ym(e,t){const n={},r=t.length;for(let s=0;s<r;s++){const r=t[s];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}function Zm(e,t,n){const r=zm(n);if(null===r)return null;return function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(const s of n.prefixes){const n=s.replace(/\/$/,""),i=e._makeStorageReference(new Location(t,n));r.prefixes.push(i)}if(n.items)for(const s of n.items){const n=e._makeStorageReference(new Location(t,s.name));r.items.push(n)}return r}(e,t,r)}class RequestInfo{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function eg(e){if(!e)throw Em()}function tg(e,t){return function(n,r){const s=Xm(e,r,t);return eg(null!==s),s}}function ng(e,t){return function(n,r){const s=Xm(e,r,t);return eg(null!==s),function(e,t,n,r){const s=zm(t);if(null===s)return null;if(!Om(s.downloadTokens))return null;const i=s.downloadTokens;if(0===i.length)return null;const o=encodeURIComponent;return i.split(",").map((t=>{const s=e.bucket,i=e.fullPath;return Mm("/b/"+o(s)+"/o/"+o(i),n,r)+Um({alt:"media",token:t})}))[0]}(s,r,e.host,e._protocol)}}function rg(e){return function(t,n){let r;var s,i;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new StorageError("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new StorageError("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=e.bucket,r=new StorageError("quota-exceeded","Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(s=e.path,r=new StorageError("unauthorized","User does not have permission to access '"+s+"'.")):r=n,r.serverResponse=n.serverResponse,r}}function sg(e){const t=rg(e);return function(n,r){let s=t(n,r);var i;return 404===n.getStatus()&&(i=e.path,s=new StorageError("object-not-found","Object '"+i+"' does not exist.")),s.serverResponse=r.serverResponse,s}}function ig(e,t,n){const r=Mm(t.fullServerUrl(),e.host,e._protocol),s=e.maxOperationRetryTime,i=new RequestInfo(r,"GET",tg(e,n),s);return i.errorHandler=sg(t),i}function og(e,t,n,r,s){const i={};t.isRoot?i.prefix="":i.prefix=t.path+"/",n&&n.length>0&&(i.delimiter=n),r&&(i.pageToken=r),s&&(i.maxResults=s);const o=Mm(t.bucketOnlyServerUrl(),e.host,e._protocol),a=e.maxOperationRetryTime,c=new RequestInfo(o,"GET",function(e,t){return function(n,r){const s=Zm(e,t,r);return eg(null!==s),s}}(e,t.bucket),a);return c.urlParams=i,c.errorHandler=rg(t),c}function ag(e,t,n){const r=Mm(t.fullServerUrl(),e.host,e._protocol)+"?alt=media",s=e.maxOperationRetryTime,i=new RequestInfo(r,"GET",((e,t)=>t),s);return i.errorHandler=sg(t),void 0!==n&&(i.headers.Range=`bytes=0-${n}`,i.successCodes=[200,206]),i}function cg(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}function ug(e,t,n,r,s){const i=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};const a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=cg(t,r,s),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Ym(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",h="\r\n--"+a+"--",l=FbsBlob.getBlob(u,r,h);if(null===l)throw Am();const d={name:c.fullPath},f=Mm(i,e.host,e._protocol),p=e.maxUploadRetryTime,m=new RequestInfo(f,"POST",tg(e,n),p);return m.urlParams=d,m.headers=o,m.body=l.uploadData(),m.errorHandler=rg(t),m}class ResumableUploadStatus{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function hg(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){eg(!1)}return eg(!!n&&-1!==(t||["active"]).indexOf(n)),n}function lg(e,t,n,r,s,i,o,a){const c=new ResumableUploadStatus(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw new StorageError("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");const u=c.total-c.current;let h=u;s>0&&(h=Math.min(h,s));const l=c.current,d=l+h,f={"X-Goog-Upload-Command":h===u?"upload, finalize":"upload","X-Goog-Upload-Offset":`${c.current}`},p=r.slice(l,d);if(null===p)throw Am();const m=t.maxUploadRetryTime,g=new RequestInfo(n,"POST",(function(e,n){const s=hg(e,["active","final"]),o=c.current+h,a=r.size();let u;return u="final"===s?tg(t,i)(e,n):null,new ResumableUploadStatus(o,a,"final"===s,u)}),m);return g.headers=f,g.body=p.uploadData(),g.progressCallback=a||null,g.errorHandler=rg(e),g}const dg={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function fg(e){switch(e){case"running":case"pausing":case"canceling":return dg.RUNNING;case"paused":return dg.PAUSED;case"success":return dg.SUCCESS;case"canceled":return dg.CANCELED;case"error":default:return dg.ERROR}}class Observer{constructor(e,t,n){if(function(e){return"function"==typeof e}(e)||null!=t||null!=n)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function pg(e){return(...t)=>{Promise.resolve().then((()=>e(...t)))}}class XhrConnection{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Fm.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=Fm.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=Fm.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw Dm("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const e in r)r.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,r[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Dm("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Dm("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw Dm("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Dm("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class XhrTextConnection extends XhrConnection{initXhr(){this.xhr_.responseType="text"}}function mg(){return new XhrTextConnection}class XhrBytesConnection extends XhrConnection{initXhr(){this.xhr_.responseType="arraybuffer"}}function gg(){return new XhrBytesConnection}class XhrBlobConnection extends XhrConnection{initXhr(){this.xhr_.responseType="blob"}}function yg(){return new XhrBlobConnection}class UploadTask{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=Qm(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=e,this._transition("error"))},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t,this._start()})),this._promise.then(null,(()=>{}))}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}}))}_createResumable(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,s){const i=t.bucketOnlyServerUrl(),o=cg(t,r,s),a={name:o.fullPath},c=Mm(i,e.host,e._protocol),u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=Ym(o,n),l=e.maxUploadRetryTime,d=new RequestInfo(c,"POST",(function(e){let t;hg(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){eg(!1)}return eg(Om(t)),t}),l);return d.urlParams=a,d.headers=u,d.body=h,d.errorHandler=rg(t),d}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,mg,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const e=this._uploadUrl;this._resolveToken(((t,n)=>{const r=function(e,t,n,r){const s=e.maxUploadRetryTime,i=new RequestInfo(n,"POST",(function(e){const t=hg(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){eg(!1)}n||eg(!1);const s=Number(n);return eg(!isNaN(s)),new ResumableUploadStatus(s,r.size(),"final"===t)}),s);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=rg(t),i}(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(r,mg,t,n);this._request=s,s.getPromise().then((e=>{e=e,this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const e=262144*this._chunkMultiplier,t=new ResumableUploadStatus(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken(((r,s)=>{let i;try{i=lg(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const o=this._ref.storage._makeRequest(i,mg,r,s);this._request=o,o.getPromise().then((e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()}),this._errorHandler)}))}_increaseMultiplier(){262144*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken(((e,t)=>{const n=ig(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,mg,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((e,t)=>{const n=ug(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,mg,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")}),this._errorHandler)}))}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=Sm(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=fg(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const s=new Observer(t||void 0,n||void 0,r||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();this._observers.slice().forEach((e=>{this._notifyObserver(e)}))}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(fg(this._state)){case dg.SUCCESS:pg(this._resolve.bind(null,this.snapshot))();break;case dg.CANCELED:case dg.ERROR:pg(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(fg(this._state)){case dg.RUNNING:case dg.PAUSED:e.next&&pg(e.next.bind(e,this.snapshot))();break;case dg.SUCCESS:e.complete&&pg(e.complete.bind(e))();break;case dg.CANCELED:case dg.ERROR:e.error&&pg(e.error.bind(e,this._error))();break;default:e.error&&pg(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class Reference{constructor(e,t){this._service=e,this._location=t instanceof Location?t:Location.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Reference(e,t)}get root(){const e=new Location(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Hm(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Location(this._location.bucket,e);return new Reference(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw Rm(e)}}function vg(e,t,n){e._throwIfRoot("uploadBytes");const r=ug(e.storage,e._location,Qm(),new FbsBlob(t,!0),n);return e.storage.makeRequestWithTokens(r,mg).then((t=>({metadata:t,ref:e})))}function wg(e){const t={prefixes:[],items:[]};return Ig(e,t).then((()=>t))}async function Ig(e,t,n){const r={pageToken:n},s=await _g(e,r);t.prefixes.push(...s.prefixes),t.items.push(...s.items),null!=s.nextPageToken&&await Ig(e,t,s.nextPageToken)}function _g(e,t){null!=t&&"number"==typeof t.maxResults&&xm("options.maxResults",1,1e3,t.maxResults);const n=t||{},r=og(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(r,mg)}function bg(e,t){e._throwIfRoot("updateMetadata");const n=function(e,t,n,r){const s=Mm(t.fullServerUrl(),e.host,e._protocol),i=Ym(n,r),o=e.maxOperationRetryTime,a=new RequestInfo(s,"PATCH",tg(e,r),o);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=i,a.errorHandler=sg(t),a}(e.storage,e._location,t,Qm());return e.storage.makeRequestWithTokens(n,mg)}function Tg(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=Mm(t.fullServerUrl(),e.host,e._protocol),s=e.maxOperationRetryTime,i=new RequestInfo(r,"GET",ng(e,n),s);return i.errorHandler=sg(t),i}(e.storage,e._location,Qm());return e.storage.makeRequestWithTokens(t,mg).then((e=>{if(null===e)throw new StorageError("no-download-url","The given file does not have any download URLs.");return e}))}function Eg(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=Mm(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,s=new RequestInfo(n,"DELETE",(function(e,t){}),r);return s.successCodes=[200,204],s.errorHandler=sg(t),s}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,mg)}function Sg(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new Location(e._location.bucket,n);return new Reference(e.storage,r)}function Ag(e,t){if(e instanceof FirebaseStorageImpl){const n=e;if(null==n._bucket)throw new StorageError("no-default-bucket","No default bucket found. Did you set the 'storageBucket' property when initializing the app?");const r=new Reference(n,n._bucket);return null!=t?Ag(r,t):r}return void 0!==t?Sg(e,t):e}function kg(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof FirebaseStorageImpl)return new Reference(e,t);throw km("To use ref(service, url), the first argument must be a Storage instance.")}return Ag(e,t)}function Cg(e,t){const n=null==t?void 0:t.storageBucket;return null==n?null:Location.makeFromBucketSpec(n,e)}class FirebaseStorageImpl{constructor(e,t,n,r,s){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=s,this._bucket=null,this._host="firebasestorage.googleapis.com",this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?Location.makeFromBucketSpec(r,this._host):Cg(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Location.makeFromBucketSpec(this._url,e):this._bucket=Cg(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){xm("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){xm("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Reference(this,e)}_makeRequest(e,t,n,r){if(this._deleted)return new FailRequest(Cm());{const s=function(e,t,n,r,s,i){const o=Um(e.urlParams),a=e.url+o,c=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(c,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(c,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(c,i),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(c,r),new NetworkRequest(a,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,s)}(e,this._appId,n,r,t,this._firebaseVersion);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}function Rg(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return new FirebaseStorageImpl(n,r,s,t,"9.6.1")}N(new Component("storage",Rg,"PUBLIC").setMultipleInstances(!0)),x("@firebase/storage","0.9.0",""),x("@firebase/storage","0.9.0","esm2017");var Ng={App:U,Auth:Yn,Firestore:pm,Functions:bm,Storage:Object.freeze({__proto__:null,StringFormat:qm,_FbsBlob:FbsBlob,_Location:Location,_TaskEvent:{STATE_CHANGED:"state_changed"},_TaskState:dg,_UploadTask:UploadTask,_dataFromString:$m,_getChild:function(e,t){return Sg(e,t)},_invalidArgument:km,_invalidRootOperation:Rm,connectStorageEmulator:function(e,t,n,s={}){!function(e,t,n,s={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:i}=s;i&&(e._overrideAuthToken="string"==typeof i?i:r(i,e.app.options.projectId))}(e,t,n,s)},deleteObject:function(e){return Eg(e=y(e))},getBlob:function(e,t){return function(e,t){e._throwIfRoot("getBlob");const n=ag(e.storage,e._location,t);return e.storage.makeRequestWithTokens(n,yg).then((e=>void 0!==t?e.slice(0,t):e))}(e=y(e),t)},getBytes:function(e,t){return function(e,t){e._throwIfRoot("getBytes");const n=ag(e.storage,e._location,t);return e.storage.makeRequestWithTokens(n,gg).then((e=>void 0!==t?e.slice(0,t):e))}(e=y(e),t)},getDownloadURL:function(e){return Tg(e=y(e))},getMetadata:function(e){return function(e){e._throwIfRoot("getMetadata");const t=ig(e.storage,e._location,Qm());return e.storage.makeRequestWithTokens(t,mg)}(e=y(e))},getStorage:function(e=L(),t){return D(e=y(e),"storage").getImmediate({identifier:t})},getStream:function(e,t){throw new Error("getStream() is only supported by NodeJS builds")},list:function(e,t){return _g(e=y(e),t)},listAll:function(e){return wg(e=y(e))},ref:function(e,t){return kg(e=y(e),t)},updateMetadata:function(e,t){return bg(e=y(e),t)},uploadBytes:function(e,t,n){return vg(e=y(e),t,n)},uploadBytesResumable:function(e,t,n){return function(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new UploadTask(e,new FbsBlob(t),n)}(e=y(e),t,n)},uploadString:function(e,t,n,r){return function(e,t,n=qm.RAW,r){e._throwIfRoot("uploadString");const s=$m(n,t),i=Object.assign({},r);return null==i.contentType&&null!=s.contentType&&(i.contentType=s.contentType),vg(e,s.data,i)}(e=y(e),t,n,r)}})};export default Ng;