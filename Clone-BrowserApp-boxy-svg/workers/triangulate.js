let e={seed:100,cellSize:.1,variance:.75,renderAs:"paths",geometryPrecision:3};globalThis.addEventListener("message",(async s=>{let[i,f]=s.data;f=t(e,f);let h=(await import("/modules/delaunator/delaunator.js")).default,d=(await import("/modules/seed-random/seed-random.js")).default,g=l(i),{width:$,height:u}=i,{variance:p,seed:M,renderAs:b}=f,m=f.cellSize*Math.min($,u);m<.02*$&&(m=o(.02*$));let y=[],c="";{let e=(Math.floor(($+4*m)/m)*m-$)/2,t=(Math.floor((u+4*m)/m)*m-u)/2,l=m*p/2,r=new d(M);for(let a=-e;a<$+e;a+=m)for(let e=-t;e<u+t;e+=m){let t=a+.5*m+(r()*l*2-l),o=e+.5*m+(r()*l*2-l);y.push([Math.floor(t),Math.floor(o)])}}{let e=h.from(y).triangles;c=`<svg viewBox="0 0 ${$} ${u}" style="shape-rendering: crispedges;">`;for(let t=0;t<e.length;t+=3){let l=[e[t],e[t+1],e[t+2]].map((e=>y[e])),s=a(l),h=r(s.x,s.y,i,g);if("rgba(0,0,0,0)"!==h){let e=n([0,0,i.width,i.height],l);if(e.length>0){for(let t of e)t[0]=o(t[0],f.geometryPrecision),t[1]=o(t[1],f.geometryPrecision);if("paths"===b){let[t,...l]=e,r=`M ${t[0]} ${t[1]}`;for(let e of l)r+=` L ${e[0]} ${e[1]}`;r+=" Z",c+=`<path d="${r}" style="fill: ${h};"></path>`}else if("polygons"===b){c+=`<polygon points="${e.map((e=>`${e[0]} ${e[1]}`)).join(" ")}" style="fill: ${h};"></polygon>`}}}}c+="</svg>"}globalThis.postMessage(c)}));let t=(e,t)=>{let l={};for(let[r,a]of Object.entries(e))l[r]=void 0!==t[r]?t[r]:e[r];return l},l=e=>{let t=new OffscreenCanvas(e.width,e.height).getContext("2d");t.drawImage(e,0,0);let l=t.getImageData(0,0,e.width,e.height),r=[];for(let e=0;e<l.data.length;e+=4)r.push([l.data[e],l.data[e+1],l.data[e+2],l.data[e+3]]);return r},r=(e,t,l,r)=>{e=Math.round(e),t=Math.round(t);{let r=1;e<0?e=r:e>=l.width&&(e=l.width-r),t<0?t=r:t>=l.height&&(t=l.height-r)}let a=r[e+t*l.width],o="rgba(0,0,0,0)";return a&&(o=s(...a)),o},a=e=>({x:(e[0][0]+e[1][0]+e[2][0])/3,y:(e[0][1]+e[1][1]+e[2][1])/3}),o=(e,t=0)=>{let l=Math.pow(10,t);return Math.round((e+Number.EPSILON)*l)/l},s=(e,t,l,r)=>{let a=e=>{let t=e.toString(16);return 1==t.length?"0"+t:t};return 255===r?"#"+a(e)+a(t)+a(l):0===r?"rgba(0,0,0,0)":`rgba(${e},${t},${l},${r=o(r/255,2)})`},n=(e,t)=>{let l,r=(e,t,l,r)=>8&l?[e[0]+(t[0]-e[0])*(r[3]-e[1])/(t[1]-e[1]),r[3]]:4&l?[e[0]+(t[0]-e[0])*(r[1]-e[1])/(t[1]-e[1]),r[1]]:2&l?[r[2],e[1]+(t[1]-e[1])*(r[2]-e[0])/(t[0]-e[0])]:1&l?[r[0],e[1]+(t[1]-e[1])*(r[0]-e[0])/(t[0]-e[0])]:null,a=(e,t)=>{let l=0;return e[0]<t[0]?l|=1:e[0]>t[2]&&(l|=2),e[1]<t[1]?l|=4:e[1]>t[3]&&(l|=8),l};for(let o=1;o<=8;o*=2){let s=t[t.length-1],n=!(a(s,e)&o);l=[];for(let i=0;i<t.length;i++){let f=t[i],h=!(a(f,e)&o);h!==n&&l.push(r(s,f,o,e)),h&&l.push(f),s=f,n=h}if(!(t=l).length)break}return l};