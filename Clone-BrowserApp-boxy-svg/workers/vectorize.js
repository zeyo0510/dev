let e={workingSize:512,blurRadius:0,blurDelta:20,numberOfColors:16,minColorRatio:0,colorQuantCycles:3,colorSampling:2,ltres:1,qtres:1,pathOmit:8,rightAngleEnhance:!0,strokeWidth:1,lineFilter:!0,ignoreWhite:!1,geometryPrecision:3};globalThis.addEventListener("message",(async r=>{let[o,i]=r.data;i=t(e,i);let a=Math.max(o.width/i.workingSize,o.height/i.workingSize,1),s=o.width/a,$=o.height/a,n=new OffscreenCanvas(s,$).getContext("2d");n.beginPath(),n.rect(0,0,s,$),n.fillStyle="white",n.fill(),n.drawImage(o,0,0,s,$);let g=n.getImageData(0,0,s,$),f=(await import("/modules/image-tracer/image-tracer.js")).default.imagedataToTracedata(g,{blurradius:i.blurRadius,blurdelta:i.blurDelta,numberofcolors:i.numberOfColors,mincolorratio:i.minColorRatio,colorquantcycles:i.colorQuantCycles,colorsampling:i.colorSampling,ltres:i.ltres,qtres:i.qtres,pathomit:i.pathOmit,rightangleenhance:i.rightAngleEnhance}),h=l(f,a,i);globalThis.postMessage(h)}));let t=(e,t)=>{let r={};for(let[l,o]of Object.entries(e))r[l]=void 0!==t[l]?t[l]:e[l];return r},r=(e,t=0)=>{let r=Math.pow(10,t);return Math.round((e+Number.EPSILON)*r)/r},l=(e,t,l)=>{let i=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${r(e.width*t,l.geometryPrecision)} ${r(e.height*t,l.geometryPrecision)}">`;if(!0===l.ignoreWhite)for(let t=0;t<e.palette.length;t+=1){e.palette[t].r+e.palette[t].g+e.palette[t].b>=600&&(e.palette[t].r=0,e.palette[t].g=0,e.palette[t].b=0,e.palette[t].a=0)}for(let r=0;r<e.layers.length;r+=1)for(let a=0;a<e.layers[r].length;a+=1)e.layers[r][a].isholepath||(i+=o(e,r,a,t,l));return i+="</svg>",i},o=(e,t,l,o,i)=>{let a=e.layers[t],s=r(e.palette[t].a/255,2),$=a[l],n="",g="";if(0===s)return"";if(i.lineFilter&&$.segments.length<3)return"";{let r=e.palette[t],{r:l,g:o,b:a}=r,$=[];$.push(`fill: rgba(${l}, ${o}, ${a}, ${s});`),i.strokeWidth>0&&($.push(`stroke: rgba(${l}, ${o}, ${a}, ${s});`),1!==i.strokeWidth&&$.push(`stroke-width: ${i.strokeWidth}px;`)),n=`style="${$.join(" ")}"`}g+='d="';g+=`M ${r($.segments[0].x1*o,i.geometryPrecision)} ${r($.segments[0].y1*o,i.geometryPrecision)} `;for(let e=0;e<$.segments.length;e+=1){if(g+=`${$.segments[e].type} ${r($.segments[e].x2*o,i.geometryPrecision)} ${r($.segments[e].y2*o,i.geometryPrecision)} `,$.segments[e].hasOwnProperty("x3")){g+=`${r($.segments[e].x3*o,i.geometryPrecision)} ${r($.segments[e].y3*o,i.geometryPrecision)} `}}g+="Z ";for(let e=0;e<$.holechildren.length;e+=1){let t=a[$.holechildren[e]];if(t.segments[t.segments.length-1].hasOwnProperty("x3")){g+=`M ${r(t.segments[t.segments.length-1].x3*o)} ${r(t.segments[t.segments.length-1].y3*o)} `}else{g+=`M ${r(t.segments[t.segments.length-1].x2*o)} ${r(t.segments[t.segments.length-1].y2*o)} `}for(let e=t.segments.length-1;e>=0;e-=1){if(g+=`${t.segments[e].type} `,t.segments[e].hasOwnProperty("x3")){g+=`${r(t.segments[e].x2*o)} ${r(t.segments[e].y2*o)} `}g+=`${r(t.segments[e].x1*o)} ${r(t.segments[e].y1*o)} `}g+="Z "}return g+='"',`<path ${g} ${n}></path>`};