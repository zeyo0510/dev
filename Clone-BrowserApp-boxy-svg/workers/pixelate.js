let e={columns:20,rows:20,pixelShape:"rectangle",pixelSize:.9,renderAs:"paths",geometryPrecision:3};globalThis.addEventListener("message",(s=>{let[a,h]=s.data;h=t(e,h);let $=r(a),{width:f,height:o}=a,{columns:p,rows:n,pixelShape:c,pixelSize:g,renderAs:b,geometryPrecision:u}=h,y=f/p,d=o/n,x=`<svg viewBox="0 0 ${f} ${o}">`;if("rectangle"===c)for(let e=0;e<p;e+=1)for(let t=0;t<n;t+=1){let r=e*y,s=t*d,h=i((r+y/2)/f,(s+d/2)/o,a,$);if("rgba(0,0,0,0)"!==h){let e=y*g,t=d*g,i=r+y/2-e/2,a=s+d/2-t/2;if("shapes"===b){let r={x:l(i,u),y:l(a,u),width:l(e,u),height:l(t,u),style:`fill: ${h};`};x+=`<rect ${Object.entries(r).map((([e,t])=>`${e}="${t}"`)).join(" ")}></rect>`}else if("paths"===b){let r={d:[["M",l(i,u),l(a,u)],["H",l(i+e,u)],["V",l(a+t,u)],["H",l(i,u)],["V",l(a,u)],["Z"]].map((e=>e.join(" "))).join(" "),style:`fill: ${h};`};x+=`<path ${Object.entries(r).map((([e,t])=>`${e}="${t}"`)).join(" ")}></path>`}}}else if("ellipse"===c)for(let e=0;e<p;e+=1)for(let t=0;t<n;t+=1){let r=e*y+y/2,s=t*d+d/2,h=y/2*g,p=d/2*g,n=i(r/f,s/o,a,$);if("rgba(0,0,0,0)"!==n)if(r=l(r,u),s=l(s,u),h=l(h,u),p=l(p,u),"shapes"===b){let e={cx:l(r,u),cy:l(s,u),rx:l(h,u),ry:l(p,u),style:`fill: ${n};`};x+=`<ellipse ${Object.entries(e).map((([e,t])=>`${e}="${t}"`)).join(" ")}></ellipse>`}else if("paths"===b){let e=u,t={d:[["M",l(r-h,e),l(s,e)],["a",l(h,e),l(p,e),0,1,0,l(2*h,e),0],["a",l(h,e),l(p,e),0,1,0,l(-2*h,e),0],["Z"]].map((e=>e.join(" "))).join(" "),style:`fill: ${n};`};x+=`<path ${Object.entries(t).map((([e,t])=>`${e}="${t}"`)).join(" ")}></path>`}}x+="</svg>",globalThis.postMessage(x)}));let t=(e,t)=>{let l={};for(let[r,i]of Object.entries(e))l[r]=void 0!==t[r]?t[r]:e[r];return l},l=(e,t=0)=>{let l=Math.pow(10,t);return Math.round((e+Number.EPSILON)*l)/l},r=e=>{let t=new OffscreenCanvas(e.width,e.height).getContext("2d");t.drawImage(e,0,0);let l=t.getImageData(0,0,e.width,e.height),r=[];for(let e=0;e<l.data.length;e+=4)r.push([l.data[e],l.data[e+1],l.data[e+2],l.data[e+3]]);return r},i=(e,t,l,r)=>{let i=r[Math.round(e*l.width)+Math.round(t*l.height)*l.width],a="rgba(0,0,0,0)";return i&&(a=s(...i)),a},s=(e,t,r,i)=>{let s=e=>{let t=e.toString(16);return 1==t.length?"0"+t:t};return 255===i?"#"+s(e)+s(t)+s(r):0===i?"rgba(0,0,0,0)":`rgba(${e},${t},${r},${i=l(i/255,2)})`};