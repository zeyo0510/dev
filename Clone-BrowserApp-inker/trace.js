/*
    Copyright (c) 2015-2020 Alexander Shutau. All rights reserved.
    No part of the materials including graphics, logos, designs, codes,
    available in this application may be copied, reproduced, translated
    or reduced to any electronic medium or machine-readable form, in
    whole or in part, without specific permission. Distribution for
    commercial purposes is prohibited.
    
      #@@#
                        e@@e
    #@@@@e  #@.e@@@@e.  #@@# .e@#  .e@@@@e.  #@.e@#
      #@@#  #@@#  #@@#  #@@@@@#<   #@@#_.#'  #@@#
      #@@#  #@@#  #@@#  #@@# '@@#  '#@@@@@#  #@@# (R)
    
      V e c t o r   g r a p h i c s   e d i t o r
    
*/
"use strict";function process(r){var t=[],n=r,e=function(){setTimeout(function(){var r=t.shift();r&&(n=r(n),e())},0)};e();var o={next:function(r){return t.push(r),o}};return o}function convolve(r,t,n,e,o){for(var a,u,s,i=[],h=0;h<o;h++)for(i.push([]),u=0;u<o;u++)i[h].push(new Uint8ClampedArray(3));for(var f=(o-1)/2,c=0;c<n;c++)for(a=0;a<t;a++){for(h=0;h<o;h++)for(u=0;u<o;u++)s=4*((s=0<=(s=c+h-f)&&s<n?s:c-h+f)*t+(s=0<=(s=a+u-f)&&s<t?s:a-u+f)),i[h][u][0]=r[0+s],i[h][u][1]=r[1+s],i[h][u][2]=r[2+s];e(i,a,c)}}function applyKernel(r,t){for(var n=[0,0,0],e=0;e<3;e++)for(var o=0;o<3;o++)for(var a=0;a<3;a++)n[a]+=r[e][o][a]*t[e][o];return new Uint8ClampedArray(n)}function applyConvolve(r,e,t,o,n){var a=new Uint8ClampedArray(r.length);return convolve(r,e,t,function(r,t,n){r=o(r,t,n),t=4*(n*e+t);a[0+t]=r[0],a[1+t]=r[1],a[2+t]=r[2],a[3+t]=255},n),a}function applyLoop(r,t,n,e){for(var o,a,u=new Uint8ClampedArray(r.length),s=0;s<n;s++)for(var i=0;i<t;i++)o=4*(s*t+i),a=e(r.slice(o,4+o),i,s),u[0+o]=a[0],u[1+o]=a[1],u[2+o]=a[2],u[3+o]=255;return u}function medianRGBFilter(r,u,t,s){var i=new Uint8ClampedArray(r);return convolve(r,u,t,function(r,t,n){var e=[],o=[],a=[];r.forEach(function(r,t){r.forEach(function(r){e.push(r[0]),o.push(r[1]),a.push(r[2])})}),e.sort(function(r,t){return r-t}),o.sort(function(r,t){return r-t}),a.sort(function(r,t){return r-t});n=4*(n*u+t),t=(s*s-1)/2;i[0+n]=e[t],i[1+n]=o[t],i[2+n]=a[t]},s),i}function dist(r,t,n,e){return void 0===n&&(n=0),void 0===e&&(e=0),Math.sqrt(Math.pow(r[n+0]-t[e+0],2)+Math.pow(r[n+1]-t[e+1],2)+Math.pow(r[n+2]-t[e+2],2))}function hsbToRgb(r,t,n){var e,o=r,a=t,u=n;if(r<0||360<r||t<0||1<t||n<0||1<n)throw new Error("Unable to convert color: hue = "+r+", saturation = "+t+", brightness = "+n+".");o<60?e={r:255,g:Math.round(o/60*255),b:0}:o<120?e={r:Math.round((120-o)/60*255),g:255,b:0}:o<180?e={r:0,g:255,b:Math.round((o-120)/60*255)}:o<240?e={r:0,g:Math.round((240-o)/60*255),b:255}:o<300?e={r:Math.round((o-240)/60*255),g:0,b:255}:o<=360&&(e={r:255,g:0,b:Math.round((360-o)/60*255)});o=Math.max(e.r,e.g,e.b),u={r:(e.r+(o-e.r)*(1-a))*u,g:(e.g+(o-e.g)*(1-a))*u,b:(e.b+(o-e.b)*(1-a))*u},u={r:Math.round(u.r),g:Math.round(u.g),b:Math.round(u.b)};return[u.r,u.g,u.b]}function rgbToHsb(r,t,n){var e,o=Math.max(r,t,n),a=Math.min(r,t,n);return o===a?e=0:o===r&&n<=t?e=60*(t-n)/(o-a):o===r&&t<n?e=60*(t-n)/(o-a)+360:o===t?e=60*(n-r)/(o-a)+120:o===n&&(e=60*(r-t)/(o-a)+240),[e,0===o?0:1-a/o,o/255]}function getLightness(r,t,n){return(.299*r+.587*t+.114*n)/255}function getRgbFromHueAndLightness(r,t){var n=hsbToRgb(r,1,1),e=getLightness(n[0],n[1],n[2]);return t===e?n:e<t?hsbToRgb(r,1-(t-e)/(1-e),1):hsbToRgb(r,1,t/e)}function parse(r){return r.split(/,/g).map(function(r){return parseInt(r)})}function trace(r,s,i,t){var n=t.maxColors,e=t.srcWidth,o=t.srcHeight,E=[0,43,128,213,255],A=null,U=null==n?3:n;postMessage({type:"progress",value:0});n=function(r,t,n,e){var o=new Uint8ClampedArray(r),r=1/16,m=3;function a(r,c,t){function f(r,t){return t.length-r.length}function n(r,t){return r[0]+r[1]+r[2]-t[0]-t[1]-t[2]}function p(r){return r.slice().sort(n)[Math.floor(r.length/2)]}function l(r,t){return Math.sqrt(Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2)+Math.pow(r[2]-t[2],2))}function g(r){for(var t,n=(t=[[],[],[]],r.forEach(function(r){t[0].push(r[0]),t[1].push(r[1]),t[2].push(r[2])}),t.map(function(r){return[Math.min.apply(Math,r),Math.max.apply(Math,r)]})),e=[[],[],[]],o=0;o<3;o++){for(var a=0;a<3;a++)e[o].push(n[o][0]+(n[o][1]-n[o][0])*a/2);e[o][2]++}for(var u=[],s=0;s<2;s++)for(var i=0;i<2;i++)for(var h=0;h<2;h++)u.push(function(r,t){return r.filter(function(r){return r[0]>=t[0][0]&&r[0]<t[0][1]&&r[1]>=t[1][0]&&r[1]<t[1][1]&&r[2]>=t[2][0]&&r[2]<t[2][1]})}(r,[[e[0][s],e[0][s+1]],[e[1][i],e[1][i+1]],[e[2][h],e[2][h+1]]]));return u.sort(f)}var v=new Uint8ClampedArray(r);return convolve(r,c,t,function(r,t,n){var e=[];r.forEach(function(r,t){r.forEach(function(r){e.push(r)})});var o,a,u,s,i,h=g(e),f=p(h[0]);u=h[1].length<3?f:(s=r[a=(m-1)/2][a],o=p(h[1]),r=l(s,f),a=l(s,o),h[2].length<3?(i=Math.min(r,a))===r?f:o:(u=p(h[2]),s=l(s,u),(i=Math.min(r,a,s))===r?f:i===a?o:u));t=4*(c*n+t);v[0+t]=u[0],v[1+t]=u[1],v[2+t]=u[2]},m),v}for(var u=new Uint8ClampedArray(o),s=0;s<8;s++)u=a(u,t,n),e((s+1)/9);for(var i=0;i<o.length;i++)o[i]=u[i];return o}(r,s,i,function(r){return postMessage({type:"progress",value:1/8*r})});postMessage({type:"progress",value:1/8,img:n});r=function(r,t,n,e){for(var o=new Uint8ClampedArray(r),v=[],a=0;a<E.length;a++)for(var u=0;u<E.length;u++)for(var s=0;s<E.length;s++)v.push(new Uint8ClampedArray([E[a],E[u],E[s]]));A;for(var i,m={},M=function(r,t){return Math.sqrt(Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2)+Math.pow(r[2]-t[2],2))},h=[],f=v,c=0;c<3;c++){v=f.concat(h.map(function(r){return new Uint8ClampedArray(r)}));var y=0;convolve(o,t,n,function(r,t,n){if(y%4!=0){y++;for(var e,o,a,u=v.reduce(function(r,t){return r.set(t[0]+","+t[1]+","+t[2],[]),r},new Map),s=Number.MAX_VALUE,i=v.length,h=0;h<3;h++)for(var f=0;f<3;f++){for(var c=0;c<i;c++)(a=M(v[c],r[h][f]))<s&&(s=a,e=r[h][f],o=v[c]);u.get(o[0]+","+o[1]+","+o[2]).push(e)}var p=[];u.forEach(function(r,t){return p.push([t,r])});var l,g=p.sort(function(r,t){return t[1].length-r[1].length})[0],g=(l=g[1].reduce(function(r,t){return r[0]+=t[0],r[1]+=t[1],r[2]+=t[2],r},[0,0,0]),new Uint8ClampedArray([l[0]/g[1].length,l[1]/g[1].length,l[2]/g[1].length]));m[String(g)]=m[String(g)]||0,m[String(g)]++}else y++},3);var p=Object.keys(m).sort(function(r,t){return m[t]-m[r]}),l={};p.map(parse).forEach(function(t){var r=v.map(function(r){return[r,M(r,t)]}).sort(function(r,t){return r[1]-t[1]})[0][0],r=r[0]+","+r[1]+","+r[2];r in l||(l[r]=[t[0]+","+t[1]+","+t[2],0]),l[r][1]+=m[t[0]+","+t[1]+","+t[2]]});for(var g=Object.keys(l).map(function(r){return l[r]}).sort(function(r,t){return t[1]-r[1]}),b=1;b<=8;b++){i=[];for(var d=0;d<g.length;d++)for(var w=d+1;w<g.length;w++)M(parse(g[d][0]),parse(g[w][0]))<16*(1+b/2)&&i.push(w);if((g=g.filter(function(r,t){return i.indexOf(t)<0})).length<=U)break}for(var x=g=g.slice(0,U),C=2;C<x.length;C++)if(x[C][1]/(x[C-1][1]+x[C-2][1])<.01){x.splice(Math.max(C,2));break}h=(g=x).map(function(r){return parse(r[0])}),e((c+1)/4)}0;return h}(n,s,i,function(r){return postMessage({type:"progress",value:1/8*(1+r)})});postMessage({type:"progress",value:.25});r=function(r,t){for(var n,e,o=new Uint8ClampedArray(r),a=0;a<i;a++)for(var u=0;u<s;u++)n=4*(a*s+u),e=t.map(function(r){return{c:r,dist:dist(r,o,0,n)}}).sort(function(r,t){return r.dist-t.dist})[0].c,o[0+n]=e[0],o[1+n]=e[1],o[2+n]=e[2],o[3+n]=255;return o}(n,r);postMessage({type:"progress",value:3/8,img:r});r=function(r,l,t){for(var g=new Uint8ClampedArray(r),n=0;n<3;n++)convolve(new Uint8ClampedArray(g),l,t,function(r,t,n){for(var e,o={},a={},u=r[2][2],s=u[0]+","+u[1]+","+u[2],i=0;i<5;i++)for(var h=0;h<5;h++)o[e=(e=r[i][h])[0]+","+e[1]+","+e[2]]=o[e]||0,o[e]+=4-(Math.abs(i-2)+Math.abs(h-2)),a[e]=a[e]||0,0<i&&0<Math.abs(2-i)&&r[i][h][0]===r[i-1][h][0]&&r[i][h][1]===r[i-1][h][1]&&r[i][h][2]===r[i-1][h][2]&&(a[e]+=4-(Math.abs(i-2)+Math.abs(h-2))),0<h&&0<Math.abs(2-h)&&r[i][h][0]===r[i][h-1][0]&&r[i][h][1]===r[i][h-1][1]&&r[i][h][2]===r[i][h-1][2]&&(a[e]+=4-(Math.abs(i-2)+Math.abs(h-2)));var f=Object.keys(Object.keys(a).length?a:o).map(function(r){return[r,a[r]]}).sort(function(r,t){return t[1]-r[1]}),c=f[0],p=f[1],c=(o[s],(c[0]===s||p[0]===s&&p[1]>c[1]-20&&4<=p[1]?s:p[1]>c[1]-20&&4<=p[1]?(u=parse(s),f=parse(c[0]),s=parse(p[0]),(dist(u,f)<dist(u,s)?c:p)[0]):c[0]).split(/,/g).map(function(r){return parseInt(r)}));g[(i=4*(n*l+t))+0]=c[0],g[i+1]=c[1],g[i+2]=c[2],g[i+3]=255},5);return g}(r,s,i);postMessage({type:"progress",value:.5,img:r});r=function(r,t,n){var e,o,a,u,s,i=2*t+1,h=new Uint8ClampedArray(i*(2*n+1)*4),f=new Uint8ClampedArray(r);for(o=0;o<n+1;o++)for(e=0;e<t+1;e++){a=4*(o*t+e),s=4*((o-1)*t+e),u=4*(o*t+e-1),u=0===e||e===t&&o<n||!(f[0+a]===f[0+u]&&f[1+a]===f[1+u]&&f[2+a]===f[2+u]&&f[3+a]===f[3+u]),s=0===o||o===n&&e<t||!(f[0+a]===f[0+s]&&f[1+a]===f[1+s]&&f[2+a]===f[2+s]&&f[3+a]===f[3+s]);var c=2*e+1,p=2*o+1;e<t&&o<n&&(h[4*(p*i+c)+0]=f[0+a],h[4*(p*i+c)+1]=f[1+a],h[4*(p*i+c)+2]=f[2+a],h[4*(p*i+c)+3]=255),o<n&&(h[4*(p*i+c-1)+0]=0,h[4*(p*i+c-1)+1]=0,h[4*(p*i+c-1)+2]=255*u,h[4*(p*i+c-1)+3]=255),e<t&&(h[4*((p-1)*i+c)+0]=0,h[4*((p-1)*i+c)+1]=0,h[4*((p-1)*i+c)+2]=255*s,h[4*((p-1)*i+c)+3]=255)}for(o=0;o<n-1;o++)for(e=0;e<t-1;e++){var c=2*e,p=2*o,l=Number(0<e&&255===h[4*(p*i+c-1)+2])+Number(e<t-1&&255===h[4*(p*i+c+1)+2])+Number(0<o&&255===h[4*((p-1)*i+c)+2])+Number(o<n-1&&255===h[4*((p+1)*i+c)+2]);2===l&&(h[4*(p*i+c)+1]=255,h[4*(p*i+c)+3]=255),2<l&&(h[4*(p*i+c)+0]=255,h[4*(p*i+c)+1]=255,h[4*(p*i+c)+3]=255)}return h}(r,s,i);postMessage({type:"progress",value:5/8,img:r});r=function(u,r,t){var s=new Uint8ClampedArray(u),o=r+1,a=t+1,i=r,h=t,f=2*r+1,c=2*t+1,p=[];function l(r,t,n){return u[4*(t*f+r)+n]}function g(r,t){r*=2,t*=2,t=(Number(0<t&&255===l(r,t-1,2))<<2)+(Number(r<f-1&&255===l(1+r,t,2))<<1)+(Number(t<c-1&&255===l(r,1+t,2))<<3)+(Number(0<r&&255===l(r-1,t,2))<<0);if(((1&t)>>0)+((2&t)>>1)+((4&t)>>2)+((8&t)>>3)==1)throw new Error("What");return t}function v(r,t,n){var e=2*r,o=2*t;if([1,2,4,8].indexOf(n)<0)throw new Error("What?");var a=e+(2===n?1:1===n?-1:0),e=o+(8===n?1:4===n?-1:0);l(a,e,3);o=0,u[4*(e*f+a)+3]=o;n=4*(f*(2*t+(4===n?-1:8===n?1:0))+2*r+(1===n?-1:2===n?1:0));s[2+n]=255===s[0+n]&&255===s[1+n]?255:0,s[1+n]=255===s[0+n]?255:128,s[0+n]=255,s[3+n]=255}var m={1:2,2:1,4:8,8:4};function M(r,t,n,e){r=r+","+t;void 0!==d[r]&&(t=e?m[n]:n,d[r][t]--,e||(w[r][x[n]]=!1),d[r][t]<0&&(d[r][t]=0))}function y(t,r){void 0===r&&(r=0);var n;return((n={})[0]=[2,8,1,4],n[4]=[2,4,1],n[2]=[8,2,4],n[8]=[1,8,2],n[1]=[4,1,8],n)[r].filter(function(r){return(t&r)===r})[0]||0}function n(r,t){return 2<((1&(t=g(r,t=t)))>>0)+((2&t)>>1)+((4&t)>>2)+((8&t)>>3)}var e=[];function b(r,t){var n=t?i+1:i,e=t?h+1:h;r:for(var o=0;o<e;o++)for(var a=0;a<n;a++)if(!r(a,o))break r}b(function(r,t){return n(r,t)&&e.push([r,t]),1},!0);var d=e.reduce(function(r,t){var o=t[0],a=t[1],u=g(o,a);return r[o+","+a]=[1,2,4,8].reduce(function(r,t){var n=0<(u&t),e=!((0!==o&&o!==i||4!==t&&8!==t)&&(0!==a&&a!==h||1!==t&&2!==t));return r[t]=n?e?1:2:0,r},{}),r},{}),w=Object.keys(d).reduce(function(r,t){var n=t.split(",").map(function(r){return parseInt(r)}),e=n[0],n=n[1],n=[0<e&&0<n,e<o&&0<n,0<e&&n<a,e<o&&n<a];return r[t]=n,r},{}),x={1:0,2:3,4:1,8:2};function C(n,e,r){var o=[n,e];v(n,e,r);for(var a,u,s=n,i=e,h=r,f={x:s,y:i},t=1e7;function(){if(u=8&h?1:4&h?-1:0,0==(a=2&h?1:1&h?-1:0)&&0==u)throw new Error("WTF");if(M(s,i,h,!1),M(s+=a,i+=u,h,!0),s===n&&i===e)return!1;i===f.y?s<f.x&&(f.x=s):i<f.y&&(f.x=s,f.y=i);var r=g(s,i),t=h;if(0!==(h=y(r,h)))return v(s,i,h),o.push(s,i),!0;y(g(s,i),t);throw new Error("What?")}()&&t--;);if(!(2<o.length))throw new Error("What?");if(p.push({topLeft:[f.x,f.y],p:o,color:null}),t<=0)throw new Error("What?")}return Object.keys(d).forEach(function(n){var e=n.split(",").map(function(r){return parseInt(r)}),o=d[n];[2,8,1,4].forEach(function(r){var t=w[n];o[r]&&t[x[r]]&&C(e[0],e[1],r)})}),b(function(r,t){var n,e,o,e=(o=g(n=r,e=t),n*=2,e*=2,e=(Number(0<e&&0<l(n,e-1,3))<<2)+(Number(n<f-1&&0<l(1+n,e,3))<<1)+(Number(e<c-1&&0<l(n,1+e,3))<<3)+(Number(0<n&&0<l(n-1,e,3))<<0),o&e);return 0<e&&C(r,t,y(e)),1},!0),p.sort(function(r,t){return r.topLeft[1]===t.topLeft[1]?r.topLeft[0]-t.topLeft[0]:r.topLeft[1]-t.topLeft[1]}),p.forEach(function(r){for(var t,n,e=r.p,o=r.topLeft,a=0;a<e.length;a+=2)e[a]===o[0]&&e[a+1]===o[1]&&(t=e.slice(a),n=e.slice(0,a),r.p=t.concat(n))}),p.forEach(function(r){var t=r.topLeft[0],t=4*((2*r.topLeft[1]+1)*f+(2*t+1));r.color=new Uint8ClampedArray([u[t],u[1+t],u[2+t],r[3+t]])}),{paths:p,crosses:e}}(r,s,i);postMessage({type:"progress",value:.75});r=function(r,t){var n=t.reduce(function(r,t){return r[t[0]+","+t[1]]=!0,r},{});function m(r){return r[0]+","+r[1]+","+function(r,t,n,e){if(1==(r=n-r))return 2;if(-1==r)return 1;if(1==(t=e-t))return 8;if(-1==t)return 4;throw new Error("WTF?")}(r[0],r[1],r[2],r[3])}var e={},o={},M={};function y(r){for(var t,n,e=[],o=r.length-2;0<=o;o-=2)t=r[o],n=r[o+1],e.push(t,n);return e}function b(r,t){return n[r+","+t]}function d(r){e[m(r)]=r}function w(r){o[m(r)]=r}r=r.map(function(r){for(var t,n,e,o,a=r.p,u=r.color,s=[],i=b(a[0],a[1])?[a[0],a[1]]:null,h=[],f=!1,c=2;c<=a.length;c+=2){var p,l,g=(f=c===a.length)?a[0]:a[c],v=f?a[1]:a[c+1];(i||h).push(g,v),(b(g,v)||f)&&(i&&(f&&(i=i.concat(h)),p=y(i),l=m(i),s.push(l),o=e=n=void 0,n=(t=i)[0],e=t[1],o=t[t.length-2],t=t[t.length-1],e<t||e===t&&n<o?(d(i),w(p)):(d(p),w(i))),b(g,v)&&(i=[g,v]))}return i||(l=m(r=[a[0],a[1]].concat(h)),s.push(l),M[m(r=r)]=r),{color:u,segNames:s}});function a(r){return r=function(r){function i(r,t,n,e){return Math.sqrt(Math.pow(n-r,2)+Math.pow(e-t,2))}function t(r,t,n){return(1-r)*t+r*n}function n(r,t,n,e){var o=1-r;return o*o*t+2*o*r*n+r*r*e}function e(r,t,n,e,o,a,u,s){return(i(r,t,n,e)+i(n,e,o,a)+i(o,a,u,s)+i(r,t,u,s))/2}for(var o,a,u,s,h,f,c,p,l,g,v,m,M,y,b,d,w,x,C,E,A,U,L,N,k,j=Math.PI/2,O=[r[0],r[1]],W=[],T=0;T<r.length-3;T+=2){o=r[T],a=r[T+1],c=0,W.splice(0),W.push(0);r:for(var I=T+2;I<r.length-1;I+=2){h=r[I+0],f=r[I+1],w=u,x=s,c+=i(r[I-2],r[I-1],h,f),W.push(c),g=c/2;for(var R=0;R<W.length-1;R++)if(g>=W[R]&&g<=W[R+1]){p=t(v=(g-W[R])/(W[R+1]-W[R]),r[(m=I+2*(1-W.length+R))+0],r[m+2]),l=t(v,r[m+1],r[m+3]);break}M=t((b=i(o,a,p,l))/(b+(d=i(h,f,p,l))),o,h),y=t(b/(b+d),a,f),u=t(2,M,p),s=t(2,y,l);for(R=T+2;R<=I-2;R+=2){var F=(R-T)/(I-T),H=i(r[R-2],r[R-1],r[R+0],r[R+1]),q=i(r[R+0],r[R+1],r[R+2],r[R+3]),P=Math.PI-(C=r[R-2],E=r[R-1],A=r[R+0],U=r[R+1],L=r[R+0],N=r[R+1],k=r[R+2],P=r[R+3],N=i(A,U,L=C+k-L,P=E+P-N),U=i(C,E,A,U),P=i(C,E,L,P),Math.acos((Math.pow(U,2)+Math.pow(P,2)-Math.pow(N,2))/2/U/P));if(2<i(n(F,o,u,h),n(F,a,s,f),r[R+0],r[R+1])||2<=H&&2<=q&&P<=j){u=w,s=x,h=r[I-2],f=r[I-1],T=I-4;break r}}}O.push(u,s,h,f)}Math.PI;for(var S,Z,B,G,K,V,X,_=[O[0],O[1]],T=0;T<=O.length-6;T+=4)o=O[T+0],a=O[T+1],u=O[T+2],s=O[T+3],h=O[T+4],f=O[T+5],_.push(t(2/3,o,u),t(2/3,a,s),t(1/3,u,h),t(1/3,s,f),h,f);for(var z,D,J,Q,Y,$,rr,tr,nr=[_[0],_[1],_[2],_[3]],T=0;T<=_.length-14;T+=6)o=_[T+0],a=_[T+1],u=_[T+2],s=_[T+3],h=_[T+4],f=_[T+5],S=_[T+6],Z=_[T+7],B=_[T+8],G=_[T+9],z=_[T+10],D=_[T+11],J=_[T+12],tr=_[T+13],Q=t(((b=i(h,f,S,Z))+(d=i(S,Z,B,G)))/d,B,S),Y=t((b+d)/d,G,Z),$=t((b+d)/b,h,S),rr=t((b+d)/b,f,Z),K=t(b/(b+d),Q,h),V=t(b/(b+d),Y,f),X=t(d/(b+d),$,B),Q=t(d/(b+d),rr,G),Y=e(o,a,u,s,h,f,S,Z),$=e(S,Z,B,G,z,D,J,tr),rr=e(o,a,u,s,K,V,S,Z),tr=e(S,Z,X,Q,z,D,J,tr),Math.abs(Y+$-rr-tr)/Math.max(Y+$,rr+tr)<=.01?nr.push(K,V,S,Z,X,Q):nr.push(h,f,S,Z,B,G);return nr.push(_[_.length-4],_[_.length-3],_[_.length-2],_[_.length-1]),nr}(r=function(r){var t,n=(t=r)[0]===t[t.length-2]&&t[1]===t[t.length-1];if(n&&r.length<=14)return r.slice();for(var e,o,a,u,s,i,h=[],f=(r[0],r[1],null),c=2;c<r.length;c+=2)e=r[c-2],o=r[c-1],a=r[c],u=r[c+1],i=u-o,i=1===(s=a-e)&&0===i?0:0===s&&1===i?90:-1===s&&0===i?180:0===s&&-1===i?270:void 0,null!==f&&f.angle===i||(f={length:0,angle:i,x0:e,y0:o,x:0,y:0},h.push(f)),f.x=a,f.y=u,f.length++;for(var p,l,g,v,m,M,y,b,d=[],c=0;c<h.length-(n?0:2);c++)m=h[c],p=h[c===h.length-1?0:c+1],M=h[c===h.length-2?0:c===h.length-1?1:c+2],l=2<m.length,g=2<p.length,v=2<M.length,!g&&l&&v&&(m=m.angle,M=M.angle,Math.max(m,M)-Math.min(m,M)==180)?d.push(p.x0,p.y0,p.x,p.y):g?(l&&d.push(p.x0,p.y0),d.push((p.x0+p.x)/2,(p.y0+p.y)/2),v&&d.push(p.x,p.y)):d.push((p.x0+p.x)/2,(p.y0+p.y)/2);for(n||(d.unshift(r[0],r[1]),2===h.length&&d.push(h[0].x,h[0].y),d.push(r[r.length-2],r[r.length-1])),!n||d[0]===d[d.length-2]&&d[1]===d[d.length-1]||d.push(d[0],d[1]);4<d.length&&d[0]===d[2]&&d[1]===d[3];)d.splice(2,2);for(;4<d.length&&d[d.length-1]===d[d.length-3]&&d[d.length-2]===d[d.length-4];)d.splice(d.length-4,2);for(var w,x,c=2;c<d.length-2;c+=2)e=d[c+0],o=d[c+1],y=d[c+2],b=d[c+3],e===y&&o===b&&(d.splice(c,2),c-=2);for(c=2;c<d.length-3;c+=2)e=d[c-2],o=d[c-1],y=d[c],b=d[c+1],w=d[c+2],x=d[c+3],Math.atan2(b-o,y-e)===Math.atan2(x-b,w-y)&&(d.splice(c,2),c-=2);return d}(r))}var u={};return Object.keys(e).forEach(function(r){var t=r.split(",").map(function(r){return parseFloat(r)}),n=(t[0],t[1],t[2],e[r]),t=a(n),t=y(u[r]=t),n=m([n[n.length-2],n[n.length-1],n[n.length-4],n[n.length-3]]);u[n]=t}),Object.keys(M).forEach(function(r){var t=a(M[r]);u[r]=t}),r.map(function(r){var t=r.color,a=r.segNames,r=a.map(function(r,t){var n=u[r],e="";0===t&&(e+="M"+n[0]+","+n[1]);for(var o=2;o<n.length;o+=6)e+=" C"+n[o]+","+n[o+1]+" "+n[o+2]+","+n[o+3]+" "+n[o+4]+","+n[o+5];return t===a.length-1&&(e+=" Z"),e}).join(""),n=[];return a.forEach(function(r,t){r=u[r];0===t?n.push.apply(n,r):n.push.apply(n,r.slice(2))}),{color:t,d:r,cubic:n}})}(r.paths,r.crosses);postMessage({type:"progress",value:7/8});var a,u,h,f,c,p,r=(a=r,u=s,h=i,(p=['<svg width="'+(f=e)+'" height="'+(c=o)+'">']).push("  <g>"),p.push.apply(p,a.map(function(r){for(var t=r.color,n=r.cubic,e=n,o="M"+l(e[0])+","+g(e[1]),a=2;a<n.length;a+=6)o+=" C"+l(e[a+0])+","+g(e[a+1])+" "+l(e[a+2])+","+g(e[a+3])+" "+l(e[a+4])+","+g(e[a+5]);return o+=" Z",'    <path fill="rgba('+t[0]+","+t[1]+","+t[2]+","+ +t[3]/255+'" d="'+o+'" />'})),p.push("  </g>"),p.push("</svg>"),p.join("\n"));function l(r){return r/u*f}function g(r){return r/h*c}return postMessage({type:"progress",value:1}),r}onmessage=function(r){r=r.data;if("start"===r.type){var r=r.value,t=r.img,n=r.width,e=r.height,o=r.srcWidth,a=r.srcHeight,u=r.maxColors;try{var s=trace(t,n,e,{maxColors:u,srcWidth:o,srcHeight:a});postMessage({type:"result",value:s})}catch(r){postMessage({type:"error",value:r.message})}}};