function t(t,e,i,r){Object.defineProperty(t,e,{get:i,set:r,enumerable:!0,configurable:!0})}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},r={},a=e.parcelRequire60cc;null==a&&((a=function(t){if(t in i)return i[t].exports;if(t in r){var e=r[t];delete r[t];var a={id:t,exports:{}};return i[t]=a,e.call(a.exports,a,a.exports),a.exports}var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(t,e){r[t]=e},e.parcelRequire60cc=a),a.register("830oE",(function(e,i){t(e.exports,"ERROR_TYPES",(()=>m)),t(e.exports,"FRAME_PERMS",(()=>w)),t(e.exports,"FRAME_PERMS_CONTAINS",(()=>x)),t(e.exports,"filesToRecord",(()=>E)),t(e.exports,"captureToFiles",(()=>b));var r=a("bOEoo"),s=a("hoPfQ"),n=a("1BBN9"),o=a("i1z1y"),l=a("3A0PR"),c=a("k69IS"),h=a("8ABn4"),d=a("8P88O"),u=a("mG6c6"),f=a("2xkva"),g=a("d6GBf"),p=a("alm1K");const m={UNKNOWN_MESSAGE:"UnknownMessage",TIMED_OUT:"TimedOut",CHROME_TABS:l.ERROR_NAME,CHROME_SCRIPTING:o.ERROR_NAME,MISSING_BLOB:"MissingBlob",CONTENT_SCRIPT:"ContentScript"},w={permissions:["webNavigation"],origins:["<all_urls>"]},x={permissions:["webNavigation"],origins:["https://*/*","http://*/*"]},E=(t,e,i,r,a,s)=>h.Capture.from(t,e,i,r,a,s).save(),b=(t,e,i,r,a)=>M(t,i,r,a).then((({blobs:t,scaleMultiplier:i,metadata:r})=>Promise.all(t.map(((t,i)=>function(t,e,i){if(!t){let t=new Error(`_saveBlobToFs got no blob: ${e}, ${i}`);return t.name=m.MISSING_BLOB,Promise.reject(t)}e=function(t,e){if(!e)return t;let i=t.split("."),r=i.pop();return i.join(".")+"-"+(e+1)+"."+r}(e,i);let r=t.size+2048;return u.default.requestFs(r).then((t=>u.default.getFile(t,e,{create:!0}))).then((e=>u.default.writeFile(e,t))).then((()=>({filename:e,size:t.size})))}(t,e,i)))).then((t=>({files:t,scaleMultiplier:i,metadata:r}))))),M=(t,e,i,r)=>_(t,e,i,r).then((e=>(r.add_url&&e.canvasObjs.forEach((({ctx:i,width:r,height:a})=>{let s=e.scaleMultiplier;i.scale(s,s),i.fillStyle="#00000055",i.fillRect(0,0,r/s,40),i.fillStyle="#fff",i.font="20px Arial",i.textBaseline="middle",i.fillText(t.url,20,20)})),e.toBlobs().then((t=>({blobs:t,scaleMultiplier:e.scaleMultiplier,metadata:e.metadata})))))),_=async(t,e,i,a)=>{let s;return e=e||function(){},""===t.url||"about:blank"===t.url||t.url.startsWith("about:blank#")?s=Promise.resolve().then((()=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");return i.fillStyle="#fff",i.fillRect(0,0,e.width,e.height),e.toDataURL()})):"chrome://newtab/"===t.url||"chrome://apps/"===t.url||"edge://newtab/"===t.url||"edge://apps/"===t.url||t.url.startsWith("https://ntp.msn.com/edge/ntp")?s=l.captureVisibleTab(t.windowId,a.fmt_details.capture):t.url.startsWith("data:image/")&&(s=Promise.resolve(t.url)),s?y(s,e,a.fmt_details.canvas):new Promise(((s,h)=>{const u=[new(0,g.default)(a.fmt_details.canvas)];let E,b,M=[];chrome.runtime.onMessage.addListener(((s,_,y)=>{try{if(void 0===E&&void 0!==s.windowWidth&&(E=s.windowWidth),void 0!==s.complete&&void 0!==s.canvasId&&u.length>1){let t=u.length,e=(t-s.canvasId-1)/t+s.complete/t;s.complete=e}switch(s.msg){case r.MSG_CAPTURE:{var v;e(s.complete);let r=s.canvasId;if(!S(r)){let t=new Error(`Bad canvasId in capture request: ${r}`);return t.name="CaptureRequestError",h(t)}let a=M[r];if(a&&(s.clip.x+=a.left,s.clip.y+=a.top),0===r){const t={ww:s.windowWidth,wh:s.windowHeight,dpr:s.devicePixelRatio};u[r].updateMetadata(t)}return(null===(v=s.links)||void 0===v?void 0:v.length)&&u[r].appendMetadataLinks(s.links),async function(t,e,i,r,a,s){if(s)return s.canvases.forEach((({canvas:t,left:e,top:i,width:a,height:s})=>{r.drawImage(t,e,i,a,s)})),e;let n="";for(;;)try{n=await l.captureVisibleTab(t,{format:"png"});break}catch(t){if(!l.isCaptureVisibleTabQuotaError(t))throw t;f.default.debug("Encountered capture quota error"),await(0,p.sleep)(50)}if(!n){let t=new Error("No dataURI generated for visible tab");throw t.name="APICaptureStepError",t}const{img:o,width:c,height:h}=await(0,p.loadImage)(n);e.image={width:c,height:h};const d=i===c?1:c/i;r.setScaleMultiplier(d),1!==d&&r.scaleAll(e,["x","y","totalWidth","totalHeight","capture.*","clip.*"]);r.isEmpty()&&(r.setObjs(e.totalWidth,e.totalHeight,e.canvasBg),r.size()>1&&a&&a(r.size()),e.bgRegions&&(e.bgRegions.forEach((t=>r.scaleAll(t,["sample.*","fill.*"]))),r.setBgRegions(e.bgRegions)));const u=e.x+e.capture.x,g=e.y+e.capture.y,m=e.clip.width,w=e.clip.height,x=u-e.clip.x,E=g-e.clip.y,b=e.image.width,M=e.image.height;0===m||0===w?f.default.warn("Zero area mask!",JSON.stringify(e)):0===b||0===M?f.default.warn("Zero area for image!",JSON.stringify(e)):r.drawImage(o,x,E,b,M,e,{x:u,y:g,width:m,height:w});return e}(t.windowId,s,E,u[r],i,s.isFrame?b:void 0).then((t=>{y(t||!0)})).catch(h),!0}case r.MSG_CAPTURE_ERROR:return h({name:m.CONTENT_SCRIPT,message:s.name+": "+s.message,stack:s.stack}),!1;case r.MSG_CAPTURE_FRAME:{let i=u.length;u.push(new(0,g.default)(a.fmt_details.canvas));let l=["top","left","width","height","windowWidth"].filter((t=>!S(s[t])));if(l.length){let t=new Error(`Bad props on ${r.MSG_CAPTURE_FRAME} request: ${l.join(", ")}`);return t.name="CaptureFrameRequestError",h(t)}return M[i]=s,function(t,e,i,r,a,s,l,h,u){let g=r.id;return Promise.resolve().then((()=>n.contains(x))).then((t=>!!t||(d.trigger("needFramePermsClick",{tagName:u}),d.oncePromise("clicked").then((t=>"ok"===t.action&&n.request(w)))))).then((d=>d?c.getAllFrames({tabId:g}).then((r=>{if((r=r.filter((t=>0===t.parentFrameId))).length<=1)return r[0];let a=r.filter((e=>e.url===t));if(a.length>=1){if(1!==a.length){let e=`multiple frames found with url: ${t}`;f.default.warn(e)}return a[0]}return function(t,e,i,r){let a=i*r;function s(t,e){return Math.abs(a+t*e-Math.min(i,t)*Math.min(r,e)*2)}const n={};return e.forEach((t=>{n[String(t.frameId)]=t})),o.executeScript({target:{tabId:t,allFrames:!0},func:()=>[window.innerWidth,window.innerHeight]}).then((t=>{let e,i;return t.map((({frameId:t,result:e})=>{const i=n[String(t)];return i?{detail:i,result:e,diff:s(e[0],e[1])}:null})).filter(Boolean).forEach((({detail:t,diff:r})=>{(null==e||r<e)&&(e=r,i=t)})),i}))}(g,r,e,i)})).then((t=>t?R(r,t.frameId,a,s,l,h).catch((t=>{if(o.isExecuteScriptChromeError(t))return null;throw t})):null)).then((t=>s.frame_persist?t:n.remove(w).then((()=>t)))):null))}(s.url,s.width,s.height,t,e,a,i,u[i],s.tagName).then((t=>{if(!t||0===t.canvases.length)return y({skip:!0});const e=t.scaleMultiplier,r=t.pageWidth,a=t.pageHeight,s=M[i],n=[["left","left"],["right","left"],["top","top"],["bottom","top"]];t.canvases.forEach((t=>{n.forEach((([i,r])=>{if(t[i]+=s[r]*e,isNaN(t[i])){const t=new Error(`attr isNaN: ${i}`);throw t.name="CanvasObjAttrError",t}}))}));const o=u[i];(o.metadata.links||[]).forEach((t=>{t.bounds.forEach((t=>{t.x+=s.left,t.y+=s.top}))})),u[i-1].appendMetadataLinks(o.metadata.links),b=t,y({width:r,height:a})})).catch(h),!0}case r.MSG_CAPTURE_COMPLETE:return null==s.canvasId&&alert(`Bad request, missing canvasId: ${JSON.stringify(s)}`),O.emit(s),y(),!1;default:{let t="Unknown message received from content script: "+s.msg;return f.default.error(t),h({name:m.UNKNOWN_MESSAGE,message:t}),!1}}}catch(t){f.default.error(t),h(t)}})),R(t,null,e,a,0,u[0],!0).then((()=>{const t=u[0];t.sortLinks(),s(t)})).catch((t=>h(t)))}))},y=async(t,e,i,r)=>{e(0);const a=await t;e(.5);const{img:s,width:n,height:o}=await(0,p.loadImage)(a);return e(1),(r=r||new(0,g.default)(i)).setObjs(n,o),r.drawImage(s,0,0,n,o),r},R=async(t,e,i,a,n,c,h)=>new Promise(((u,g)=>{(async function(){await async function(t){if(s.isFileUrl(t)){if(!await s.isAllowedFileSchemeAccess())return d.trigger("needFilePermsClick"),new Promise((()=>{}))}}(t.url);let g=!1;try{const i=await(0,p.timeoutWrap)(l.sendMessage(t.id,{msg:r.MSG_CHECK_EXISTS},{frameId:e}),50,"tabs.sendSendMessage.checkExists");f.default.debug("Message.checkExists",i),i&&i.startTime&&"js/page/index.js"===i.script&&(g=!0)}catch(t){f.default.debug("Message.checkExists.error",t)}if(!g)try{await(0,p.timeoutWrap)(function(t,e,i){t.url;if(function(t){let e=chrome.runtime.getURL("");return t.url.substring(0,e.length)===e}(t)){let e,r=chrome.runtime.getURL(i);try{e=chrome.extension.getViews({type:"tab",tabId:t.id})}catch(t){e=chrome.extension.getViews({type:"tab"})}let a=e.filter((e=>e.location.href===t.url));return a.length||f.default.error("No matching window found for: "+t.url),Promise.all(a.map((t=>new Promise(((e,i)=>{let a=t.document.createElement("script");a.src=r,a.addEventListener("load",e,!1),t.document.body.appendChild(a)})))))}{const r={files:[i],target:{tabId:t.id}};return"number"==typeof e&&(r.target.frameIds=[e]),o.executeScript(r)}}(t,e,"js/page/index.js"),6e3,"api._executeScript")}catch(e){if(h&&(o.isExecuteScriptChromeError(e)||n>0)){const e=l.captureVisibleTab(t.windowId,a.fmt_details.capture);return await y(e,i,a.fmt_details.capture,c),void u(v(c))}throw e}i(0);const m={msg:r.MSG_SCROLL_PAGE,canvasId:n,opts:a};e=e||0,await l.sendMessage(t.id,m,{frameId:e});const w=t=>{if(t.canvasId===n){O.off(w),c.applyBgRegions();const t=v(c);u(t)}};O.on(w)})().catch(g)})),v=t=>{const e=t.canvasObjs,i=t.scaleMultiplier||1;return{canvases:e,pageWidth:t.totalWidth/i,pageHeight:t.totalHeight/i,scaleMultiplier:i}};const S=t=>"number"==typeof t,O=function(){const t="CaptureCompleteListener";return{on:e=>d.on(t,e),off:e=>d.off(t,e),emit:e=>d.trigger(t,e)}}()})),a.register("bOEoo",(function(e,i){t(e.exports,"MSG_CAPTURE",(()=>r)),t(e.exports,"MSG_CAPTURE_COMPLETE",(()=>a)),t(e.exports,"MSG_CAPTURE_ERROR",(()=>s)),t(e.exports,"MSG_CAPTURE_FRAME",(()=>n)),t(e.exports,"MSG_CHECK_EXISTS",(()=>o)),t(e.exports,"MSG_SCROLL_PAGE",(()=>l));const r="capture",a="captureComplete",s="captureError",n="captureFrame",o="checkExists",l="scrollPage"})),a.register("i1z1y",(function(e,i){t(e.exports,"ERROR_NAME",(()=>s)),t(e.exports,"executeScript",(()=>o)),t(e.exports,"isExecuteScriptChromeError",(()=>l));var r=a("5dZ7N");const s="ChromeScriptingError",n=(0,r.genWrapError)(s),o=t=>n(chrome.scripting.executeScript(t),"executeScript"),l=t=>(0,r.isLastError)(t)&&t.name===s&&"executeScript"===t.via&&(-1!==t.message.indexOf("Extension manifest must request permission")||-1!==t.message.indexOf("Frame with ID")&&-1!==t.message.indexOf("is showing error page")||-1!==t.message.indexOf('"chrome-error://'))})),a.register("k69IS",(function(e,i){t(e.exports,"getAllFrames",(()=>s));const r=(0,a("5dZ7N").genWrapError)("ChromeWebNavigationError"),s=t=>r(chrome.webNavigation.getAllFrames(t),"getAllFrames")})),a.register("d6GBf",(function(e,i){t(e.exports,"default",(()=>l));var r=a("gstfn"),s=a("2xkva");const n=28800,o=9e3;class l{size(){return this.canvasObjs.length}isEmpty(){return 0===this.canvasObjs.length}updateMetadata(t){this.metadata={...this.metadata,...t}}appendMetadataLinks(t){if(t){const e=[...this.metadata.links||[],...t];this.metadata={...this.metadata,links:e}}}sortLinks(){this.metadata.links&&this.metadata.links.sort(((t,e)=>t.bounds[0].y===e.bounds[0].y?t.bounds[0].x-e.bounds[0].x:t.bounds[0].y-e.bounds[0].y))}setScaleMultiplier(t){this.scaleMultiplier=t}setObjs(t,e,i){this.totalWidth=t,this.totalHeight=e;let r,a,s,l,c,h=e>n||t>n||e*t>2592e5,d=t>e,u=h?d?n:o:t,f=h?d?o:n:e,g=Math.ceil(t/u),p=Math.ceil(e/f),m=0,w=[];for(r=0;r<p;r++)for(a=0;a<g;a++){s=document.createElement("canvas"),s.width=a==g-1&&t%u||u,s.height=r==p-1&&e%f||f;let n=s.getContext("2d");i&&(n.fillStyle=i,n.fillRect(0,0,s.width,s.height)),l=a*u,c=r*f,w.push({canvas:s,ctx:n,index:m,left:l,right:l+s.width,top:c,bottom:c+s.height,width:s.width,height:s.height}),m++}this.canvasObjs=w}toDataURLs(){return this.canvasObjs.map((t=>t.canvas.toDataURL(this.exportFormat)))}toBlobs(){return Promise.all(this.canvasObjs.map((t=>(0,r.canvasToBlob)(t.canvas,this.exportFormat))))}fillRect(t,e,i,r,a){this._filter(e,i,r,a).forEach((s=>{let n=this._shift(s,e,i);s.ctx.fillStyle=t,s.ctx.fillRect(n.x,n.y,r,a)}))}strokeRect(t,e,i,r,a){this._filter(e,i,r,a).forEach((s=>{let n=this._shift(s,e,i);s.ctx.strokeStyle=t,s.ctx.strokeRect(n.x,n.y,r,a)}))}drawImage(t,e,i,r,a,s,n){this._debugCounter++,this._filter(e,i,r,a).forEach((o=>{const l=this._shift(o,e,i),c=n?{...n,...this._shift(o,n.x,n.y)}:void 0,h=o.ctx;if(h.save(),c){const t=new Path2D,{x:e,y:i,width:r,height:a}=c,s=Math.floor(c.x),n=Math.floor(c.y);let o=Math.ceil(c.width),l=Math.ceil(c.height);s+o<e+r&&(o+=1),n+l<i+a&&(l+=1),t.rect(s,n,o,l),h.clip(t)}if(h.drawImage(t,l.x,l.y),h.restore(),s&&"object"==typeof s&&!0===s.debug){const t=n||{x:l.x,y:l.y,width:r,height:a};let e=Math.max(0,t.x),i=Math.max(0,t.y),o=t.x<0?t.width+t.x:t.width,c=t.y<0?t.height+t.y:t.height;h.save(),h.strokeStyle="#0F0",h.lineWidth=3,h.strokeRect(e,i,o,c);const d=15;h.font=`${d}px Arial`,h.textAlign="left",h.textBaseline="top";const u=`#${this._debugCounter}: ${this._str(s)}`,f=5,g=h.measureText(u).width;h.fillStyle="rgba(0, 0, 0, .4)",h.fillRect(e,i,g+2*f,d+2*f),h.fillStyle="#FFF",h.fillText(u,e+f,i+f)}}))}_str(t){try{if("capture"===t.msg)return JSON.stringify({x:t.x,y:t.y,clip:t.clip,capture:t.capture})}catch(t){}try{return JSON.stringify(t)}catch(e){return`${t}`}}_filter(t,e,i,r){let a=t+i,s=e+r;return this.canvasObjs.filter((i=>t<i.right&&a>i.left&&e<i.bottom&&s>i.top))}_shift(t,e,i){return{x:Math.round(e-t.left),y:Math.round(i-t.top)}}_constrain(t,e,i,r,a){const s=this._shift(t,e,i),n=s.x,o=n+r,l=s.y,c=l+a,h=Math.max(0,n),d=Math.max(0,l);return{x:h,y:d,width:Math.min(t.height,o-h),height:Math.min(t.height,c-d)}}scale(t){return(t||0)*this.scaleMultiplier}scaleAll(t,e){e.forEach((e=>{if("*"===e)Object.keys(t).forEach((e=>t[e]=this.scale(t[e])));else{let i=e.indexOf(".");-1===i?t[e]=this.scale(t[e]):this.scaleAll(t[e.substring(0,i)],[e.substring(i+1)])}}))}setBgRegions(t){this.bgRegions=t}applyBgRegions(){this.bgRegions.forEach((({sample:t,fill:e},i)=>{const r=new Map;this._filter(t.x,t.y,t.width,t.height).forEach((e=>{let i=this._constrain(e,t.x,t.y,t.width,t.height);if(i.width>0&&i.height>0){let t=document.createElement("canvas");t.width=i.width,t.height=i.height;let a,n=t.getContext("2d");n.drawImage(e.canvas,-i.x,-i.y);try{a=n.getImageData(0,0,i.width,i.height)}catch(t){s.default.error(t)}a&&this._getHisto(a.data,r)}}));let a=0,n=0;if(r.forEach(((t,e)=>{t>a&&(a=t,n=e)})),0!==n){const t=`rgb(${this._toRgb(n).join(", ")})`;this.fillRect(t,e.x,e.y,e.width,e.height)}}))}_getHisto(t,e){e=e||new Map;for(let i=0,r=t.length;i<r;i+=4)if(255===t[i+3]){const r=this._toInt(t[i],t[i+1],t[i+2]);e.set(r,(e.get(r)||0)+1)}return e}_toInt(t,e,i){return(t<<16)+(e<<8)+i}_toRgb(t){const e=255&t,i=255&(t>>=8);return[255&(t>>=8),i,e]}constructor(t){this.exportFormat=t,this.canvasObjs=[],this.bgRegions=[],this.scaleMultiplier=1,this.totalWidth=0,this.totalHeight=0,this.metadata={},this._debugCounter=0,this.scaleMultiplier=1,this.totalWidth=0,this.totalHeight=0,this.metadata={},this._debugCounter=0}}}));
//# sourceMappingURL=popup.7dc20801.js.map
