(()=>{function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},a={},o=n.parcelRequire60cc;null==o&&((o=function(e){if(e in r)return r[e].exports;if(e in a){var t=a[e];delete a[e];var n={id:e,exports:{}};return r[e]=n,t.call(n.exports,n,n.exports),n.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){a[e]=t},n.parcelRequire60cc=o),o.register("gwJFa",(function(e,t){
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){"use strict";var t={}.hasOwnProperty;function n(){for(var e=[],r=0;r<arguments.length;r++){var a=arguments[r];if(a){var o=typeof a;if("string"===o||"number"===o)e.push(a);else if(Array.isArray(a)&&a.length){var i=n.apply(null,a);i&&e.push(i)}else if("object"===o)for(var s in a)t.call(a,s)&&a[s]&&e.push(s)}}return e.join(" ")}e.exports?(n.default=n,e.exports=n):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],(function(){return n})):window.classNames=n}()})),o.register("jQEAy",(function(t,n){e(t.exports,"ERROR_NAME",(()=>s)),e(t.exports,"getZoom",(()=>u)),e(t.exports,"captureVisibleTab",(()=>d)),e(t.exports,"isCaptureVisibleTabQuotaError",(()=>m)),e(t.exports,"sendMessage",(()=>p)),e(t.exports,"getCurrentTab",(()=>h)),e(t.exports,"openInTabs",(()=>f));var r=o("8rN6d"),a=o("8bPtr"),i=o("3k2hL");const s="ChromeTabsError",l=(0,i.genLastErrorFmt)(s),c=(0,i.genWrapError)(s),u=e=>c(chrome.tabs.getZoom(e),"getZoom"),d=(e,t)=>c(chrome.tabs.captureVisibleTab(e,t),"captureVisibleTab"),m=e=>e&&"object"==typeof e&&e.name===s&&"captureVisibleTab"===e.via&&e.message&&-1!==e.message.indexOf("MAX_CAPTURE_VISIBLE_TAB_CALLS_PER_SECOND"),p=(e,t,n)=>new Promise(((r,a)=>{chrome.tabs.sendMessage(e,t,n,(e=>{const t=(0,i.getLastError)();return t?a(l(t,"sendMessage")):r(e)}))})),h=()=>{return(e={active:!0,currentWindow:!0},c(chrome.tabs.query(e),"query")).then((e=>e[0]));var e},f=(g=(0,r.default)((function(e,t){var n,r,o;return(0,a.__generator)(this,(function(a){return n=void 0,r=t.length,[2,(o=a=>{if(a>=t.length)return t;let i=t[a],s=a===r-1;return e.incognito&&0===a?(l={url:i,incognito:!1,focused:s},c(chrome.windows.create(l),"windowsCreate")).then((e=>(n=e.id,o(a+1)))):(e=>c(chrome.tabs.create(e),"create"))({url:i,active:s,windowId:n,openerTabId:e.id,index:(e.incognito?0:e.index)+1+a}).then((e=>o(a+1)));var l})(0)]}))})),function(e,t){return g.apply(this,arguments)});var g}));var i=o("7b0kr"),s=o("iiDPj"),l=o("nKr4g"),c=o("kOtTY");const u=()=>{const e=(0,c.getQueryString)(),t=e.id||e.oid,n=e.e,r=e.url;return{options:h(t,n,r),history:f(t,n,r),capture:t?m(t,r):void 0,editor:t&&n?p(t,n,r):void 0}},d=(e,t,n)=>{let r=void 0!==n&&n;if(e){-1===e.href.indexOf("?")&&(e.href=t,r&&e.setAttribute("style",""))}},m=(e,t)=>{let n=void 0===t?null:t;const r={id:e};n&&(r.url=n);return"/capture.html"+("?"+(0,c.toQueryString)(r))},p=(e,t,n)=>{let r=void 0===n?null:n;const a={id:e,e:t};r&&(a.url=r);return"/editor.html"+("?"+(0,c.toQueryString)(a))},h=(e,t,n)=>{let r=void 0===e?null:e,a=void 0===t?null:t,o=void 0===n?null:n,i="";if(r){const e={id:r};a&&(e.e=a),o&&(e.url=o),i="?"+(0,c.toQueryString)(e)}return"/options.html"+i},f=(e,t,n)=>{let r=void 0===e?null:e,a=void 0===t?null:t,o=void 0===n?null:n,i="";if(r){const e={oid:r};a&&(e.e=a),o&&(e.url=o),i="?"+(0,c.toQueryString)(e)}return"/capture.html"+i};var g=o("jBCXK"),v=o("hGGFE"),b=o("ff4Ef"),y=o("gwJFa"),E=(i=o("7b0kr"),o("dChev")),w=o("fiP9V"),x=o("crHLg"),k=o("8DwkQ"),C=(o("nKr4g"),o("5Xemj"));var _=o("ceb36"),S=o("h1Khz"),N=o("8ioZ3");let R=null;const L=e=>{let t=void 0!==e&&e;if(null===R){const e=document.createElement("a");e.style.cssText="position: sticky;",R=-1!==e.style.position.indexOf("sticky")}return R&&t&&document.documentElement.classList.add("csspositionsticky"),R};var T=o("2brSn"),F=o("1I2HB"),O=o("8rN6d"),z=o("8bPtr"),M=(l=o("nKr4g"),o("2z2pA"));S=o("h1Khz"),c=o("kOtTY");const H=(e,t)=>{let n,r,a=[];return e.forEach((e=>{e[t]!==r&&(void 0!==n&&a.push(n),r=e[t],n={key:r,vals:[]}),n.vals.push(e)})),n&&n.vals.length&&a.push(n),a},A=e=>{window.clearTimeout(A.timeoutId),(0,c.asArray)(document.querySelectorAll(".notif")).forEach((e=>e.classList.add("hide"))),(0,l.$)(e).classList.remove("hide"),A.timeoutId=window.setTimeout((()=>(0,l.$)(e).classList.add("hide")),2e3)};A.timeoutId=null;const I=(j=(0,O.default)((function(e){var t,n,r;return(0,z.__generator)(this,(function(a){switch(a.label){case 0:return M.default.error("options error",e),[4,S.update(e)];case 1:return a.sent(),t=q("div",{className:"error",textContent:"An error was encountered!  "}),n=(0,c.reportLink)(window.location.href,(0,c.errorToString)(e)),r=q("a",{className:"underline",target:"_blank",rel:"noopener noreferrer",href:n,textContent:"Report issue"}),t.appendChild(r),P(),document.body.appendChild(t),window.scrollTo(0,0),[2]}}))})),function(e){return j.apply(this,arguments)});var j;const P=()=>{(0,c.asArray)(document.querySelectorAll("body > .error")).forEach((e=>{e.parentNode.removeChild(e)}))},q=(e,t)=>{let n=document.createElement(e);return t&&t.style&&(Object.assign(n.style,t.style),delete t.style),Object.assign(n,t),n},D=e=>{switch(e.type){case"checkbox":return e.checked;case"text":case"textarea":case"select-one":return e.value;default:throw new Error(`Unknown input type: ${e.type}`)}};g=o("jBCXK"),v=o("hGGFE"),b=o("ff4Ef"),y=o("gwJFa");var $=o("3pr9z");i=o("7b0kr");function U(){return U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},U.apply(this,arguments)}function K(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}i=o("7b0kr");o("3pr9z");var V=!!document.documentElement.currentStyle,G={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},Q=["letter-spacing","line-height","font-family","font-weight","font-size","font-style","tab-size","text-rendering","text-transform","width","text-indent","padding-top","padding-right","padding-bottom","padding-left","border-top-width","border-right-width","border-bottom-width","border-left-width","box-sizing"],X={},W=document.createElement("textarea"),Z=function(e){Object.keys(G).forEach((function(t){e.style.setProperty(t,G[t],"important")}))};function J(e,t,n,r,a){void 0===n&&(n=!1),void 0===r&&(r=null),void 0===a&&(a=null),null===W.parentNode&&document.body.appendChild(W);var o=function(e,t,n){void 0===n&&(n=!1);if(n&&X[t])return X[t];var r=window.getComputedStyle(e);if(null===r)return null;var a=Q.reduce((function(e,t){return e[t]=r.getPropertyValue(t),e}),{}),o=a["box-sizing"];if(""===o)return null;V&&"border-box"===o&&(a.width=parseFloat(a.width)+parseFloat(r["border-right-width"])+parseFloat(r["border-left-width"])+parseFloat(r["padding-right"])+parseFloat(r["padding-left"])+"px");var i=parseFloat(a["padding-bottom"])+parseFloat(a["padding-top"]),s=parseFloat(a["border-bottom-width"])+parseFloat(a["border-top-width"]),l={sizingStyle:a,paddingSize:i,borderSize:s,boxSizing:o};n&&(X[t]=l);return l}(e,t,n);if(null===o)return null;var i=o.paddingSize,s=o.borderSize,l=o.boxSizing,c=o.sizingStyle;Object.keys(c).forEach((function(e){W.style[e]=c[e]})),Z(W),W.value=e.value||e.placeholder||"x";var u=-1/0,d=1/0,m=W.scrollHeight;"border-box"===l?m+=s:"content-box"===l&&(m-=i),W.value="x";var p=W.scrollHeight-i,h=Math.floor(m/p);return null!==r&&(u=p*r,"border-box"===l&&(u=u+i+s),m=Math.max(u,m)),null!==a&&(d=p*a,"border-box"===l&&(d=d+i+s),m=Math.min(d,m)),{height:m,minHeight:u,maxHeight:d,rowCount:Math.floor(m/p),valueRowCount:h}}W.setAttribute("tab-index","-1"),W.setAttribute("aria-hidden","true"),Z(W);var Y=function(){},ee=0,te=function(e){var t,n;function r(t){var n;return(n=e.call(this,t)||this)._onRef=function(e){n._ref=e;var t=n.props.inputRef;"function"!=typeof t?t.current=e:t(e)},n._onChange=function(e){n._controlled||n._resizeComponent(),n.props.onChange(e,B(n))},n._resizeComponent=function(e){void 0===e&&(e=Y);var t=J(n._ref,n._uid,n.props.useCacheForDOMMeasurements,n.props.minRows,n.props.maxRows);if(null!==t){var r=t.height,a=t.minHeight,o=t.maxHeight,i=t.rowCount,s=t.valueRowCount;n.rowCount=i,n.valueRowCount=s,n.state.height===r&&n.state.minHeight===a&&n.state.maxHeight===o?e():n.setState({height:r,minHeight:a,maxHeight:o},e)}else e()},n.state={height:t.style&&t.style.height||0,minHeight:-1/0,maxHeight:1/0},n._uid=ee++,n._controlled=void 0!==t.value,n._resizeLock=!1,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=r.prototype;return a.render=function(){var e=this.props,t=(e.inputRef,e.maxRows,e.minRows,e.onHeightChange,e.useCacheForDOMMeasurements,K(e,["inputRef","maxRows","minRows","onHeightChange","useCacheForDOMMeasurements"]));return t.style=U({},t.style,{height:this.state.height}),Math.max(t.style.maxHeight||1/0,this.state.maxHeight)<this.state.height&&(t.style.overflow="hidden"),(0,i.createElement)("textarea",U({},t,{onChange:this._onChange,ref:this._onRef}))},a.componentDidMount=function(){var e=this;this._resizeComponent(),this._resizeListener=function(){e._resizeLock||(e._resizeLock=!0,e._resizeComponent((function(){e._resizeLock=!1})))},window.addEventListener("resize",this._resizeListener)},a.componentDidUpdate=function(e,t){e!==this.props&&this._resizeComponent(),this.state.height!==t.height&&this.props.onHeightChange(this.state.height,this)},a.componentWillUnmount=function(){var e;window.removeEventListener("resize",this._resizeListener),e=this._uid,delete X[e]},r}(i.Component);te.defaultProps={inputRef:Y,onChange:Y,onHeightChange:Y,useCacheForDOMMeasurements:!1};var ne=te,re=(g=o("jBCXK"),i=o("7b0kr"),o("5Gpcw"));const ae=e=>{let n=e.text,r=e.cta1,a=e.cta1LinkFn,o=e.cta2,s=e.cta2LinkFn,l=e.isShow,c=e.setShow,u=e.setHide,d=e.userId;const m="premium-cta",p=l?{onClick:u}:{onMouseEnter:c,onClick:c,onFocus:c};return(0,i.useEffect)((()=>{let e,t;return l&&(e=e=>{!!e.target.closest(`.${m}`)||u()},t=e=>{27===e.keyCode&&u()},document.documentElement.addEventListener("click",e,!1),document.documentElement.addEventListener("keyup",t,!1)),()=>{e&&document.documentElement.removeEventListener("click",e,!1),t&&document.documentElement.removeEventListener("keyup",t,!1)}}),[l,u]),t(i).createElement("span",{className:m},t(i).createElement("span",(0,g.default)({tabIndex:"0",className:"premium-cta--icon"},p),"?"),l&&t(i).createElement("span",{className:"premium-cta--tooltip"},n,!1,r&&a&&t(i).createElement(t(i).Fragment,null,t(i).createElement("br",null),t(i).createElement("a",{href:a()},r),!d&&o&&s&&t(i).createElement(t(i).Fragment,null," or ",t(i).createElement("a",{href:s()},o)))))};ae.displayName="PremiumCta";var oe=ae;const ie=e=>{let n=e.field,r=e.value,a=e.onChange,o=e.isSubOk,s=e.userId;const l=n.premiumInfo,c=!o&&!!l;c&&(r=l.basicDefault);const u=(0,b.default)((0,i.useState)(!1),2),d=u[0],m=u[1],p=()=>m(!0),h=e=>{const t=e.currentTarget,n=t.name;if(c)p();else{const e=D(t);a(n,e)}};let f;switch(n.type){case"bool":f=t(i).createElement("div",{className:"options-ctrl"},t(i).createElement("label",null,t(i).createElement("input",{className:"options-input",type:"checkbox",name:n.name,checked:r,onChange:h}),t(i).createElement("span",{className:"label-text"},n.label)));break;case"text":f=t(i).createElement("div",{className:"options-ctrl flex-wrapper"},t(i).createElement("label",null,n.label),"textarea"===n.width?t(i).createElement(ne,{className:"options-input",name:n.name,style:{resize:"none"},value:r,onChange:h}):t(i).createElement("input",{className:"options-input",type:"text",name:n.name,value:r,onChange:h,disabled:n.disabled}));break;case"choice":f=t(i).createElement("div",{className:"options-ctrl flex-wrapper"},t(i).createElement("label",null,n.label),t(i).createElement("select",{className:"options-input",name:n.name,value:r,onChange:h},n.convertedChoices.map((e=>t(i).createElement("option",{key:e.key,value:e.key},e.display||e.key)))));break;default:throw new Error(`unsupported type! ${n.type}`)}const E=t(i).createElement("span",{className:"help"},n.help&&"function"==typeof n.help?n.help(r):n.help||"",c&&t(i).createElement(t(i).Fragment,null," ",t(i).createElement(oe,(0,v.default)((0,g.default)({},l),{isShow:d,setShow:p,setHide:()=>m(!1),userId:s}))),t(i).createElement("span",{className:"msg"}));return t(i).createElement("div",{className:t(y)("options-elt",`type-${n.type}`)},f,E)};ie.displayName="OptionField",ie.propTypes={field:t($).shape({name:t($).string.isRequired,type:t($).oneOf(["choice","bool","text"]),group:t($).string.isRequired,default:t($).any,label:t($).string.isRequired,help:t($).string,validate:t($).func,hidden:t($).bool,premiumInfo:t($).shape({text:t($).string.isRequired,cta1:t($).string,cta1LinkFn:t($).func,cta2:t($).string,cta2LinkFn:t($).func,basicDefault:t($).any.isRequired})}).isRequired,value:t($).any,onChange:t($).func.isRequired,isSubOk:t($).bool.isRequired,userId:t($).string};var se=ie,le=(g=o("jBCXK"),b=o("ff4Ef"),y=o("gwJFa"),i=o("7b0kr"),o("95ETH")),ce=(o("5Xemj"),M=o("2z2pA"),o("eW2D8"));le=o("95ETH"),C=o("5Xemj"),re=o("5Gpcw"),N=o("8ioZ3");const ue=[{id:"downloads",perms:le.PERMISSIONS.DOWNLOADS,name:(0,C.tr)("Downloads permission"),help_text:(0,C.tr)("This permission is required for the download buttons and the auto-download feature."),on_revoke:function(){N.default.remove("auto_dl2")}}];(0,re.noIframes)()||ue.push({id:"iframe",perms:ce.FRAME_PERMS,permsContains:ce.FRAME_PERMS_CONTAINS,name:(0,C.tr)("iFrame permission"),help_html:(0,C.tr)("This permission is required in order to scroll the inner contents of $iframes$ or $framesets$.",null,[],{iframes:{content:'<a class="dim" target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe">iframes</a>',example:"iframes"},framesets:{content:'<a class="dim" target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/frameset">framesets</a>',example:"framesets"}})});i=o("7b0kr"),le=o("95ETH");const de=e=>{let n=e.tog,r=e.value,a=e.onChange;return t(i).createElement("div",{className:"perm-row cb-row"},t(i).createElement("label",null,t(i).createElement("input",{className:"cb-input",type:"checkbox",name:n.id,checked:r||!1,disabled:void 0===r,onChange:e=>{e.currentTarget.checked?le.request(n.perms).then((e=>{e?(A("notif-sav"),a(n.id,!0)):A("notif-err")})).catch(I):le.remove(n.perms).then((e=>{e?(n.on_revoke&&n.on_revoke(),A("notif-sav"),a(n.id,!1)):A("notif-err")})).catch(I)}}),t(i).createElement("span",{className:"cb-text"},n.name)),n.help_text?t(i).createElement("div",{className:"cb-help"},n.help_text):n.help_html?t(i).createElement("div",{className:"cb-help",dangerouslySetInnerHTML:{__html:n.help_html}}):null)};de.displayName="ToggleElt";var me=de;const pe=()=>{const e=(0,b.default)((0,i.useState)({}),2),n=e[0],r=e[1],a=(0,b.default)((0,i.useState)(!1),2),o=a[0],s=a[1],l=e=>r((t=>(0,g.default)({},t,e)));(0,i.useEffect)((()=>{ue.map((e=>{le.contains(e.permsContains||e.perms).then((t=>{l({[e.id]:t})})).catch((e=>M.default.error(e)))}))}),[]);const c=(e,t)=>{l({[e]:t})};return t(i).createElement("div",{className:"container",id:"perm-settings-container"},t(i).createElement("p",null,t(i).createElement("a",{href:"",className:"perm-header dim",id:"perm-toggle",onClick:e=>{e.preventDefault(),s(!o)}},t(i).createElement("strong",null,(0,C.tr)("Permissions"),t(i).createElement("span",{className:t(y)("arrow",{"pe-7s-angle-down":!o,"pe-7s-angle-up":o})})))),o&&t(i).createElement("div",{id:"perm-content"},t(i).createElement("p",null,(0,C.tr)("Any optional permissions that were previously granted will appear checked here. You can revoke them at any time. If they are needed again in the future, they will be re-requested.")),ue.map((e=>t(i).createElement(me,{key:e.id,tog:e,value:n[e.id],onChange:c})))))};pe.displayName="ToggleElts";var he=pe;const fe=()=>{const e=(0,b.default)((0,i.useState)(null),2),n=e[0],r=e[1],a=(0,b.default)((0,i.useState)({}),2),o=a[0],s=a[1],c=(0,b.default)((0,i.useState)(null),2),u=c[0],d=c[1],m=e=>r((t=>(0,g.default)({},t,e)));(0,i.useEffect)((()=>{_.default.pageview(),L(!0),(0,C.updateHtml)(),S.update(),Array.prototype.slice.call(document.querySelectorAll("a[data-href]")).forEach((e=>{e.href=e.dataset.href})),(0,l.$)("version-num").innerText=(0,F.getVersion)();const e=(0,x.makeLoginUrl)();l.$.findClass("account-url").forEach((t=>{t.setAttribute("href",e),t.style.display=""})),E.default.loginStateProm(!0).then((e=>{d(e)})),N.default.onUpdate((e=>{const t={};e.forEach((e=>{t[e]=N.default.state[e]})),m(t)})),N.default.load().then((e=>{r(e)}))}),[]),(0,i.useEffect)((()=>{if(k.REGISTER_SELF_URL){const e=document.getElementById("opts-menu-right");e||alert("Missing opts-menu-right wrapper!");const t=document.createElement("a");Object.assign(t.style,{display:"inline-block",marginRight:"20px",color:"#ef4444"}),t.textContent="Connect backend",t.target="_blank",t.href=`${k.REGISTER_SELF_URL}?id=${encodeURIComponent(chrome.runtime.id)}`,e.prepend(t),t.addEventListener("click",(e=>{e.shiftKey&&window.setTimeout((()=>{t.parentNode.removeChild(t)}))}),!1)}}),[]);const p=(e,t)=>{const n=N.default.getField(e);let r="";var a,i;n.process&&(a=n.process(t),t=a.val,r=a.msg),r&&o[e]!==r&&(i={[e]:r},s((e=>(0,g.default)({},e,i))));(n.validate||T.PromiseTrue)(t).then((n=>n?(m({[e]:t}),N.default.set(e,t).then((()=>{A("notif-sav")}))):void 0)).catch((e=>{I(e)}))};if(!n)return t(i).createElement("div",{className:"container",id:"settings-container"},(0,C.tr)("loading…"));const h=u&&u.userId||null,f=!!u&&"sub-ok"===u.subState,R=u&&u.store&&u.store.show_experimental||!1,O=H(Object.entries(N.default.fields).map((e=>{let t=(0,b.default)(e,2),r=t[0],a=t[1];return(0,w.isFieldHidden)(a,f,n)?null:(0,v.default)((0,g.default)({},a),{name:r})})).filter((e=>e)),"group");return t(i).createElement(t(i).Fragment,null,t(i).createElement("div",{className:"container",id:"settings-container"},O.map(((e,r)=>{let a=e.key,o=e.vals;return t(i).createElement("div",{key:a,className:"options-group"},t(i).createElement("h3",null,a),t(i).createElement("div",{className:t(y)("options-list",{last:r===O.length-1})},o.map((e=>e.experimental&&!R?null:t(i).createElement(se,{key:e.name,field:e,value:n[e.name],onChange:p,userId:h,isSubOk:f})))))}))),t(i).createElement(he,null))};fe.displayName="App";var ge=fe;!function(){const e=u(),t=e.editor||e.capture||e.history;t&&l.$.findClass("back-button").forEach((e=>{-1===e.getAttribute("href").indexOf("?")&&(e.removeAttribute("data-href"),e.href=t)})),d((0,l.$)("btn-settings"),e.options),d((0,l.$)("btn-history"),e.history)}(),(0,s.render)(t(i).createElement(ge,null),document.getElementById("root"))})();
//# sourceMappingURL=options.3fb4960c.js.map
