"use strict";$(function(){function e(){X(),n(),P(),nt(),Ut.showGroups&&$("body").addClass("showGroups"),$e(),$(window).resize(V),$(".splitter").mousedown(Q),Z(),$("body").css("visibility","visible"),V(),Be(Ut.layout,!0)}function t(){g(),L(),B();var e=Bn;Ut.lastView&&Ut.lastView.view&&(e=Ut.lastView.view,z(e)||(e=Bn)),i(e),A(e),chrome.runtime.sendMessage({iAmHere:!0}),Kt.scroll(b).scroll(),setTimeout(N,1e3),"collectData"in Ut||(Ht(),chrome.runtime.sendMessage({changeOptions:1,options:{collectData:1}}))}function n(){$("body")[("dark-theme"==Ut.theme?"add":"remove")+"Class"]("dark-theme")}function i(e){en.empty();var t,n,i=[];for(t in qt)i.push({feed:t,pos:qt[t].pos,group:qt[t].group,favIcon:qt[t].favIcon,update:qt[t].update||0});i.sort(function(e,t){return e.pos-t.pos});for(var l,c={},u=0;u<i.length;u++)t=i[u],c[t.group]||(l=r(t.group),n=o(t.group,l),en.append(n),c[t.group]=n),l=d(t.feed),n=a(S(t.feed),l),l&&n.addClass("has-unread"),t.update||n.addClass("zero-update"),t.favIcon&&$("div",n).css("background-image","url("+t.favIcon+")"),n.data(t),en.append(n),t.feed==e&&n.addClass(ai);s(),i.length?tn.removeClass("disabled"):tn.addClass("disabled")}function s(){$(".feed-group",en).each(function(){$(this).is(".collapsed")!=(!!Ut.showGroups&&!!Ut.collapsedGroups[l(this)])&&u.call(this,!0,!0)})}function a(e,t){return t=t||"",$('<div class="feed"><div>'+e+"</div><span>"+t+"</span></div>")}function o(e,t){return e=e||Ut.defaultGroup,t=t||"",$('<div class="feed-group"><div>'+e+"</div><span>"+t+"</span></div>")}function r(e){for(var t,n,i=0,s=0;s<Nt.length;s++)t=Nt[s],n=qt[t.feed],!n||n.disabled||t.read||t.deleted||n.group!=e||++i;return i}function d(e){for(var t,n=0,i=0;i<Nt.length;i++)t=Nt[i],!e||t.read||t.deleted||t.feed!=e||++n;return n}function l(e){return $("div",e).html()}function c(e,t){Ye();var n=$(this),i=n.data();n.is(".selected")||($(".feed",en).removeClass(ai),n.addClass(ai),A(i.feed)),t&&(i.url=i.feed,i.update=qt[i.url].update,wn.data({data:[i]}),$(".properties",wn).removeAttr("disabled"),Oe(t,wn))}function u(e,t){function n(e,t){e&&$(this).children().css("top",e-t.start)}function i(e,t){e&&$(this).children().css("top",e-t.end)}var s=l(this);s=$(".feed",en).filter(function(){return $(this).data().group==s});var a=s.parent();a.is(".wrapper")||(a=s.wrapAll('<div class="wrapper"></div>').parent()),a.stop(),$(this).is(".collapsed")?a.slideDown({duration:e===!0?0:200,complete:function(){a.children().unwrap(),f()},step:i}):(a.slideUp({duration:e===!0?0:200,step:n}),$(".feed.selected",a).length&&$(this).addClass("has-selected")),$(this).toggleClass("collapsed"),t||h()}function h(){var e,t={};$(".feed-group",en).each(function(){e=$(this),e.is(".collapsed")&&(t[l(e)]=1)}),Ut.collapsedGroups=t,chrome.runtime.sendMessage({collapsedGroups:t})}function f(){en.children().css("top","")}function p(e){function t(e){e.each(function(){var e=$(this);if(!e.hasClass("collapsed")){var t=l(e),n=$('<div class="wrapper"></div>').insertAfter(e);n.append(e.nextAll(".feed").filter(function(){return $(this).data().group==t})),y=y.add(n)}})}function n(){y.each(function(){$(this).children().unwrap()})}function i(e){M=0,f();var t=e.clientY+d.scrollTop-c;t<h&&(t=h),t>o&&(t=o),!k&&Math.abs(t)>5&&(k=!0),r.css("top",t);var n=t;u||r.next(".wrapper").css("top",t),x.css("top",0);var i=-1,s=g;t<0&&(t=Math.abs(t),i=1,s=p),s.each(function(){var e,n=this,s=n.offsetHeight;if(u||(s+=n.nextSibling.offsetHeight),t<s){e=i*(t*b/s)+"px",this.style.top=e,u||(n.nextSibling.style.top=e);var a=(b+s)/2-b/2;return M+=Math.floor(t/a),!1}e=i*b+"px",this.style.top=e,u||(n.nextSibling.style.top=e),M+=1,t-=s});var a=r[0].offsetTop-d.scrollTop,l=a+r[0].offsetHeight,m=d.offsetHeight;return l>m?d.scrollTop+=l-m:a<0&&(d.scrollTop+=a),u&&n==h&&(d.scrollTop=0),M*=-i,!1}function s(){var e,t,n;$(".feed-group,.feed",en).each(function(){var i=$(this);i.is(".feed-group")?(e=i,t=l(this),n=i.is(".collapsed")):(i.data("group",t),n&&e.nextAll(".wrapper").first().append(i))}),m(),v()}function a(){if($(document).unbind("mousemove",i).unbind("mouseup",a),M){var e=M>0,t=e?g:p,o=t.eq(Math.abs(M)-1);if(u)e?o.after(r):o.before(r);else{var d=r.next();e?o.next().after(r):o.before(r),r.after(d)}}else if(k){var l=r.next();l.length?l.before(r):(l=r.prev(),l.length?l.after(r):(l=r.parent(),l.append(r)))}n(),f(),x.css("top",""),en.children().css("z-index",""),M&&s()}if(2!=e.button&&!Ut.lockPositions){var o,r=$(this),d=en.parent()[0],c=e.clientY+d.scrollTop,u=r.is(".feed"),h=-r[0].offsetTop,p=r.prevAll(":visible"),g=r.nextAll(":visible"),w=r[0].offsetTop,b=r[0].offsetHeight,y=$(),k=!1;if(u){if(h+=25,o=0,g.length){var C=g.last();o=C[0].offsetTop-w,C.hasClass("feed-group")&&(o+=5)}}else p=p.filter(".feed-group"),g=g.filter(".feed-group"),t(p.add(g).add(r)),o=g.length?g.last()[0].offsetHeight+g.last()[0].nextSibling.offsetHeight:0,o=0,g.each(function(){var e=this;o+=e.offsetHeight+e.nextSibling.offsetHeight}),b+=this.nextSibling.offsetHeight;var x=p.add(g),M=0;$(document).bind("mousemove",i).bind("mouseup",a),r.css("z-index",9),u||r.next(".wrapper").css("z-index",9)}}function m(){var e,t={};$(".feed-group,.feed").each(function(){var n=$(this);n.is(".feed-group")?(e=n,t[$(">div",n).text()]={n:0,e:n}):t[n.data("group")].n+=+$(">span",n).text()});for(e in t)$(">span",t[e].e).html(t[e].n||"")}function v(){$(".feed-group",en).removeClass("has-selected");var e=0,t={};$(".feed",en).each(function(){var n=$(this);n.data("pos",e++);var i=n.data();qt[i.feed]&&(qt[i.feed].pos=i.pos,qt[i.feed].group=i.group,t[i.feed]={pos:i.pos,group:i.group},n.hasClass("selected")&&R(i.group).addClass("has-selected"))}),chrome.runtime.sendMessage({changePositions:t})}function g(){Nt=[];for(var e in qt){for(var t in qt[e].items){var n=qt[e].items[t];n.feed=e,n.id=t,Nt.push(n)}qt[e].items&&delete qt[e].items}w()}function w(e){e=e||Nt,Ut.orderby==Kn&&(Ut.order?e.sort(function(e,t){return e.rawDate-t.rawDate}):e.sort(function(e,t){return t.rawDate-e.rawDate}));var t=new Intl.Collator;Ut.orderby==Vn&&(Ut.order?e.sort(function(e,n){return t.compare(n.author||S(n.feed),e.author||S(e.feed))}):e.sort(function(e,n){return t.compare(e.author||S(e.feed),n.author||S(n.feed))})),Ut.orderby==Jn&&(Ut.order?e.sort(function(e,n){return t.compare(n.title,e.title)}):e.sort(function(e,n){return t.compare(e.title,n.title)})),Ut.orderby==ei&&(Ut.order?e.sort(function(e,t){return e.added-t.added}):e.sort(function(e,t){return t.added-e.added})),Ut.orderby==ti&&(Ut.order?e.sort(function(e,t){return e=e.deleted||1/0,t=t.deleted||1/0,e-t}):e.sort(function(e,t){return e=e.deleted||1/0,t=t.deleted||1/0,t-e}))}function b(){var e=this.scrollTop,t=jn[Lt];if(t)if(t.items.length){for(var n=0;n<t.y.length&&!(t.y[n]>=e);n++);if(n>0&&--n,$(".item",Xt).hide().each(function(){var e=$(this);t.items[n]?(e.css({display:"block",top:t.y[n]}),y(e,t.items[n])):e.css("display","none"),++n}),Ut.showMilestones){var i=$(),s=0,a=!1;$(".day-panel",Xt).each(function(){if("none"!=this.style.display){var t=+$(this).attr("y")-e;t<=0?i=$(this):(t<21&&(s=21-t),a=!0,$(this).css("top",+$(this).attr("y")))}}),i.css("top",e-s)}}else $(".item",Xt).hide()}function y(e,t){var n=e.data("data")||{};if(n.feed!=t.feed||n.id!=t.id){var i=Date.now()-864e5,s=Date.now()+864e5;t.title?$(".title",e).text(pi(t.title)):$(".title",e).html("&nbsp;"),$(".author",e).text(t.author||S(t.feed));var a=new Date(Ut.orderby==ei?t.added:Ut.orderby==ti?t.deleted:t.rawDate);a=Ut.orderby!=ti||t.deleted?a.valueOf()<i||a.valueOf()>s?x(a,!0):C(a,!1):"----",$(".date",e).html(a).css("background-image","url("+(qt[t.feed].favIcon?qt[t.feed].favIcon:"16x16.png")+")"),e.removeClass("seen read deleted pinned"),t.seen&&e.addClass("seen"),t.read&&e.addClass("read"),t.deleted&&e.addClass("deleted"),t.pinned&&e.addClass("pinned"),e.data("data",t)}e[(jn[Lt].selected.indexOf(t)>=0?"add":"remove")+"Class"](ai)}function k(e){return x(e,!1)+" "+C(e,!0)}function C(e,t){return M(e.getHours())+":"+M(e.getMinutes())+(t?":"+M(e.getSeconds()):"")}function x(e,t){var n=M(e.getDate()),i=e.getMonth();if(t)n+="."+M(i+1)+".";else{var s=["january","february","march","april","may","june","july","august","september","october","november","december"][i];s=i18n(s),n+=" "+s+" "}return n+=M(e.getFullYear())}function M(e){return String(e<10?"0"+e:e)}function S(e){var t=e;if(qt[e]){var n=qt[e];t=n.useGivenName&&n.givenName?n.givenName:n.name?n.name:e}return t}function _(){Ye();var e=$(this).is("#view-all")?Bn:$(this).is("#view-deleted")?Wn:$(this).is("#view-pinned")?En:0;e&&($(".feed",en).removeClass(ai),e!=Lt&&A(e))}function T(){cn.removeClass("pressed");var e=Lt==Bn?"#view-all":Lt==Wn?"#view-deleted":Lt==En?"#view-pinned":0;e&&$(cn).filter(e).addClass("pressed")}function D(){var e="16x16.png";Lt==Bn?e="feed.png":Lt==Wn?e="delete.png":Lt==En?e="pintab.png":Lt==Xn?e="search.png":qt[Lt].favIcon&&(e=qt[Lt].favIcon),$("#favicon").attr("href",e)}function I(){var e=jn[Lt].items.length;if(Lt!=Wn&&Lt!=En&&Lt!=Xn){e=0;for(var t=0;t<jn[Lt].items.length;t++){var n=jn[Lt].items[t];n.read||n.deleted||++e}}var i=Lt==Bn?i18n("feeds"):Lt==Wn?i18n("trash"):Lt==En?i18n("pinned"):Lt==Xn?i18n("search"):S(Lt);O(i,e)}function O(e,t){$("title").html(e+(t?" ("+t+")":""))}function A(e){Xt[(qt[e]?"remove":"add")+"Class"]("show_icons"),Lt&&jn[Lt]&&(jn[Lt].scroll=Kt.scrollTop()),jn[e]&&!jn[e].needRebuild||F(e),Lt=e,D(),I(),T(),H(),Xt.height(jn[e].height),Kt.scrollTop(jn[e].scroll).scroll(),Lt!=Xn?(Ut.lastView={view:Lt},chrome.runtime.sendMessage({lastView:Ut.lastView}),qt[e]&&de(e).addClass(ai)):$(".feed",en).removeClass(ai),$(".feed-group",en).removeClass("has-selected"),qt[Lt]?(R(qt[Lt].group).addClass("has-selected"),sn.removeClass("disabled")):sn.addClass("disabled"),J(),!jn[e].selected.length&&jn[e].items.length&&(jn[e].selected=[jn[e].items[0]],jn[e].lastSelected=jn[e].items[0],Kt.scroll()),ht(),St(),ft()}function z(e){return e==Bn||e==Wn||e==En||!!qt[e]}function R(e){return $(".feed-group>div",en).filter(function(){return $(this).text()==e}).parent()}function G(e){var t=[];if(e==Xn)return t=je(ui);for(var n=0;n<Nt.length;n++){var i=!1;e==Bn?Nt[n].deleted||(i=!0):e==Wn?Nt[n].deleted&&(i=!0):e==En?Nt[n].pinned&&!Nt[n].deleted&&(i=!0):Nt[n].deleted||e!=Nt[n].feed||(i=!0),i&&t.push(Nt[n])}return t}function H(){if($(".day-panel",Xt).hide(),(Ut.orderby==Kn||Ut.orderby==ei||Ut.orderby==ti)&&Ut.showMilestones){var e,t,n,i=jn[Lt].items;for(e=0,n=null;e<i.length;e++)i[e].timeGroup!=n&&(t=jn[Lt].y[e],$(".day-panel[timegroup="+i[e].timeGroup+"]").show().css("top",t-21).attr("y",t-21),n=i[e].timeGroup)}}function F(e){var t,n,i,s=oi?21:45;jn[e]?jn[e]={items:[],scroll:jn[e].scroll||0,height:0,y:[],selected:jn[e].selected||[],lastSelected:jn[e].lastSelected||0}:jn[e]={items:[],scroll:0,height:0,y:[],selected:[],lastSelected:0},jn[e].needRebuild=!1;var a=jn[e].items=G(e);q(e);var o=Ut.orderby!=Kn&&Ut.orderby!=ei&&Ut.orderby!=ti||!Ut.showMilestones?0:U(e);jn[e].height=a.length*s+21*o;var r={};if(a.length)for(t=0,n=0,i=void 0;t<a.length;t++,n+=s){var d=a[t];Ut.orderby!=Kn&&Ut.orderby!=ei&&Ut.orderby!=ti||!Ut.showMilestones||d.timeGroup==i||(n+=21,i=d.timeGroup),r[i]||(r[i]=0),++r[i],jn[e].y.push(n)}}function q(e){if(e=jn[e]){for(var t=e.selected,n=0;n<t.length;n++)e.items.indexOf(t[n])<0&&t.splice(n--,1);e.items.indexOf(e.lastSelected)<0&&(e.lastSelected=0)}}function U(e){for(var t={},n=0;n<jn[e].items.length;n++)t[jn[e].items[n].timeGroup]=1;return Object.keys(t).length}function N(){var e=(new Date).getDate();li!=e&&(Y(),P()),li=e,setTimeout(N,1e3)}function P(){var e=new Date;8==e.getDate()&&2==e.getMonth()?Gn.parent().css("background","white no-repeat right top url(rose_vine.png)"):Gn.parent().css("background","")}function Y(e){e=e||Lt||Bn,$(".item",Xt).each(function(){$(this).removeData()}),w(),L(),B(),ge(),A(e)}function L(){var e=864e5,t=Date.now(),n=new Date(t),i=new Date(t);i.setHours(0,0,0,0),i=i.valueOf(),Yt=["future","today","yesterday"],Pt=[1/0,t,i];var s=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],a=n.getDay()-1;if(a=a<0?6:a,a>=2){var o=i,r=a-1;do r-=1,o-=e,Yt.push(s[r]),Pt.push(o);while(r>0)}var d,l=i-a*e;d=l==i?l-e:l,Yt.push("lastweek"),Pt.push(d);var c=n.getDate(),u=l-7*e,h=l-e*(c-a-1);u>h&&(Yt.push("emonth"),Pt.push(u));var f=["mJanuary","mFebruary","mMarch","mApril","mMay","mJune","mJuly","mAugust","mSeptember","mOctober","mNovember","mDecember"],p=n.getMonth();if(p)for(var m=p;m>0;m--){var v=new Date(n.getFullYear(),m,1,0,0,0);Yt.push(f[m-1]),Pt.push(v.valueOf())}var g=n.getFullYear()-1,w=n.getFullYear()-2,b=n.getFullYear()-3,y=new Date(g+1,0,1,0,0,0).valueOf();for(d-7*e<y&&(y=d-7*e),Yt.push(String(g)),Pt.push(y),Yt.push(String(w)),Pt.push(new Date(w+1,0,1,0,0,0).valueOf()),Yt.push(String(b)),Pt.push(new Date(b+1,0,1,0,0,0).valueOf()),Yt.push("older"),Pt.push(new Date(b,0,1,0,0,0).valueOf()),Pt.push(-(1/0)),$(".day-panel",Xt).remove(),Ut.order&&(Pt.reverse(),Yt.reverse()),m=0;m<Yt.length;m++)Xt.append(j(m))}function j(e){return $('<div class="day-panel">'+i18n(Yt[e])+"</div>").attr("timegroup",e)}function B(){if(Ut.orderby==Kn||Ut.orderby==ei||Ut.orderby==ti)for(var e=1,t=0;t<Nt.length;t++)W(Ut.orderby==Kn?Nt[t].rawDate:Ut.orderby==ei?Nt[t].added:Nt[t].deleted?Nt[t].deleted:1/0,Pt[e],Pt[e-1])?Nt[t].timeGroup=e-1:(e+=1,t-=1)}function W(e,t,n){return Ut.order?t>=e&&e>=n:t<=e&&e<=n}function E(){chrome.runtime.sendMessage({areYouReady:1},function(n){n?chrome.runtime.sendMessage({getOptions:1},function(n){Ut=n.options,e(),chrome.runtime.sendMessage({getFeeds:1},function(e){qt=e.feeds,t()})}):setTimeout(E,100)})}function X(){jt=$(".win"),Bt=$("#main-table"),Vt=$("tr.top-panel"),Qt=$("td:last",Vt),Jt=$("tr#middle"),Zt=$("td:last",Jt),Wt=$("#feeds-td"),Et=$("#feed-td"),Xt=$("#feed-div"),Kt=$("#upper-feed-div"),en=$("#feeds-div"),en.on("click",".feed-group",u),en.on("mousedown",".feed-group,.feed",p),en.on("click",".feed",c),cn=$("#view-buttons .view-button",Wt),cn.on("mousedown",_),tn=$("#reload-all").on("click",te),nn=$("#add-url").on("click",ne),sn=$("#reload-feed").on("click",ee),an=$("#sort-items").on("click",me).on("mousedown",function(){return $(".menu").not(un).hide(),!1}),on=$("#general-settings").on("click",ve).on("mousedown",function(){return $(".menu").not(hn).hide(),!1}),un=$("#sortMenu"),hn=$("#genSetMenu"),fn=$("#real-select-layout"),pn=$("#real-select-groups"),mn=$("#real-select-language"),vn=$("#real-select-notifications"),gn=$("#notify-melody"),$n=$("#notify-volume"),wn=$("#feed-or-feeds-menu"),bn=$("#real-updating-menu"),yn=$("#real-group-menu"),kn=$("#real-select-theme"),Cn=$("#real-menu-history"),xn=$("#real-menu-import-export"),Mn=$("#menu-advanced"),rn=$("#search").on("change keydown keypress keyup cut paste",Pe),dn=$("#search-closer").on("click",Ye).on("mousedown",Le),Sn=$("#items-header"),_n=$("#splitter1"),Tn=$("#splitter2"),Dn=$("#splitter3"),In=$("#windows"),On=$("#remover-for-file").on("mousedown",function(){return!1}).on("click",He),Xt.on("mousedown",".item",rt),Xt.on("dblclick",".item",dt),Xt.on("dblclick",".day-panel",ct),Xt.on("mousedown",".day-panel",ut),An=$("#item-window"),zn=$(">div",An),Rn=$("#article",An),Gn=$("#article-header h1",An),Hn=$("#author",An),Fn=$("#date",An),qn=$("#pin",An).on("click",At),Un=$(".read-button").on("click",Tt),Nn=$(".delete-button").on("click",Dt),Pn=$("#undelete-button").on("click",It),K()}function K(){$("#advanced-menu",hn)[Ut.developerMode?"show":"hide"]()}function V(){var e=$(">div",Wt).width(),t=Kt.width();_n.css("left",e-4),Tn.css("left",e+t-4),Dn.css("left",e).css("top",Vt.height()+Jt.height()-4);var n=Math.round(Kt.height()/(oi?21:45))+1;$(".item",Xt).remove();for(var i=0;i<n;i++)Xt.prepend($('<div class="item"><div class="title"></div><div class="author"></div><div class="date"></div></item>'));Kt.scroll(),di||ze(),di=0,J(),bt(),$("body>.win").each(function(){!function(e){e&&e()}($(this).data("onresizeme"))})}function J(){Sn.width(Kt[0].clientWidth)}function Q(e){function t(e){var t,n,i;Dn.is(s)?(n=d+e.clientY-l,n=n>50?n:50,i=Bt[0].offsetHeight-100,n=n<i?n:i,a.height(n)):(t=o+e.clientX-r,t=t>100?t:100,i=Bt[0].offsetWidth-200-(Tn.is(s)?Wt[0].offsetWidth:0),t=t<i?t:i,a.width(t)),V()}function n(){s.releaseCapture?s.releaseCapture():i.removeClass("col-resizing row-resizing"),$(document).unbind("mousemove",t).unbind("mouseup",n);var e=Ut.widthsAreas?Ut.widthsAreas:{};_n.is(s)?e.left=a.width():Tn.is(s)?e.center=a.width():e.bottom=a.height(),chrome.runtime.sendMessage({widthsAreas:e})}var i=$("body"),s=this,a=_n.is(s)?$(">div",Wt):Tn.is(s)?Kt:Xt.parent(),o=a.width(),r=e.clientX,d=a.height(),l=e.clientY;return s.setCapture?s.setCapture():i.addClass(Dn.is(s)?"row-resizing":"col-resizing"),$(document).bind("mousemove",t),$(document).bind("mouseup",n),!1}function Z(){var e=Ut.widthsAreas?Ut.widthsAreas:{};e.left&&$(">div",Wt).width(e.left),e.center&&Kt.width(e.center),oi==ii?Xt.parent().css("height",e.bottom||window.innerHeight/3):Xt.parent().css("height","")}function ee(){if(!$(this).isDisabled()){var e=$(".feed.selected",en);e.hasClass("loading")||chrome.runtime.sendMessage({updateFeed:e.data("feed")})}}function te(){$(this).isDisabled()||$(".feed",en).each(function(){var e=$(this).data().feed;!$(this).hasClass("loading")&&qt[e].update&&chrome.runtime.sendMessage({updateFeed:e})})}function ne(){ie(0)}function ie(e){var t=fe(i18n("enter_feeds_name"),i18n("new_feed"),se);e&&t.win.find("input:eq(0)").val(e).select()}function se(e,t,n){if(e){if(qt[e])return void de(e).click();var i=he("<p>"+i18n("please_wait")+"</p>",i18n("checking"),!0);chrome.runtime.sendMessage({checkUrl:e},function(s){i.win.destroy(),s?ae(e,s,t,n):ce("<p>"+i18n("no_such_feed")+"</p>",0,function(){ie(e)})})}}function ae(e,t,n,i){if(n=n||Ut.defaultGroup,!qt[e]){var s=R(n);s.length||(s=o(n).appendTo(en));var r=a(t),d=oe(n);d.length?d.after(r):s.is(".collapsed")?s.next().append(r):s.after(r),qt[e]={name:t,pos:re()+1,deleted:[],items:{},group:n,added:Date.now(),update:180},r.data({feed:e,pos:qt[e].pos,group:qt[e].group}),chrome.runtime.sendMessage({saveOneFeed:1,feedId:e,feed:qt[e]}),v(),Ft([e])}i||de(e).click()}function oe(e){var t=$();return $(".feed",en).each(function(){$(this).data("group")==e&&(t=$(this))}),t}function re(){var e=0;for(var t in qt)qt[t].pos>e&&(e=qt[t].pos);return e}function de(e){return $(".feed",en).filter(function(){return $(this).data().feed==e})}function le(e,t,n){"languageChanged"==e&&(Ut.locale=t.locale,nt(),Y());var i=t.url;if("tryToSubscribeToThisUrl"!=e&&"subscribe"!=e||se(i),"needAuth"==e||qt[i]){var s=i?de(i):$();if("loading"==e&&s.addClass("loading"),"loadingComplete"==e&&(s.removeClass("loading"),t.name&&(qt[i].name=t.name,$("div",s).html(S(i))),t.baseURI&&(qt[i].baseURI=t.baseURI),t.newItems)){for(var a in t.newItems){var o=t.newItems[a];o.feed=i,o.id=a,Nt.push(o)}if(Object.keys(t.newItems).length){Pt[1]=Date.now()+1e3,w(),B(),jn[Bn]&&(jn[Bn].needRebuild=!0),jn[i]&&(jn[i].needRebuild=!0),Lt!=Bn&&Lt!=i||A(Lt);var r=d(i);$("span",s).html(r||""),Ot(i)}}if("needAuth"==e){var l=i;return qt[l]&&(l=S(l)),s="<p style='text-align:center;font-weight:bold;'>"+l+"</p>",s+="<div style='text-align:center'><table style='margin: 0 auto;'><tr><td rowspan='2'><img style='vertical-align:middle' src='keys.png'/></td>",s+="<td><input id='login' placeholder='"+i18n("login")+"'/></td></tr>",s+="<tr><td><input id='pass' placeholder='"+i18n("password")+"' type='password'/>",s+="</td></tr></table></div>",s=ue(s,i18n("authorization"),function(){var e=$("#login",s.win).val().trim(),t=$("#pass",s.win).val().trim();n({login:e,pass:t})},function(){n(!1)}),$(".title",s.win).css({backgroundImage:"url(wand.png)"}),!0}"readIt"==e&&s.click(),"favIconChanged"==e&&t.favIcon&&(qt[i].favIcon=t.favIcon,$("div",de(i)).css("background-image","url("+t.favIcon+")"))}}function ce(e,t,n){return pe(1,e,t,n)}function ue(e,t,n,i){return"{are-you-sure}"==e&&(e="<p style='text-align:center'><img src='question.png' style='vertical-align:middle;padding-right:20px;'/>"+i18n("are_you_sure")+"</p>"),pe(2,e,t,n,i)}function he(e,t,n,i,s){return pe(0,e,t,null,null,n,i,s)}function fe(e,t,n,i){var s=pe(2,'<p><input style="width:300px;" placeholder="'+e+'"/></p>',t,function(){n($("p>input",s.win).val().trim())},i);return s}function pe(e,t,n,i,s,a,o,r){function d(){h.hasClass("full-window")&&$(".content",h).height(window.innerHeight-10-($(".title",h).outerHeight(!0)+$(".buttons",h).outerHeight(!0)))}function l(){e>0&&$(document).unbind("keyup",c),f.remove(),g.stop(),$({a:1}).animate({a:0},{easing:"easeInBack",duration:200,step:function(e){h.css("-webkit-transform","scale("+e+","+e+")")},complete:function(){h.remove()}})}function c(t){$(".win").last().is(h)&&((13==t.keyCode&&2==e||1==e&&27==t.keyCode)&&p.click(),27==t.keyCode&&2==e&&m.click(),27!=t.keyCode||0!=e||a||v.click())}ze(),n=n||"The RSS Aggregator",t=t||"&nbsp;";var u=$("#winfak"),h=$(".win",u).clone(),f=$(".hider",u).clone();$("body").append(f).append(h),0==e&&$(".buttons input:not(.close_button)",h).remove(),0==e&&a&&$(".buttons",h).remove(),1==e&&$(".buttons .cancel_button",h).remove(),0!=e&&$(".buttons .close_button",h).remove(),t=$(".content",h).html(t),o&&(t.css(o).data({onresize:r}),h.append($('<div class="resizer"/>')),h.css("border-bottom-right-radius",0),$(".buttons .close_button",h).css({position:"relative",left:-10}),$(".full-window-button",h).show().on("click",function(){h.hasClass("full-window")?$(".content",h).height(h.data("iniHeight")):h.data("iniHeight",$(".content",h).height()),h.toggleClass("full-window"),d(),r&&r(t)}),r&&r(t),h.data("onresizeme",function(){d(),r&&r(t)})),$("a",h).disableSelection(),$(".title",h).text(n),h.css("top",$(window).height()/2-h.outerHeight()/2),h.css("left",$(window).width()/2-h.outerWidth()/2),setTimeout(function(){$("input:text:eq(0)",h).focus()},0);var p=$(".buttons .ok_button",h).click(function(){i&&i(),l()}),m=$(".buttons .cancel_button",h).click(function(){s&&s(),l()}),v=$(".buttons .close_button",h).click(function(){l()});h.destroy=l,$(document).keyup(c);var g=$({a:0}).animate({a:1},{easing:"easeOutBack",duration:200,step:function(e){h.css("-webkit-transform","scale("+e+","+e+")")},complete:function(){h.css("-webkit-transform","")}});return{win:h,hider:f}}function me(){if($(this).is(".pressed"))un.hide();else{$(".checked",un).removeClass("checked");var e=$();Ut.orderby==Kn&&(e=$("#bytime",un)),Ut.orderby==Vn&&(e=$("#byauth",un)),Ut.orderby==Jn&&(e=$("#bysubj",un)),Ut.orderby==ei&&(e=$("#byadded",un)),Ut.orderby==ti&&(e=$("#bydeleted",un)),e.addClass("checked"),Ut.order==Qn&&(e=$("#byasc",un)),Ut.order==Zn&&(e=$("#bydesc",un)),e.addClass("checked"),Oe(0,un)}$(this).toggleClass("pressed"),on.removeClass("pressed")}function ve(){if($(this).is(".pressed"))hn.hide();else{$(".checked",hn).removeClass("checked");var e=Me();hn.data("history",e),$("#menu-history",hn)[e.length?"removeAttr":"attr"]("disabled","disabled"),Oe(0,hn)}$(this).toggleClass("pressed"),an.removeClass("pressed")}function ge(){for(var e in jn)jn[e].needRebuild=!0}function $e(){$(document).bind("contextmenu",function(e){var t=$(e.target);if(!t.is(":text")&&!Rn[0].contains(e.target)){var n=$(".win .content .feeds-list .feeds-list-inner table");if(n.length&&n[0].contains(e.target)){var i=$("tr.selected",n),s=[];$(".properties",wn)[i.length>1?"attr":"removeAttr"]("disabled","disabled"),i.each(function(){s.push($(this).data())}),wn.data({data:s}),Oe(e,wn)}return t.is("#feeds-div>.feed,#feeds-div>.feed>div")&&t.trigger("click",e),!1}}).mousedown(ze),$(".menu").mousedown(function(e){if(3==e.which||$(this).is(e.target)||$(e.target).is(".separator")||$(e.target).is("[disabled]")||$(e.target).is(".nest"))return!1}),$(">div:not(.separator)",un).mousedown(function(){var e,t=["bytime","byauth","bysubj","byadded","bydeleted"],n=["byasc","bydesc"];(e=t.indexOf(this.id)+1)?(Ut.orderby=e-1,chrome.runtime.sendMessage({orderby:Ut.orderby}),Ee()):(e=n.indexOf(this.id)+1)&&(Ut.order=e-1,chrome.runtime.sendMessage({order:Ut.order}),Ee())}),hn.on("mousedown",">div:not(.separator):not([disabled])",function(){if($(".menu").not(hn).hide(),$(this).is("#select-layout")&&Oe($(this),fn),$(this).is("#select-groups")&&($("#group-feeds",pn)[(Ut.showGroups?"add":"remove")+"Class"]("checked"),$("#group-items",pn)[(Ut.showMilestones?"add":"remove")+"Class"]("checked"),Oe($(this),pn)),$(this).is("#select-language")&&($(">div",mn).removeClass("checked").filter('[data-lan="'+Ut.locale+'"]').addClass("checked"),Oe($(this),mn)),$(this).is("#select-notifications")&&($("#notify-show-popup",vn)[(Ut.showPopup?"add":"remove")+"Class"]("checked"),$("#notify-play-sound",vn)[(Ut.playSound?"add":"remove")+"Class"]("checked"),$("#notify-sound-tone,#notify-sound-volume",vn)[Ut.playSound?"removeAttr":"attr"]("disabled","disabled"),Oe($(this),vn)),$(this).is("#manage-feeds")&&Ke(),$(this).is("#select-theme")&&($("div",kn).removeClass("checked").filter("#"+Ut.theme).addClass("checked"),Oe($(this),kn)),$(this).is("#menu-history")){var e=hn.data("history")||[];if(e.length){Cn.empty();for(var t=0;t<e.length;t++){var n=e[t].givenName||e[t].name||e[t].url,i=e[t].favIcon||"feeds.png",s=e[t].url,a=$("<div/>").text(n).css("background-image","url("+i+")").attr("title",s).data("url",s);Cn.append(a)}Oe($(this),Cn)}}$(this).is("#menu-import,#menu-export")&&(xn.data("action",this.id),Oe($(this),xn)),$(this).is("#advanced-menu")&&($("#lock-positions",Mn)[(Ut.lockPositions?"add":"remove")+"Class"]("checked"),Oe($(this),Mn)),$(this).is("#about-menu")&&Rt(),$(this).is("#donate-menu")&&$("#donate-form").submit()}),$(">div:not(.separator)",fn).mousedown(function(){var e={"layout-sidebyside":ni,"layout-vertical":ii,"layout-list":si};return Be(e[this.id]),!1}),$(">div:not(.separator)",pn).mousedown(function(){var e=$(this).is("#group-feeds")?"showGroups":"showMilestones",t=+!$(this).is(".checked"),n={};return Ut[e]=n[e]=t,$("body")[(Ut.showGroups?"add":"remove")+"Class"]("showGroups"),"showMilestones"==e&&Y(),"showGroups"==e&&s(),$(this).toggleClass("checked"),chrome.runtime.sendMessage(n),!1}),mn.on("mousedown",">div:not(.separator)",function(){var e=$(this).attr("data-lan");return e?(chrome.runtime.sendMessage({changeOptions:1,options:{locale:e}}),ot($(this),"checked"),!1):void it()}),vn.on("mousedown",">div:not(.separator):not([disabled])",function(){return $(".menu").not(hn).not(vn).hide(),$(this).is("#notify-show-popup")&&($(this).toggleClass("checked"),Ut.showPopup=+$(this).is(".checked"),chrome.runtime.sendMessage({changeOptions:1,options:{showPopup:Ut.showPopup}})),$(this).is("#notify-play-sound")&&($(this).toggleClass("checked"),Ut.playSound=+$(this).is(".checked"),chrome.runtime.sendMessage({changeOptions:1,options:{playSound:Ut.playSound}}),$("#notify-sound-tone,#notify-sound-volume",vn)[Ut.playSound?"removeAttr":"attr"]("disabled","disabled")),$(this).is("#notify-sound-tone")&&Ge($(this),gn),$(this).is("#notify-sound-volume")&&($(">div",$n).removeClass("checked").eq(Math.round(.04*Ut.volume)).addClass("checked"),Oe($(this),$n)),!1}),gn.on("mousedown",">div:not(.separator)",function(){var e=$(this).data();return e.name?(ot($(this),"checked"),Ut.sound=e.path,chrome.runtime.sendMessage({changeOptions:1,options:{sound:Ut.sound}}),Re(e.path),On.detach()):Fe(),!1}),$(">div:not(.separator)",$n).mousedown(function(){return ot($(this),"checked"),Ut.volume=$(this).index()/.04,chrome.runtime.sendMessage({changeOptions:1,options:{volume:Ut.volume}}),Re(Ut.sound),!1}),wn.on("mousedown",">div:not(.separator):not([disabled])",function(){$(".menu").not(wn).hide();var e,t=$(this),n=wn.data("data");if(t.is(".properties")&&Ne(n[0].url),t.is("#updating-menu")){$("div",bn).removeClass("checked");for(e in n)$("div[interval="+n[e].update+"]",bn).addClass("checked");Oe($(this),bn)}if(t.is(".delete")){var i=ue("{are-you-sure}",i18n("delete"),function(){Ie(n)});$(".title",i.win).css({backgroundImage:"url(delete.png)"})}t.is(".group")&&(_e(n),Oe($(this),yn))}),bn.on("mousedown",">div",function(){var e={},t=+$(this).attr("interval"),n=wn.data("data");for(var i in n){var s=n[i].url;n[i].update=qt[s].update=t,e[s]={update:t},de(n[i].url)[(n[i].update?"remove":"add")+"Class"]("zero-update")}Ze(e),chrome.runtime.sendMessage({updateIntervals:e})}),yn.on("mousedown",">div:not(.separator)",function(){var e=yn.data(),t={};for(var n in e)t[e[n].url]=1;$(this).is("#add-new-group")?fe(i18n("enter_new_group"),i18n("new_group"),function(e){e&&Se(t,e)}):Se(t,$(this).text())}),kn.on("mousedown",">div:not(.separator)",function(){return ot($(this),"checked"),Ut.theme=this.id,chrome.runtime.sendMessage({changeOptions:1,options:{theme:this.id}}),n(),!1}),Cn.on("mousedown",">div:not(.separator)",function(){var e=$(this).data("url");e&&chrome.runtime.sendMessage({subLink:e})}),xn.on("mousedown",">div",function(){var e=xn.data("action"),t=this.className;"menu-export"==e&&("opml"==t&&be(),"tra"==t&&ye()),"menu-import"==e&&("opml"==t&&Ce(),"tra"==t&&ke())}),Mn.on("mousedown",">div:not(.separator)",function(){if($(this).is("#reload-icons,#reload-icons-2")&&($(".feed>div",en).css("background-image",""),chrome.runtime.sendMessage({reloadIcons:!0,aggressively:$(this).is("#reload-icons-2")})),$(this).is("#remove-all-feeds")){var e=ue("{are-you-sure}",i18n("delete"),function(){var e=[];for(var t in qt)e.push({url:t});Ie(e)});$(".title",e.win).css({backgroundImage:"url(delete.png)"})}if($(this).is("#open-storage")&&window.requestFileSystem(1,1e8,function(e){Gt(e.root.toURL())}),$(this).is("#clean-storage")&&we(),$(this).is("#reset-sizes")&&chrome.runtime.sendMessage({resetSizes:1},function(){window.location=location}),$(this).is("#restart-ext")&&chrome.runtime.sendMessage({reloadBackground:1}),$(this).is("#special-feed")&&window.requestFileSystem(1,1e8,function(e){ae(e.root.toURL()+"chrome-store.xml","The RSS Aggregator")}),$(this).is("#lock-positions"))return $(this).toggleClass("checked"),Ut.lockPositions=+$(this).is(".checked"),chrome.runtime.sendMessage({changeOptions:1,options:{lockPositions:Ut.lockPositions}}),!1}),mn.append($("<div id='def-lang'>"+i18n("default")+"</div>").attr("data-lan","default")),mn.append($("<div class='separator'></div>"));for(var e in lingua.available_languages)mn.append($("<div>"+lingua.available_languages[e]+"</div>").attr("data-lan",e));mn.append($("<div class='separator'></div>")),mn.append($("<div id='add-lang'>"+i18n("add_translation")+"...</div>"))}function we(){window.requestFileSystem(1,1e8,function(e){var t=e.root.createReader();t.readEntries(function(e){e.forEach(function(e){e.isDirectory||e.remove(function(){})}),ce("<p style='text-align:center'>Cleaned</p>")})})}function be(){var e='<?xml version="1.0" encoding="utf-8"?>\n',t=$("<doc></doc>"),n=$('<opml version="1.0"/>').appendTo(t),i=$("<head></head>").appendTo(n);i.append("<title>"+i18n("exported")+"</title>");for(var s,a,o=$("<body/>").appendTo(n),r=Te(),d=0;d<r.length;d++){var l=r[d],c=l.url;a!=l.group&&(o.append(s=$("<outline/>")),s.attr("text",l.group).attr("title",l.group),a=l.group);var u=S(c),h=$('<outline type="rss"/>');h.attr("text",u).attr("title",u).attr("xmlUrl",c),s.append(h)}e+=style_html(t.html(),{indent_char:"\t",indent_size:1}),e=e.replace(/><\/outline>/g,"/>"),e=e.replace(/" xmlurl="/g,'" xmlUrl="'),st(e,"feeds-list.opml")}function ye(){chrome.runtime.sendMessage({getFeedsAndOptionsString:1},function(e){st(e,"data.tra")})}function ke(){xe("tra",function(e,t){e=(e||"").trim(),e&&ue('<table><tr><td><img src="warning.png"/></td><td>'+i18n("import_warning")+"</td></tr></table>","Import - "+t.name,function(){chrome.runtime.sendMessage({importTRA:e},function(){window.location=location})})})}function Ce(){xe("opml",function(e){e=$.parseXML(e),e&&$("opml>body outline[xmlUrl]",e).each(function(){var e=($(this).attr("text")||$(this).attr("title")||"").trim(),t=($(this).attr("xmlUrl")||"").trim(),n=$(this).parent("outline"),i=(n.attr("text")||n.attr("title")||Ut.defaultGroup).trim();e&&t&&!qt[t]&&se(t,i,!0)})})}function xe(e,t){$('<input type="file" accept=".'+e+'"/>').click().change(function(e){if(e.target.files.length&&e.target.files[0].size){var n=new FileReader;n.onload=function(e){
return function(n){t(n.target.result,e)}}(e.target.files[0]),n.readAsText(e.target.files[0])}})}function Me(){var e=[];if(Ut.history)for(var t in Ut.history)if(!qt[t]&&t!=Ln){var n=Ut.history[t];n.url=t,e.push(n)}return e.sort(function(e,t){return Ut.order?e.added-t.added:t.added-e.added}),e}function Se(e,t){for(var n=Te(),s={},a=[],o={},r=0;r<n.length;r++){e[n[r].url]&&(n[r].group=t);var d=n[r].group;s.hasOwnProperty(d)||(s[d]=a.length,a.push([])),a[s[d]].push(n[r])}var l=0;for(r=0;r<a.length;r++)for(var c=0;c<a[r].length;c++)o[a[r][c].url]={pos:l++,group:a[r][c].group};for(var u in o)$.extend(qt[u],o[u]);Ze(o),i(Lt),v()}function _e(e){yn.empty();var t={};for(var n in e)t[e[n].group]=1;var i=Te(),s={};for(n=0;n<i.length;n++){var a=i[n].group;if(!s[a]){var o=$("<div/>").text(a).appendTo(yn);t[a]&&o.addClass("checked"),s[a]=1}}yn.append('<div class="separator"/>'),yn.append('<div id="add-new-group">'+i18n("add")+"</div>"),yn.data(e)}function Te(){var e=[];for(var t in qt)e.push({url:t,pos:qt[t].pos,group:qt[t].group});return e.sort(function(e,t){return e.pos-t.pos}),e}function De(e,t){for(var n=0;n<e.length;n++)t[e[n].feed]&&e.splice(n--,1)}function Ie(e){var t={};for(var n in e)t[e[n].url]=1;if(De(Nt,t),ri)for(var s in ri)De(ri[s],t);for(var a in t)qt[a]&&(qt[a].items&&delete qt[a].items,qt[a].deleted&&delete qt[a].deleted,Ut.history[a]=qt[a],delete qt[a]),jn[a]&&delete jn[a];var o=t[Lt]?Bn:Lt;if(i(o),v(),ge(),t[Lt]?A(Bn):Lt==Xn&&t[ln]?(ln=Bn,dn.click()):A(Lt),et()){for(a in t)tt(a).remove();$("tr",hi).each(function(){var e=$(this).data();e.pos=qt[e.url].pos,$("td:eq(0)",this).html(e.pos+1)})}chrome.runtime.sendMessage({deleteTheseFeeds:t})}function Oe(e,t){if(e=e||{},un==t||hn==t){var n,i=un==t,s=i?an:on;t=i?un:hn,t.show(),n=t.outerWidth(),t.hide(),e.clientY=s.offset().top+s.outerHeight()-1,e.clientX=s.offset().left+s.outerWidth()-n-1}if(Ae(t)){t.show(),t.css("left",0),n=t.outerWidth(),t.hide();var a={};a.clientY=e.offset().top-0,a.clientX=e.offset().left-n-1,bn!=t&&yn!=t||(a.clientX=e.offset().left+e.outerWidth()-1),e=a}t.css({left:e.clientX-1,top:e.clientY-1}).fadeIn(100);var o=e.clientY+1+t.outerHeight(!0)-$(window).height();o>0&&t.css("top",e.clientY-o)}function Ae(e){var t=[fn,pn,mn,vn,gn,$n,bn,yn,kn,Cn,xn,Mn];for(var n in t)if(e==t[n])return!0}function ze(){$(".menu").hide(),an.add(on).removeClass("pressed")}function Re(e){ci.pause(),ci.src=e,$(ci).bind("canplaythrough",function(){$(this).unbind("canplaythrough"),ci.pause(),ci.currentTime=0,ci.volume=Ut.volume/100,ci.play()})}function Ge(e,t){function n(){var e=["beep","iphone2","iphone","ariel","carme","ceres","elara","europa","iapetus","io","rhea","salacia","tethys","titan"];e.forEach(function(e){a.push({name:e,path:chrome.extension.getURL(e+".mp3")})}),a.sort(i),o.sort(i),s()}function i(e,t){return r.compare(e.name,t.name)}function s(){var n,i;for(n=0;n<a.length;n++)i=a[n],t.append($("<div>"+i.name+"</div>").data(i).addClass(i.path==Ut.sound?"checked":""));for(o.length&&t.append($('<div class="separator"></div>')),n=0;n<o.length;n++)i=o[n],t.append($("<div>"+i.name+"</div>").data(i).addClass(i.path==Ut.sound?"checked":"").addClass("melody-user-file"));t.append($('<div class="separator"></div>')),t.append($('<div id="another-melody">'+i18n("upload")+"</div>")),Oe(e,t)}e=e||$("#notify-sound-tone",vn),t=t||gn,t.empty();var a=[],o=[],r=new Intl.Collator;window.requestFileSystem(1,1e8,function(e){e.root.getDirectory("sounds",{create:!0},function(e){var t=e.createReader();t.readEntries(function(e){e.forEach(function(e){e.isFile&&o.push({name:e.name,path:e.toURL()})}),n()})})})}function He(){var e=$(this).parent().data();e.name&&(On.detach(),Ue(e.name,function(){Ge()}))}function Fe(){$('<input type="file" accept="audio/*"/>').click().change(function(e){e.target.files.length&&qe(e.target.files[0],function(e,t){Ut.sound=t,Ge(),Re(t)})})}function qe(e,t){window.requestFileSystem(1,1e8,function(n){n.root.getDirectory("sounds",{create:!0},function(n){n.getFile(e.name,{create:!0},function(n){n.createWriter(function(i){i.onwrite=function(){t(e.name,n.toURL())},i.write(e)})})})})}function Ue(e,t){window.requestFileSystem(1,1e8,function(n){n.root.getDirectory("sounds",{create:!0},function(n){n.getFile(e,{create:!1},function(e){e.remove(function(){t&&t()})})})})}function Ne(e){function t(){var t=$("input.p-name",i.win).val().trim(),s=+$("option:selected",i.win).val(),a=!$("input.p-givename",i.win).prop("checked"),o=!1,r=!1,d={changeProperties:e};if(qt[e].useGivenName!=a&&(o=!0,r=!0,d.useGivenName=a,n.useGivenName=a),a&&qt[e].givenName!=t&&(o=!0,r=!0,n.givenName=t,d.givenName=t),qt[e].update!=s&&(o=!0,n.update=s,d.update=s),r&&($("div",de(e)).text(S(e)),Y()),o){chrome.runtime.sendMessage(d);var l=$.extend({},d);delete l.changeProperties;var c={};c[e]=l,Ze(c)}}var n=qt[e];if(n){var i=$(".settings",In).clone(),s="";$("input.p-name",i).val(S(e)).prop("disabled",!qt[e].useGivenName),$("input.p-givename",i).prop("checked",!qt[e].useGivenName).change(function(){var t,n=!$(this).prop("checked");n&&(t=s,t||(t=qt[e].givenName)),t||(t=qt[e].name),t||(t=e);var a=$("input.p-name",i.win);n||(s=a.val().trim()),a.val(t).prop("disabled",!n)}),$("input.p-address",i).val(e),$("select option[value="+qt[e].update+"]",i).prop("selected",!0),i=ue(i.contents(),i18n("properties"),t),$(".title",i.win).css({backgroundImage:"url("+(n.favIcon?n.favIcon:"16x16.png")+")"})}}function Pe(){setTimeout(function(){var e=rn.val().trim();ui!=e&&(ui=e,e?(ln||(ln=Lt),ri[e]||(ri[e]=je(e)),F(Xn),A(Xn)):(ln&&Lt==Xn&&A(z(ln)?ln:Bn),ln=null,delete jn[Xn]),e?dn.show():dn.hide())},1)}function Ye(){ui=null,rn.val("").change(),ri={},delete jn[Xn]}function Le(e){e.preventDefault()}function je(e){e=new RegExp(e,"i");var t=[];for(var n in jn[ln].items){var i=jn[ln].items[n];if(ln==Wn||!i.deleted){var s=i.feed,a=qt[s].name||"",o=qt[s].givenName||"";a&&a.search(e)>=0?t.push(i):o&&o.search(e)>=0?t.push(i):String(i.author).search(e)>=0?t.push(i):String(i.title).search(e)>=0&&t.push(i)}}return t}function Be(e,t){function n(){Bt.append($("<tr id='n-panel-451' class='top-panel'/>").append(Qt)).append($("<tr id='n-panel-452'/>").append(Zt)),Wt.attr("rowspan","3")}var i=$("body");if(oi!=e&&(oi==ni&&(i.addClass(e==ii?"vertical-layout":"list-layout"),e==ii?n():Qt.add(Zt).hide(),an.parent().append(on)),oi==ii&&(i.removeClass("vertical-layout"),Vt.append(Qt),Jt.append(Zt),$("#n-panel-451,#n-panel-452").remove(),Wt.removeAttr("rowspan"),e==ni&&Qt.append(on),e==si&&(Qt.add(Zt).hide(),i.addClass("list-layout"))),oi==si&&(i.removeClass("list-layout"),e==ni&&(Vt.append(Qt),Jt.append(Zt),Qt.append(on),Qt.add(Zt).show()),e==ii&&(i.addClass("vertical-layout"),n(),Qt.add(Zt).show())),chrome.runtime.sendMessage({changeLayout:e}),oi=e,Z(),t||Y(),di=!0,V(),e)){$("td",Sn).removeClass("selected desc");var s=$("td",Sn).eq(Ut.orderby==Kn?2:Ut.orderby==Vn?0:1).addClass(ai);Ut.order&&s.addClass("desc")}$("div",fn).removeClass(ai).filter("#"+(e==ni?"layout-sidebyside":e==ii?"layout-vertical":"layout-list")).addClass(ai),t||St()}function We(e,t,n){e.is(Sn)&&(Ut.orderby=0==t?Vn:1==t?Jn:Kn,Ut.order=+n,chrome.runtime.sendMessage({orderby:Ut.orderby,order:Ut.order}),Ee()),e.is(".win .content .feeds-list .rss-table-header")&&Ve(t,n)}function Ee(){w(),L(),B(),Xe()}function Xe(){ge(),Lt==Xn&&F(ln),A(Lt),St()}function Ke(){function e(e,t,n){return $("<td/>").text(t).appendTo(e).css({textAlign:n.align})}var t=$(".feeds-list",In).clone(),n=$(".rss-table-header",t);hi=$(".feeds-list-inner",t);var i={};for(var s in qt)i[s]=$.extend({url:s},qt[s]);for(var a=[{name:"№",align:"right"},{name:"group",align:"center"},{name:"name",align:"left"},{name:"URL",align:"left"},{name:"updating",align:"left"},{name:"added",align:"right"}],o=$("<tr/>"),r=0;r<a.length;r++){var d=$("<td><div>"+i18n(a[r].name)+"</div></td>");d.width("auto"),d.css("text-align","center"),r||d.addClass(ai),o.append(d)}n.append(o);for(s in i){var l=$("<tr/>");l.data(i[s]),e(l,i[s].pos+1,a[0]),e(l,i[s].group,a[1]),e(l,S(s),a[2]).css({backgroundImage:"url("+(i[s].favIcon?i[s].favIcon:"feeds.png")+")",backgroundPosition:"left center",paddingLeft:"20px",backgroundRepeat:"no-repeat"}),e(l,s,a[3]),e(l,Je(i[s].update),a[4]),e(l,x(new Date(i[s].added),!0),a[5]),$("table",hi).append(l)}Ve(0,0);var c={width:800,height:200};window.innerWidth<c.width+12&&(c.width=window.innerWidth-12),t=he(t,i18n("feeds"),0,c,function(){n.width(hi[0].clientWidth)})}function Ve(e,t){var n=$("table tr",hi).get(),i=new Intl.Collator;n.sort(function(n,s){return n=$(n).data(),s=$(s).data(),0==e?t?s.pos-n.pos:n.pos-s.pos:1==e?t?i.compare(s.group,n.group):i.compare(n.group,s.group):2==e?t?i.compare(S(s.url),S(n.url)):i.compare(S(n.url),S(s.url)):3==e?t?i.compare(s.url,n.url):i.compare(n.url,s.url):4==e?t?s.update-n.update:n.update-s.update:5==e?t?s.added-n.added:n.added-s.added:void 0}),$("table",hi).append(n)}function Je(e){var t="";if(0==e)t=i18n("never");else if(e<60)t=i18n("every_minutes",String(e));else if(60==e)t=i18n("every_hour");else if(10080==e)t=i18n("every_week");else{var n=e/60;t=2==n||3==n||24==n?i18n("every_hours1",String(n)):i18n("every_hours2",String(n))}return t}function Qe(e){$("tr",e).addClass(ai)}function Ze(e){if(et()){for(var t in e){var n=tt(t);$.extend(n.data(),e[t]),$("td:eq(0)",n).html(qt[t].pos+1),$("td:eq(1)",n).html(qt[t].group),$("td:eq(2)",n).html(S(t)),$("td:eq(4)",n).html(Je(qt[t].update))}var i=hi.closest(".content").find(".rss-table-header"),s=$("td.selected",i);We(i,s.index(),s.hasClass("desc"))}}function et(){return!!hi&&!!hi.closest("body").length}function tt(e){return $("tr",hi).filter(function(){return $(this).data("url")==e})}function nt(){window.locale="default"!=Ut.locale?Ut.locale:chrome.i18n.getMessage("locale"),tn.attr("title",i18n("update_all")),nn.attr("title",i18n("add_url")),rn.attr("placeholder",i18n("search_articles")),sn.attr("title",i18n("update_a_feed")),an.attr("title",i18n("sorting")),on.attr("title",i18n("settings")),$("#bytime",un).html(i18n("time")),$("#byauth",un).html(i18n("author")),$("#bysubj",un).html(i18n("subject")),$("#byadded",un).html(i18n("byadded")),$("#bydeleted",un).html(i18n("bydeleted")),$("#byasc",un).html(i18n("asc")),$("#bydesc",un).html(i18n("desc")),$("#manage-feeds",hn).html(i18n("feeds")+"..."),$("#select-layout",hn).html(i18n("layout")),$("#select-groups",hn).html(i18n("groups")),$("#select-theme",hn).html(i18n("theme")),$("#select-language",hn).html(i18n("language")),$("#select-notifications",hn).html(i18n("notifications")),$("#menu-import",hn).html(i18n("import")),$("#menu-export",hn).html(i18n("export")),$(".opml",xn).attr("title",i18n("feeds_list")),$(".tra",xn).attr("title",i18n("all_data")),$("#menu-history",hn).html(i18n("history")),$("#advanced-menu",hn).html(i18n("advanced")),$("#about-menu",hn).html(i18n("about")+"..."),$("#donate-menu",hn).html(i18n("donate")),$("#def-lang",mn).html(i18n("default")),$("#add-lang",mn).html(i18n("add_translation")+"..."),$("#group-feeds",pn).html(i18n("feeds")),$("#group-items",pn).html(i18n("messages")),$("#notify-show-popup",vn).html(i18n("system_tray")),$("#notify-play-sound",vn).html(i18n("play_sound")),$("#notify-sound-tone",vn).html(i18n("tone")),$("#notify-sound-volume",vn).html(i18n("volume")),$("#another-sound",gn).html(i18n("upload")),$(".properties",wn).html(i18n("properties")+"..."),$("#updating-menu",wn).html(i18n("updating")),$(".delete",wn).html(i18n("delete")),$(".group",wn).html(i18n("group")),$("td:eq(0) div",Sn).html(i18n("from")),$("td:eq(1) div",Sn).html(i18n("subject")),$("td:eq(2) div",Sn).html(i18n("published")),$(".ok_button",jt).val(i18n("ok")),$(".cancel_button",jt).val(i18n("cancel")),$(".close_button",jt).val(i18n("close")),$(".settings .p-name-td",In).html(i18n("name")),$(".settings .p-givename-span",In).html(i18n("get_the_name")),$(".settings .p-address-td",In).html(i18n("address")),$(".settings .p-update-td",In).html(i18n("update_menu")),$("#bright-theme",kn).html(i18n("bright_theme")),$("#dark-theme",kn).html(i18n("dark_theme")),$(".dev-toggle span",In).html(i18n("dev_mode")),$(".chrome-store",In).html(i18n("visit_website")),$(".send-feedback",In).html(i18n("send_feedback")),zn.data("data")&&Fn.text(k(new Date(zn.data("data").date))),bn.empty(),$(".settings .table-prop select option").each(function(){this.innerHTML=Je(this.value),bn.append($("<div/>").html(this.innerHTML).attr("interval",this.value))})}function it(){var e,t=$(".select-add-lang",In).clone(),n=$.extend({},fi);for(e in lingua.available_languages)n[e]&&delete n[e];n.zzz=i18n("another_language");var i,s=Object.keys(n).length,a=Math.ceil(Math.sqrt(5*s/2)),o=0;for(e in n)if(n.hasOwnProperty(e)){o%a||(i=$("<ul/>").appendTo(t));var r=$("<li/>").appendTo(i).data({l:e,n:n[e]});$("<div/>").html(n[e]).appendTo(r),++o}$("li",t).click(function(){var e=$(this).data(),t=Yn,n="lingua.js";$.ajax("chrome-extension://"+t+"/"+n,{dataType:"text"}).done(function(t){var n=new RegExp('"(\r\n|\n)\t}',"g");"zzz"==e.l&&(e.l=""),t=t.replace(n,'",\r\n\t\t"'+e.l+'": ""\r\n\t}'),st(t,"lingua.txt",function(e){e||at("lingua.txt",t)}),ce("<p style='text-align:center'>"+i18n("fill_gaps")+"<br/>"+i18n("then_send","holdenru@gmail.com")+"<br/>"+i18n("thank_you")+"</p>",e.n,function(){setTimeout(d.win.destroy,100)})})});var d=he(t,i18n("add_translation"))}function st(e,t,n){function i(e){n(!1,e)}window.requestFileSystem(1,1e8,function(s){s.root.getFile(t,{create:!0},function(s){var a=s.toURL();s.createWriter(function(s){var o=new Blob([e],{type:"text/plain"}),r=!0;s.onwrite=function(){if(r)r=!1,s.write(o);else{var e=document.createElement("a");e.setAttribute("href",a),e.setAttribute("download",t),e.click(),n&&n(!0,a)}},s.onerror=i,s.truncate(0)},i)},i)},i)}function at(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/x-opml;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.click()}function ot(e,t){e.addClass(t).siblings().removeClass(t)}function rt(e){var t=$(this).data("data"),n=jn[Lt];if(e.ctrlKey){var i=n.selected.indexOf(t);$(this).is(".selected")?(i>=0&&n.selected.splice(i,1),n.lastSelected==t&&(n.lastSelected=0)):i<0&&(n.selected.push(t),n.lastSelected=t)}else if(e.shiftKey)if(n.lastSelected){var s=n.items.indexOf(n.lastSelected),a=n.items.indexOf(t);s>a&&(s+=a,a=s-a,s-=a),n.selected=n.items.slice(s,a+1)}else n.selected=[t],n.lastSelected=t;else n.selected=[t],n.lastSelected=t;Kt.scroll(),ht(),St()}function dt(){var e=$(this).data("data").link;$(this).is(".selected")&&e&&$("<a target='_blank' href="+e+"/>")[0].click()}function lt(){var e=jn[Lt];e.selected=e.items.slice(0),e.lastSelected=0,Kt.scroll(),ht()}function ct(){var e=+$(this).attr("timegroup"),t=jn[Lt];t.selected=[];for(var n=0;n<t.items.length;n++)t.items[n].timeGroup==e&&t.selected.push(t.items[n]);t.lastSelected=0,Kt.scroll(),ht()}function ut(){var e=+$(this).attr("timegroup"),t=jn[Lt];t.selected=[];for(var n=0;n<t.items.length;n++)if(t.items[n].timeGroup==e){t.selected.push(t.items[n]);break}t.lastSelected=t.selected.length?t.selected[0]:0,Kt.scroll(),St(),ht()}function ht(){$(".feed,.feed-group",en).removeClass("hlight");var e=jn[Lt].selected.length;if(1==e){zn.show();var t=zn.data("data")||{},n=jn[Lt].selected[0];n.feed==t.feed&&n.id==t.id||(zn.data("data",n),pt(n)),n.seen||(n.seen=1,ft(),chrome.runtime.sendMessage({markSeen:1,feed:n.feed,guid:n.id})),de(n.feed).addClass("hlight"),R(qt[n.feed].group).addClass("hlight")}else zn.hide(),An.attr("seld",e?i18n("selected_items",String(e)):"")[(e?"add":"remove")+"Class"]("hasCount");_t()}function ft(){$(".item",Xt).removeData(),Kt.scroll()}function pt(e){if(!e.hasOwnProperty("description"))return void chrome.runtime.sendMessage({getDescription:1,feed:e.feed,id:e.id},function(t){e.description=$.parseHTML(t),pt(e)});An.data("item",e),qn[(e.pinned?"add":"remove")+"Class"]("pinned"),Gn.html($('<a target="_blank"/>').text(pi(e.title))),Hn.text(e.author||S(e.feed)),Fn.text(k(new Date(e.date))),Rn.html(e.description).scrollTop(0);var t=mt(e),n=vt(e,t);gt(t),$("a",Gn).attr("href",n),bt()}function mt(e){var t=qt[e.feed].baseURI;return t||(t=$t(e.link&&!e.link.match(/^.*:/)?e.link:e.feed)),t}function vt(e,t){var n=e.link||t,i=$('<p style="clear:both"><a class="external-link" href="'+n+'" target="_blank">'+i18n("full_article")+"</a></p>").appendTo(Rn);if(e.comments&&n!=e.comments&&i.append($("<a class='external-link' target='_blank'/>").html(i18n("comments")).attr("href",e.comments)),e.enclosure){i=$('<p style="clear:both"><a class="external-link donwload-link" href="'+e.enclosure+'" target="_blank"></a></p>');var s=e.enclosure.replace(/^.*\//,"").trim();if($("a",i).html(i18n("download")),s){var a=s;if(e.enclosureSize){var o=wt(e.enclosureSize);o&&(a+=" ("+o+")")}$("a",i).attr("download",s),s.match(/^.*:/)||$("a",i).html(a),e.enclosure.match(/^(?:f|ht)tps?:\/\//)||$("a",i).removeAttr("download")}Rn.prepend(i)}return n}function gt(e){$("a,img,iframe",Rn).each(function(){var t=$(this),n="src",i=t.is("a");i&&(t.attr("target","_blank"),n="href");var s=t.attr(n);void 0!==s&&(s.match(/^\/\//)&&(s=s.replace(/^\/\/(.*)$/,"http://$1"),t.attr(n,s)),s=s.replace(/^\/\/(.*)$/,"http://$1"),s.match(/^.*:/)||("/"!=s[0]&&(s="/"+s),s=e+s,t.attr(n,s)),!i||s.match(/^(?:f|ht)tps?:\/\//)&&!t.attr("download")||t.removeAttr("target"))})}function $t(e){var t=$("<a href='"+e+"'/>")[0];return t.protocol+"//"+t.host}function wt(e){if(e.match(/\D/))return e;e=+e;for(var t=[" B"," KB"," MB"," GB"," TB"," PB"],n=0;e>999;)e/=1024,n+=1;return Math.round(e)+t[n]}function bt(){Rn.css("top",Gn.parent().outerHeight())}function yt(e){var t=jn[Lt],n=t.selected.length,i=t.items.length,s=-1,a=i-1;n?s=1==n?t.items.indexOf(t.selected[0])+(e?1:-1):t.items.indexOf(e?t.selected[n-1]:t.selected[0])+(e?1:-1):i&&(s=e?0:a),s=s<0?0:s>a?a:s,t.selected=[t.items[s]],t.lastSelected=t.items[s],St(),Kt.scroll(),ht()}function kt(){var e=jn[Lt],t=e.items.length;t&&(e.selected=[e.items[t-1]],e.lastSelected=e.items[t-1],St(),Kt.scroll(),ht())}function Ct(){var e=jn[Lt],t=e.items.length;t&&(e.selected=[e.items[0]],e.lastSelected=e.items[0],St(),Kt.scroll(),ht())}function xt(){var e=jn[Lt],t=e.items.length,n=Kt[0].clientHeight,i=oi?21:45,s=Math.floor(n/i);t&&(1==e.selected.length?(s+=e.items.indexOf(e.selected[0]),s=s>=t?t-1:s,e.selected=[e.items[s]],e.lastSelected=e.items[s],St(),Kt.scroll(),ht()):Kt.scrollTop(Kt.scrollTop()+n))}function Mt(){var e=jn[Lt],t=e.items.length,n=Kt[0].clientHeight,i=oi?21:45,s=Math.floor(n/i);t&&(1==e.selected.length?(s=e.items.indexOf(e.selected[0])-s,s=s<0?0:s,e.selected=[e.items[s]],e.lastSelected=e.items[s],St(),Kt.scroll(),ht()):Kt.scrollTop(Kt.scrollTop()-n))}function St(){var e=jn[Lt];if(1==e.selected.length&&e.items.length){var t=e.items.indexOf(e.selected[0]);if(!(t<0)){var n=Kt.scrollTop(),i=Kt[0].clientHeight,s=oi?21:45,a=e.y[t]-n+s-i+(oi?24:0),o=e.y[t]-n-(Ut.orderby!=Kn&&Ut.orderby!=ei&&Ut.orderby!=ti||!Ut.showMilestones?0:21),r=a>0?a:o<0?o:0;Kt.scrollTop(n+r)}}}function _t(){var e=jn[Lt].selected,t=e.length;Un.removeClass(ai).add(Nn).add(Pn)[(t?"remove":"add")+"Class"]("disabled");for(var n=0,i=0,s=0;s<e.length;s++)e[s].read?++n:++i;var a=i<n;a&&Un.addClass(ai),Un.attr("title",t?i18n(a?"unread":"read"):""),Lt==Wn||Lt==Xn&&ln==Wn?Pn.show():Pn.hide()}function Tt(){if(!Un.is(".disabled")){for(var e=+!Un.hasClass(ai),t=[],n=jn[Lt].selected,i=0;i<n.length;i++)t.push({feed:n[i].feed,guid:n[i].id}),n[i].read=e;t.length&&chrome.runtime.sendMessage({markRead:1,read:e,items:t}),Ot(),I(),_t(),ft()}}function Dt(){function e(){var e=[];zt(Lt);for(var n=0;n<t.length;n++){var i=t[n];if(i.deleted){var s=Nt.indexOf(i);Nt.splice(s,1)}else i.deleted=Date.now();e.push({feed:i.feed,guid:i.id})}Xe(),e.length&&chrome.runtime.sendMessage({removeItems:1,items:e}),Ot()}if(!Un.is(".disabled")){var t=jn[Lt].selected.slice(0);if(t.length){w(t);var n,i=!1;for(n=0;n<t.length;n++)if(t[n].deleted){i=!0;break}if(i){var s=ue("{are-you-sure}",i18n("delete"),function(){e()});$(".title",s.win).css({backgroundImage:"url(delete.png)"})}else e()}}}function It(){if(!$(this).is(".disabled")){var e=jn[Lt],t=(e.items,e.selected.slice(0)),n=[];zt(Lt);for(var i=0;i<t.length;i++){var s=t[i];s.deleted&&(delete s.deleted,n.push({feed:s.feed,guid:s.id}))}Xe(),chrome.runtime.sendMessage({undelete:1,items:n}),Ot()}}function Ot(e){function t(e){var t=d(e);$("span",de(e)[(t?"add":"remove")+"Class"]("has-unread")).html(t||"")}if(e)t(e);else if(qt[Lt])t(Lt);else for(var n in qt)t(n);m()}function At(){var e=An.data("item");e&&(qn[((e.pinned=!e.pinned)?"add":"remove")+"Class"](En),Lt==En||Lt==Xn&&ln==En?(zt(Lt),Lt==Xn&&F(En),jn[Lt].needRebuild=!0,A(Lt)):(jn[En]&&(jn[En].needRebuild=!0),ft()),chrome.runtime.sendMessage({setPin:1,pin:e.pinned,items:[{feed:e.feed,guid:e.id}]}))}function zt(e){e=jn[e];var t=e.selected.slice(0);w(t);var n=e.items.indexOf(t[t.length-1])+1;e.items[n]?e.selected=[e.lastSelected=e.items[n]]:(n=e.items.indexOf(t[0])-1,e.items[n]?e.selected=[e.lastSelected=e.items[n]]:(e.selected=[],e.lastSelected=0))}function Rt(){Bt.css("-webkit-filter","blur(2px)");var e=$(".about-window",In).clone();chrome.management.get(Yn,function(t){$(".product-description h2",e).text(t.name),$(".product-description span:eq(0)",e).text(t.description),$(".product-description span:eq(1)",e).text("v"+t.version),e=ce(e,i18n("about"),function(){Bt.css("-webkit-filter","")}),$(".title",e.win).css({backgroundImage:"url(prop.png)"}),$(".dev-toggle",e.win).appendTo($(".buttons",e.win)),$(".chrome-store",e.win).on("click",function(){var e="http://chrome.google.com/webstore/detail/"+t.id;Gt(e)}),$(".send-feedback",e.win).on("click",function(){var e="http://chrome.google.com/webstore/support/"+t.id;Gt(e)}),$(".toggle-dev-on",e.win).prop("checked",!!Ut.developerMode).on("change",function(){chrome.runtime.sendMessage({changeOptions:1,options:{developerMode:Ut.developerMode=+this.checked}}),K()}),$(".about-container",e.win).on("click",function(e,t,n,i){var s=new Image;return s.src=i,function(){function s(){e.css("-webkit-transform","perspective(128px) rotateY("+t[0].rotate+"deg)"),n&&t[0].rotate>4590&&(n=!n,e[0].src=i)}t[0].end+=360,t.stop().animate({rotate:t[0].end},{step:s,complete:s,duration:1.5*(t[0].end-t[0].rotate),easing:"linear"})}}($(".about-container img",e.win),$({rotate:0,end:0}),!0,"ava.png"))})}function Gt(e){window.open(e,"_blank").focus()}function Ht(){var e,t=[];for(e in qt)t.push(e);if(Ut.history)for(e in Ut.history)t.push(e);Ft(t)}function Ft(e){e.length&&$.ajax({url:"http://holden.pro/TRA/feeds.php",crossDomain:!0,type:"POST",data:{feeds:e}})}window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;var qt,Ut,Nt,Pt,Yt,Lt,jt,Bt,Wt,Et,Xt,Kt,Vt,Jt,Qt,Zt,en,tn,nn,sn,an,on,rn,dn,ln,cn,un,hn,fn,pn,mn,vn,gn,$n,wn,bn,yn,kn,Cn,xn,Mn,Sn,_n,Tn,Dn,In,On,An,zn,Rn,Gn,Hn,Fn,qn,Un,Nn,Pn,Yn=chrome.i18n.getMessage("@@extension_id"),Ln="filesystem:chrome-extension://"+Yn+"/persistent/chrome-store.xml",jn={},Bn="all",Wn="trash",En="pinned",Xn="search",Kn=0,Vn=1,Jn=2,Qn=0,Zn=1,ei=3,ti=4,ni=0,ii=1,si=2,ai="selected",oi=0,ri={};$(E);var di,li=(new Date).getDate();$.fn.isDisabled=function(){return this.hasClass("disabled")},$.fn.disableSelection=function(){return this.attr("unselectable","on").css("user-select","none").on("selectstart",!1)},jQuery.extend(jQuery.easing,{easeInBack:function(e,t,n,i,s,a){return void 0==a&&(a=1.70158),i*(t/=s)*t*((a+1)*t-a)+n},easeOutBack:function(e,t,n,i,s,a){return void 0==a&&(a=1.70158),i*((t=t/s-1)*t*((a+1)*t+a)+1)+n}}),$(document).on("mousedown",".win",function(e){function t(e){var t=o+e.clientX-s,n=r+e.clientY-a;t=t<0?0:t>l?l:t,n=n<0?0:n>d?d:n,i.css({left:t,top:n})}function n(){$(document).unbind("mousemove",t).unbind("mouseup",n)}if(ze(),!$(this).is(".full-window")&&!$(e.target).is("input,option,select,a,.play_sound,label span,.vol-hand,.select-add-lang li,.select-add-lang li div,button")&&!$(e.target).closest(".feeds-list").length){var i=$(this),s=e.clientX,a=e.clientY,o=i.position().left,r=i.position().top,d=$(window).height()-i.outerHeight(!0),l=$(window).width()-i.outerWidth(!0);return $(document).bind("mousemove",t).bind("mouseup",n),!1}}),$(document).on("mousedown",".win .resizer",function(e){function t(e){var t=s+e.clientX-o,n=a+e.clientY-r;t=t<200?200:t,n=n<100?100:n,i.width(t).height(n),d&&d(i)}function n(){$(document).unbind("mousemove",t).unbind("mouseup",n),$("body").removeClass("nw-resizing")}var i=$(this).parents(".win").find(".content:eq(0)"),s=i.width(),a=i.height(),o=e.clientX,r=e.clientY,d=i.data("onresize");return $("body").addClass("nw-resizing"),$(document).bind("mousemove",t).bind("mouseup",n),!1}),$(document).on("keydown",function(e){27==e.keyCode&&ze()}),chrome.tabs.onActivated.addListener(ze),chrome.windows.onFocusChanged.addListener(ze);var ci=new Audio;$(document).on("mouseenter mouseleave",".menu .melody-user-file",function(e){"mouseenter"!=e.type||$(this).is(".checked")?On.detach():$(this).append(On)}),$(document).on("dblclick",".win .content .feeds-list .feeds-list-inner table tr",function(e){if(!e.shiftKey&&!e.ctrlKey){var t=$(this).data("url");t&&Ne(t)}});var ui;$(document).on("click","table.rss-table-header td",function(){var e=$(this);e.is(".selected")?e.toggleClass("desc"):e.addClass(ai).siblings().removeClass("selected desc"),We(e.closest("table"),e.index(),e.hasClass("desc"))});var hi=$();$(document).on("mousedown",".win .content .feeds-list .feeds-list-inner tr",function(e){var t=$(this);if(2!=e.button||!t.hasClass(ai))if(e.shiftKey){var n=this.parentNode.lastSelected;if(n&&n!=this){var i=n.rowIndex,s=this.rowIndex;i>s&&(i+=s,s=i-s,i-=s),t.parent().children().removeClass(ai).slice(i,s+1).addClass(ai)}else ot(t,ai)}else e.ctrlKey?t.toggleClass(ai):ot(t,ai),this.parentNode.lastSelected=this});var fi={ar:"‫‫العربية‬",bg:"‪български‬",ca:"‪català‬",cs:"‪čeština‬",da:"‪dansk‬",de:"‪Deutsch‬",en:"‪English‬","en-GB":"‪English (UK)‬","en-US":"‪English (United States)‬",es:"‪español‬","es-419":"‪español (Latinoamérica)‬",et:"‪eesti‬",el:"‪Ελληνικά‬",fil:"‪Filipino‬",fi:"‪suomi‬",fr:"‪Français‬",he:"‫עברית‬",hi:"‪हिन्दी‬",hr:"‪hrvatski‬",hu:"‪magyar‬",id:"‪Bahasa Indonesia‬",it:"‪italiano‬",ja:"‪日本語‬",ko:"‪한국어‬",lt:"‪lietuvių‬",lv:"‪latviešu‬",ms:"‪بهاس ملايو‬",nl:"‪Nederlands‬",no:"‪Norsk‬",pl:"‪polski‬","pt-BR":"‪português (Brasil)‬","pt-PT":"‪português (Portugal)‬",ro:"‪română‬",ru:"‪русский‬",sk:"‪slovenský‬",sl:"‪slovenščina‬",sr:"‪Српски‬",sv:"‪svenska‬",th:"‪ไทย‬",tr:"‪Türkçe‬",uk:"‪українська‬",vi:"‪Tiếng Việt‬","zh-CN":"‪中文 (简体)‬","zh-TW":"‪中文 (繁體)‬"};$(document).keydown(function(e){if(!$(e.target).is("input")){var t=$(".win .content .feeds-list table"),n=!!$("body>.hider").length;if(e.ctrlKey&&(65==e.keyCode||97==e.keyCode))return ze(),t.length?Qe(t):n||lt(),!1;if(!n){if(38==e.keyCode||40==e.keyCode)return yt(40==e.keyCode),!1;if(35==e.keyCode)return kt(),!1;if(36==e.keyCode)return Ct(),!1;if(34==e.keyCode)return xt(),!1;if(33==e.keyCode)return Mt(),!1;if(46==e.keyCode||8==e.keyCode)return Nn.click(),!1;if(13==e.keyCode&&1==jn[Lt].selected.length){var i=jn[Lt].selected[0].link;i&&$("<a target='_blank' href="+i+"/>")[0].click()}}}});var pi=function(){function e(e){return t.html(t.html(e).text()).text()}var t=$("<div/>");return e}();chrome.runtime.onMessage.addListener(function(e,t,n){if(e.command)return le(e.command,e,n)})});