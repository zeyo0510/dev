$(function(){function e(){window.locale="default"!=n.locale?n.locale:chrome.i18n.getMessage("locale"),$("title,#subscribe").text(i18n("subscribe")),$("#learn a").text(i18n("learn_more")).attr("href",i18n("wiki")),$("#footer span").text(i18n("generated_by")+" ")}function t(e){if(e){var t="";e.baseURI&&(t=e.baseURI);var n=document.implementation.createHTMLDocument();t||(t=$("<a/>",n).attr("href",i)[0],t=t.protocol+"//"+t.host);var o=e.title?e.title:i;$("h1:eq(0)").text(o),$(".loading").removeClass("loading"),$("#footer a").text(i).attr("href","view-source:"+i);for(var c=0;c<e.items.length;c++){var s=e.items[c],l=$.parseHTML(s.descr,n);s=$('<li><h2><a href="'+s.link+'">'+s.title+"</a></h2><p>"+s.date+"<br/>"+s.author+"</p><div></div></li>",n),$("div",s).append(l),$("table,tbody,tr,td",s).each(function(){var e=$(this).children();e.unwrap(),e.wrap("<div></div>")}),s.appendTo("#itemsUl")}r(t),$("#subscribe").click(function(){chrome.runtime.sendMessage({subscribe:i,name:o})})}else a()}function a(){$("title").text("=("),$("#loading").css("background-image","none").html(i18n("cannot_load")+" <a href='"+i+"'>"+i+"</a>")}function r(e){$("li a,li img").each(function(){var t=$(this),a="src",r=t.is("a");r&&(t.attr("target","_blank"),a="href");var n=t.attr(a);void 0!==n&&(n.match(/^.*:/)||("/"!=n[0]&&(n="/"+n),n=e+n,t.attr(a,n)),!r||n.match(/^(?:f|ht)tps?:\/\//)&&!t.attr("download")||t.removeAttr("target"))})}var n;chrome.runtime.sendMessage({getOptions:1},function(t){n=t.options,e()});var i=window.pleaseSubscribeToThisUrl||JSON.parse(decodeURIComponent(location.search.substr(1))).url;chrome.runtime.onMessage.addListener(function(t,a,r){return t.favIcon?($("#wrapper>h1").css("background-image","url("+t.favIcon+")"),void $("#favicon").attr("href",t.favIcon)):t.command&&"languageChanged"==t.command?(n.locale=t.locale,void e()):void 0}),chrome.runtime.sendMessage({parseUrl:i},t)});